import{V as j,d as q,c as B}from"./index-C1TKk8vI.js";import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{R as x}from"./TabNews-DPESzVct.js";import F from"./main-CCmna8Q9.js";import G from"./MsgList-aBqr6GeG.js";import{g as K}from"./index-DtRh1LY9.js";import{f as X,aj as P}from"./form-designer-BpYekVAY.js";import{x as U,r as c,X as H,j as A,y as p,E as L,F as T,C as f,G as O,u as s,z as y,J as b,O as S,l as Q,K as Y,n as V}from"./form-create-7GAbgMwl.js";const C=_=>j.get({url:"/mp/message/page",params:_}),Z={key:0},$={key:1,class:"el-table__empty-block"},ee={class:"msg-send"},R=B(U({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(_){const E=q(),I=_,m=c(-1),d=c(!1),k=c(!0),i=c([]),r=H({pageNo:1,pageSize:14,accountId:m}),o=H({nickname:"\u7528\u6237",avatar:"/assets/profile-BiJdjH9E.jpg",accountId:m}),h=c(!1),l=c({type:x.Text,accountId:-1,articles:[]}),N=c(null),t=c(null);A(async()=>{var e,u;const a=await K(I.userId);o.nickname=((e=a.nickname)==null?void 0:e.length)>0?a.nickname:o.nickname,o.avatar=((u=o.avatar)==null?void 0:u.length)>0?a.avatar:o.avatar,m.value=a.accountId,l.value.accountId=a.accountId,W()});const J=async()=>{var e;if(!s(l))return;l.value.type===x.News&&l.value.articles&&l.value.articles.length>1&&(l.value.articles=[l.value.articles[0]],E.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(u=>j.post({url:"/mp/message/send",data:u}))({userId:I.userId,...l.value});h.value=!1,i.value=[...i.value,a],await z(),(e=N.value)==null||e.clear()},M=()=>{r.pageNo++,w(r,null)},w=async(a,e=null)=>{var g;d.value=!0;let u=await C(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:I.userId,accountId:a.accountId},e));const v=((g=t.value)==null?void 0:g.scrollHeight)??0,n=u.list.reverse();i.value=[...n,...i.value],d.value=!1,(n.length<r.pageSize||n.length===0)&&(k.value=!1),r.pageNo=a.pageNo,r.pageSize=a.pageSize,r.pageNo===1?await z():n.length!==0&&(await V(),v!==0&&t.value&&(t.value.scrollTop=t.value.scrollHeight-v-100))},W=()=>{w(r)},z=async()=>{await V(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return(a,e)=>{const u=X,v=D,n=P;return p(),L(v,null,{default:T(()=>[f("div",{class:"msg-div",ref_key:"msgDivRef",ref:t},[O(f("div",null,null,512),[[n,s(d)]]),s(d)?b("",!0):(p(),y("div",Z,[s(k)?(p(),y("div",{key:0,class:"el-table__empty-block",onClick:M},e[1]||(e[1]=[f("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1)]))):b("",!0),s(k)?b("",!0):(p(),y("div",$,e[2]||(e[2]=[f("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1)])))])),S(G,{list:s(i),"account-id":s(m),user:s(o)},null,8,["list","account-id","user"])],512),O((p(),y("div",ee,[S(s(F),{ref_key:"replySelectRef",ref:N,modelValue:s(l),"onUpdate:modelValue":e[0]||(e[0]=g=>Q(l)?l.value=g:null)},null,8,["modelValue"]),S(u,{type:"success",class:"send-but",onClick:J},{default:T(()=>e[3]||(e[3]=[Y("\u53D1\u9001(S)")])),_:1})])),[[n,s(h)]])]),_:1})}}}),[["__scopeId","data-v-66e296ab"]]),ae=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));export{R as W,C as g,ae as m};
