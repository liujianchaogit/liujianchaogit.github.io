import{d as ea,_ as ta,c as ia}from"./index-DiGvuAxb.js";import{k as sa,r as C,a3 as la,b as na,e as oa,y as I,m as d,z as t,v as u,H as e,E as T,h as j,u as o,C as S,l as x,$ as q,F as G,G as H,B as ra,A as ca,I as ua,M as E}from"./form-create-D7wT855o.js";import{C as w}from"./index-BnSnpYRs.js";import va from"./RoleRepository-CblW3ki2.js";import{T as da,f as pa,k as ma,aN as Ca,a6 as ya,b as fa,aO as ha,aP as ka,aF as wa,O as _a,M as ga}from"./form-designer-drfGvdgz.js";import{r as Ma}from"./gpt-WhTktY3S.js";import"./RoleHeader-CvEUfQh3.js";import"./RoleList-DI5JP5xy.js";import"./ChatRoleForm.vue_vue_type_script_setup_true_lang-XtFwfXNX.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./constants-C3gLHYOK.js";import"./index-DJwvf2H9.js";import"./constants-CHvLs4wt.js";import"./index-BjDTSUtW.js";import"./index-BNzDiiC2.js";import"./RoleCategoryList-DDqRDAga.js";const ba={class:"h-100%"},xa={class:"conversation-list"},Va={key:0,class:"conversation-item classify-title"},za=["onClick","onMouseover"],Ia={class:"title-wrapper"},Ta=["src"],Sa={class:"title"},Da={class:"button-wrapper"},Fa={class:"tool-box"},Oa=ia(sa({__name:"ConversationList",props:{activeId:{type:String||null,required:!0}},emits:["onConversationCreate","onConversationClick","onConversationClear","onConversationDelete"],setup(K,{expose:N,emit:Y}){const V=ea(),_=C(""),p=C(null),D=C(null),r=C([]),y=C({}),z=C(!1),F=C(),O=K,f=Y,J=async s=>{if(_.value.trim().length){const a=r.value.filter(l=>l.title.includes(_.value.trim()));y.value=await U(a)}else y.value=await U(r.value)},L=async s=>{const a=r.value.filter(l=>l.id===s);f("onConversationClick",a[0])&&(p.value=s)},h=async()=>{try{if(F.value=setTimeout(()=>{z.value=!0},50),r.value=await w.getChatConversationMyList(),r.value.sort((s,a)=>a.createTime-s.createTime),r.value.length===0)return p.value=null,void(y.value={});y.value=await U(r.value)}finally{F.value&&clearTimeout(F.value),z.value=!1}},U=async s=>{const a={\u7F6E\u9876:[],\u4ECA\u5929:[],\u4E00\u5929\u524D:[],\u4E09\u5929\u524D:[],\u4E03\u5929\u524D:[],\u4E09\u5341\u5929\u524D:[]},l=Date.now(),v=864e5,$=3*v,A=7*v,M=30*v;for(const i of s){if(i.pinned){a.\u7F6E\u9876.push(i);continue}const k=l-i.createTime;k<v?a.\u4ECA\u5929.push(i):k<$?a.\u4E00\u5929\u524D.push(i):k<A?a.\u4E09\u5929\u524D.push(i):k<M?a.\u4E03\u5929\u524D.push(i):a.\u4E09\u5341\u5929\u524D.push(i)}return a},P=async()=>{const s=await w.createChatConversationMy({});await h(),await L(s),f("onConversationCreate")},Q=async()=>{try{await V.confirm("\u786E\u8BA4\u540E\u5BF9\u8BDD\u4F1A\u5168\u90E8\u6E05\u7A7A\uFF0C\u7F6E\u9876\u7684\u5BF9\u8BDD\u9664\u5916\u3002"),await w.deleteChatConversationMyByUnpinned(),ga({message:"\u64CD\u4F5C\u6210\u529F!",type:"success"}),p.value=null,await h(),f("onConversationClear")}catch{}},g=C(!1),R=async()=>{g.value=!g.value},{activeId:W}=la(O);return na(W,async(s,a)=>{p.value=s}),N({createConversation:P}),oa(async()=>{await h(),O.activeId?p.value=O.activeId:r.value.length&&(p.value=r.value[0].id,await f("onConversationClick",r.value[0]))}),(s,a)=>{const l=ta,v=pa,$=ma,A=Ca,M=ya,i=fa,k=wa,X=da;return d(),I(X,{width:"260px",class:"conversation-container h-100%"},{default:t(()=>[u("div",ba,[e(v,{class:"w-1/1 btn-new-conversation",type:"primary",onClick:P},{default:t(()=>[e(l,{icon:"ep:plus",class:"mr-5px"}),a[3]||(a[3]=T(" \u65B0\u5EFA\u5BF9\u8BDD "))]),_:1}),e($,{modelValue:o(_),"onUpdate:modelValue":a[0]||(a[0]=m=>j(_)?_.value=m:null),size:"large",class:"mt-10px search-input",placeholder:"\u641C\u7D22\u5386\u53F2\u8BB0\u5F55",onKeyup:J},{prefix:t(()=>[e(l,{icon:"ep:search"})]),_:1},8,["modelValue"]),u("div",xa,[o(z)?(d(),I(A,{key:0,description:".","v-loading":o(z)},null,8,["v-loading"])):S("",!0),(d(!0),x(H,null,q(Object.keys(o(y)),m=>(d(),x("div",{key:m},[o(y)[m].length?(d(),x("div",Va,[e(M,{class:"mx-1",size:"small",tag:"b"},{default:t(()=>[T(G(m),1)]),_:2},1024)])):S("",!0),(d(!0),x(H,null,q(o(y)[m],n=>(d(),x("div",{class:"conversation-item",key:n.id,onClick:b=>L(n.id),onMouseover:b=>D.value=n.id,onMouseout:a[1]||(a[1]=b=>D.value="")},[u("div",{class:ra(n.id===o(p)?"conversation active":"conversation")},[u("div",Ia,[u("img",{class:"avatar",src:n.roleAvatar||o(Ma)},null,8,Ta),u("span",Sa,G(n.title),1)]),ca(u("div",Da,[e(v,{class:"btn",link:"",onClick:E(b=>(async c=>{c.pinned=!c.pinned,await w.updateChatConversationMy(c),await h()})(n),["stop"])},{default:t(()=>[n.pinned?S("",!0):(d(),I(i,{key:0,title:"\u7F6E\u9876"},{default:t(()=>[e(o(ha))]),_:1})),n.pinned?(d(),I(i,{key:1,title:"\u7F6E\u9876"},{default:t(()=>[e(o(ka))]),_:1})):S("",!0)]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:E(b=>(async c=>{const{value:Z}=await _a.prompt("\u4FEE\u6539\u6807\u9898",{inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",inputValue:c.title});await w.updateChatConversationMy({id:c.id,title:Z}),V.success("\u91CD\u547D\u540D\u6210\u529F"),await h();const B=r.value.filter(aa=>aa.id===c.id);B.length>0&&p.value===B[0].id&&f("onConversationClick",B[0])})(n),["stop"])},{default:t(()=>[e(i,{title:"\u7F16\u8F91"},{default:t(()=>[e(l,{icon:"ep:edit"})]),_:1})]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:E(b=>(async c=>{try{await V.delConfirm(`\u662F\u5426\u786E\u8BA4\u5220\u9664\u5BF9\u8BDD - ${c.title}?`),await w.deleteChatConversationMy(c.id),V.success("\u5BF9\u8BDD\u5DF2\u5220\u9664"),await h(),f("onConversationDelete",c)}catch{}})(n),["stop"])},{default:t(()=>[e(i,{title:"\u5220\u9664\u5BF9\u8BDD"},{default:t(()=>[e(l,{icon:"ep:delete"})]),_:1})]),_:2},1032,["onClick"])],512),[[ua,o(D)===n.id]])],2)],40,za))),128))]))),128)),a[4]||(a[4]=u("div",{class:"h-160px w-100%"},null,-1))])]),u("div",Fa,[u("div",{onClick:R},[e(l,{icon:"ep:user"}),e(M,{size:"small"},{default:t(()=>a[5]||(a[5]=[T("\u89D2\u8272\u4ED3\u5E93")])),_:1})]),u("div",{onClick:Q},[e(l,{icon:"ep:delete"}),e(M,{size:"small"},{default:t(()=>a[6]||(a[6]=[T("\u6E05\u7A7A\u672A\u7F6E\u9876\u5BF9\u8BDD")])),_:1})])]),e(k,{modelValue:o(g),"onUpdate:modelValue":a[2]||(a[2]=m=>j(g)?g.value=m:null),title:"\u89D2\u8272\u4ED3\u5E93",size:"754px"},{default:t(()=>[e(va)]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-baef00d5"]]);export{Oa as default};
