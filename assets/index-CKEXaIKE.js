import{a as ra,d as na,u as sa,h as ia,D as I,_ as da}from"./index-DiGvuAxb.js";import{_ as pa}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{_ as ua}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{_ as ca}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as ma}from"./index-BrNbcFk-.js";import{k as fa,r as g,P as _a,e as ya,af as ba,l as L,m as s,H as e,z as l,u as t,Z as B,G as E,$ as ga,y as i,A as m,E as d,F as ha,C as P}from"./form-create-D7wT855o.js";import{c as R}from"./permission-DHNmNb_V.js";import{_ as wa}from"./JobForm.vue_vue_type_script_setup_true_lang-BtH6u9t_.js";import{_ as ka}from"./JobDetail.vue_vue_type_script_setup_true_lang-BEwVx5zT.js";import{d as va}from"./download-oWiM5xVU.js";import{b as ja,e as xa,d as Ca,f as Na,r as Sa}from"./index-DW44UPfZ.js";import{f as w}from"./constants-C3gLHYOK.js";import{h as Oa,ai as Pa,k as Ra,x as Va,Q as Ta,f as Ua,Z as Aa,_ as qa,a1 as za,a2 as Fa,a3 as Ja,aj as Da}from"./form-designer-drfGvdgz.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./formatTime-DeTj2b0K.js";const Ia=fa({name:"InfraJob",__name:"index",setup(La){const{t:x}=ra(),f=na(),{push:K}=sa(),C=g(!0),V=g(0),T=g([]),n=_a({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),U=g(),N=g(!1),_=async()=>{C.value=!0;try{const r=await ja(n);T.value=r.list,V.value=r.total}finally{C.value=!1}},k=()=>{n.pageNo=1,_()},Q=()=>{U.value.resetFields(),k()},Z=async()=>{try{await f.exportConfirm(),N.value=!0;const r=await xa(n);va.excel(r,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},A=g(),q=(r,a)=>{A.value.open(r,a)},G=async r=>{try{await f.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+r.name+"?",x("common.reminder")),await Sa(r.id),f.success("\u6267\u884C\u6210\u529F"),await _()}catch{}},z=g(),H=r=>{z.value.open(r)},F=r=>{K(r&&r>0?"/job/job-log?id="+r:"/job/job-log")};return ya(()=>{_()}),(r,a)=>{const S=ma,J=Ra,v=Pa,M=Ta,X=Va,h=da,p=Ua,$=Oa,D=ca,y=qa,W=ua,O=Ja,Y=Fa,aa=za,ea=Aa,la=pa,b=ba("hasPermi"),oa=Da;return s(),L(E,null,[e(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),e(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),e(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),e(D,null,{default:l(()=>[e($,{class:"-mb-15px",model:t(n),ref_key:"queryFormRef",ref:U,inline:!0,"label-width":"100px"},{default:l(()=>[e(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:l(()=>[e(J,{modelValue:t(n).name,"onUpdate:modelValue":a[0]||(a[0]=o=>t(n).name=o),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:B(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:l(()=>[e(X,{modelValue:t(n).status,"onUpdate:modelValue":a[1]||(a[1]=o=>t(n).status=o),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(s(!0),L(E,null,ga(t(ia)(t(I).INFRA_JOB_STATUS),o=>(s(),i(M,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:l(()=>[e(J,{modelValue:t(n).handlerName,"onUpdate:modelValue":a[2]||(a[2]=o=>t(n).handlerName=o),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:B(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(v,null,{default:l(()=>[e(p,{onClick:k},{default:l(()=>[e(h,{icon:"ep:search",class:"mr-5px"}),a[7]||(a[7]=d(" \u641C\u7D22"))]),_:1}),e(p,{onClick:Q},{default:l(()=>[e(h,{icon:"ep:refresh",class:"mr-5px"}),a[8]||(a[8]=d(" \u91CD\u7F6E"))]),_:1}),m((s(),i(p,{type:"primary",plain:"",onClick:a[3]||(a[3]=o=>q("create"))},{default:l(()=>[e(h,{icon:"ep:plus",class:"mr-5px"}),a[9]||(a[9]=d(" \u65B0\u589E "))]),_:1})),[[b,["infra:job:create"]]]),m((s(),i(p,{type:"success",plain:"",onClick:Z,loading:t(N)},{default:l(()=>[e(h,{icon:"ep:download",class:"mr-5px"}),a[10]||(a[10]=d(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[b,["infra:job:export"]]]),m((s(),i(p,{type:"info",plain:"",onClick:a[4]||(a[4]=o=>F())},{default:l(()=>[e(h,{icon:"ep:zoom-in",class:"mr-5px"}),a[11]||(a[11]=d(" \u6267\u884C\u65E5\u5FD7 "))]),_:1})),[[b,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(D,null,{default:l(()=>[m((s(),i(ea,{data:t(T)},{default:l(()=>[e(y,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),e(y,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),e(y,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:l(o=>[e(W,{type:t(I).INFRA_JOB_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),e(y,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),e(y,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),e(y,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),e(y,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:l(o=>[m((s(),i(p,{type:"primary",link:"",onClick:j=>q("update",o.row.id)},{default:l(()=>a[12]||(a[12]=[d(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[b,["infra:job:update"]]]),m((s(),i(p,{type:"primary",link:"",onClick:j=>(async u=>{try{const c=u.status===w.STOP?"\u5F00\u542F":"\u5173\u95ED";await f.confirm("\u786E\u8BA4\u8981"+c+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+u.id+'"\u7684\u6570\u636E\u9879?',x("common.reminder"));const ta=u.status===w.STOP?w.NORMAL:w.STOP;await Ca(u.id,ta),f.success(c+"\u6210\u529F"),await _()}catch{}})(o.row)},{default:l(()=>[d(ha(o.row.status===t(w).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[b,["infra:job:update"]]]),m((s(),i(p,{type:"danger",link:"",onClick:j=>(async u=>{try{await f.delConfirm(),await Na(u),f.success(x("common.delSuccess")),await _()}catch{}})(o.row.id)},{default:l(()=>a[13]||(a[13]=[d(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[b,["infra:job:delete"]]]),m((s(),i(aa,{onCommand:j=>((u,c)=>{switch(u){case"handleRun":G(c);break;case"openDetail":H(c.id);break;case"handleJobLog":F(c==null?void 0:c.id)}})(j,o.row)},{dropdown:l(()=>[e(Y,null,{default:l(()=>[t(R)(["infra:job:trigger"])?(s(),i(O,{key:0,command:"handleRun"},{default:l(()=>a[15]||(a[15]=[d(" \u6267\u884C\u4E00\u6B21 ")])),_:1})):P("",!0),t(R)(["infra:job:query"])?(s(),i(O,{key:1,command:"openDetail"},{default:l(()=>a[16]||(a[16]=[d(" \u4EFB\u52A1\u8BE6\u7EC6 ")])),_:1})):P("",!0),t(R)(["infra:job:query"])?(s(),i(O,{key:2,command:"handleJobLog"},{default:l(()=>a[17]||(a[17]=[d(" \u8C03\u5EA6\u65E5\u5FD7 ")])),_:1})):P("",!0)]),_:1})]),default:l(()=>[e(p,{type:"primary",link:""},{default:l(()=>[e(h,{icon:"ep:d-arrow-right"}),a[14]||(a[14]=d(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[b,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[oa,t(C)]]),e(la,{total:t(V),page:t(n).pageNo,"onUpdate:page":a[5]||(a[5]=o=>t(n).pageNo=o),limit:t(n).pageSize,"onUpdate:limit":a[6]||(a[6]=o=>t(n).pageSize=o),onPagination:_},null,8,["total","page","limit"])]),_:1}),e(wa,{ref_key:"formRef",ref:A,onSuccess:_},null,512),e(ka,{ref_key:"detailRef",ref:z},null,512)],64)}}});export{Ia as default};
