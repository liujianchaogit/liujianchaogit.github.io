import{e as Y,D as G,b as j,d as z,L as v}from"./index-C1TKk8vI.js";import{_ as H}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{T as J}from"./ThingModelProperty-NqM8AZt3.js";import q from"./ThingModelService-C_EkPIPB.js";import A from"./ThingModelEvent-HZDgEV4h.js";import{T as E}from"./index-BGHavkVr.js";import{T as s,D as r,a as B}from"./config-6hyG0uwh.js";import{K as Q,t as W,s as X,ai as Z,k as $,h as ee,f as ae,aj as le}from"./form-designer-BpYekVAY.js";import{x as te,r as m,y as i,E as c,F as o,O as p,K as I,u as l,G as de,z as oe,a4 as pe,L as re,M as se,J as R,l as ue,i as ie}from"./form-create-7GAbgMwl.js";const U={PRODUCT:"IOT_PRODUCT"},ne=te({name:"IoTThingModelForm",__name:"ThingModelForm",emits:["success"],setup(me,{expose:b,emit:g}){const N=ie(U.PRODUCT),{t:T}=j(),P=z(),u=m(!1),h=m(""),n=m(!1),O=m(""),a=m({type:s.PROPERTY,dataType:r.INT,property:{dataType:r.INT,dataSpecs:{dataType:r.INT}},service:{},event:{}}),f=m();b({open:async(e,t)=>{if(u.value=!0,h.value=T("action."+e),O.value=e,D(),t){n.value=!0;try{a.value=await E.getThingModel(t),v(a.value.property)&&(a.value.dataType=r.INT,a.value.property={dataType:r.INT,dataSpecs:{dataType:r.INT}}),v(a.value.service)&&(a.value.service={}),v(a.value.event)&&(a.value.event={})}finally{n.value=!1}}},close:()=>u.value=!1});const k=g,w=async()=>{await f.value.validate(),n.value=!0;try{const e=Q(a.value);e.productId=N.value.id,e.productKey=N.value.productKey,C(e),O.value==="create"?(await E.createThingModel(e),P.success(T("common.createSuccess"))):(await E.updateThingModel(e),P.success(T("common.updateSuccess")))}finally{u.value=!1,k("success"),n.value=!1}},C=e=>{e.type===s.PROPERTY&&(V(e.property),e.dataType=e.property.dataType,e.property.identifier=e.identifier,e.property.name=e.name,delete e.service,delete e.event),e.type===s.SERVICE&&(V(e.service),e.dataType=e.service.dataType,e.service.identifier=e.identifier,e.service.name=e.name,delete e.property,delete e.event),e.type===s.EVENT&&(V(e.event),e.dataType=e.event.dataType,e.event.identifier=e.identifier,e.event.name=e.name,delete e.property,delete e.service)},V=e=>{v(e.dataSpecs)&&delete e.dataSpecs,v(e.dataSpecsList)&&delete e.dataSpecsList},D=()=>{var e;a.value={type:s.PROPERTY,dataType:r.INT,property:{dataType:r.INT,dataSpecs:{dataType:r.INT}},service:{},event:{}},(e=f.value)==null||e.resetFields()};return(e,t)=>{const M=W,x=X,y=Z,_=$,L=ee,S=ae,F=H,K=le;return i(),c(F,{modelValue:l(u),"onUpdate:modelValue":t[8]||(t[8]=d=>ue(u)?u.value=d:null),title:l(h)},{footer:o(()=>[p(S,{disabled:l(n),type:"primary",onClick:w},{default:o(()=>t[9]||(t[9]=[I("\u786E \u5B9A")])),_:1},8,["disabled"]),p(S,{onClick:t[7]||(t[7]=d=>u.value=!1)},{default:o(()=>t[10]||(t[10]=[I("\u53D6 \u6D88")])),_:1})]),default:o(()=>[de((i(),c(L,{ref_key:"formRef",ref:f,model:l(a),rules:l(B),"label-width":"100px"},{default:o(()=>[p(y,{label:"\u529F\u80FD\u7C7B\u578B",prop:"type"},{default:o(()=>[p(x,{modelValue:l(a).type,"onUpdate:modelValue":t[0]||(t[0]=d=>l(a).type=d)},{default:o(()=>[(i(!0),oe(se,null,pe(l(Y)(l(G).IOT_THING_MODEL_TYPE),d=>(i(),c(M,{key:d.value,value:d.value},{default:o(()=>[I(re(d.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(y,{label:"\u529F\u80FD\u540D\u79F0",prop:"name"},{default:o(()=>[p(_,{modelValue:l(a).name,"onUpdate:modelValue":t[1]||(t[1]=d=>l(a).name=d),placeholder:"\u8BF7\u8F93\u5165\u529F\u80FD\u540D\u79F0"},null,8,["modelValue"])]),_:1}),p(y,{label:"\u6807\u8BC6\u7B26",prop:"identifier"},{default:o(()=>[p(_,{modelValue:l(a).identifier,"onUpdate:modelValue":t[2]||(t[2]=d=>l(a).identifier=d),placeholder:"\u8BF7\u8F93\u5165\u6807\u8BC6\u7B26"},null,8,["modelValue"])]),_:1}),l(a).type===l(s).PROPERTY?(i(),c(J,{key:0,modelValue:l(a).property,"onUpdate:modelValue":t[3]||(t[3]=d=>l(a).property=d)},null,8,["modelValue"])):R("",!0),l(a).type===l(s).SERVICE?(i(),c(q,{key:1,modelValue:l(a).service,"onUpdate:modelValue":t[4]||(t[4]=d=>l(a).service=d)},null,8,["modelValue"])):R("",!0),l(a).type===l(s).EVENT?(i(),c(A,{key:2,modelValue:l(a).event,"onUpdate:modelValue":t[5]||(t[5]=d=>l(a).event=d)},null,8,["modelValue"])):R("",!0),p(y,{label:"\u63CF\u8FF0",prop:"description"},{default:o(()=>[p(_,{modelValue:l(a).description,"onUpdate:modelValue":t[6]||(t[6]=d=>l(a).description=d),maxlength:200,rows:3,placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027\u63CF\u8FF0",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[K,l(n)]])]),_:1},8,["modelValue","title"])}}});export{U as I,ne as _};
