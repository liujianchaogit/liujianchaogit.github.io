import{e as X,D as Y,b as z,d as H,a as J}from"./index-C1TKk8vI.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{a as Z}from"./index-DZT3uREC.js";import{a as $,c as ee,u as ae}from"./index-pmRUIUos.js";import{g as le}from"./index-CZiMqbPE.js";import{a as de}from"./index-Bdw660V1.js";import{d as te}from"./index-DdKGlDdM.js";import{k as re,ai as ue,j as oe,Q as se,x as ne,i as ie,l as ce,F as pe,h as me,f as fe,aj as ve}from"./form-designer-BpYekVAY.js";import{x as be,r as c,X as _e,y as i,E as m,F as r,O as t,K as M,u as d,G as Ie,z as V,a4 as y,M as w,l as Ve}from"./form-create-7GAbgMwl.js";const ye=be({__name:"ReceivableForm",emits:["success"],setup(we,{expose:P,emit:S}){const{t:k}=z(),x=H(),C=c([]),f=c(!1),R=c(""),v=c(!1),p=c(""),a=c({}),j=_e({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],price:[{required:!0,message:"\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=c(),E=c([]),h=c([]),U=c([]);P({open:async(u,l,o)=>{var n;if(f.value=!0,R.value=k("action."+u),p.value=u,D(),l){v.value=!0;try{const s=await $(l);a.value=s,await T(s.customerId),a.value.contractId=(n=s==null?void 0:s.contract)==null?void 0:n.id}finally{v.value=!1}}C.value=await le(),E.value=await de(),p.value==="create"&&(a.value.ownerUserId=J().getUser.id),o&&(a.value.customerId=o.customerId,await T(o.customerId),a.value.contractId=o.contractId,await q(o.contractId),o.id&&(a.value.planId=o.id,a.value.price=o.price,a.value.returnType=o.returnType))}});const A=S,B=async()=>{if(g&&await g.value.validate()){v.value=!0;try{const u=a.value;p.value==="create"?(await ee(u),x.success(k("common.createSuccess"))):(await ae(u),x.success(k("common.updateSuccess"))),f.value=!1,A("success")}finally{v.value=!1}}},D=()=>{var u;a.value={},(u=g.value)==null||u.resetFields()},T=async u=>{a.value.contractId=void 0,u&&(h.value=[],h.value=await te(u))},q=async u=>{if(a.value.planId=void 0,u){U.value=[],U.value=await Z(a.value.customerId,u);const l=h.value.find(o=>o.id===u);l&&(a.value.price=l.totalPrice-l.totalReceivablePrice)}},G=u=>{if(!u)return;const l=U.value.find(o=>o.id===u);l&&(a.value.price=l.price,a.value.returnType=l.returnType)};return(u,l)=>{const o=re,n=ue,s=oe,b=se,_=ne,I=ie,K=ce,L=pe,N=me,F=fe,O=W,Q=ve;return i(),m(O,{modelValue:d(f),"onUpdate:modelValue":l[10]||(l[10]=e=>Ve(f)?f.value=e:null),title:d(R)},{footer:r(()=>[t(F,{disabled:d(v),type:"primary",onClick:B},{default:r(()=>l[11]||(l[11]=[M("\u786E \u5B9A")])),_:1},8,["disabled"]),t(F,{onClick:l[9]||(l[9]=e=>f.value=!1)},{default:r(()=>l[12]||(l[12]=[M("\u53D6 \u6D88")])),_:1})]),default:r(()=>[Ie((i(),m(N,{ref_key:"formRef",ref:g,model:d(a),rules:d(j),"label-width":"100px"},{default:r(()=>[t(I,null,{default:r(()=>[t(s,{span:12},{default:r(()=>[t(n,{label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"},{default:r(()=>[t(o,{modelValue:d(a).no,"onUpdate:modelValue":l[0]||(l[0]=e=>d(a).no=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:r(()=>[t(n,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:r(()=>[t(_,{modelValue:d(a).ownerUserId,"onUpdate:modelValue":l[1]||(l[1]=e=>d(a).ownerUserId=e),disabled:d(p)!=="create",class:"w-1/1"},{default:r(()=>[(i(!0),V(w,null,y(d(C),e=>(i(),m(b,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(I,null,{default:r(()=>[t(s,{span:12},{default:r(()=>[t(n,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:r(()=>[t(_,{modelValue:d(a).customerId,"onUpdate:modelValue":l[2]||(l[2]=e=>d(a).customerId=e),disabled:d(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:T},{default:r(()=>[(i(!0),V(w,null,y(d(E),e=>(i(),m(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),t(s,{span:12},{default:r(()=>[t(n,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:r(()=>[t(_,{modelValue:d(a).contractId,"onUpdate:modelValue":l[3]||(l[3]=e=>d(a).contractId=e),disabled:d(p)!=="create"||!d(a).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C",onChange:q},{default:r(()=>[(i(!0),V(w,null,y(d(h),e=>(i(),m(b,{key:e.id,disabled:e.auditStatus!==20,label:e.name,value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(I,null,{default:r(()=>[t(s,{span:12},{default:r(()=>[t(n,{label:"\u56DE\u6B3E\u671F\u6570",prop:"planId"},{default:r(()=>[t(_,{modelValue:d(a).planId,"onUpdate:modelValue":l[4]||(l[4]=e=>d(a).planId=e),disabled:d(p)!=="create"||!d(a).contractId,class:"!w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u671F\u6570",onChange:G},{default:r(()=>[(i(!0),V(w,null,y(d(U),e=>(i(),m(b,{key:e.id,disabled:e.receivableId,label:"\u7B2C "+e.period+" \u671F",value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),t(s,{span:12},{default:r(()=>[t(n,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:r(()=>[t(_,{modelValue:d(a).returnType,"onUpdate:modelValue":l[5]||(l[5]=e=>d(a).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:r(()=>[(i(!0),V(w,null,y(d(X)(d(Y).CRM_RECEIVABLE_RETURN_TYPE),e=>(i(),m(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(I,null,{default:r(()=>[t(s,{span:12},{default:r(()=>[t(n,{label:"\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:r(()=>[t(K,{modelValue:d(a).price,"onUpdate:modelValue":l[6]||(l[6]=e=>d(a).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:r(()=>[t(n,{label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:r(()=>[t(L,{modelValue:d(a).returnTime,"onUpdate:modelValue":l[7]||(l[7]=e=>d(a).returnTime=e),placeholder:"\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(I,null,{default:r(()=>[t(s,{span:24},{default:r(()=>[t(n,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[t(o,{modelValue:d(a).remark,"onUpdate:modelValue":l[8]||(l[8]=e=>d(a).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Q,d(v)]])]),_:1},8,["modelValue","title"])}}});export{ye as _};
