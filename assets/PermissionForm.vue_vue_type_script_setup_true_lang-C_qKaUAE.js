import{e as j,D as A,b as D,d as G}from"./index-C1TKk8vI.js";import{_ as J}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{g as K}from"./index-CZiMqbPE.js";import{P as Q,B as V,c as W,u as X}from"./index-BuK0ap75.js";import{Q as H,x as Y,ai as Z,u as $,s as ee,w as ae,q as le,h as ue,f as se,aj as te}from"./form-designer-BpYekVAY.js";import{x as oe,r as m,X as re,j as de,y as o,E as n,F as s,O as r,K as c,u as a,G as ie,z as k,a4 as E,M as T,J as g,L as me,l as ve}from"./form-create-7GAbgMwl.js";const ne=oe({name:"CrmPermissionForm",__name:"PermissionForm",emits:["success"],setup(ce,{expose:z,emit:O}){const{t:_}=D(),I=G(),i=m(!1),C=m(""),y=m(!1),f=m(""),M=m([]),u=m({}),U=re({userId:[{required:!0,message:"\u4EBA\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],level:[{required:!0,message:"\u6743\u9650\u7EA7\u522B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=m();z({open:async(t,e,d,v)=>{i.value=!0,C.value=_("action."+t)+"\u56E2\u961F\u6210\u5458",f.value=t,S(e,d),v&&(u.value.ids=v)},open0:async(t,e,d,v,p)=>{i.value=!0,C.value=_("action."+t)+"\u56E2\u961F\u6210\u5458",f.value=t,S(e,d),u.value.level=p,u.value.ids=[v]}});const x=O,F=async()=>{if(b&&await b.value.validate()){y.value=!0;try{const t=u.value;f.value==="create"?(await W(a(t)),I.success(_("common.createSuccess"))):(await X(a(t)),I.success(_("common.updateSuccess"))),i.value=!1,x("success")}finally{y.value=!1}}},S=(t,e)=>{var d;(d=b.value)==null||d.resetFields(),u.value={},u.value={...u.value,bizType:t,bizId:e}};return de(async()=>{M.value=await K()}),(t,e)=>{const d=H,v=Y,p=Z,N=$,P=ee,R=ae,h=le,B=ue,w=se,q=J,L=te;return o(),n(q,{modelValue:a(i),"onUpdate:modelValue":e[4]||(e[4]=l=>ve(i)?i.value=l:null),title:a(C),width:"30%"},{footer:s(()=>[r(w,{disabled:a(y),type:"primary",onClick:F},{default:s(()=>e[8]||(e[8]=[c("\u786E \u5B9A")])),_:1},8,["disabled"]),r(w,{onClick:e[3]||(e[3]=l=>i.value=!1)},{default:s(()=>e[9]||(e[9]=[c("\u53D6 \u6D88")])),_:1})]),default:s(()=>[ie((o(),n(B,{ref_key:"formRef",ref:b,model:a(u),rules:a(U),"label-width":"100px"},{default:s(()=>[a(f)==="create"?(o(),n(p,{key:0,label:"\u9009\u62E9\u4EBA\u5458",prop:"userId"},{default:s(()=>[r(v,{modelValue:a(u).userId,"onUpdate:modelValue":e[0]||(e[0]=l=>a(u).userId=l)},{default:s(()=>[(o(!0),k(T,null,E(a(M),l=>(o(),n(d,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),r(p,{label:"\u6743\u9650\u7EA7\u522B",prop:"level"},{default:s(()=>[r(P,{modelValue:a(u).level,"onUpdate:modelValue":e[1]||(e[1]=l=>a(u).level=l)},{default:s(()=>[(o(!0),k(T,null,E(a(j)(a(A).CRM_PERMISSION_LEVEL),l=>(o(),k(T,{key:l.value},[l.value!=a(Q).OWNER?(o(),n(N,{key:0,value:l.value},{default:s(()=>[c(me(l.label),1)]),_:2},1032,["value"])):g("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1}),a(f)==="create"&&a(u).bizType===a(V).CRM_CUSTOMER?(o(),n(p,{key:1,label:"\u540C\u65F6\u6DFB\u52A0\u81F3"},{default:s(()=>[r(h,{modelValue:a(u).toBizTypes,"onUpdate:modelValue":e[2]||(e[2]=l=>a(u).toBizTypes=l)},{default:s(()=>[r(R,{value:a(V).CRM_CONTACT},{default:s(()=>e[5]||(e[5]=[c("\u8054\u7CFB\u4EBA")])),_:1},8,["value"]),r(R,{value:a(V).CRM_BUSINESS},{default:s(()=>e[6]||(e[6]=[c("\u5546\u673A")])),_:1},8,["value"]),r(R,{value:a(V).CRM_CONTRACT},{default:s(()=>e[7]||(e[7]=[c("\u5408\u540C")])),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})):g("",!0)]),_:1},8,["model","rules"])),[[L,a(y)]])]),_:1},8,["modelValue","title"])}}});export{ne as _};
