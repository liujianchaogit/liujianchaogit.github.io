import{b as j,d as q}from"./index-C1TKk8vI.js";import{_ as z}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{x as E,r as n,X as G,f as M,y as i,E as c,F as u,O as f,K as b,u as s,G as O,a5 as Q,U as R,z as D,a4 as S,M as X,l as B}from"./form-create-7GAbgMwl.js";import{e as H,f as I}from"./property-Jm61HwC0.js";import{Q as J,x as N,ai as T,h as W,f as Y,aj as Z}from"./form-designer-BpYekVAY.js";const $=E({name:"ProductPropertyForm",__name:"ProductPropertyAddForm",props:{propertyList:{type:Array,default:()=>{}}},setup(x,{expose:V}){const{t:h}=j(),y=q(),t=n(!1),o=n(!1),a=n({name:""}),k=G({name:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),d=n(),m=n([]),p=n([]),g=x;M(()=>g.propertyList,l=>{l&&(m.value=l)},{deep:!0,immediate:!0}),V({open:async()=>{t.value=!0,F(),await K()}});const _=async()=>{for(const e of m.value)if(e.name===a.value.name)return y.error("\u8BE5\u5C5E\u6027\u5DF2\u5B58\u5728\uFF0C\u8BF7\u52FF\u91CD\u590D\u6DFB\u52A0");if(!d||!await d.value.validate())return;const l=p.value.find(e=>e.name===a.value.name);if(l)return m.value.push({id:l.id,...a.value,values:[]}),void(t.value=!1);o.value=!0;try{const e=a.value,v=await H(e);m.value.push({id:v,...a.value,values:[]}),y.success(h("common.createSuccess")),t.value=!1}finally{o.value=!1}},F=()=>{var l;a.value={name:""},(l=d.value)==null||l.resetFields()},K=async()=>{o.value=!0;try{p.value=await I()}finally{o.value=!1}};return(l,e)=>{const v=J,P=N,U=T,A=W,w=Y,C=z,L=Z;return i(),c(C,{modelValue:s(t),"onUpdate:modelValue":e[2]||(e[2]=r=>B(t)?t.value=r:null),title:"\u6DFB\u52A0\u5546\u54C1\u5C5E\u6027"},{footer:u(()=>[f(w,{disabled:s(o),type:"primary",onClick:_},{default:u(()=>e[3]||(e[3]=[b("\u786E \u5B9A")])),_:1},8,["disabled"]),f(w,{onClick:e[1]||(e[1]=r=>t.value=!1)},{default:u(()=>e[4]||(e[4]=[b("\u53D6 \u6D88")])),_:1})]),default:u(()=>[O((i(),c(A,{ref_key:"formRef",ref:d,model:s(a),rules:s(k),"label-width":"80px",onKeydown:Q(R(_,["prevent"]),["enter"])},{default:u(()=>[f(U,{label:"\u5C5E\u6027\u540D\u79F0",prop:"name"},{default:u(()=>[f(P,{modelValue:s(a).name,"onUpdate:modelValue":e[0]||(e[0]=r=>s(a).name=r),"reserve-keyword":!1,"allow-create":"",class:"!w-360px","default-first-option":"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5C5E\u6027\u540D\u79F0\u3002\u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u53EF\u624B\u52A8\u8F93\u5165\u9009\u62E9"},{default:u(()=>[(i(!0),D(X,null,S(s(p),r=>(i(),c(v,{key:r.id,label:r.name,value:r.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeydown"])),[[L,s(o)]])]),_:1},8,["modelValue"])}}});export{$ as _};
