import{d as ea,_ as ta,c as sa}from"./index-C1TKk8vI.js";import{x as ia,r as C,ab as la,f as na,j as oa,y as d,E as I,F as t,C as u,O as e,K as T,u as o,l as $,J as U,z as x,M as q,a4 as A,L as B,H as ra,G as ca,U as F,P as ua}from"./form-create-7GAbgMwl.js";import{C as k}from"./index-WftQHYNa.js";import va from"./RoleRepository-cLH_Jpru.js";import{aO as da,aP as pa,O as ma,M as Ca,f as ya,k as fa,aN as wa,a7 as ha,b as ka,aF as _a,U as ga}from"./form-designer-BpYekVAY.js";import{r as Ma}from"./gpt-WhTktY3S.js";import"./RoleHeader-DyVWyY9f.js";import"./RoleList-BRpgu4gP.js";import"./ChatRoleForm.vue_vue_type_script_setup_true_lang-DHIfKaY2.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./constants-IYPHa1Ih.js";import"./index-BojwE7iS.js";import"./constants-DawjRUyr.js";import"./index-D8bH8MOw.js";import"./index-B7sLP7QQ.js";import"./RoleCategoryList-t-vkaKHn.js";const ba={class:"h-100%"},xa={class:"conversation-list"},Va={key:0,class:"conversation-item classify-title"},za=["onClick","onMouseover"],Ia={class:"title-wrapper"},Ta=["src"],Ua={class:"title"},Oa={class:"button-wrapper"},Sa={class:"tool-box"},Da=sa(ia({__name:"ConversationList",props:{activeId:{type:String||null,required:!0}},emits:["onConversationCreate","onConversationClick","onConversationClear","onConversationDelete"],setup(G,{expose:H,emit:J}){const V=ea(),_=C(""),p=C(null),O=C(null),r=C([]),y=C({}),z=C(!1),S=C(),D=G,f=J,Q=async i=>{if(_.value.trim().length){const a=r.value.filter(l=>l.title.includes(_.value.trim()));y.value=await L(a)}else y.value=await L(r.value)},K=async i=>{const a=r.value.filter(l=>l.id===i);f("onConversationClick",a[0])&&(p.value=i)},w=async()=>{try{if(S.value=setTimeout(()=>{z.value=!0},50),r.value=await k.getChatConversationMyList(),r.value.sort((i,a)=>a.createTime-i.createTime),r.value.length===0)return p.value=null,void(y.value={});y.value=await L(r.value)}finally{S.value&&clearTimeout(S.value),z.value=!1}},L=async i=>{const a={\u7F6E\u9876:[],\u4ECA\u5929:[],\u4E00\u5929\u524D:[],\u4E09\u5929\u524D:[],\u4E03\u5929\u524D:[],\u4E09\u5341\u5929\u524D:[]},l=Date.now(),v=864e5,P=3*v,j=7*v,M=30*v;for(const s of i){if(s.pinned){a.\u7F6E\u9876.push(s);continue}const h=l-s.createTime;h<v?a.\u4ECA\u5929.push(s):h<P?a.\u4E00\u5929\u524D.push(s):h<j?a.\u4E09\u5929\u524D.push(s):h<M?a.\u4E03\u5929\u524D.push(s):a.\u4E09\u5341\u5929\u524D.push(s)}return a},N=async()=>{const i=await k.createChatConversationMy({});await w(),await K(i),f("onConversationCreate")},R=async()=>{try{await V.confirm("\u786E\u8BA4\u540E\u5BF9\u8BDD\u4F1A\u5168\u90E8\u6E05\u7A7A\uFF0C\u7F6E\u9876\u7684\u5BF9\u8BDD\u9664\u5916\u3002"),await k.deleteChatConversationMyByUnpinned(),Ca({message:"\u64CD\u4F5C\u6210\u529F!",type:"success"}),p.value=null,await w(),f("onConversationClear")}catch{}},g=C(!1),W=async()=>{g.value=!g.value},{activeId:X}=la(D);return na(X,async(i,a)=>{p.value=i}),H({createConversation:N}),oa(async()=>{await w(),D.activeId?p.value=D.activeId:r.value.length&&(p.value=r.value[0].id,await f("onConversationClick",r.value[0]))}),(i,a)=>{const l=ta,v=ya,P=fa,j=wa,M=ha,s=ka,h=_a,Y=ga;return d(),I(Y,{width:"260px",class:"conversation-container h-100%"},{default:t(()=>[u("div",ba,[e(v,{class:"w-1/1 btn-new-conversation",type:"primary",onClick:N},{default:t(()=>[e(l,{icon:"ep:plus",class:"mr-5px"}),a[3]||(a[3]=T(" \u65B0\u5EFA\u5BF9\u8BDD "))]),_:1}),e(P,{modelValue:o(_),"onUpdate:modelValue":a[0]||(a[0]=m=>$(_)?_.value=m:null),size:"large",class:"mt-10px search-input",placeholder:"\u641C\u7D22\u5386\u53F2\u8BB0\u5F55",onKeyup:Q},{prefix:t(()=>[e(l,{icon:"ep:search"})]),_:1},8,["modelValue"]),u("div",xa,[o(z)?(d(),I(j,{key:0,description:".","v-loading":o(z)},null,8,["v-loading"])):U("",!0),(d(!0),x(q,null,A(Object.keys(o(y)),m=>(d(),x("div",{key:m},[o(y)[m].length?(d(),x("div",Va,[e(M,{class:"mx-1",size:"small",tag:"b"},{default:t(()=>[T(B(m),1)]),_:2},1024)])):U("",!0),(d(!0),x(q,null,A(o(y)[m],n=>(d(),x("div",{class:"conversation-item",key:n.id,onClick:b=>K(n.id),onMouseover:b=>O.value=n.id,onMouseout:a[1]||(a[1]=b=>O.value="")},[u("div",{class:ra(n.id===o(p)?"conversation active":"conversation")},[u("div",Ia,[u("img",{class:"avatar",src:n.roleAvatar||o(Ma)},null,8,Ta),u("span",Ua,B(n.title),1)]),ca(u("div",Oa,[e(v,{class:"btn",link:"",onClick:F(b=>(async c=>{c.pinned=!c.pinned,await k.updateChatConversationMy(c),await w()})(n),["stop"])},{default:t(()=>[n.pinned?U("",!0):(d(),I(s,{key:0,title:"\u7F6E\u9876"},{default:t(()=>[e(o(da))]),_:1})),n.pinned?(d(),I(s,{key:1,title:"\u7F6E\u9876"},{default:t(()=>[e(o(pa))]),_:1})):U("",!0)]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:F(b=>(async c=>{const{value:Z}=await ma.prompt("\u4FEE\u6539\u6807\u9898",{inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",inputValue:c.title});await k.updateChatConversationMy({id:c.id,title:Z}),V.success("\u91CD\u547D\u540D\u6210\u529F"),await w();const E=r.value.filter(aa=>aa.id===c.id);E.length>0&&p.value===E[0].id&&f("onConversationClick",E[0])})(n),["stop"])},{default:t(()=>[e(s,{title:"\u7F16\u8F91"},{default:t(()=>[e(l,{icon:"ep:edit"})]),_:1})]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:F(b=>(async c=>{try{await V.delConfirm(`\u662F\u5426\u786E\u8BA4\u5220\u9664\u5BF9\u8BDD - ${c.title}?`),await k.deleteChatConversationMy(c.id),V.success("\u5BF9\u8BDD\u5DF2\u5220\u9664"),await w(),f("onConversationDelete",c)}catch{}})(n),["stop"])},{default:t(()=>[e(s,{title:"\u5220\u9664\u5BF9\u8BDD"},{default:t(()=>[e(l,{icon:"ep:delete"})]),_:1})]),_:2},1032,["onClick"])],512),[[ua,o(O)===n.id]])],2)],40,za))),128))]))),128)),a[4]||(a[4]=u("div",{class:"h-160px w-100%"},null,-1))])]),u("div",Sa,[u("div",{onClick:W},[e(l,{icon:"ep:user"}),e(M,{size:"small"},{default:t(()=>a[5]||(a[5]=[T("\u89D2\u8272\u4ED3\u5E93")])),_:1})]),u("div",{onClick:R},[e(l,{icon:"ep:delete"}),e(M,{size:"small"},{default:t(()=>a[6]||(a[6]=[T("\u6E05\u7A7A\u672A\u7F6E\u9876\u5BF9\u8BDD")])),_:1})])]),e(h,{modelValue:o(g),"onUpdate:modelValue":a[2]||(a[2]=m=>$(g)?g.value=m:null),title:"\u89D2\u8272\u4ED3\u5E93",size:"754px"},{default:t(()=>[e(va)]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-baef00d5"]]);export{Da as default};
