import{d as Ie,b as Te,u as De,e as le,D as I,H as Ve,_ as Ee}from"./index-C1TKk8vI.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as Se}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as Oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{x as Pe,r as u,X as Ue,j as Fe,aq as Le,y as s,z as k,O as a,F as i,u as t,M as w,a4 as T,E as p,a5 as ae,K as c,G as v,C as d,H as te,L as C,J as Re}from"./form-create-7GAbgMwl.js";import{d as ze}from"./formatTime-EbFUBcAO.js";import{a as j,D as P}from"./index-DR2HTwYi.js";import{_ as Ke}from"./DeviceForm.vue_vue_type_script_setup_true_lang-0_dTGe-A.js";import{P as qe}from"./index-DDlNWlg-.js";import{D as je}from"./index-BAzhGSOD.js";import{d as Ae}from"./download-oWiM5xVU.js";import{_ as Ye}from"./DeviceGroupForm.vue_vue_type_script_setup_true_lang-Cj2gG92N.js";import{_ as Ge}from"./DeviceImportForm.vue_vue_type_script_setup_true_lang-BQnMrMhi.js";import{Q as He,x as Je,ai as Me,k as Qe,f as We,ap as Xe,h as $e,ak as Be,a7 as Ze,W as el,ad as ll,j as al,i as tl,$ as il,P as sl,a6 as ol,_ as dl,aj as pl}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";const cl={class:"p-4 relative"},nl={class:"flex items-center mb-3"},rl={class:"mr-2.5 flex items-center"},ul={class:"text-[16px] font-600 flex-1"},ml={class:"inline-flex items-center"},fl={class:"flex items-center text-[14px]"},vl={class:"flex-1"},xl={class:"mb-2.5 last:mb-0"},yl={class:"text-[#0070ff]"},_l={class:"mb-2.5 last:mb-0"},gl={class:"mb-2.5 last:mb-0"},bl={class:"text-[#0b1d30] inline-block align-middle overflow-hidden text-ellipsis whitespace-nowrap max-w-[130px]"},kl={class:"w-[100px] h-[100px]"},wl={class:"flex items-center px-0"},Cl=Pe({name:"IoTDevice",__name:"index",setup(hl){const D=Ie(),{t:A}=Te(),U=u(!0),F=u([]),Y=u(0),o=Ue({pageNo:1,pageSize:10,deviceName:void 0,productId:void 0,deviceType:void 0,nickname:void 0,status:void 0,groupId:void 0}),G=u(),L=u(!1),E=u([]),R=u([]),h=u([]),V=u("card"),ie=u("/src/assets/imgs/iot/device.png"),se=u("/src/assets/svgs/iot/card-fill.svg"),g=async()=>{U.value=!0;try{const r=await P.getDevicePage(o);F.value=r.list,Y.value=r.total}finally{U.value=!1}},N=()=>{o.pageNo=1,g()},oe=()=>{G.value.resetFields(),h.value=[],N()},H=u(),z=(r,l)=>{H.value.open(r,l)},{push:J}=De(),K=r=>{J({name:"IoTDeviceDetail",params:{id:r}})},M=async r=>{try{await D.delConfirm(),await P.deleteDevice(r),D.success(A("common.delSuccess")),await g()}catch{}},de=async()=>{try{await D.exportConfirm(),L.value=!0;const r=await P.exportDeviceExcel(o);Ae.excel(r,"\u7269\u8054\u7F51\u8BBE\u5907.xls")}catch{}finally{L.value=!1}},pe=r=>{h.value=r.map(l=>l.id)},ce=async()=>{try{await D.delConfirm(),await P.deleteDeviceList(h.value),D.success(A("common.delSuccess")),await g()}catch{}},Q=u(),ne=()=>{Q.value.open(h.value)},W=r=>{J({name:"IoTDeviceDetail",params:{id:r},query:{tab:"model"}})},X=u(),re=()=>{X.value.open()};return Fe(async()=>{g(),E.value=await qe.getSimpleProductList(),R.value=await je.getSimpleDeviceGroupList()}),(r,l)=>{const S=He,O=Je,b=Me,$=Qe,m=Ee,n=We,ue=Xe,me=$e,B=Oe,Z=Be,fe=Ze,q=Se,ve=el,xe=ll,ye=al,_e=tl,_=il,ge=sl,be=ol,ke=dl,we=Ne,x=Le("hasPermi"),Ce=pl;return s(),k(w,null,[a(B,null,{default:i(()=>[a(me,{class:"-mb-15px",model:t(o),ref_key:"queryFormRef",ref:G,inline:!0,"label-width":"68px"},{default:i(()=>[a(b,{label:"\u4EA7\u54C1",prop:"productId"},{default:i(()=>[a(O,{modelValue:t(o).productId,"onUpdate:modelValue":l[0]||(l[0]=e=>t(o).productId=e),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(E),e=>(s(),p(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"DeviceName",prop:"deviceName"},{default:i(()=>[a($,{modelValue:t(o).deviceName,"onUpdate:modelValue":l[1]||(l[1]=e=>t(o).deviceName=e),placeholder:"\u8BF7\u8F93\u5165 DeviceName",clearable:"",onKeyup:ae(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(b,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:i(()=>[a($,{modelValue:t(o).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>t(o).nickname=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0",clearable:"",onKeyup:ae(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u7C7B\u578B",prop:"deviceType"},{default:i(()=>[a(O,{modelValue:t(o).deviceType,"onUpdate:modelValue":l[3]||(l[3]=e=>t(o).deviceType=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u7C7B\u578B",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(le)(t(I).IOT_PRODUCT_DEVICE_TYPE),e=>(s(),p(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u72B6\u6001",prop:"status"},{default:i(()=>[a(O,{modelValue:t(o).status,"onUpdate:modelValue":l[4]||(l[4]=e=>t(o).status=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u72B6\u6001",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(le)(t(I).IOT_DEVICE_STATE),e=>(s(),p(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupId"},{default:i(()=>[a(O,{modelValue:t(o).groupId,"onUpdate:modelValue":l[5]||(l[5]=e=>t(o).groupId=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(R),e=>(s(),p(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{class:"float-right !mr-0 !mb-0"},{default:i(()=>[a(ue,null,{default:i(()=>[a(n,{type:t(V)==="card"?"primary":"default",onClick:l[6]||(l[6]=e=>V.value="card")},{default:i(()=>[a(m,{icon:"ep:grid"})]),_:1},8,["type"]),a(n,{type:t(V)==="list"?"primary":"default",onClick:l[7]||(l[7]=e=>V.value="list")},{default:i(()=>[a(m,{icon:"ep:list"})]),_:1},8,["type"])]),_:1})]),_:1}),a(b,null,{default:i(()=>[a(n,{onClick:N},{default:i(()=>[a(m,{icon:"ep:search",class:"mr-5px"}),l[11]||(l[11]=c(" \u641C\u7D22 "))]),_:1}),a(n,{onClick:oe},{default:i(()=>[a(m,{icon:"ep:refresh",class:"mr-5px"}),l[12]||(l[12]=c(" \u91CD\u7F6E "))]),_:1}),v((s(),p(n,{type:"primary",plain:"",onClick:l[8]||(l[8]=e=>z("create"))},{default:i(()=>[a(m,{icon:"ep:plus",class:"mr-5px"}),l[13]||(l[13]=c(" \u65B0\u589E "))]),_:1})),[[x,["iot:device:create"]]]),v((s(),p(n,{type:"success",plain:"",onClick:de,loading:t(L)},{default:i(()=>[a(m,{icon:"ep:download",class:"mr-5px"}),l[14]||(l[14]=c(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[x,["iot:device:export"]]]),v((s(),p(n,{type:"warning",plain:"",onClick:re},{default:i(()=>[a(m,{icon:"ep:upload"}),l[15]||(l[15]=c(" \u5BFC\u5165 "))]),_:1})),[[x,["iot:device:import"]]]),v((s(),p(n,{type:"primary",plain:"",onClick:ne,disabled:t(h).length===0},{default:i(()=>[a(m,{icon:"ep:folder-add",class:"mr-5px"}),l[16]||(l[16]=c(" \u6DFB\u52A0\u5230\u5206\u7EC4 "))]),_:1},8,["disabled"])),[[x,["iot:device:update"]]]),v((s(),p(n,{type:"danger",plain:"",onClick:ce,disabled:t(h).length===0},{default:i(()=>[a(m,{icon:"ep:delete",class:"mr-5px"}),l[17]||(l[17]=c(" \u6279\u91CF\u5220\u9664 "))]),_:1},8,["disabled"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(B,null,{default:i(()=>[t(V)==="card"?(s(),p(_e,{key:0,gutter:16},{default:i(()=>[(s(!0),k(w,null,T(t(F),e=>(s(),p(ye,{key:e.id,xs:24,sm:12,md:12,lg:6,class:"mb-4"},{default:i(()=>[a(xe,{class:"h-full transition-colors relative overflow-hidden","body-style":{padding:"0"}},{default:i(()=>{var f;return[d("div",{class:te(["absolute top-0 left-0 right-0 h-[50px] pointer-events-none",[e.state===t(j).ONLINE?"bg-gradient-to-b from-[#eefaff] to-transparent":"bg-gradient-to-b from-[#fff1f1] to-transparent"]])},null,2),d("div",cl,[d("div",nl,[d("div",rl,[a(Z,{src:t(se),class:"w-[18px] h-[18px]"},null,8,["src"])]),d("div",ul,C(e.deviceName),1),d("div",ml,[d("div",{class:te(["w-1 h-1 rounded-full mr-1.5",e.state===t(j).ONLINE?"bg-[var(--el-color-success)]":"bg-[var(--el-color-danger)]"])},null,2),a(fe,{class:"!text-xs font-bold",type:e.state===t(j).ONLINE?"success":"danger"},{default:i(()=>[c(C(t(Ve)(t(I).IOT_DEVICE_STATE,e.state)),1)]),_:2},1032,["type"])])]),d("div",fl,[d("div",vl,[d("div",xl,[l[18]||(l[18]=d("span",{class:"text-[#717c8e] mr-2.5"},"\u6240\u5C5E\u4EA7\u54C1",-1)),d("span",yl,C((f=t(E).find(y=>y.id===e.productId))==null?void 0:f.name),1)]),d("div",_l,[l[19]||(l[19]=d("span",{class:"text-[#717c8e] mr-2.5"},"\u8BBE\u5907\u7C7B\u578B",-1)),a(q,{type:t(I).IOT_PRODUCT_DEVICE_TYPE,value:e.deviceType},null,8,["type","value"])]),d("div",gl,[l[20]||(l[20]=d("span",{class:"text-[#717c8e] mr-2.5"},"DeviceKey",-1)),d("span",bl,C(e.deviceKey),1)])]),d("div",kl,[a(Z,{src:t(ie),class:"w-full h-full"},null,8,["src"])])]),a(ve,{class:"!my-3"}),d("div",wl,[v((s(),p(n,{class:"flex-1 !px-2 !h-[32px] text-[13px]",type:"primary",plain:"",onClick:y=>z("update",e.id)},{default:i(()=>[a(m,{icon:"ep:edit-pen",class:"mr-1"}),l[21]||(l[21]=c(" \u7F16\u8F91 "))]),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),a(n,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"warning",plain:"",onClick:y=>K(e.id)},{default:i(()=>[a(m,{icon:"ep:view",class:"mr-1"}),l[22]||(l[22]=c(" \u8BE6\u60C5 "))]),_:2},1032,["onClick"]),a(n,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"info",plain:"",onClick:y=>W(e.id)},{default:i(()=>[a(m,{icon:"ep:tickets",class:"mr-1"}),l[23]||(l[23]=c(" \u6570\u636E "))]),_:2},1032,["onClick"]),l[24]||(l[24]=d("div",{class:"mx-[10px] h-[20px] w-[1px] bg-[#dcdfe6]"},null,-1)),v((s(),p(n,{class:"!px-2 !h-[32px] text-[13px]",type:"danger",plain:"",onClick:y=>M(e.id)},{default:i(()=>[a(m,{icon:"ep:delete"})]),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})):v((s(),p(ke,{key:1,data:t(F),stripe:!0,"show-overflow-tooltip":!0,onSelectionChange:pe},{default:i(()=>[a(_,{type:"selection",width:"55"}),a(_,{label:"DeviceName",align:"center",prop:"deviceName"},{default:i(e=>[a(ge,{onClick:f=>K(e.row.id)},{default:i(()=>[c(C(e.row.deviceName),1)]),_:2},1032,["onClick"])]),_:1}),a(_,{label:"\u5907\u6CE8\u540D\u79F0",align:"center",prop:"nickname"}),a(_,{label:"\u6240\u5C5E\u4EA7\u54C1",align:"center",prop:"productId"},{default:i(e=>{var f;return[c(C(((f=t(E).find(y=>y.id===e.row.productId))==null?void 0:f.name)||"-"),1)]}),_:1}),a(_,{label:"\u8BBE\u5907\u7C7B\u578B",align:"center",prop:"deviceType"},{default:i(e=>[a(q,{type:t(I).IOT_PRODUCT_DEVICE_TYPE,value:e.row.deviceType},null,8,["type","value"])]),_:1}),a(_,{label:"\u6240\u5C5E\u5206\u7EC4",align:"center",prop:"groupId"},{default:i(e=>{var f;return[(f=e.row.groupIds)!=null&&f.length?(s(!0),k(w,{key:0},T(e.row.groupIds,y=>(s(),p(be,{key:y,class:"ml-5px",size:"small"},{default:i(()=>{var ee;return[c(C((ee=t(R).find(he=>he.id===y))==null?void 0:ee.name),1)]}),_:2},1024))),128)):Re("",!0)]}),_:1}),a(_,{label:"\u8BBE\u5907\u72B6\u6001",align:"center",prop:"status"},{default:i(e=>[a(q,{type:t(I).IOT_DEVICE_STATE,value:e.row.status},null,8,["type","value"])]),_:1}),a(_,{label:"\u6700\u540E\u4E0A\u7EBF\u65F6\u95F4",align:"center",prop:"onlineTime",formatter:t(ze),width:"180px"},null,8,["formatter"]),a(_,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:i(e=>[v((s(),p(n,{link:"",type:"primary",onClick:f=>K(e.row.id)},{default:i(()=>l[25]||(l[25]=[c(" \u67E5\u770B ")])),_:2},1032,["onClick"])),[[x,["iot:product:query"]]]),a(n,{link:"",type:"primary",onClick:f=>W(e.row.id)},{default:i(()=>l[26]||(l[26]=[c(" \u65E5\u5FD7 ")])),_:2},1032,["onClick"]),v((s(),p(n,{link:"",type:"primary",onClick:f=>z("update",e.row.id)},{default:i(()=>l[27]||(l[27]=[c(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),v((s(),p(n,{link:"",type:"danger",onClick:f=>M(e.row.id)},{default:i(()=>l[28]||(l[28]=[c(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["data"])),[[Ce,t(U)]]),a(we,{total:t(Y),page:t(o).pageNo,"onUpdate:page":l[9]||(l[9]=e=>t(o).pageNo=e),limit:t(o).pageSize,"onUpdate:limit":l[10]||(l[10]=e=>t(o).pageSize=e),onPagination:g},null,8,["total","page","limit"])]),_:1}),a(Ke,{ref_key:"formRef",ref:H,onSuccess:g},null,512),a(Ye,{ref_key:"groupFormRef",ref:Q,onSuccess:g},null,512),a(Ge,{ref_key:"importFormRef",ref:X,onSuccess:g},null,512)],64)}}});export{Cl as default};
