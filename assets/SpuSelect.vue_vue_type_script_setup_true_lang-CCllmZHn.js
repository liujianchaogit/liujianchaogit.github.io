import{p as H,d as ae,E as le,C as v,K as oe,_ as re}from"./index-C1TKk8vI.js";import{_ as te}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{x as se,r as i,j as pe,y as x,E as V,F as t,O as a,K as g,u as l,a5 as ue,G as de,J as K,L as ce,l as me}from"./form-create-7GAbgMwl.js";import{g as fe}from"./index-DK77YGos.js";import{d as ve}from"./formatTime-EbFUBcAO.js";import{h as ge,d as we}from"./tree-COGD3qag.js";import{g as ke}from"./category-BHM6Cffl.js";import{g as he,d as ye}from"./spu-75LBH-4N.js";import{_ as _e,k as Se,j as be,av as xe,F as Ve,f as Ce,i as Pe,$ as Te,ak as Ue,aj as Ie}from"./form-designer-BpYekVAY.js";import{_ as ze}from"./SkuList.vue_vue_type_script_setup_true_lang-Bof6RkjR.js";const Be=se({name:"PromotionSpuSelect",__name:"SpuSelect",props:{isSelectSku:H.bool.def(!1),radio:H.bool.def(!1)},emits:["confirm"],setup(I,{expose:M,emit:G}){const C=I,w=ae(),z=i(0),B=i([]),P=i(!1),f=i(!1),D=i(""),s=i({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),T=i([]),U=i(),R=i(),k=i(),h=i(!1),y=i(),d=i(0),m=i([]),J=o=>{var u;const e=(u=R.value)==null?void 0:u.getSkuTableRef();if(d.value===0)return w.warning("\u8BF7\u5148\u9009\u62E9\u5546\u54C1\u518D\u9009\u62E9\u76F8\u5E94\u7684\u89C4\u683C\uFF01\uFF01\uFF01"),void(e==null?void 0:e.clearSelection());if(o.length!==0)if(C.radio){if(m.value=[o.map(n=>n.id)[0]],o.length>1)return e==null||e.clearSelection(),void(e==null?void 0:e.toggleRowSelection(o.pop(),!0))}else m.value=o.map(n=>n.id);else m.value=[]},O=o=>{var e,u;if(o.length!==0){if(d.value=o.map(n=>n.id)[0],m.value.length>0&&(m.value=[]),o.length>1)return(e=U.value)==null||e.clearSelection(),void((u=U.value)==null?void 0:u.toggleRowSelection(o.pop(),!0));j(o[0],o)}else d.value=0},j=async(o,e)=>{var n,S;if(d.value!==0){if(o.id!==d.value)return w.warning("\u4F60\u5DF2\u9009\u62E9\u5546\u54C1\u8BF7\u5148\u53D6\u6D88"),void(y.value=[d.value]);if(h.value&&((n=k.value)==null?void 0:n.id)===o.id)return}if(k.value={},T.value=[],h.value=!1,(e==null?void 0:e.length)===0)return void(y.value=[]);const u=await he(o.id);(S=u.skus)==null||S.forEach(p=>{p.price=v(p.price),p.marketPrice=v(p.marketPrice),p.costPrice=v(p.costPrice),p.firstBrokeragePrice=v(p.firstBrokeragePrice),p.secondBrokeragePrice=v(p.secondBrokeragePrice)}),T.value=fe(u),k.value=u,h.value=!0,y.value=[o.id]},E=G,$=()=>{d.value!==0?C.isSelectSku&&m.value.length===0?w.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1\u5C5E\u6027"):(C.isSelectSku?E("confirm",d.value,m.value):E("confirm",d.value),f.value=!1,d.value=0,m.value=[]):w.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1")};M({open:()=>{D.value="\u5546\u54C1\u9009\u62E9",f.value=!0}});const _=async()=>{P.value=!0;try{const o=await ye(s.value);B.value=o.list,z.value=o.total}finally{P.value=!1}},L=()=>{_()},q=()=>{s.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},_()},N=i();return pe(async()=>{await _();const o=await ke({});N.value=ge(o,"id","parentId")}),(o,e)=>{const u=Se,n=be,S=xe,p=Ve,Y=re,b=Ce,A=Pe,c=Te,Q=Ue,W=ne,X=ie,Z=te,ee=Ie;return x(),V(Z,{modelValue:l(f),"onUpdate:modelValue":e[6]||(e[6]=r=>me(f)?f.value=r:null),appendToBody:!0,title:l(D),width:"70%"},{footer:t(()=>[a(b,{type:"primary",onClick:$},{default:t(()=>e[9]||(e[9]=[g("\u786E \u5B9A")])),_:1}),a(b,{onClick:e[5]||(e[5]=r=>f.value=!1)},{default:t(()=>e[10]||(e[10]=[g("\u53D6 \u6D88")])),_:1})]),default:t(()=>[a(X,null,{default:t(()=>[a(A,{gutter:20,class:"mb-10px"},{default:t(()=>[a(n,{span:6},{default:t(()=>[a(u,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=r=>l(s).name=r),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:ue(L,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{span:6},{default:t(()=>[a(S,{modelValue:l(s).categoryId,"onUpdate:modelValue":e[1]||(e[1]=r=>l(s).categoryId=r),data:l(N),props:l(we),"check-strictly":"",class:"w-1/1","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),a(n,{span:6},{default:t(()=>[a(p,{modelValue:l(s).createTime,"onUpdate:modelValue":e[2]||(e[2]=r=>l(s).createTime=r),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(n,{span:6},{default:t(()=>[a(b,{onClick:L},{default:t(()=>[a(Y,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=g(" \u641C\u7D22 "))]),_:1}),a(b,{onClick:q},{default:t(()=>[a(Y,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=g(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1}),de((x(),V(l(_e),{ref_key:"spuListRef",ref:U,data:l(B),"expand-row-keys":l(y),"row-key":"id",onExpandChange:j,onSelectionChange:O},{default:t(()=>[I.isSelectSku?(x(),V(c,{key:0,type:"expand",width:"30"},{default:t(()=>[l(h)?(x(),V(l(ze),{key:0,ref_key:"skuListRef",ref:R,isComponent:!0,isDetail:!0,"prop-form-data":l(k),"property-list":l(T),onSelectionChange:J},null,8,["prop-form-data","property-list"])):K("",!0)]),_:1})):K("",!0),a(c,{type:"selection",width:"55"}),a(c,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id"}),a(c,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:t(({row:r})=>[a(Q,{src:r.picUrl,class:"h-30px w-30px",onClick:De=>{return F=r.picUrl,void oe({zIndex:99999999,urlList:[F]});var F}},null,8,["src","onClick"])]),_:1}),a(c,{"show-overflow-tooltip":!0,label:"\u5546\u54C1\u540D\u79F0","min-width":"300",prop:"name"}),a(c,{align:"center",label:"\u5546\u54C1\u552E\u4EF7","min-width":"90",prop:"price"},{default:t(({row:r})=>[g(ce(l(le)(r.price)),1)]),_:1}),a(c,{align:"center",label:"\u9500\u91CF","min-width":"90",prop:"salesCount"}),a(c,{align:"center",label:"\u5E93\u5B58","min-width":"90",prop:"stock"}),a(c,{align:"center",label:"\u6392\u5E8F","min-width":"70",prop:"sort"}),a(c,{formatter:l(ve),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180"},null,8,["formatter"])]),_:1},8,["data","expand-row-keys"])),[[ee,l(P)]]),a(W,{limit:l(s).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>l(s).pageSize=r),page:l(s).pageNo,"onUpdate:page":e[4]||(e[4]=r=>l(s).pageNo=r),total:l(z),onPagination:_},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}}});export{Be as _};
