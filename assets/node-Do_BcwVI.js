import{T as m}from"./index-DwSWB2Hs.js";import{P as $,a as C,C as a,A as w,R as x,e as H,c as G,f as V,t as B}from"./consts-D6_WKT2v.js";import{p as X}from"./index-BCN8BzfC.js";import{r as o,f as J,i as p,u as f,a9 as q}from"./form-create-7GAbgMwl.js";function K(s){const r=o(s.flowNode);return J(()=>s.flowNode,n=>{r.value=n}),r}const L=s=>{const r=[];return s&&s.forEach(n=>{X(JSON.parse(n),r)}),r};function Q(s){const r=o([]),n=p("formType",o()),v=p("formFields",o([])),R=(c,e)=>{let t=[];return e&&(t=L(e).map(u=>{const i=c.find(_=>_.field==u.field);return{field:u.field,title:u.title,permission:i?i.permission:s}})),t},S=c=>{let e=[];return c&&(e=L(c).map(t=>({field:t.field,title:t.title,permission:s}))),e},T=L(f(v));return{formType:n,fieldsPermissionConfig:r,formFieldOptions:T,getNodeConfigFormFields:c=>{(c=q(c))&&c.length!==0?r.value=R(c,f(v)):r.value=S(f(v))}}}function z(){const s=p("formFields",o([]));return L(f(s))}function W(){const s=p("formFields",o([])),r=L(f(s));return r.unshift({field:$.START_USER_ID,title:"\u53D1\u8D77\u4EBA",required:!0}),r}function Y(s){const r=p("roleList",o([])),n=p("postList",o([])),v=p("userList",o([])),R=p("deptList",o([])),S=p("userGroupList",o([])),T=p("deptTree",o()),c=p("formFields",o([])),e=o();return s===C.USER_TASK_NODE||s===C.TRANSACTOR_NODE?e.value={candidateStrategy:a.USER,approveMethod:w.SEQUENTIAL_APPROVE,approveRatio:100,rejectHandlerType:x.FINISH_PROCESS,assignStartUserHandlerType:H.START_USER_AUDIT,returnNodeId:"",timeoutHandlerEnable:!1,timeoutHandlerType:1,timeDuration:6,maxRemindCount:1,buttonsSetting:[]}:e.value={candidateStrategy:a.USER},{configForm:e,roleOptions:r,postOptions:n,userOptions:v,userGroupOptions:S,deptTreeOptions:T,handleCandidateParam:()=>{let t;if(!e.value)return t;switch(e.value.candidateStrategy){case a.USER:t=e.value.userIds.join(",");break;case a.ROLE:t=e.value.roleIds.join(",");break;case a.POST:t=e.value.postIds.join(",");break;case a.USER_GROUP:t=e.value.userGroups.join(",");break;case a.FORM_USER:t=e.value.formUser;break;case a.EXPRESSION:t=e.value.expression;break;case a.DEPT_MEMBER:case a.DEPT_LEADER:t=e.value.deptIds.join(",");break;case a.START_USER_DEPT_LEADER:case a.START_USER_MULTI_LEVEL_DEPT_LEADER:t=e.value.deptLevel+"";break;case a.MULTI_LEVEL_DEPT_LEADER:t=e.value.deptIds.join(",").concat("|"+e.value.deptLevel);break;case a.FORM_DEPT_LEADER:t=e.value.formDept.concat("|"+e.value.deptLevel);break}return t},parseCandidateParam:(t,u)=>{if(e.value&&u)switch(t){case a.USER:e.value.userIds=u.split(",").map(i=>+i);break;case a.ROLE:e.value.roleIds=u.split(",").map(i=>+i);break;case a.POST:e.value.postIds=u.split(",").map(i=>+i);break;case a.USER_GROUP:e.value.userGroups=u.split(",").map(i=>+i);break;case a.FORM_USER:e.value.formUser=u;break;case a.EXPRESSION:e.value.expression=u;break;case a.DEPT_MEMBER:case a.DEPT_LEADER:e.value.deptIds=u.split(",").map(i=>+i);break;case a.START_USER_DEPT_LEADER:case a.START_USER_MULTI_LEVEL_DEPT_LEADER:e.value.deptLevel=+u;break;case a.MULTI_LEVEL_DEPT_LEADER:{const i=u.split("|");e.value.deptIds=i[0].split(",").map(_=>+_),e.value.deptLevel=+i[1];break}case a.FORM_DEPT_LEADER:{const i=u.split("|");e.value.formDept=i[0],e.value.deptLevel=+i[1];break}}},getShowText:()=>{var u,i,_,D,P,g,U,I,A,O,h,b,y,k,M,N,j,F;let t="";if(((u=e.value)==null?void 0:u.candidateStrategy)===a.USER&&((i=e.value)==null?void 0:i.userIds.length)>0){const l=[];v==null||v.value.forEach(d=>{var E;(E=e.value)!=null&&E.userIds.includes(d.id)&&l.push(d.nickname)}),t=`\u6307\u5B9A\u6210\u5458\uFF1A${l.join(",")}`}if(((_=e.value)==null?void 0:_.candidateStrategy)===a.ROLE&&e.value.roleIds.length>0){const l=[];r==null||r.value.forEach(d=>{var E;(E=e.value)!=null&&E.roleIds.includes(d.id)&&l.push(d.name)}),t=`\u6307\u5B9A\u89D2\u8272\uFF1A${l.join(",")}`}if((((D=e.value)==null?void 0:D.candidateStrategy)===a.DEPT_MEMBER||((P=e.value)==null?void 0:P.candidateStrategy)===a.DEPT_LEADER||((g=e.value)==null?void 0:g.candidateStrategy)===a.MULTI_LEVEL_DEPT_LEADER)&&((U=e.value)==null?void 0:U.deptIds.length)>0){const l=[];R==null||R.value.forEach(d=>{var E;(E=e.value)!=null&&E.deptIds.includes(d.id)&&l.push(d.name)}),t=e.value.candidateStrategy===a.DEPT_MEMBER?`\u90E8\u95E8\u6210\u5458\uFF1A${l.join(",")}`:e.value.candidateStrategy===a.DEPT_LEADER?`\u90E8\u95E8\u7684\u8D1F\u8D23\u4EBA\uFF1A${l.join(",")}`:`\u591A\u7EA7\u90E8\u95E8\u7684\u8D1F\u8D23\u4EBA\uFF1A${l.join(",")}`}if(((I=e.value)==null?void 0:I.candidateStrategy)===a.POST&&e.value.postIds.length>0){const l=[];n==null||n.value.forEach(d=>{var E;(E=e.value)!=null&&E.postIds.includes(d.id)&&l.push(d.name)}),t=`\u6307\u5B9A\u5C97\u4F4D: ${l.join(",")}`}if(((A=e.value)==null?void 0:A.candidateStrategy)===a.USER_GROUP&&((O=e.value)==null?void 0:O.userGroups.length)>0){const l=[];S==null||S.value.forEach(d=>{var E;(E=e.value)!=null&&E.userGroups.includes(d.id)&&l.push(d.name)}),t=`\u6307\u5B9A\u7528\u6237\u7EC4: ${l.join(",")}`}if(((h=e.value)==null?void 0:h.candidateStrategy)===a.FORM_USER){const l=L(f(c)).find(d=>{var E;return d.field===((E=e.value)==null?void 0:E.formUser)});t=`\u8868\u5355\u7528\u6237\uFF1A${l==null?void 0:l.title}`}return((b=e.value)==null?void 0:b.candidateStrategy)===a.FORM_DEPT_LEADER&&(t="\u8868\u5355\u5185\u90E8\u95E8\u8D1F\u8D23\u4EBA"),((y=e.value)==null?void 0:y.candidateStrategy)===a.APPROVE_USER_SELECT&&(t="\u5BA1\u6279\u4EBA\u81EA\u9009"),((k=e.value)==null?void 0:k.candidateStrategy)===a.START_USER_SELECT&&(t="\u53D1\u8D77\u4EBA\u81EA\u9009"),((M=e.value)==null?void 0:M.candidateStrategy)===a.START_USER&&(t="\u53D1\u8D77\u4EBA\u81EA\u5DF1"),((N=e.value)==null?void 0:N.candidateStrategy)===a.START_USER_DEPT_LEADER&&(t="\u53D1\u8D77\u4EBA\u7684\u90E8\u95E8\u8D1F\u8D23\u4EBA"),((j=e.value)==null?void 0:j.candidateStrategy)===a.START_USER_MULTI_LEVEL_DEPT_LEADER&&(t="\u53D1\u8D77\u4EBA\u8FDE\u7EED\u90E8\u95E8\u8D1F\u8D23\u4EBA"),((F=e.value)==null?void 0:F.candidateStrategy)===a.EXPRESSION&&(t=`\u6D41\u7A0B\u8868\u8FBE\u5F0F\uFF1A${e.value.expression}`),t}}}function Z(){const s=o(!1);return{settingVisible:s,closeDrawer:()=>{s.value=!1},openDrawer:()=>{s.value=!0}}}function ee(s){const r=o(),n=o(!1);return{nodeName:r,showInput:n,clickIcon:()=>{n.value=!0},blurEvent:()=>{n.value=!1,r.value=r.value||G.get(s)}}}function ae(s,r){const n=o(!1);return{showInput:n,clickTitle:()=>{n.value=!0},blurEvent:()=>{n.value=!1,s.value.name=s.value.name||G.get(r)}}}function te(s){return s?s===m.APPROVE?"status-pass":s===m.RUNNING?"status-running":s===m.REJECT?"status-reject":s===m.CANCEL?"status-cancel":"":""}function se(s,r,n,v){let R="";if(s===V.EXPRESSION&&r&&(R=`\u8868\u8FBE\u5F0F\uFF1A${r}`),s===V.RULE){const S=n==null?void 0:n.and;let T;const c=n==null?void 0:n.conditions.map(e=>"("+e.rules.map(t=>t.leftSide&&t.rightSide?re(v,t.leftSide)+" "+ne(t.opCode)+" "+t.rightSide:(T="\u8BF7\u5B8C\u5584\u6761\u4EF6\u89C4\u5219","")).join(e.and?" \u4E14 ":" \u6216 ")+" ) ");R=T?"":c.join(S?" \u4E14 ":" \u6216 ")}return R}const re=(s,r)=>{const n=s.find(v=>v.field===r);return n==null?void 0:n.title},ne=s=>{const r=B.find(n=>n.value===s);return r==null?void 0:r.label};export{Z as a,ee as b,Q as c,ae as d,te as e,Y as f,W as g,se as h,z as i,K as u};
