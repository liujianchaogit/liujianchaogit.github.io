import{au as D,d as F,u as G,_ as J}from"./index-C1TKk8vI.js";import{_ as K}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as X}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{b as $,g as H}from"./index-DLPyhh9r.js";import{h as Q,i as W}from"./index-C_v5t3_7.js";import{_ as V}from"./BusinessForm.vue_vue_type_script_setup_true_lang-C-tbO4kY.js";import{B as S}from"./index-BuK0ap75.js";import{_ as Y}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-D8lenXv5.js";import{f as Z,i as ee,$ as ae,P as se,_ as te,aj as oe}from"./form-designer-BpYekVAY.js";import{x as ie,r as l,X as re,f as ne,y as u,z as ce,O as a,F as r,K as d,u as t,G as v,E as m,J as k,L as le,M as pe,aq as ue}from"./form-create-7GAbgMwl.js";const de=ie({name:"CrmBusinessList",__name:"BusinessList",props:{bizType:{},bizId:{},customerId:{},contactId:{}},setup(x){const f=F(),o=x,I=l(!0),z=l(0),w=l([]),s=re({pageNo:1,pageSize:10,customerId:void 0,contactId:void 0}),b=async()=>{I.value=!0;try{s.customerId=void 0,s.contactId=void 0;let i={list:[],total:0};switch(o.bizType){case S.CRM_CUSTOMER:s.customerId=o.bizId,i=await H(s);break;case S.CRM_CONTACT:s.contactId=o.bizId,i=await $(s);break;default:return}w.value=i.list,z.value=i.total}finally{I.value=!1}},y=()=>{s.pageNo=1,b()},C=l(),T=()=>{C.value.open("create",null,o.customerId,o.contactId)},{push:E}=G(),h=l(),B=()=>{h.value.open()},M=async i=>{const e={contactId:o.bizId,businessIds:i};_.value.getSelectionRows().forEach(p=>{e.businessIds.push(p.id)}),await Q(e),f.success("\u5173\u8054\u5546\u673A\u6210\u529F"),y()},_=l(),L=async()=>{const i={contactId:o.bizId,businessIds:_.value.getSelectionRows().map(e=>e.id)};if(i.businessIds.length===0)return f.error("\u672A\u9009\u62E9\u5546\u673A");await W(i),f.success("\u53D6\u5173\u5546\u673A\u6210\u529F"),y()};return ne(()=>[o.bizId,o.bizType],()=>{y()},{immediate:!0,deep:!0}),(i,e)=>{const p=J,g=Z,O=ee,n=ae,P=se,U=te,j=X,q=K,N=ue("hasPermi"),A=oe;return u(),ce(pe,null,[a(O,{justify:"end"},{default:r(()=>[a(g,{onClick:T},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:opportunity"}),e[2]||(e[2]=d(" \u521B\u5EFA\u5546\u673A "))]),_:1}),t(s).contactId?v((u(),m(g,{key:0,onClick:B},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=d("\u5173\u8054 "))]),_:1})),[[N,["crm:contact:create-business"]]]):k("",!0),t(s).contactId?v((u(),m(g,{key:1,onClick:L},{default:r(()=>[a(p,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=d("\u89E3\u9664\u5173\u8054 "))]),_:1})),[[N,["crm:contact:delete-business"]]]):k("",!0)]),_:1}),a(q,{class:"mt-10px"},{default:r(()=>[v((u(),m(U,{ref_key:"businessRef",ref:_,data:t(w),stripe:!0,"show-overflow-tooltip":!0},{default:r(()=>[t(s).contactId?(u(),m(n,{key:0,type:"selection",width:"55"})):k("",!0),a(n,{label:"\u5546\u673A\u540D\u79F0",fixed:"left",align:"center",prop:"name"},{default:r(c=>[a(P,{type:"primary",underline:!1,onClick:me=>{return R=c.row.id,void E({name:"CrmBusinessDetail",params:{id:R}});var R}},{default:r(()=>[d(le(c.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(n,{label:"\u5546\u673A\u91D1\u989D",align:"center",prop:"price",formatter:t(D)},null,8,["formatter"]),a(n,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName"}),a(n,{label:"\u5546\u673A\u7EC4",align:"center",prop:"statusTypeName"}),a(n,{label:"\u5546\u673A\u9636\u6BB5",align:"center",prop:"statusName"})]),_:1},8,["data"])),[[A,t(I)]]),a(j,{total:t(z),page:t(s).pageNo,"onUpdate:page":e[0]||(e[0]=c=>t(s).pageNo=c),limit:t(s).pageSize,"onUpdate:limit":e[1]||(e[1]=c=>t(s).pageSize=c),onPagination:b},null,8,["total","page","limit"])]),_:1}),a(V,{ref_key:"formRef",ref:C,onSuccess:b},null,512),a(Y,{ref_key:"businessModalRef",ref:h,"customer-id":o.customerId,onSuccess:M},null,8,["customer-id"])],64)}}});export{de as _};
