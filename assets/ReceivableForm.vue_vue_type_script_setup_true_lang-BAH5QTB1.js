import{a as $,d as B,h as J,D as K,b as O}from"./index-DiGvuAxb.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{a as X}from"./index-LzLQUCg-.js";import{a as Z,c as ee,u as le}from"./index-BZ5-F52f.js";import{g as ae}from"./index-BEHCTgo8.js";import{a as ue}from"./index-CwL9yoSU.js";import{d as de}from"./index-D4xnjFDX.js";import{aj as te,h as re,i as oe,j as se,ai as ne,k as ie,x as ce,Q as me,l as pe,F as fe,f as ve}from"./form-designer-drfGvdgz.js";import{k as be,r as c,P as _e,y as p,m as i,z as t,A as Ie,u,H as d,l as V,G as y,$ as w,E as F,h as Ve}from"./form-create-D7wT855o.js";const ye=be({__name:"ReceivableForm",emits:["success"],setup(we,{expose:S,emit:j}){const{t:k}=$(),x=B(),C=c([]),f=c(!1),R=c(""),v=c(!1),m=c(""),l=c({}),z=_e({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],price:[{required:!0,message:"\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=c(),E=c([]),U=c([]),h=c([]);S({open:async(r,a,o)=>{var n;if(f.value=!0,R.value=k("action."+r),m.value=r,G(),a){v.value=!0;try{const s=await Z(a);l.value=s,await T(s.customerId),l.value.contractId=(n=s==null?void 0:s.contract)==null?void 0:n.id}finally{v.value=!1}}C.value=await ae(),E.value=await ue(),m.value==="create"&&(l.value.ownerUserId=O().getUser.id),o&&(l.value.customerId=o.customerId,await T(o.customerId),l.value.contractId=o.contractId,await q(o.contractId),o.id&&(l.value.planId=o.id,l.value.price=o.price,l.value.returnType=o.returnType))}});const A=j,D=async()=>{if(g&&await g.value.validate()){v.value=!0;try{const r=l.value;m.value==="create"?(await ee(r),x.success(k("common.createSuccess"))):(await le(r),x.success(k("common.updateSuccess"))),f.value=!1,A("success")}finally{v.value=!1}}},G=()=>{var r;l.value={},(r=g.value)==null||r.resetFields()},T=async r=>{l.value.contractId=void 0,r&&(U.value=[],U.value=await de(r))},q=async r=>{if(l.value.planId=void 0,r){h.value=[],h.value=await X(l.value.customerId,r);const a=U.value.find(o=>o.id===r);a&&(l.value.price=a.totalPrice-a.totalReceivablePrice)}},H=r=>{if(!r)return;const a=h.value.find(o=>o.id===r);a&&(l.value.price=a.price,l.value.returnType=a.returnType)};return(r,a)=>{const o=ie,n=ne,s=se,b=me,_=ce,I=oe,L=pe,M=fe,N=re,P=ve,Q=W,Y=te;return i(),p(Q,{modelValue:u(f),"onUpdate:modelValue":a[10]||(a[10]=e=>Ve(f)?f.value=e:null),title:u(R)},{footer:t(()=>[d(P,{disabled:u(v),type:"primary",onClick:D},{default:t(()=>a[11]||(a[11]=[F("\u786E \u5B9A")])),_:1},8,["disabled"]),d(P,{onClick:a[9]||(a[9]=e=>f.value=!1)},{default:t(()=>a[12]||(a[12]=[F("\u53D6 \u6D88")])),_:1})]),default:t(()=>[Ie((i(),p(N,{ref_key:"formRef",ref:g,model:u(l),rules:u(z),"label-width":"100px"},{default:t(()=>[d(I,null,{default:t(()=>[d(s,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"},{default:t(()=>[d(o,{modelValue:u(l).no,"onUpdate:modelValue":a[0]||(a[0]=e=>u(l).no=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),d(s,{span:12},{default:t(()=>[d(n,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:t(()=>[d(_,{modelValue:u(l).ownerUserId,"onUpdate:modelValue":a[1]||(a[1]=e=>u(l).ownerUserId=e),disabled:u(m)!=="create",class:"w-1/1"},{default:t(()=>[(i(!0),V(y,null,w(u(C),e=>(i(),p(b,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(s,{span:12},{default:t(()=>[d(n,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:t(()=>[d(_,{modelValue:u(l).customerId,"onUpdate:modelValue":a[2]||(a[2]=e=>u(l).customerId=e),disabled:u(m)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:T},{default:t(()=>[(i(!0),V(y,null,w(u(E),e=>(i(),p(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),d(s,{span:12},{default:t(()=>[d(n,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:t(()=>[d(_,{modelValue:u(l).contractId,"onUpdate:modelValue":a[3]||(a[3]=e=>u(l).contractId=e),disabled:u(m)!=="create"||!u(l).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C",onChange:q},{default:t(()=>[(i(!0),V(y,null,w(u(U),e=>(i(),p(b,{key:e.id,disabled:e.auditStatus!==20,label:e.name,value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(s,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u671F\u6570",prop:"planId"},{default:t(()=>[d(_,{modelValue:u(l).planId,"onUpdate:modelValue":a[4]||(a[4]=e=>u(l).planId=e),disabled:u(m)!=="create"||!u(l).contractId,class:"!w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u671F\u6570",onChange:H},{default:t(()=>[(i(!0),V(y,null,w(u(h),e=>(i(),p(b,{key:e.id,disabled:e.receivableId,label:"\u7B2C "+e.period+" \u671F",value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),d(s,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:t(()=>[d(_,{modelValue:u(l).returnType,"onUpdate:modelValue":a[5]||(a[5]=e=>u(l).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:t(()=>[(i(!0),V(y,null,w(u(J)(u(K).CRM_RECEIVABLE_RETURN_TYPE),e=>(i(),p(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(s,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:t(()=>[d(L,{modelValue:u(l).price,"onUpdate:modelValue":a[6]||(a[6]=e=>u(l).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),d(s,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:t(()=>[d(M,{modelValue:u(l).returnTime,"onUpdate:modelValue":a[7]||(a[7]=e=>u(l).returnTime=e),placeholder:"\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(s,{span:24},{default:t(()=>[d(n,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[d(o,{modelValue:u(l).remark,"onUpdate:modelValue":a[8]||(a[8]=e=>u(l).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Y,u(v)]])]),_:1},8,["modelValue","title"])}}});export{ye as _};
