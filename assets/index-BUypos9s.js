import{e as X,D as $,d as H,u as J,h as W,b as Y,_ as Z}from"./index-C1TKk8vI.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{x as te,r as f,X as le,j as oe,y as d,z as L,O as e,F as l,u as o,a5 as ne,M as z,a4 as se,E as g,K as u,G as _,C as D,L as re,aq as de}from"./form-create-7GAbgMwl.js";import{d as ie}from"./formatTime-EbFUBcAO.js";import{K as S}from"./index-Ctuiy-PU.js";import{_ as ue}from"./KnowledgeSegmentForm.vue_vue_type_script_setup_true_lang-CLBp-V9v.js";import{C as b}from"./constants-IYPHa1Ih.js";import{c as pe}from"./permission-0vfiopec.js";import{k as ce,ai as me,Q as fe,x as ge,f as we,h as _e,$ as be,D as he,_ as ve,aj as ye}from"./form-designer-BpYekVAY.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";const xe={class:"content-expand",style:{padding:"10px 20px","white-space":"pre-wrap","line-height":"1.5","background-color":"#f9f9f9","border-radius":"4px","border-left":"3px solid #409eff"}},ke=te({name:"KnowledgeSegment",__name:"index",setup(Se){const p=H(),q=J(),C=W(),{t:I}=Y(),h=f(!0),V=f([]),E=f(0),n=le({pageNo:1,pageSize:10,documentId:void 0,content:void 0,status:void 0}),K=f(),i=async()=>{h.value=!0;try{const c=await S.getKnowledgeSegmentPage(n);V.value=c.list,E.value=c.total}finally{h.value=!1}},v=()=>{n.pageNo=1,i()},B=()=>{K.value.resetFields(),v()},N=f(),U=(c,a)=>{N.value.open(c,a,n.documentId)};return oe(()=>{if(!C.query.documentId)return p.error("\u6587\u6863 ID \u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u67E5\u770B\u5206\u6BB5\u5217\u8868"),void q.push({name:"AiKnowledgeDocument"});n.documentId=C.query.documentId,i()}),(c,a)=>{const P=ce,y=me,F=fe,M=ge,x=Z,m=we,O=_e,A=ae,s=be,R=he,T=ve,j=ee,k=de("hasPermi"),G=ye;return d(),L(z,null,[e(A,null,{default:l(()=>[e(O,{class:"-mb-15px",model:o(n),ref_key:"queryFormRef",ref:K,inline:!0,"label-width":"68px"},{default:l(()=>[e(y,{label:"\u6587\u6863\u7F16\u53F7",prop:"documentId"},{default:l(()=>[e(P,{modelValue:o(n).documentId,"onUpdate:modelValue":a[0]||(a[0]=t=>o(n).documentId=t),placeholder:"\u8BF7\u8F93\u5165\u6587\u6863\u7F16\u53F7",clearable:"",onKeyup:ne(v,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(y,{label:"\u662F\u5426\u542F\u7528",prop:"status"},{default:l(()=>[e(M,{modelValue:o(n).status,"onUpdate:modelValue":a[1]||(a[1]=t=>o(n).status=t),placeholder:"\u8BF7\u9009\u62E9\u662F\u5426\u542F\u7528",clearable:"",class:"!w-240px"},{default:l(()=>[(d(!0),L(z,null,se(o(X)(o($).COMMON_STATUS),t=>(d(),g(F,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,null,{default:l(()=>[e(m,{onClick:v},{default:l(()=>[e(x,{icon:"ep:search",class:"mr-5px"}),a[5]||(a[5]=u(" \u641C\u7D22"))]),_:1}),e(m,{onClick:B},{default:l(()=>[e(x,{icon:"ep:refresh",class:"mr-5px"}),a[6]||(a[6]=u(" \u91CD\u7F6E"))]),_:1}),_((d(),g(m,{type:"primary",plain:"",onClick:a[2]||(a[2]=t=>U("create"))},{default:l(()=>[e(x,{icon:"ep:plus",class:"mr-5px"}),a[7]||(a[7]=u(" \u65B0\u589E "))]),_:1})),[[k,["ai:knowledge:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(A,null,{default:l(()=>[_((d(),g(T,{data:o(V),stripe:!0,"show-overflow-tooltip":!0},{default:l(()=>[e(s,{label:"\u5206\u6BB5\u7F16\u53F7",align:"center",prop:"id"}),e(s,{type:"expand"},{default:l(t=>[D("div",xe,[a[8]||(a[8]=D("div",{class:"content-title",style:{"margin-bottom":"8px",color:"#606266","font-size":"14px","font-weight":"bold"}}," \u5B8C\u6574\u5185\u5BB9\uFF1A ",-1)),u(" "+re(t.row.content),1)])]),_:1}),e(s,{label:"\u5207\u7247\u5185\u5BB9",align:"center",prop:"content","min-width":"250px","show-overflow-tooltip":!0}),e(s,{label:"\u5B57\u7B26\u6570",align:"center",prop:"contentLength"}),e(s,{label:"token \u6570\u91CF",align:"center",prop:"tokens"}),e(s,{label:"\u53EC\u56DE\u6B21\u6570",align:"center",prop:"retrievalCount"}),e(s,{label:"\u662F\u5426\u542F\u7528",align:"center",prop:"status"},{default:l(t=>[e(R,{modelValue:t.row.status,"onUpdate:modelValue":w=>t.row.status=w,"active-value":0,"inactive-value":1,onChange:w=>(async r=>{try{const Q=r.status===b.ENABLE?"\u542F\u7528":"\u7981\u7528";await p.confirm('\u786E\u8BA4\u8981"'+Q+'"\u8BE5\u5206\u6BB5\u5417?'),await S.updateKnowledgeSegmentStatus({id:r.id,status:r.status}),p.success(I("common.updateSuccess")),await i()}catch{r.status=r.status===b.ENABLE?b.DISABLE:b.ENABLE}})(t.row),disabled:!o(pe)(["ai:knowledge:update"])},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),e(s,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:o(ie),width:"180px"},null,8,["formatter"]),e(s,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:l(t=>[_((d(),g(m,{link:"",type:"primary",onClick:w=>U("update",t.row.id)},{default:l(()=>a[9]||(a[9]=[u(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[k,["ai:knowledge:update"]]]),_((d(),g(m,{link:"",type:"danger",onClick:w=>(async r=>{try{await p.delConfirm(),await S.deleteKnowledgeSegment(r),p.success(I("common.delSuccess")),await i()}catch{}})(t.row.id)},{default:l(()=>a[10]||(a[10]=[u(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[k,["ai:knowledge:delete"]]])]),_:1})]),_:1},8,["data"])),[[G,o(h)]]),e(j,{total:o(E),page:o(n).pageNo,"onUpdate:page":a[3]||(a[3]=t=>o(n).pageNo=t),limit:o(n).pageSize,"onUpdate:limit":a[4]||(a[4]=t=>o(n).pageSize=t),onPagination:i},null,8,["total","page","limit"])]),_:1}),e(ue,{ref_key:"formRef",ref:N,onSuccess:i},null,512)],64)}}});export{ke as default};
