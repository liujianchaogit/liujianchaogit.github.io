import{av as E,b as ae,d as le,aw as de,a as oe}from"./index-C1TKk8vI.js";import{_ as te}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as ue}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{a as se}from"./index-Bdw660V1.js";import{b as re,c as ie,u as ne}from"./index-DdKGlDdM.js";import{g as me}from"./index-CZiMqbPE.js";import{b as ce}from"./index-C_v5t3_7.js";import{d as pe,a as fe}from"./index-DLPyhh9r.js";import{_ as ve}from"./ContractProductForm.vue_vue_type_script_setup_true_lang-BsCJVFcd.js";import{k as be,ai as _e,j as Ve,Q as Ie,x as Ue,i as ge,F as we,a0 as Pe,a1 as ye,l as ke,h as he,f as Ce,aj as xe}from"./form-designer-BpYekVAY.js";import{x as Te,r as i,X as De,f as Fe,c as R,y as n,E as c,F as o,O as e,K as S,u as d,G as qe,z as V,a4 as I,M as U,l as z}from"./form-create-7GAbgMwl.js";const je=Te({__name:"ContractForm",emits:["success"],setup(Ee,{expose:G,emit:K}){const{t:P}=ae(),C=le(),p=i(!1),x=i(""),f=i(!1),g=i(""),t=i({id:void 0,no:void 0,name:void 0,customerId:void 0,businessId:void 0,orderDate:void 0,startTime:void 0,endTime:void 0,signUserId:void 0,signContactId:void 0,ownerUserId:void 0,discountPercent:0,totalProductPrice:void 0,remark:void 0,products:[]}),M=De({name:[{required:!0,message:"\u5408\u540C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],orderDate:[{required:!0,message:"\u4E0B\u5355\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),w=i(),y=i([]),T=i([]),D=i([]),F=i([]),k=i("product"),q=i();Fe(()=>t.value,u=>{if(!u)return;const l=u.products.reduce((s,r)=>s+r.totalPrice,0),m=l-(u.discountPercent!=null?de(l,u.discountPercent/100):0);t.value.totalProductPrice=l,t.value.totalPrice=m},{deep:!0}),G({open:async(u,l)=>{if(p.value=!0,x.value=P("action."+u),g.value=u,X(),l){f.value=!0;try{t.value=await re(l)}finally{f.value=!1}}T.value=await se(),y.value=await me(),g.value==="create"&&(t.value.ownerUserId=oe().getUser.id),F.value=await ce(),D.value=await pe()}});const O=K,Q=async()=>{if(w&&await w.value.validate()){f.value=!0,q.value.validate();try{const u=d(t.value);g.value==="create"?(await ie(u),C.success(P("common.createSuccess"))):(await ne(u),C.success(P("common.updateSuccess"))),p.value=!1,O("success")}finally{f.value=!1}}},X=()=>{var u;t.value={id:void 0,no:void 0,name:void 0,customerId:void 0,businessId:void 0,orderDate:void 0,startTime:void 0,endTime:void 0,signUserId:void 0,signContactId:void 0,ownerUserId:void 0,discountPercent:0,totalProductPrice:void 0,remark:void 0,products:[]},(u=w.value)==null||u.resetFields()},B=()=>{t.value.businessId=void 0,t.value.signContactId=void 0,t.value.products=[]},H=async u=>{const l=await fe(u);l.products.forEach(m=>{m.contractPrice=m.businessPrice}),t.value.products=l.products},J=R(()=>F.value.filter(u=>u.customerId==t.value.customerId)),L=R(()=>D.value.filter(u=>u.customerId==t.value.customerId));return(u,l)=>{const m=be,s=_e,r=Ve,v=Ie,b=Ue,_=ge,h=we,N=Pe,W=ye,Y=ue,Z=ke,$=he,j=Ce,A=te,ee=xe;return n(),c(A,{modelValue:d(p),"onUpdate:modelValue":l[16]||(l[16]=a=>z(p)?p.value=a:null),title:d(x),width:"1280"},{footer:o(()=>[e(j,{disabled:d(f),type:"primary",onClick:Q},{default:o(()=>l[17]||(l[17]=[S("\u4FDD\u5B58")])),_:1},8,["disabled"]),e(j,{onClick:l[15]||(l[15]=a=>p.value=!1)},{default:o(()=>l[18]||(l[18]=[S("\u53D6 \u6D88")])),_:1})]),default:o(()=>[qe((n(),c($,{ref_key:"formRef",ref:w,model:d(t),rules:d(M),"label-width":"120px"},{default:o(()=>[e(_,null,{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{label:"\u5408\u540C\u7F16\u53F7",prop:"no"},{default:o(()=>[e(m,{disabled:"",modelValue:d(t).no,"onUpdate:modelValue":l[0]||(l[0]=a=>d(t).no=a),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u5408\u540C\u540D\u79F0",prop:"name"},{default:o(()=>[e(m,{modelValue:d(t).name,"onUpdate:modelValue":l[1]||(l[1]=a=>d(t).name=a),placeholder:"\u8BF7\u8F93\u5165\u5408\u540C\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:o(()=>[e(b,{modelValue:d(t).ownerUserId,"onUpdate:modelValue":l[2]||(l[2]=a=>d(t).ownerUserId=a),disabled:d(g)!=="create",class:"w-1/1"},{default:o(()=>[(n(!0),V(U,null,I(d(y),a=>(n(),c(v,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(_,null,{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:o(()=>[e(b,{modelValue:d(t).customerId,"onUpdate:modelValue":l[3]||(l[3]=a=>d(t).customerId=a),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1",onChange:B},{default:o(()=>[(n(!0),V(U,null,I(d(T),a=>(n(),c(v,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u5546\u673A\u540D\u79F0",prop:"businessId"},{default:o(()=>[e(b,{onChange:H,disabled:!d(t).customerId,modelValue:d(t).businessId,"onUpdate:modelValue":l[4]||(l[4]=a=>d(t).businessId=a),class:"w-1/1"},{default:o(()=>[(n(!0),V(U,null,I(d(L),a=>(n(),c(v,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(_,null,{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{label:"\u4E0B\u5355\u65E5\u671F",prop:"orderDate"},{default:o(()=>[e(h,{modelValue:d(t).orderDate,"onUpdate:modelValue":l[5]||(l[5]=a=>d(t).orderDate=a),placeholder:"\u9009\u62E9\u4E0B\u5355\u65E5\u671F",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u5F00\u59CB\u65F6\u95F4",prop:"startTime"},{default:o(()=>[e(h,{modelValue:d(t).startTime,"onUpdate:modelValue":l[6]||(l[6]=a=>d(t).startTime=a),placeholder:"\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:o(()=>[e(h,{modelValue:d(t).endTime,"onUpdate:modelValue":l[7]||(l[7]=a=>d(t).endTime=a),placeholder:"\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,null,{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{label:"\u516C\u53F8\u7B7E\u7EA6\u4EBA",prop:"signUserId"},{default:o(()=>[e(b,{modelValue:d(t).signUserId,"onUpdate:modelValue":l[8]||(l[8]=a=>d(t).signUserId=a),class:"w-1/1"},{default:o(()=>[(n(!0),V(U,null,I(d(y),a=>(n(),c(v,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u5BA2\u6237\u7B7E\u7EA6\u4EBA",prop:"signContactId"},{default:o(()=>[e(b,{modelValue:d(t).signContactId,"onUpdate:modelValue":l[9]||(l[9]=a=>d(t).signContactId=a),disabled:!d(t).customerId,class:"w-1/1"},{default:o(()=>[(n(!0),V(U,null,I(d(J),a=>(n(),c(v,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[e(m,{modelValue:d(t).remark,"onUpdate:modelValue":l[10]||(l[10]=a=>d(t).remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Y,null,{default:o(()=>[e(W,{modelValue:d(k),"onUpdate:modelValue":l[11]||(l[11]=a=>z(k)?k.value=a:null),class:"-mt-15px -mb-10px"},{default:o(()=>[e(N,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:o(()=>[e(ve,{ref_key:"productFormRef",ref:q,products:d(t).products,disabled:u.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,null,{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:o(()=>[e(m,{disabled:"",modelValue:d(t).totalProductPrice,"onUpdate:modelValue":l[12]||(l[12]=a=>d(t).totalProductPrice=a),formatter:d(E)},null,8,["modelValue","formatter"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:o(()=>[e(Z,{modelValue:d(t).discountPercent,"onUpdate:modelValue":l[13]||(l[13]=a=>d(t).discountPercent=a),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:8},{default:o(()=>[e(s,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"totalPrice"},{default:o(()=>[e(m,{disabled:"",modelValue:d(t).totalPrice,"onUpdate:modelValue":l[14]||(l[14]=a=>d(t).totalPrice=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:d(E)},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[ee,d(f)]])]),_:1},8,["modelValue","title"])}}});export{je as _};
