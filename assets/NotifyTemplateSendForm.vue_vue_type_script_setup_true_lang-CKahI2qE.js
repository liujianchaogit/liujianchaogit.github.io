import{d as G,e as N,D as R}from"./index-C1TKk8vI.js";import{_ as j}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{x as z,r as i,X as K,y as s,E as f,F as u,O as r,u as l,K as y,G as v,z as V,M as _,a4 as b,L,P as T,l as O}from"./form-create-7GAbgMwl.js";import{g as Q}from"./index-CZiMqbPE.js";import{g as X,s as Y}from"./index-BFNgxSWX.js";import{k as A,ai as B,u as H,s as J,Q as W,x as Z,h as $,f as ee,aj as ae}from"./form-designer-BpYekVAY.js";const le=z({name:"SystemNotifyTemplateSendForm",__name:"NotifyTemplateSendForm",setup(te,{expose:x}){const I=G(),p=i(!1),n=i(!1),t=i({content:"",params:{},userId:void 0,userType:1,templateCode:"",templateParams:new Map}),g=K({userId:[{required:!0,message:"\u7528\u6237\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],templateCode:[{required:!0,message:"\u6A21\u7248\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],templateParams:{}}),c=i(),h=i([]);x({open:async m=>{p.value=!0,w(),n.value=!0;try{const e=await X(m);t.value.content=e.content,t.value.params=e.params,t.value.templateCode=e.code,t.value.templateParams=e.params.reduce((d,o)=>(d[o]="",d),{}),g.templateParams=e.params.reduce((d,o)=>(d[o]={required:!0,message:"\u53C2\u6570 "+o+" \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},d),{})}finally{n.value=!1}h.value=await Q()}});const k=async()=>{if(c&&await c.value.validate()){n.value=!0;try{const m=t.value,e=await Y(m);e&&I.success("\u63D0\u4EA4\u53D1\u9001\u6210\u529F\uFF01\u53D1\u9001\u7ED3\u679C\uFF0C\u89C1\u53D1\u9001\u65E5\u5FD7\u7F16\u53F7\uFF1A"+e),p.value=!1}finally{n.value=!1}}},w=()=>{var m;t.value={content:"",params:{},mobile:"",templateCode:"",templateParams:new Map,userType:1},(m=c.value)==null||m.resetFields()};return(m,e)=>{const d=A,o=B,U=H,C=J,S=W,q=Z,F=$,P=ee,E=j,M=ae;return s(),f(E,{modelValue:l(p),"onUpdate:modelValue":e[5]||(e[5]=a=>O(p)?p.value=a:null),title:"\u6D4B\u8BD5\u53D1\u9001","max-height":500},{footer:u(()=>[r(P,{disabled:l(n),type:"primary",onClick:k},{default:u(()=>e[6]||(e[6]=[y("\u786E \u5B9A")])),_:1},8,["disabled"]),r(P,{onClick:e[4]||(e[4]=a=>p.value=!1)},{default:u(()=>e[7]||(e[7]=[y("\u53D6 \u6D88")])),_:1})]),default:u(()=>[v((s(),f(F,{ref_key:"formRef",ref:c,model:l(t),rules:l(g),"label-width":"140px"},{default:u(()=>[r(o,{label:"\u6A21\u677F\u5185\u5BB9",prop:"content"},{default:u(()=>[r(d,{modelValue:l(t).content,"onUpdate:modelValue":e[0]||(e[0]=a=>l(t).content=a),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u5185\u5BB9",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),r(o,{label:"\u7528\u6237\u7C7B\u578B",prop:"userType"},{default:u(()=>[r(C,{modelValue:l(t).userType,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).userType=a)},{default:u(()=>[(s(!0),V(_,null,b(l(N)(l(R).USER_TYPE),a=>(s(),f(U,{key:a.value,value:a.value},{default:u(()=>[y(L(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(r(o,{label:"\u63A5\u6536\u4EBAID",prop:"userId"},{default:u(()=>[r(d,{modelValue:l(t).userId,"onUpdate:modelValue":e[2]||(e[2]=a=>l(t).userId=a),style:{width:"160px"}},null,8,["modelValue"])]),_:1},512),[[T,l(t).userType===1]]),v(r(o,{label:"\u63A5\u6536\u4EBA",prop:"userId"},{default:u(()=>[r(q,{modelValue:l(t).userId,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).userId=a),placeholder:"\u8BF7\u9009\u62E9\u63A5\u6536\u4EBA"},{default:u(()=>[(s(!0),V(_,null,b(l(h),a=>(s(),f(S,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},512),[[T,l(t).userType===2]]),(s(!0),V(_,null,b(l(t).params,a=>(s(),f(o,{key:a,label:"\u53C2\u6570 {"+a+"}",prop:"templateParams."+a},{default:u(()=>[r(d,{modelValue:l(t).templateParams[a],"onUpdate:modelValue":D=>l(t).templateParams[a]=D,placeholder:"\u8BF7\u8F93\u5165 "+a+" \u53C2\u6570"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])),[[M,l(n)]])]),_:1},8,["modelValue"])}}});export{le as _};
