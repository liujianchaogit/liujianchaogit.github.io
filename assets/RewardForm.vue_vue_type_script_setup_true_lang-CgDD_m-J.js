import{V as v,b as H,d as Q,e as h,D as k,G as R,aS as O}from"./index-C1TKk8vI.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as Z}from"./RewardRule.vue_vue_type_script_setup_true_lang-COfdsr1-.js";import $ from"./SpuShowcase-CfL_FGvb.js";import{l as V,k as p}from"./constants-IYPHa1Ih.js";import{_ as ee}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-hov9NPFT.js";import{K as ae,k as le,ai as te,F as oe,u as re,s as ue,h as de,f as se,aj as ce}from"./form-designer-BpYekVAY.js";import{x as pe,r as n,X as ie,y as i,E as g,F as r,O as u,u as l,K as _,G as ne,z as U,M as x,a4 as q,L as G,l as L,J as N,n as me}from"./form-create-7GAbgMwl.js";const ye=async m=>await v.get({url:"/promotion/reward-activity/page",params:m}),fe=async m=>await v.delete({url:"/promotion/reward-activity/delete?id="+m}),ve=async m=>await v.put({url:"/promotion/reward-activity/close?id="+m}),ge=pe({name:"ProductBrandForm",__name:"RewardForm",emits:["success"],setup(m,{expose:Y,emit:F}){const{t:T}=H(),b=Q(),y=n(!1),w=n(""),f=n(!1),C=n(""),a=n({conditionType:V.PRICE.type,productScope:p.ALL.scope,rules:[]}),D=ie({name:[{required:!0,message:"\u6D3B\u52A8\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],startAndEndTime:[{required:!0,message:"\u6D3B\u52A8\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionType:[{required:!0,message:"\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5546\u54C1\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),S=n(),I=n();Y({open:async(s,e)=>{var o;if(y.value=!0,w.value=T("action."+s),C.value=s,j(),e){f.value=!0;try{const d=await(async c=>await v.get({url:"/promotion/reward-activity/get?id="+c}))(e);d.startAndEndTime=[d.startTime,d.endTime],(o=d.rules)==null||o.forEach(c=>{c.discountPrice=R(c.discountPrice||0),d.conditionType===V.PRICE.type&&(c.limit=R(c.limit||0))}),a.value=d,await z()}finally{f.value=!1}}}});const M=F,K=async()=>{var s;if(S.value&&await S.value.validate()){f.value=!0;try{(s=I.value)==null||s.setRuleCoupon();const e=ae(a.value);e.startTime=e.startAndEndTime[0],e.endTime=e.startAndEndTime[1],delete e.startAndEndTime,e.rules.forEach(o=>{o.discountPrice=O(o.discountPrice||0),e.conditionType===V.PRICE.type&&(o.limit=O(o.limit||0))}),function(o){switch(a.value.productScope){case p.SPU.scope:o.productScopeValues=a.value.productSpuIds;break;case p.CATEGORY.scope:o.productScopeValues=Array.isArray(a.value.productCategoryIds)?a.value.productCategoryIds:[a.value.productCategoryIds]}}(e),C.value==="create"?(await(async o=>await v.post({url:"/promotion/reward-activity/create",data:o}))(e),b.success(T("common.createSuccess"))):(await(async o=>await v.put({url:"/promotion/reward-activity/update",data:o}))(e),b.success(T("common.updateSuccess"))),y.value=!1,M("success")}finally{f.value=!1}}},j=()=>{a.value={conditionType:V.PRICE.type,productScope:p.ALL.scope,rules:[]}},z=async()=>{switch(a.value.productScope){case p.SPU.scope:a.value.productSpuIds=a.value.productScopeValues;break;case p.CATEGORY.scope:await me();let s=a.value.productScopeValues;Array.isArray(s)&&s.length===1&&(s=s[0]),a.value.productCategoryIds=s}};return(s,e)=>{const o=le,d=te,c=oe,E=re,A=ue,B=de,P=se,J=W,X=ce;return i(),g(J,{modelValue:l(y),"onUpdate:modelValue":e[9]||(e[9]=t=>L(y)?y.value=t:null),title:l(w),width:"65%"},{footer:r(()=>[u(P,{disabled:l(f),type:"primary",onClick:K},{default:r(()=>e[10]||(e[10]=[_("\u786E \u5B9A")])),_:1},8,["disabled"]),u(P,{onClick:e[8]||(e[8]=t=>y.value=!1)},{default:r(()=>e[11]||(e[11]=[_("\u53D6 \u6D88")])),_:1})]),default:r(()=>[ne((i(),g(B,{ref_key:"formRef",ref:S,model:l(a),rules:l(D),"label-width":"80px"},{default:r(()=>[u(d,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:r(()=>[u(o,{modelValue:l(a).name,"onUpdate:modelValue":e[0]||(e[0]=t=>l(a).name=t),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(d,{label:"\u6D3B\u52A8\u65F6\u95F4",prop:"startAndEndTime"},{default:r(()=>[u(c,{modelValue:l(a).startAndEndTime,"onUpdate:modelValue":e[1]||(e[1]=t=>l(a).startAndEndTime=t),"end-placeholder":l(T)("common.endTimeText"),"start-placeholder":l(T)("common.startTimeText"),"range-separator":"-",type:"datetimerange","value-format":"x"},null,8,["modelValue","end-placeholder","start-placeholder"])]),_:1}),u(d,{label:"\u6761\u4EF6\u7C7B\u578B",prop:"conditionType"},{default:r(()=>[u(A,{modelValue:l(a).conditionType,"onUpdate:modelValue":e[2]||(e[2]=t=>l(a).conditionType=t)},{default:r(()=>[(i(!0),U(x,null,q(l(h)(l(k).PROMOTION_CONDITION_TYPE),t=>(i(),g(E,{key:t.value,label:t.value},{default:r(()=>[_(G(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(d,{label:"\u4F18\u60E0\u8BBE\u7F6E"},{default:r(()=>[u(Z,{ref_key:"rewardRuleRef",ref:I,modelValue:l(a),"onUpdate:modelValue":e[3]||(e[3]=t=>L(a)?a.value=t:null)},null,8,["modelValue"])]),_:1}),u(d,{label:"\u6D3B\u52A8\u8303\u56F4",prop:"productScope"},{default:r(()=>[u(A,{modelValue:l(a).productScope,"onUpdate:modelValue":e[4]||(e[4]=t=>l(a).productScope=t)},{default:r(()=>[(i(!0),U(x,null,q(l(h)(l(k).PROMOTION_PRODUCT_SCOPE),t=>(i(),g(E,{key:t.value,label:t.value},{default:r(()=>[_(G(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(a).productScope===l(p).SPU.scope?(i(),g(d,{key:0,prop:"productSpuIds"},{default:r(()=>[u($,{modelValue:l(a).productSpuIds,"onUpdate:modelValue":e[5]||(e[5]=t=>l(a).productSpuIds=t)},null,8,["modelValue"])]),_:1})):N("",!0),l(a).productScope===l(p).CATEGORY.scope?(i(),g(d,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:r(()=>[u(ee,{modelValue:l(a).productCategoryIds,"onUpdate:modelValue":e[6]||(e[6]=t=>l(a).productCategoryIds=t),multiple:!0},null,8,["modelValue"])]),_:1})):N("",!0),u(d,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[u(o,{modelValue:l(a).remark,"onUpdate:modelValue":e[7]||(e[7]=t=>l(a).remark=t),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[X,l(f)]])]),_:1},8,["modelValue","title"])}}});export{ge as _,ve as c,fe as d,ye as g};
