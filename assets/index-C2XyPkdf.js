import{D as ne,d as pe,A as de,c as ue}from"./index-C1TKk8vI.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as fe}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{x as ve,r as n,j as ye,y as f,E as g,F as t,C as m,O as a,u as e,L as T,J as k,K as Z,l as q,G as V,z as H,P as $,n as xe,ae as be}from"./form-create-7GAbgMwl.js";import{f as _e}from"./formatTime-EbFUBcAO.js";import{B as R,a as S}from"./constants-IYPHa1Ih.js";import{b as ge}from"./formCreate-DNZv5C32.js";import{g as Te,a as ke}from"./index-C52Al6V4.js";import{g as Ie}from"./index-CZiMqbPE.js";import he from"./ProcessInstanceBpmnViewer-CPqCMmGq.js";import{_ as Ne}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-CkpBAPzO.js";import{_ as Ce}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-TNI6R5-j.js";import we from"./ProcessInstanceOperationButton-B7JFS-_i.js";import{_ as Ee}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-t8BTVj8T.js";import{F as j}from"./consts-D6_WKT2v.js";import{T as w}from"./index-DwSWB2Hs.js";import{W as Pe,af as Ue,j as Oe,i as Ve,e as Re,a0 as Se,a1 as je,aj as Ae}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";import"./bpmn-embedded-CLKwycJq.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./XTextButton-BjjL95Dk.js";import"./XButton-we2I6miX.js";import"./index-DREge7zO.js";import"./node-Do_BcwVI.js";import"./index-BCN8BzfC.js";import"./utils-QiRL3TXx.js";import"./index-BwT0n6gf.js";import"./tree-COGD3qag.js";import"./index-BtHQyrBm.js";import"./index-B0Mya_PA.js";import"./index-CYJDvQdV.js";import"./index-DbP8QQV-.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./index-D2S4HpRp.js";import"./index-DMrIORbd.js";import"./simple-process-designer-DWOFOAFc.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-C6CtoOwH.js";import"./index-j0g2sdlj.js";import"./download-oWiM5xVU.js";import"./SignDialog.vue_vue_type_script_setup_true_lang-am84u5wT.js";import"./index-vcegfSq2.js";const Be={class:"processInstance-wrap-main"},De=["src"],Me={class:"text-#878c93 h-15px"},Fe={class:"flex items-center gap-5 mb-10px h-40px"},Le={class:"text-26px font-bold mb-5px"},ze={class:"flex items-center gap-5 mb-10px text-13px h-35px"},Ke={class:"bg-gray-100 h-35px rounded-3xl flex items-center p-8px gap-2 dark:color-gray-600"},Ge={class:"text-#878c93"},Je={class:"form-scroll-area"},We={class:"form-box flex flex-col mb-30px flex-1"},Ye={key:1},Qe={class:"form-scroll-area"},Xe={class:"form-scroll-area"},Ze={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},qe=ue(ve({name:"BpmProcessInstanceDetail",__name:"index",props:{id:{},taskId:{},activityId:{}},setup(ee){const I=ee,A=pe(),v=n(!1),o=n({}),i=n({}),h=n({}),B=n(),ae={[w.RUNNING]:"/assets/running-Cm4KjmYZ.svg",[w.APPROVE]:"/assets/approve-BQD8ihNj.svg",[w.REJECT]:"/assets/reject-C_en7x-2.svg",[w.CANCEL]:"/assets/cancel-Cn_ivYkt.svg"},p=n(),d=n({rule:[],option:{},value:{}}),E=[],D=()=>{se(),oe()},M=n(null),se=async()=>{var r,s;v.value=!0;try{const y={processInstanceId:I.id,activityId:I.activityId,taskId:I.taskId},l=await Te(y);if(!l)return void A.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(!l.processDefinition||!l.processInstance)return void A.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");if(o.value=l.processInstance,i.value=l.processDefinition,i.value.formType===R.NORMAL){const u=l.formFieldsPermission;E.splice(0),((r=d.value.rule)==null?void 0:r.length)>0?d.value.value=o.value.formVariables:ge(d,i.value.formConf,i.value.formFields,o.value.formVariables),xe().then(()=>{var N,x,C;(N=p.value)==null||N.btn.show(!1),(x=p.value)==null||x.resetBtn.show(!1),(C=p.value)==null||C.disabled(!0),u&&Object.keys(l.formFieldsPermission).forEach(b=>{le(b,u[b])})})}else M.value=de(l.processDefinition.formCustomViewPath);F.value=l.activityNodes,(s=B.value)==null||s.loadTodoTask(l.todoTask)}finally{v.value=!1}},oe=async()=>{var s;S.BPMN===((s=i.value)==null?void 0:s.modelType)&&(h.value={bpmnXml:""});const r=await ke(I.id);r&&(h.value=r)},F=n([]),le=(r,s)=>{var y,l,u;s===j.READ&&((y=p.value)==null||y.disabled(!0,r)),s===j.WRITE&&((l=p.value)==null||l.disabled(!1,r),E.push(r)),s===j.NONE&&((u=p.value)==null||u.hidden(!0,r))},re=()=>{D()},P=n("form"),L=n([]);return ye(async()=>{D(),L.value=await Ie()}),(r,s)=>{const y=Pe,l=fe,u=Ue,N=be("form-create"),x=Oe,C=Ve,b=Re,U=Se,te=je,ie=ce,me=Ae;return f(),g(ie,{bodyStyle:{padding:"10px 20px 0"},class:"position-relative"},{default:t(()=>[m("div",Be,[a(b,null,{default:t(()=>{var z,K,G,J,W,Y,Q,X;return[m("img",{class:"position-absolute right-20px",width:"150",src:ae[e(o).status],alt:""},null,8,De),m("div",Me,"\u7F16\u53F7\uFF1A"+T(r.id),1),a(y,{class:"!my-8px"}),m("div",Fe,[m("div",Le,T(e(o).name),1),e(o).status?(f(),g(l,{key:0,type:e(ne).BPM_PROCESS_INSTANCE_STATUS,value:e(o).status},null,8,["type","value"])):k("",!0)]),m("div",ze,[m("div",Ke,[(K=(z=e(o))==null?void 0:z.startUser)!=null&&K.avatar?(f(),g(u,{key:0,size:28,src:(J=(G=e(o))==null?void 0:G.startUser)==null?void 0:J.avatar},null,8,["src"])):(Y=(W=e(o))==null?void 0:W.startUser)!=null&&Y.nickname?(f(),g(u,{key:1,size:28},{default:t(()=>{var c,_;return[Z(T((_=(c=e(o))==null?void 0:c.startUser)==null?void 0:_.nickname.substring(0,1)),1)]}),_:1})):k("",!0),Z(" "+T((X=(Q=e(o))==null?void 0:Q.startUser)==null?void 0:X.nickname),1)]),m("div",Ge,T(e(_e)(e(o).startTime))+" \u63D0\u4EA4 ",1)]),a(te,{modelValue:e(P),"onUpdate:modelValue":s[2]||(s[2]=c=>q(P)?P.value=c:null)},{default:t(()=>[a(U,{label:"\u5BA1\u6279\u8BE6\u60C5",name:"form"},{default:t(()=>[m("div",Je,[a(b,null,{default:t(()=>[a(C,null,{default:t(()=>[a(x,{span:17,class:"!flex !flex-col formCol"},{default:t(()=>{var c,_;return[V((f(),H("div",We,[((c=e(i))==null?void 0:c.formType)===e(R).NORMAL?(f(),g(x,{key:0},{default:t(()=>[a(N,{modelValue:e(d).value,"onUpdate:modelValue":s[0]||(s[0]=O=>e(d).value=O),api:e(p),"onUpdate:api":s[1]||(s[1]=O=>q(p)?p.value=O:null),option:e(d).option,rule:e(d).rule},null,8,["modelValue","api","option","rule"])]),_:1})):k("",!0),((_=e(i))==null?void 0:_.formType)===e(R).CUSTOM?(f(),H("div",Ye,[a(e(M),{id:e(o).businessKey},null,8,["id"])])):k("",!0)])),[[me,e(v)]])]}),_:1}),a(x,{span:7},{default:t(()=>[a(Ee,{"activity-nodes":e(F)},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(U,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:t(()=>[m("div",Qe,[V(a(Ne,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[$,e(i).modelType&&e(i).modelType===e(S).SIMPLE]]),V(a(he,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[$,e(i).modelType&&e(i).modelType===e(S).BPMN]])])]),_:1}),a(U,{label:"\u6D41\u8F6C\u8BB0\u5F55",name:"record"},{default:t(()=>[m("div",Xe,[a(b,null,{default:t(()=>[a(Ce,{loading:e(v),id:r.id},null,8,["loading","id"])]),_:1})])]),_:1}),k("",!0)]),_:1},8,["modelValue"]),m("div",Ze,[a(we,{ref_key:"operationButtonRef",ref:B,"process-instance":e(o),"process-definition":e(i),userOptions:e(L),"normal-form":e(d),"normal-form-api":e(p),"writable-fields":E,onSuccess:re},null,8,["process-instance","process-definition","userOptions","normal-form","normal-form-api"])])]}),_:1})])]),_:1})}}}),[["__scopeId","data-v-6799f0b5"]]);export{qe as default};
