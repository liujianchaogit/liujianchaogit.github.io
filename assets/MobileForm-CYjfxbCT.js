import{a as D,d as G,o as J,u as K,ai as Q,y as W,z as X,aj as Y,r as Z,c as $}from"./index-DiGvuAxb.js";import{_ as ee}from"./XButton-BXTtfQPD.js";import{k as le,r as g,c as ae,u as e,P as N,b as oe,A as te,I as ne,y as w,m as f,z as a,H as l,C as h,l as C,F as S}from"./form-create-D7wT855o.js";import{u as y}from"./useIcon-D9kiYfhb.js";import{u as ie,L as se,_ as de,a as re}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-Bo4PwzaE.js";import{r as _}from"./formRules-D4RhDYOS.js";import{i as me,j as pe,ai as ue,k as ce,h as ge,d as V}from"./form-designer-drfGvdgz.js";const fe={key:1,class:"getMobileCode",style:{cursor:"pointer"}},be=$(le({name:"MobileForm",__name:"MobileForm",setup(he){const{t:i}=D(),I=G(),L=J(),{currentRoute:M,push:E}=K(),x=g(),u=g(!1),P=y({icon:"ep:house"}),j=y({icon:"ep:cellphone"}),z=y({icon:"ep:circle-check"}),{validForm:U}=re(x),{handleBackLogin:B,getLoginState:R}=ie(),T=ae(()=>e(R)===se.MOBILE),q={tenantName:[_],mobileNumber:[_],code:[_]},o=N({codeImg:"",tenantEnable:"false",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"\u828B\u9053\u6E90\u7801",mobileNumber:"",code:""}}),p=N({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),s=g(0),c=g(""),A=async()=>{await v(),p.smsCode.mobile=o.loginForm.mobileNumber,await Q(p.smsCode).then(async()=>{I.success(i("login.SmsSendMsg")),s.value=60;let n=setInterval(()=>{s.value=s.value-1,s.value<=0&&clearInterval(n)},1e3)})};oe(()=>M.value,n=>{var t;c.value=(t=n==null?void 0:n.query)==null?void 0:t.redirect},{immediate:!0});const v=async()=>{if(o.tenantEnable==="true"){const n=await W(o.loginForm.tenantName);X(n)}};return(n,t)=>{const m=ue,d=pe,b=ce,k=me,F=ee,H=ge;return te((f(),w(H,{ref_key:"formSmsLogin",ref:x,model:e(o).loginForm,rules:q,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:a(()=>[l(k,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:a(()=>[l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[l(m,null,{default:a(()=>[l(de,{style:{width:"100%"}})]),_:1})]),_:1}),l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[e(o).tenantEnable==="true"?(f(),w(m,{key:0,prop:"tenantName"},{default:a(()=>[l(b,{modelValue:e(o).loginForm.tenantName,"onUpdate:modelValue":t[0]||(t[0]=r=>e(o).loginForm.tenantName=r),placeholder:e(i)("login.tenantNamePlaceholder"),"prefix-icon":e(P),type:"primary",link:""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):h("",!0)]),_:1}),l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[l(m,{prop:"mobileNumber"},{default:a(()=>[l(b,{modelValue:e(o).loginForm.mobileNumber,"onUpdate:modelValue":t[1]||(t[1]=r=>e(o).loginForm.mobileNumber=r),placeholder:e(i)("login.mobileNumberPlaceholder"),"prefix-icon":e(j)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[l(m,{prop:"code"},{default:a(()=>[l(k,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:a(()=>[l(d,{span:24},{default:a(()=>[l(b,{modelValue:e(o).loginForm.code,"onUpdate:modelValue":t[2]||(t[2]=r=>e(o).loginForm.code=r),placeholder:e(i)("login.codePlaceholder"),"prefix-icon":e(z)},{append:a(()=>[e(s)<=0?(f(),C("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:A},S(e(i)("login.getSmsCode")),1)):h("",!0),e(s)>0?(f(),C("span",fe,S(e(s))+"\u79D2\u540E\u53EF\u91CD\u65B0\u83B7\u53D6 ",1)):h("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[l(m,null,{default:a(()=>[l(F,{loading:e(u),title:e(i)("login.login"),class:"w-[100%]",type:"primary",onClick:t[3]||(t[3]=r=>(async()=>{await v(),await U()&&(V.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),u.value=!0,p.loginSms.mobile=o.loginForm.mobileNumber,p.loginSms.code=o.loginForm.code,await Y(p.loginSms).then(async O=>{Z(O),c.value||(c.value="/"),E({path:c.value||L.addRouters[0].path})}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{V.service().close()},400)}))})())},null,8,["loading","title"])]),_:1})]),_:1}),l(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:a(()=>[l(m,null,{default:a(()=>[l(F,{loading:e(u),title:e(i)("login.backLogin"),class:"w-[100%]",onClick:t[4]||(t[4]=r=>e(B)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[ne,e(T)]])}}}),[["__scopeId","data-v-a3cd5b9c"]]);export{be as default};
