import{b as z,d as A}from"./index-C1TKk8vI.js";import{_ as H}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as M}from"./Tooltip.vue_vue_type_script_setup_true_lang-CTZOMnhL.js";import{D as P,b as Q,c as T,u as W}from"./index-2SiQtehE.js";import{d as Y,h as Z}from"./tree-COGD3qag.js";import{g as ee}from"./index-B0Mya_PA.js";import{k as ae,ai as le,y as te,a7 as se,$ as de,l as ue,f as oe,_ as re,h as ne,aj as ie}from"./form-designer-BpYekVAY.js";import{x as ce,r as n,X as me,y as o,E as r,F as l,O as t,u as s,K as i,G as pe,L as g,J as F,l as fe}from"./form-create-7GAbgMwl.js";const ve=ce({__name:"BusinessStatusForm",emits:["success"],setup(ye,{expose:K,emit:R}){const{t:_}=z(),V=A(),c=n(!1),x=n(""),m=n(!1),C=n(""),d=n({id:void 0,name:"",deptIds:[],statuses:[]}),q=me({name:[{required:!0,message:"\u72B6\u6001\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=n(),S=n([]),f=n(),U=n(!0);K({open:async(u,e)=>{if(c.value=!0,x.value=_("action."+u),C.value=u,D(),e){m.value=!0;try{d.value=await Q(e),f.value.setCheckedKeys(d.value.deptIds),d.value.statuses.length==0&&w()}finally{m.value=!1}}else w();S.value=Z(await ee())}});const B=R,j=async()=>{await h.value.validate(),m.value=!0;try{const u=d.value;u.deptIds=f.value.getCheckedKeys(!1),C.value==="create"?(await T(u),V.success(_("common.createSuccess"))):(await W(u),V.success(_("common.updateSuccess"))),c.value=!1,B("success")}finally{m.value=!1}},D=()=>{var u,e;U.value=!0,d.value={id:void 0,name:"",deptIds:[],statuses:[]},(u=f.value)==null||u.setCheckedNodes([]),(e=h.value)==null||e.resetFields()},w=()=>{d.value.statuses.push({name:"",percent:void 0})};return(u,e)=>{const I=ae,b=le,E=M,G=te,v=se,y=de,J=ue,k=oe,L=re,N=ne,O=H,X=ie;return o(),r(O,{title:s(x),modelValue:s(c),"onUpdate:modelValue":e[2]||(e[2]=a=>fe(c)?c.value=a:null)},{footer:l(()=>[t(k,{onClick:j,type:"primary",disabled:s(m)},{default:l(()=>e[6]||(e[6]=[i("\u786E \u5B9A")])),_:1},8,["disabled"]),t(k,{onClick:e[1]||(e[1]=a=>c.value=!1)},{default:l(()=>e[7]||(e[7]=[i("\u53D6 \u6D88")])),_:1})]),default:l(()=>[pe((o(),r(N,{ref_key:"formRef",ref:h,model:s(d),rules:s(q),"label-width":"100px"},{default:l(()=>[t(b,{label:"\u72B6\u6001\u7EC4\u540D",prop:"name"},{default:l(()=>[t(I,{modelValue:s(d).name,"onUpdate:modelValue":e[0]||(e[0]=a=>s(d).name=a),placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u7EC4\u540D"},null,8,["modelValue"])]),_:1}),t(b,{label:"\u5E94\u7528\u90E8\u95E8",prop:"deptIds"},{label:l(()=>[t(E,{message:"\u4E0D\u9009\u62E9\u90E8\u95E8\u65F6\uFF0C\u9ED8\u8BA4\u5168\u516C\u53F8\u751F\u6548",title:"\u5E94\u7528\u90E8\u95E8"})]),default:l(()=>[t(G,{ref_key:"treeRef",ref:f,data:s(S),props:s(Y),"check-strictly":!s(U),"node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","show-checkbox":""},null,8,["data","props","check-strictly"])]),_:1}),t(b,{label:"\u9636\u6BB5\u8BBE\u7F6E",prop:"statuses"},{default:l(()=>[t(L,{border:"",style:{width:"100%"},data:s(d).statuses.concat(P)},{default:l(()=>[t(y,{align:"center",label:"\u9636\u6BB5",width:"70"},{default:l(a=>[a.row.defaultStatus?(o(),r(v,{key:1},{default:l(()=>e[3]||(e[3]=[i("\u7ED3\u675F")])),_:1})):(o(),r(v,{key:0},{default:l(()=>[i("\u9636\u6BB5 "+g(a.$index+1),1)]),_:2},1024))]),_:1}),t(y,{align:"center",label:"\u9636\u6BB5\u540D\u79F0",width:"160",prop:"name"},{default:l(({row:a})=>[a.endStatus?(o(),r(v,{key:1},{default:l(()=>[i(g(a.name),1)]),_:2},1024)):(o(),r(I,{key:0,modelValue:a.name,"onUpdate:modelValue":p=>a.name=p,placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),t(y,{width:"140",align:"center",label:"\u8D62\u5355\u7387\uFF08%\uFF09",prop:"percent"},{default:l(({row:a})=>[a.endStatus?(o(),r(v,{key:1},{default:l(()=>[i(g(a.percent),1)]),_:2},1024)):(o(),r(J,{key:0,modelValue:a.percent,"onUpdate:modelValue":p=>a.percent=p,placeholder:"\u8BF7\u8F93\u5165\u8D62\u5355\u7387","controls-position":"right",min:0,max:100,precision:2,class:"!w-1/1"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),t(y,{label:"\u64CD\u4F5C",width:"110",align:"center"},{default:l(a=>[a.row.endStatus?F("",!0):(o(),r(k,{key:0,link:"",type:"primary",onClick:p=>w(a.$index)},{default:l(()=>e[4]||(e[4]=[i(" \u6DFB\u52A0 ")])),_:2},1032,["onClick"])),a.row.endStatus?F("",!0):(o(),r(k,{key:1,link:"",type:"danger",onClick:p=>{return $=a.$index,void d.value.statuses.splice($,1);var $},disabled:s(d).statuses.length<=1},{default:l(()=>e[5]||(e[5]=[i(" \u5220\u9664 ")])),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[X,s(m)]])]),_:1},8,["title","modelValue"])}}});export{ve as _};
