import{b as G,d as H}from"./index-C1TKk8vI.js";import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{d as O,h as X}from"./tree-COGD3qag.js";import{g as q}from"./index-DvrIs0Uy.js";import{g as z,a as B}from"./index-BLpDMWlm.js";import{a6 as J,ai as P,D as Q,y as T,ad as W,h as Y,f as Z,aj as $}from"./form-designer-BpYekVAY.js";import{x as ee,r as d,X as ae,y as w,E as C,F as l,O as s,u as o,K as c,G as le,L as V,l as h}from"./form-create-7GAbgMwl.js";const se=ee({name:"SystemRoleAssignMenuForm",__name:"RoleAssignMenuForm",emits:["success"],setup(te,{expose:b,emit:g}){const{t:I}=G(),F=H(),n=d(!1),i=d(!1),t=ae({id:void 0,name:"",code:"",menuIds:[]}),p=d(),y=d([]),m=d(!1),u=d(),v=d(!1);b({open:async a=>{n.value=!0,M(),y.value=X(await q()),t.id=a.id,t.name=a.name,t.code=a.code,i.value=!0;try{t.value.menuIds=await z(a.id),t.value.menuIds.forEach(e=>{u.value.setChecked(e,!0,!1)})}finally{i.value=!1}}});const R=g,K=async()=>{if(p&&await p.value.validate()){i.value=!0;try{const a={roleId:t.id,menuIds:[...u.value.getCheckedKeys(!1),...u.value.getHalfCheckedKeys()]};await B(a),F.success(I("common.updateSuccess")),n.value=!1,R("success")}finally{i.value=!1}}},M=()=>{var a,e;v.value=!1,m.value=!1,t.value={id:void 0,name:"",code:"",menuIds:[]},(a=u.value)==null||a.setCheckedNodes([]),(e=p.value)==null||e.resetFields()},U=()=>{u.value.setCheckedNodes(v.value?y.value:[])},A=()=>{var e;const a=(e=u.value)==null?void 0:e.store.nodesMap;for(let f in a)a[f].expanded!==m.value&&(a[f].expanded=m.value)};return(a,e)=>{const f=J,_=P,x=Q,E=T,N=W,S=Y,k=Z,j=L,D=$;return w(),C(j,{modelValue:o(n),"onUpdate:modelValue":e[3]||(e[3]=r=>h(n)?n.value=r:null),title:"\u83DC\u5355\u6743\u9650"},{footer:l(()=>[s(k,{disabled:o(i),type:"primary",onClick:K},{default:l(()=>e[6]||(e[6]=[c("\u786E \u5B9A")])),_:1},8,["disabled"]),s(k,{onClick:e[2]||(e[2]=r=>n.value=!1)},{default:l(()=>e[7]||(e[7]=[c("\u53D6 \u6D88")])),_:1})]),default:l(()=>[le((w(),C(S,{ref_key:"formRef",ref:p,model:o(t),"label-width":"80px"},{default:l(()=>[s(_,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[s(f,null,{default:l(()=>[c(V(o(t).name),1)]),_:1})]),_:1}),s(_,{label:"\u89D2\u8272\u6807\u8BC6"},{default:l(()=>[s(f,null,{default:l(()=>[c(V(o(t).code),1)]),_:1})]),_:1}),s(_,{label:"\u83DC\u5355\u6743\u9650"},{default:l(()=>[s(N,{class:"w-full h-400px !overflow-y-scroll",shadow:"never"},{header:l(()=>[e[4]||(e[4]=c(" \u5168\u9009/\u5168\u4E0D\u9009: ")),s(x,{modelValue:o(v),"onUpdate:modelValue":e[0]||(e[0]=r=>h(v)?v.value=r:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:U},null,8,["modelValue"]),e[5]||(e[5]=c(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: ")),s(x,{modelValue:o(m),"onUpdate:modelValue":e[1]||(e[1]=r=>h(m)?m.value=r:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:A},null,8,["modelValue"])]),default:l(()=>[s(E,{ref_key:"treeRef",ref:u,data:o(y),props:o(O),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019","node-key":"id","show-checkbox":""},null,8,["data","props"])]),_:1})]),_:1})]),_:1},8,["model"])),[[D,o(i)]])]),_:1},8,["modelValue"])}}});export{se as _};
