import{a as M,d as N,h as Q,D as Y,b as $}from"./index-DiGvuAxb.js";import{_ as z}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{b as J,c as O,u as W}from"./index-LzLQUCg-.js";import{g as X}from"./index-BEHCTgo8.js";import{a as Z}from"./index-CwL9yoSU.js";import{d as ee}from"./index-D4xnjFDX.js";import{aj as le,h as ae,i as ue,j as re,ai as de,k as te,x as se,Q as oe,l as ne,F as ie,f as me,K as ce}from"./form-designer-drfGvdgz.js";import{k as pe,r as i,P as fe,y as v,m as n,z as u,A as ve,u as l,H as a,l as w,G as I,$ as g,E as D,h as be}from"./form-create-D7wT855o.js";const _e=pe({__name:"ReceivablePlanForm",emits:["success"],setup(Ve,{expose:F,emit:P}){const{t:U}=M(),T=N(),x=i([]),m=i(!1),E=i(""),c=i(!1),p=i(""),d=i({}),S=fe({price:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=i(),R=i([]),h=i([]);F({open:async(s,r,f,o)=>{if(m.value=!0,E.value=U("action."+s),p.value=s,B(),r){c.value=!0;try{const t=await J(r);d.value=ce(t),await k(t.customerId),d.value.contractId=t==null?void 0:t.contractId}finally{c.value=!1}}x.value=await X(),R.value=await Z(),p.value==="create"&&(d.value.ownerUserId=$().getUser.id),f&&(d.value.customerId=f,await k(f)),o&&(d.value.contractId=o)}});const j=P,A=async()=>{if(b&&await b.value.validate()){c.value=!0;try{const s=d.value;p.value==="create"?(await O(s),T.success(U("common.createSuccess"))):(await W(s),T.success(U("common.updateSuccess"))),m.value=!1,j("success")}finally{c.value=!1}}},B=()=>{var s;d.value={},(s=b.value)==null||s.resetFields()},k=async s=>{d.value.contractId=void 0,s&&(h.value=[],h.value=await ee(s))};return(s,r)=>{const f=te,o=de,t=re,_=oe,V=se,y=ue,q=ne,G=ie,H=ae,C=me,K=z,L=le;return n(),v(K,{modelValue:l(m),"onUpdate:modelValue":r[10]||(r[10]=e=>be(m)?m.value=e:null),title:l(E)},{footer:u(()=>[a(C,{disabled:l(c),type:"primary",onClick:A},{default:u(()=>r[11]||(r[11]=[D("\u786E \u5B9A")])),_:1},8,["disabled"]),a(C,{onClick:r[9]||(r[9]=e=>m.value=!1)},{default:u(()=>r[12]||(r[12]=[D("\u53D6 \u6D88")])),_:1})]),default:u(()=>[ve((n(),v(H,{ref_key:"formRef",ref:b,model:l(d),rules:l(S),"label-width":"110px"},{default:u(()=>[a(y,null,{default:u(()=>[a(t,{span:12},{default:u(()=>[a(o,{label:"\u8FD8\u6B3E\u671F\u6570",prop:"period"},{default:u(()=>[a(f,{modelValue:l(d).period,"onUpdate:modelValue":r[0]||(r[0]=e=>l(d).period=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:12},{default:u(()=>[a(o,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:u(()=>[a(V,{modelValue:l(d).ownerUserId,"onUpdate:modelValue":r[1]||(r[1]=e=>l(d).ownerUserId=e),disabled:l(p)!=="create",class:"w-1/1"},{default:u(()=>[(n(!0),w(I,null,g(l(x),e=>(n(),v(_,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:u(()=>[a(t,{span:12},{default:u(()=>[a(o,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:u(()=>[a(V,{modelValue:l(d).customerId,"onUpdate:modelValue":r[2]||(r[2]=e=>l(d).customerId=e),disabled:l(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:k},{default:u(()=>[(n(!0),w(I,null,g(l(R),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(t,{span:12},{default:u(()=>[a(o,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:u(()=>[a(V,{modelValue:l(d).contractId,"onUpdate:modelValue":r[3]||(r[3]=e=>l(d).contractId=e),disabled:l(p)!=="create"||!l(d).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C"},{default:u(()=>[(n(!0),w(I,null,g(l(h),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:u(()=>[a(t,{span:12},{default:u(()=>[a(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:u(()=>[a(q,{modelValue:l(d).price,"onUpdate:modelValue":r[4]||(r[4]=e=>l(d).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:12},{default:u(()=>[a(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:u(()=>[a(G,{modelValue:l(d).returnTime,"onUpdate:modelValue":r[5]||(r[5]=e=>l(d).returnTime=e),placeholder:"\u9009\u62E9\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:u(()=>[a(t,{span:12},{default:u(()=>[a(o,{label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays"},{default:u(()=>[a(q,{modelValue:l(d).remindDays,"onUpdate:modelValue":r[6]||(r[6]=e=>l(d).remindDays=e),class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u63D0\u524D\u51E0\u5929\u63D0\u9192"},null,8,["modelValue"])]),_:1})]),_:1}),a(t,{span:12},{default:u(()=>[a(o,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:u(()=>[a(V,{modelValue:l(d).returnType,"onUpdate:modelValue":r[7]||(r[7]=e=>l(d).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:u(()=>[(n(!0),w(I,null,g(l(Q)(l(Y).CRM_RECEIVABLE_RETURN_TYPE),e=>(n(),v(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(t,{span:24},{default:u(()=>[a(o,{label:"\u5907\u6CE8",prop:"remark"},{default:u(()=>[a(f,{modelValue:l(d).remark,"onUpdate:modelValue":r[8]||(r[8]=e=>l(d).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[L,l(c)]])]),_:1},8,["modelValue","title"])}}});export{_e as _};
