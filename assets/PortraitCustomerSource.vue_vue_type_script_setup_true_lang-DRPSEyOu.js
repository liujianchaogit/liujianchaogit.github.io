import{D as p,H as b,L,aJ as g,aH as C}from"./index-DiGvuAxb.js";import{_ as W}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{_ as T}from"./Echart.vue_vue_type_script_setup_true_lang-DccU3tqu.js";import{S as j}from"./portrait-CHeb7gaE.js";import{ac as z,i as A,j as H,af as q,aj as D,_ as I,Z as k}from"./form-designer-drfGvdgz.js";import{k as G,r as _,P as w,e as J,l as Z,m as v,G as B,H as e,z as o,u as s,A as F,y as K}from"./form-create-D7wT855o.js";const N=G({name:"PortraitCustomerSource",__name:"PortraitCustomerSource",props:{queryParams:{}},setup(S,{expose:y}){const R=S,i=_(!1),c=_([]),n=w({title:{text:"\u5168\u90E8\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u5168\u90E8\u5BA2\u6237"}}},series:[{name:"\u5168\u90E8\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),u=w({title:{text:"\u6210\u4EA4\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u6210\u4EA4\u5BA2\u6237"}}},series:[{name:"\u6210\u4EA4\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),f=async()=>{i.value=!0;const r=await j.getCustomerSource(R.queryParams);n.series&&n.series[0]&&n.series[0].data&&(n.series[0].data=r.map(t=>({name:b(p.CRM_CUSTOMER_SOURCE,t.source),value:t.customerCount}))),u.series&&u.series[0]&&u.series[0].data&&(u.series[0].data=r.map(t=>({name:b(p.CRM_CUSTOMER_SOURCE,t.source),value:t.dealCount}))),x(r),c.value=r,i.value=!1};y({loadData:f});const x=r=>{if(L(r))return;const t=r,d=g(t.map(a=>a.customerCount)),m=g(t.map(a=>a.dealCount));t.forEach(a=>{a.sourcePortion=a.customerCount===0?0:C(a.customerCount,d),a.dealPortion=a.dealCount===0?0:C(a.dealCount,m)})};return J(()=>{f()}),(r,t)=>{const d=T,m=q,a=H,P=A,h=z,l=I,E=W,O=k,M=D;return v(),Z(B,null,[e(h,{shadow:"never"},{default:o(()=>[e(P,{gutter:20},{default:o(()=>[e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(n)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(u)},null,8,["options"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(h,{class:"mt-16px",shadow:"never"},{default:o(()=>[F((v(),K(O,{data:s(c)},{default:o(()=>[e(l,{align:"center",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(l,{align:"center",label:"\u5BA2\u6237\u6765\u6E90",prop:"source",width:"100"},{default:o(U=>[e(E,{type:s(p).CRM_CUSTOMER_SOURCE,value:U.row.source},null,8,["type","value"])]),_:1}),e(l,{align:"center",label:"\u5BA2\u6237\u4E2A\u6570","min-width":"200",prop:"customerCount"}),e(l,{align:"center",label:"\u6210\u4EA4\u4E2A\u6570","min-width":"200",prop:"dealCount"}),e(l,{align:"center",label:"\u6765\u6E90\u5360\u6BD4(%)","min-width":"200",prop:"sourcePortion"}),e(l,{align:"center",label:"\u6210\u4EA4\u5360\u6BD4(%)","min-width":"200",prop:"dealPortion"})]),_:1},8,["data"])),[[M,s(i)]])]),_:1})],64)}}});export{N as _};
