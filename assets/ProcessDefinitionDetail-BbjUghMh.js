import{u as Q,d as Y,_ as Z,c as ee}from"./index-DiGvuAxb.js";import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{d as ie,b as oe}from"./formCreate-DGy7HbUv.js";import{a as j,B as te}from"./constants-C3gLHYOK.js";import{N as le,C as se,F as P}from"./consts-CvaDWb4S.js";import re from"./ProcessInstanceBpmnViewer-B5XpeIaZ.js";import{_ as ne}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-dOF1_6Hu.js";import{_ as me}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-CfiJLsSe.js";import{u as pe}from"./tagsView-B3xQDSQ0.js";import{g as ue,f as ce}from"./index-pGMn8Zyx.js";import{a as de}from"./index-Dm7yQOF4.js";import{e as fe,V as ve,a0 as ye,$ as be,i as _e,j as Se,aj as he,f as De}from"./form-designer-drfGvdgz.js";import{k as Pe,r as m,b as ge,a6 as xe,y as g,m as v,z as n,v as _,H as o,F as we,h as O,u as t,A as Ve,l as U,C as x,E as F,n as Ce}from"./form-create-D7wT855o.js";import"./bpmn-embedded-CEyxHmW-.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./XTextButton-CO9jQPGe.js";import"./XButton-BXTtfQPD.js";import"./index-brTT8YwK.js";import"./index-BEHCTgo8.js";import"./node-CQ9Ble-i.js";import"./index-7o_S5bjn.js";import"./index-BCN8BzfC.js";import"./utils-aZyOMVaO.js";import"./index-DTNfh8Br.js";import"./tree-COGD3qag.js";import"./index-CLkdJnRM.js";import"./index-eU2zJvzd.js";import"./index-CNUeQNrn.js";import"./index-RiOYYfh_.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./index-GbnTArhn.js";import"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import"./color-BN7ZL7BD.js";import"./index-BES_6pzR.js";import"./formatTime-DeTj2b0K.js";import"./simple-process-designer-DszNnWcD.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-uNUCv3aR.js";import"./index-PFHQ4aD1.js";import"./download-oWiM5xVU.js";import"./index-DS_oxMOO.js";const Ee={class:"processInstance-wrap-main"},Ie={class:"text-#878c93 h-15px"},Ne={class:"form-scroll-area"},ke={class:"form-scroll-area"},Re={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Te={key:0,class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},Ae=ee(Pe({name:"ProcessDefinitionDetail",__name:"ProcessDefinitionDetail",props:{selectProcessDefinition:{}},emits:["cancel"],setup(M,{expose:B,emit:L}){const S=M,J=L,h=m(!1),{push:w,currentRoute:$}=Q(),D=Y(),{delView:z}=pe(),c=m({rule:[],option:{},value:{}}),p=m(),d=m([]),u=m({}),y=m({}),V=m(null),C=m(),b=m("form"),E=m([]);ge(c.value,a=>{a&&Object.keys(a.value).length>0&&(y.value=u.value,u.value={},I({id:S.selectProcessDefinition.id,processVariablesStr:JSON.stringify(a.value)}))},{immediate:!0});const I=async a=>{var e,s;try{const r=await ue({processDefinitionId:a.id,activityId:le.START_USER_NODE_ID,processVariablesStr:a.processVariablesStr});if(!r)return void D.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(E.value=r.activityNodes,d.value=(e=r.activityNodes)==null?void 0:e.filter(i=>se.START_USER_SELECT===i.candidateStrategy),((s=d.value)==null?void 0:s.length)>0)for(const i of d.value)y.value[i.id]&&y.value[i.id].length>0?u.value[i.id]=y.value[i.id]:u.value[i.id]=[];const l=r.formFieldsPermission;l&&Object.keys(l).forEach(i=>{H(i,l[i])})}finally{}},H=(a,e)=>{var s,r,l;e===P.READ&&((s=p.value)==null||s.disabled(!0,a)),e===P.WRITE&&((r=p.value)==null||r.disabled(!1,a)),e===P.NONE&&((l=p.value)==null||l.hidden(!0,a))},N=async()=>{var a;if(p.value&&S.selectProcessDefinition){if(await p.value.validate(),((a=d.value)==null?void 0:a.length)>0){for(const e of d.value)if(Array.isArray(u.value[e.id])&&u.value[e.id].length===0)return D.warning(`\u8BF7\u9009\u62E9${e.name}\u7684\u5019\u9009\u4EBA`)}h.value=!0;try{await ce({processDefinitionId:S.selectProcessDefinition.id,variables:c.value.value,startUserSelectAssignees:u.value}),D.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),z(t($)),await w({name:"BpmProcessInstanceMy"})}finally{h.value=!1}}},W=()=>{J("cancel")},X=(a,e)=>{u.value[a]=e==null?void 0:e.map(s=>s.id)};return B({initProcessInfo:async(a,e)=>{var s;if(d.value=[],u.value={},a.formType==te.NORMAL){const r=ie(a.formFields).map(i=>i.field);for(const i in e)r.includes(i)||delete e[i];oe(c,a.formConf,a.formFields,e),await Ce(),(s=p.value)==null||s.btn.show(!1),await I({id:a.id,processVariablesStr:JSON.stringify(e)});const l=await de(a.id);l&&(V.value=l.bpmnXml,C.value=l.simpleModel)}else a.formCustomCreatePath&&await w({path:a.formCustomCreatePath})}}),(a,e)=>{const s=ve,r=xe("form-create"),l=Se,i=_e,k=fe,R=be,q=ye,T=Z,A=De,G=ae,K=he;return v(),g(G,{bodyStyle:{padding:"10px 20px 0"}},{default:n(()=>[_("div",Ee,[o(k,null,{default:n(()=>[_("div",Ie,"\u6D41\u7A0B\uFF1A"+we(a.selectProcessDefinition.name),1),o(s,{class:"!my-8px"}),o(q,{modelValue:t(b),"onUpdate:modelValue":e[2]||(e[2]=f=>O(b)?b.value=f:null)},{default:n(()=>[o(R,{label:"\u8868\u5355\u586B\u5199",name:"form"},{default:n(()=>[Ve((v(),U("div",Ne,[o(k,null,{default:n(()=>[o(i,null,{default:n(()=>[o(l,{span:17},{default:n(()=>[o(r,{rule:t(c).rule,api:t(p),"onUpdate:api":e[0]||(e[0]=f=>O(p)?p.value=f:null),modelValue:t(c).value,"onUpdate:modelValue":e[1]||(e[1]=f=>t(c).value=f),option:t(c).option,onSubmit:N},null,8,["rule","api","modelValue","option"])]),_:1}),o(l,{span:6,offset:1},{default:n(()=>[o(me,{ref:"timelineRef","activity-nodes":t(E),"show-status-icon":!1,onSelectUserConfirm:X},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])),[[K,t(h)]])]),_:1}),o(R,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:n(()=>[_("div",ke,[t(j).BPMN===a.selectProcessDefinition.modelType?(v(),g(re,{key:0,"bpmn-xml":t(V)},null,8,["bpmn-xml"])):x("",!0),t(j).SIMPLE===a.selectProcessDefinition.modelType?(v(),g(ne,{key:1,"simple-json":t(C)},null,8,["simple-json"])):x("",!0)])]),_:1})]),_:1},8,["modelValue"]),_("div",Re,[t(b)==="form"?(v(),U("div",Te,[o(A,{plain:"",type:"success",onClick:N},{default:n(()=>[o(T,{icon:"ep:select"}),e[3]||(e[3]=F("\xA0 \u53D1\u8D77 "))]),_:1}),o(A,{plain:"",type:"danger",onClick:W},{default:n(()=>[o(T,{icon:"ep:close"}),e[4]||(e[4]=F("\xA0 \u53D6\u6D88 "))]),_:1})])):x("",!0)])]),_:1})])]),_:1})}}}),[["__scopeId","data-v-7496937a"]]);export{Ae as default};
