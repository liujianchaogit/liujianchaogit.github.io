import{d as de,G as Z,C as me,D as Q,a as ve,_ as fe,c as ye}from"./index-C1TKk8vI.js";import{_ as ge}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as be}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as _e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as we}from"./index-BhsNgP9o.js";import{x as xe,r as u,X as he,j as ke,aq as Ue,y as i,z as _,O as e,F as r,M as C,a4 as R,E as m,G as f,u as s,P as Pe,K as y,C as z,L as w}from"./form-create-7GAbgMwl.js";import{f as Se,e as Ie}from"./index-DsFOJog9.js";import{a as Ce}from"./index-DCZ6sajB.js";import{f as Ne}from"./formatter-Cy2d_MRj.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang-CbFphOmn.js";import{d as Ve}from"./formatTime-EbFUBcAO.js";import{D as Te}from"./constants-IYPHa1Ih.js";import{_ as qe}from"./OrderPickUpForm.vue_vue_type_script_setup_true_lang-sYJ2cYPP.js";import{F as De,ai as Re,Q as Oe,x as Fe,k as je,f as Ee,h as ze,j as Ae,i as Me,$ as Ye,ak as Be,a6 as Ge,_ as Le,aj as $e}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";import"./CountTo.vue_vue_type_script_setup_true_lang-uzCRArVn.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./index-DjmT9uk6.js";import"./OrderUpdateRemarkForm.vue_vue_type_script_setup_true_lang-CjLSUkBt.js";import"./OrderDeliveryForm.vue_vue_type_script_setup_true_lang-D0U_Vl7p.js";import"./index-CyioDjMj.js";import"./OrderUpdateAddressForm.vue_vue_type_script_setup_true_lang-ChtcaCuM.js";import"./index-R1Ohxk4X.js";import"./tree-COGD3qag.js";import"./OrderUpdatePriceForm.vue_vue_type_script_setup_true_lang-BkvbeH0u.js";import"./tagsView-C2oS-OQq.js";const He={class:"mr-10px"},Ke={class:"flex flex-col flex-wrap gap-1"},Ze=ye(xe({name:"PickUpOrder",__name:"index",setup(Qe){const x=de(),g=u(""),X=u([]),N=u(""),v=u(!0),A=u(2),M=u([]),Y=u(),B={pageNo:1,pageSize:10,createTime:void 0,deliveryType:Te.PICK_UP.type,pickUpStoreId:-1},t=u({...B}),h=he({queryParam:"no"}),k=u(),V=u(!1),U=u(!0),G=u([{value:"no",label:"\u8BA2\u5355\u53F7"},{value:"userId",label:"\u7528\u6237UID"},{value:"userNickname",label:"\u7528\u6237\u6635\u79F0"},{value:"userMobile",label:"\u7528\u6237\u7535\u8BDD"}]),J=o=>{var l;(l=G.value.filter(n=>n.value!==o))==null||l.forEach(n=>{t.value.hasOwnProperty(n.value)&&delete t.value[n.value]})},T=async()=>{v.value=!0;try{k.value=await Se(s(t));const o=await Ie(s(t));M.value=o.list,A.value=o.total}finally{v.value=!1}},F=async()=>{t.value.pageNo=1,await T()},W=()=>{var o;(o=Y.value)==null||o.resetFields(),t.value={...B},d.value.length>0&&(t.value.pickUpStoreId=d.value[0].id),F()},d=u([]),j=u(),ee=()=>{j.value.open()},ae=async()=>{try{if(!("serial"in navigator)||navigator.serial==null||typeof navigator.serial!="object"||!("requestPort"in navigator.serial))return void x.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u626B\u7801\u67AA\u8FDE\u63A5\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668\u91CD\u8BD5");g.value=await navigator.serial.requestPort(),X.value=await navigator.serial.getPorts(),await g.value.open({baudRate:9600,dataBits:8,stopBits:2}),x.success("\u6210\u529F\u8FDE\u63A5\u626B\u7801\u67AA"),V.value=!0,le()}catch{}},le=async()=>{N.value=g.value.readable.getReader();let o="";for(;;){const{value:l,done:n}=await N.value.read();if(n){N.value.releaseLock();break}const q=new TextDecoder().decode(l);if(o=`${o}${q}`,q.includes("\r")){let b=o.replace("\r","");o="",j.value.open(b)}}},re=async()=>{g.value!==""?(await N.value.cancel(),await g.value.close(),g.value="",x.success("\u5DF2\u6210\u529F\u65AD\u5F00\u626B\u7801\u67AA\u8FDE\u63A5"),V.value=!1):x.warning("\u8BF7\u5148\u8FDE\u63A5\u6216\u6253\u5F00\u626B\u7801\u67AA")};return ke(async()=>{if(await(async()=>{d.value=await Ce();const o=ve().getUser.id;d.value=d.value.filter(l=>{var n;return(n=l.verifyUserIds)==null?void 0:n.includes(o)})})(),d.value.length===0)return x.error("\u5F53\u524D\u767B\u5F55\u4EBA\u6CA1\u7ED1\u5B9A\u4EFB\u4F55\u81EA\u63D0\u70B9"),v.value=!1,void(U.value=!0);t.value.pickUpStoreId=d.value[0].id,U.value=!1,await T()}),(o,l)=>{const n=we,q=De,b=Re,L=Oe,$=Fe,te=je,E=fe,P=Ee,oe=ze,H=_e,D=Ae,ie=Me,p=Ye,ue=Be,se=Ge,K=be,ne=Le,pe=ge,ce=Ue("hasPermi"),S=$e;return i(),_(C,null,[e(n,{title:"\u3010\u4EA4\u6613\u3011\u4EA4\u6613\u8BA2\u5355",url:"https://doc.iocoder.cn/mall/trade-order/"}),e(n,{title:"\u3010\u4EA4\u6613\u3011\u8D2D\u7269\u8F66",url:"https://doc.iocoder.cn/mall/trade-cart/"}),e(H,null,{default:r(()=>[e(oe,{ref_key:"queryFormRef",ref:Y,inline:!0,model:t.value,class:"-mb-15px","label-width":"68px"},{default:r(()=>[e(b,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:r(()=>[e(q,{modelValue:t.value.createTime,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-280px","end-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4","start-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(b,{label:"\u81EA\u63D0\u95E8\u5E97",prop:"pickUpStoreId"},{default:r(()=>[e($,{modelValue:t.value.pickUpStoreId,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.pickUpStoreId=a),class:"!w-280px",placeholder:"\u5168\u90E8",onChange:F},{default:r(()=>[(i(!0),_(C,null,R(d.value,a=>(i(),m(L,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"\u805A\u5408\u641C\u7D22"},{default:r(()=>[f(e(te,{modelValue:t.value[s(h).queryParam],"onUpdate:modelValue":l[3]||(l[3]=a=>t.value[s(h).queryParam]=a),class:"!w-280px",clearable:"",placeholder:"\u8BF7\u8F93\u5165",type:s(h).queryParam==="userId"?"number":"text"},{prepend:r(()=>[e($,{modelValue:s(h).queryParam,"onUpdate:modelValue":l[2]||(l[2]=a=>s(h).queryParam=a),class:"!w-110px",placeholder:"\u5168\u90E8",onChange:J},{default:r(()=>[(i(!0),_(C,null,R(G.value,a=>(i(),m(L,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","type"]),[[Pe,!0]])]),_:1}),e(b,null,{default:r(()=>[e(P,{onClick:F},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:search"}),l[6]||(l[6]=y(" \u641C\u7D22 "))]),_:1}),e(P,{onClick:W},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:refresh"}),l[7]||(l[7]=y(" \u91CD\u7F6E "))]),_:1}),f((i(),m(P,{onClick:ee,type:"success",plain:"",disabled:U.value},{default:r(()=>[e(E,{class:"mr-5px",icon:"ep:check"}),l[8]||(l[8]=y(" \u6838\u9500 "))]),_:1},8,["disabled"])),[[ce,["trade:order:pick-up"]]]),e(P,{type:"primary",onClick:ae,disabled:V.value||U.value},{default:r(()=>l[9]||(l[9]=[y(" \u8FDE\u63A5\u626B\u63CF\u67AA ")])),_:1},8,["disabled"]),e(P,{type:"danger",onClick:re,disabled:!V.value||U.value},{default:r(()=>l[10]||(l[10]=[y(" \u65AD\u5F00\u626B\u63CF\u67AA ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ie,{gutter:16,class:"summary"},{default:r(()=>[f((i(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(O,{title:"\u8BA2\u5355\u6570\u91CF",icon:"icon-park-outline:transaction-order","icon-color":"bg-blue-100","icon-bg-color":"text-blue-500",value:((a=k.value)==null?void 0:a.orderCount)||0},null,8,["value"])]}),_:1})),[[S,v.value]]),f((i(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(O,{title:"\u8BA2\u5355\u91D1\u989D",icon:"streamline:money-cash-file-dollar-common-money-currency-cash-file","icon-color":"bg-purple-100","icon-bg-color":"text-purple-500",prefix:"\uFFE5",decimals:2,value:s(Z)(((a=k.value)==null?void 0:a.orderPayPrice)||0)},null,8,["value"])]}),_:1})),[[S,v.value]]),f((i(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(O,{title:"\u9000\u6B3E\u5355\u6570",icon:"heroicons:receipt-refund","icon-color":"bg-yellow-100","icon-bg-color":"text-yellow-500",value:((a=k.value)==null?void 0:a.afterSaleCount)||0},null,8,["value"])]}),_:1})),[[S,v.value]]),f((i(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(O,{title:"\u9000\u6B3E\u91D1\u989D",icon:"ri:refund-2-line","icon-color":"bg-green-100","icon-bg-color":"text-green-500",prefix:"\uFFE5",decimals:2,value:s(Z)(((a=k.value)==null?void 0:a.afterSalePrice)||0)},null,8,["value"])]}),_:1})),[[S,v.value]])]),_:1}),e(H,null,{default:r(()=>[f((i(),m(ne,{data:M.value},{default:r(()=>[e(p,{label:"\u8BA2\u5355\u53F7",align:"center",prop:"no","min-width":"180"}),e(p,{label:"\u7528\u6237\u4FE1\u606F",align:"center",prop:"user.nickname","min-width":"80"}),e(p,{label:"\u63A8\u8350\u4EBA\u4FE1\u606F",align:"center",prop:"brokerageUser.nickname","min-width":"100"}),e(p,{label:"\u5546\u54C1\u4FE1\u606F",align:"center",prop:"spuName","min-width":"300"},{default:r(({row:a})=>[(i(!0),_(C,null,R(a.items,c=>(i(),_("div",{class:"flex items-center",key:c.id},[e(ue,{src:c.picUrl,class:"mr-10px h-30px w-30px flex-shrink-0","preview-src-list":[c.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"]),z("span",He,w(c.spuName),1),z("div",Ke,[(i(!0),_(C,null,R(c.properties,I=>(i(),m(se,{key:I.propertyId,class:"mr-10px"},{default:r(()=>[y(w(I.propertyName)+": "+w(I.valueName),1)]),_:2},1024))),128)),z("span",null,w(s(me)(c.price))+" \u5143 x "+w(c.count),1)])]))),128))]),_:1}),e(p,{label:"\u5B9E\u4ED8\u91D1\u989D(\u5143)",align:"center",prop:"payPrice","min-width":"110",formatter:s(Ne)},null,8,["formatter"]),e(p,{label:"\u6838\u9500\u5458",align:"center",prop:"storeStaffName","min-width":"70"}),e(p,{label:"\u6838\u9500\u95E8\u5E97",align:"center",prop:"pickUpStoreId","min-width":"80"},{default:r(({row:a})=>{var c;return[y(w((c=d.value.find(I=>I.id===a.pickUpStoreId))==null?void 0:c.name),1)]}),_:1}),e(p,{label:"\u652F\u4ED8\u72B6\u6001",align:"center",prop:"payStatus","min-width":"80"},{default:r(({row:a})=>[e(K,{type:s(Q).INFRA_BOOLEAN_STRING,value:a.payStatus||!1},null,8,["type","value"])]),_:1}),e(p,{align:"center",label:"\u8BA2\u5355\u72B6\u6001",prop:"status",width:"120"},{default:r(({row:a})=>[e(K,{type:s(Q).TRADE_ORDER_STATUS,value:a.status},null,8,["type","value"])]),_:1}),e(p,{label:"\u4E0B\u5355\u65F6\u95F4",align:"center",prop:"createTime","min-width":"170",formatter:s(Ve)},null,8,["formatter"])]),_:1},8,["data"])),[[S,v.value]]),e(pe,{limit:t.value.pageSize,"onUpdate:limit":l[4]||(l[4]=a=>t.value.pageSize=a),page:t.value.pageNo,"onUpdate:page":l[5]||(l[5]=a=>t.value.pageNo=a),total:A.value,onPagination:T},null,8,["limit","page","total"])]),_:1}),e(qe,{ref_key:"pickUpForm",ref:j,onSuccess:T},null,512)],64)}}}),[["__scopeId","data-v-37c33c0d"]]);export{Ze as default};
