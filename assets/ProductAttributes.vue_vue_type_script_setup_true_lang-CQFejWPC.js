import{p as M,a as N,d as O}from"./index-DiGvuAxb.js";import{k as T,r as p,c as W,b as X,l as A,m as v,G as I,$ as V,y as z,z as r,v as K,H as d,E as f,F as L,A as P,Z as Y,u as y,h as g,I as R}from"./form-create-D7wT855o.js";import{c as ee,b as ae}from"./property-CPQMPIru.js";import{j as le,a6 as se,a5 as ue,x as te,Q as ne,f as oe,V as ie}from"./form-designer-drfGvdgz.js";const re=T({name:"ProductAttributes",__name:"ProductAttributes",props:{propertyList:{type:Array,default:()=>{}},isDetail:M.bool.def(!1)},emits:["success"],setup(b,{emit:$}){const{t:j}=N(),_=O(),s=p(""),c=p(null),D=W(()=>e=>c.value!==null&&(c.value===e||void 0)),h=p([]),E=e=>{e!=null&&(h.value.some(l=>{var o,t;return((o=l.inputRef)==null?void 0:o.attributes.id)===((t=e.inputRef)==null?void 0:t.attributes.id)})||h.value.push(e))},u=p([]),k=p([]),F=b;X(()=>F.propertyList,e=>{e&&(u.value=e)},{deep:!0,immediate:!0});const w=$,C=async(e,l)=>{if(s.value){if(u.value[e].values.find(t=>t.name===s.value))return _.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u5C5E\u6027\u503C\uFF0C\u8BF7\u91CD\u8BD5"),c.value=null,void(s.value="");const o=k.value.find(t=>t.name===s.value);if(o)return c.value=null,s.value="",u.value[e].values.push({id:o.id,name:o.name}),void w("success",u.value);try{const t=await ee({propertyId:l,name:s.value});u.value[e].values.push({id:t,name:s.value}),_.success(j("common.createSuccess")),w("success",u.value)}catch{_.error("\u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}c.value=null,s.value=""},G=async e=>{k.value=await ae(e)};return(e,l)=>{const o=se,t=ue,H=ne,Q=te,S=oe,U=ie,Z=le;return v(!0),A(I,null,V(y(u),(m,n)=>(v(),z(Z,{key:n},{default:r(()=>[K("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[1]||(l[1]=[f("\u5C5E\u6027\u540D\uFF1A")])),_:1}),d(t,{closable:!b.isDetail,class:"mx-1",type:"success",onClose:a=>(i=>{var x;(x=u.value)==null||x.splice(i,1),w("success",u.value)})(n)},{default:r(()=>[f(L(m.name),1)]),_:2},1032,["closable","onClose"])]),K("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[2]||(l[2]=[f("\u5C5E\u6027\u503C\uFF1A")])),_:1}),(v(!0),A(I,null,V(m.values,(a,i)=>(v(),z(t,{key:a.id,closable:!b.isDetail,class:"mx-1",onClose:x=>((q,J)=>{var B;(B=u.value[q].values)==null||B.splice(J,1)})(n,i)},{default:r(()=>[f(L(a.name),1)]),_:2},1032,["closable","onClose"]))),128)),P(d(Q,{id:`input${n}`,ref_for:!0,ref:E,modelValue:y(s),"onUpdate:modelValue":l[0]||(l[0]=a=>g(s)?s.value=a:null),"reserve-keyword":!1,"allow-create":"",class:"!w-30","default-first-option":"",filterable:"",size:"small",onBlur:a=>C(n,m.id),onChange:a=>C(n,m.id),onKeyup:Y(a=>C(n,m.id),["enter"])},{default:r(()=>[(v(!0),A(I,null,V(y(k),a=>(v(),z(H,{key:a.id,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:2},1032,["id","modelValue","onBlur","onChange","onKeyup"]),[[R,y(D)(n)]]),P(d(S,{class:"button-new-tag ml-1",size:"small",onClick:a=>(async i=>{c.value=i,h.value[i].focus(),await G(u.value[i].id)})(n)},{default:r(()=>l[3]||(l[3]=[f(" + \u6DFB\u52A0 ")])),_:2},1032,["onClick"]),[[R,!y(D)(n)]])]),d(U,{class:"my-10px"})]),_:2},1024))),128)}}});export{re as _};
