import{a as z,d as H,u as K,e as $,C as y,E as _,F as g}from"./index-DiGvuAxb.js";import{_ as q}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{u as G}from"./tagsView-B3xQDSQ0.js";import{g as J,c as L,u as M}from"./spu-CLGmBlok.js";import{_ as O}from"./InfoForm.vue_vue_type_script_setup_true_lang-Cx4hMK0h.js";import{_ as Q}from"./DescriptionForm.vue_vue_type_script_setup_true_lang-DTxeVvLD.js";import{_ as W}from"./OtherForm.vue_vue_type_script_setup_true_lang-DSIaUWis.js";import{_ as X}from"./SkuForm.vue_vue_type_script_setup_true_lang-BXuS-DwH.js";import{_ as Y}from"./DeliveryForm.vue_vue_type_script_setup_true_lang-vkGUiinW.js";import{aj as Z,a0 as ee,$ as ae,h as re,ai as ie,f as te,K as oe}from"./form-designer-drfGvdgz.js";import{k as se,r as m,e as le,A as ce,u as e,y as S,m as E,z as c,H as o,h as v,C as me,E as V}from"./form-create-D7wT855o.js";import"./tree-COGD3qag.js";import"./category-CayzwY8F.js";import"./brand-B4dehyoL.js";import"./formRules-D4RhDYOS.js";import"./index-BTEYh4my.js";import"./SkuList.vue_vue_type_script_setup_true_lang-COHN0vPi.js";import"./ProductAttributes.vue_vue_type_script_setup_true_lang-CQFejWPC.js";import"./property-CPQMPIru.js";import"./ProductPropertyAddForm.vue_vue_type_script_setup_true_lang-4hyxL7Ie.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./index-BT5m0TvU.js";import"./constants-C3gLHYOK.js";const pe=se({name:"ProductSpuAdd",__name:"index",setup(ue){const{t:B}=z(),h=H(),{push:I,currentRoute:T}=K(),{params:w,name:j}=$(),{delView:x}=G(),n=m(!1),i=m("info"),p=m(!1),D=m(),F=m(),U=m(),b=m(),C=m(),u=m({name:"",categoryId:void 0,keyword:"",picUrl:"",sliderPicUrls:[],introduction:"",deliveryTypes:[],deliveryTemplateId:void 0,brandId:void 0,specType:!1,subCommissionType:!1,skus:[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}],description:"",sort:0,giveIntegral:0,virtualSalesCount:0}),A=async()=>{var f,r,s,a,k;n.value=!0;try{await((f=e(D))==null?void 0:f.validate()),await((r=e(F))==null?void 0:r.validate()),await((s=e(U))==null?void 0:s.validate()),await((a=e(b))==null?void 0:a.validate()),await((k=e(C))==null?void 0:k.validate());const d=oe(e(u.value));d.skus.forEach(t=>{t.name=d.name,t.price=g(t.price),t.marketPrice=g(t.marketPrice),t.costPrice=g(t.costPrice),t.firstBrokeragePrice=g(t.firstBrokeragePrice),t.secondBrokeragePrice=g(t.secondBrokeragePrice)});const P=[];d.sliderPicUrls.forEach(t=>{typeof t=="object"?P.push(t.url):P.push(t)}),d.sliderPicUrls=P;const N=d;w.id?(await M(N),h.success(B("common.updateSuccess"))):(await L(N),h.success(B("common.createSuccess"))),R()}finally{n.value=!1}},R=()=>{x(e(T)),I({name:"ProductSpu"})};return le(async()=>{await(async()=>{var r;j==="ProductSpuDetail"&&(p.value=!0);const f=w.id;if(f){n.value=!0;try{const s=await J(f);(r=s.skus)==null||r.forEach(a=>{p.value?(a.price=y(a.price),a.marketPrice=y(a.marketPrice),a.costPrice=y(a.costPrice),a.firstBrokeragePrice=y(a.firstBrokeragePrice),a.secondBrokeragePrice=y(a.secondBrokeragePrice)):(a.price=_(a.price),a.marketPrice=_(a.marketPrice),a.costPrice=_(a.costPrice),a.firstBrokeragePrice=_(a.firstBrokeragePrice),a.secondBrokeragePrice=_(a.secondBrokeragePrice))}),u.value=s}finally{n.value=!1}}})()}),(f,r)=>{const s=ae,a=ee,k=te,d=ie,P=re,N=q,t=Z;return ce((E(),S(N,null,{default:c(()=>[o(a,{modelValue:e(i),"onUpdate:modelValue":r[5]||(r[5]=l=>v(i)?i.value=l:null)},{default:c(()=>[o(s,{label:"\u57FA\u7840\u8BBE\u7F6E",name:"info"},{default:c(()=>[o(O,{ref_key:"infoRef",ref:D,activeName:e(i),"onUpdate:activeName":r[0]||(r[0]=l=>v(i)?i.value=l:null),"is-detail":e(p),propFormData:e(u)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u4EF7\u683C\u5E93\u5B58",name:"sku"},{default:c(()=>[o(X,{ref_key:"skuRef",ref:F,activeName:e(i),"onUpdate:activeName":r[1]||(r[1]=l=>v(i)?i.value=l:null),"is-detail":e(p),propFormData:e(u)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u7269\u6D41\u8BBE\u7F6E",name:"delivery"},{default:c(()=>[o(Y,{ref_key:"deliveryRef",ref:U,activeName:e(i),"onUpdate:activeName":r[2]||(r[2]=l=>v(i)?i.value=l:null),"is-detail":e(p),propFormData:e(u)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u5546\u54C1\u8BE6\u60C5",name:"description"},{default:c(()=>[o(Q,{ref_key:"descriptionRef",ref:b,activeName:e(i),"onUpdate:activeName":r[3]||(r[3]=l=>v(i)?i.value=l:null),"is-detail":e(p),propFormData:e(u)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u5176\u5B83\u8BBE\u7F6E",name:"other"},{default:c(()=>[o(W,{ref_key:"otherRef",ref:C,activeName:e(i),"onUpdate:activeName":r[4]||(r[4]=l=>v(i)?i.value=l:null),"is-detail":e(p),propFormData:e(u)},null,8,["activeName","is-detail","propFormData"])]),_:1})]),_:1},8,["modelValue"]),o(P,null,{default:c(()=>[o(d,{style:{float:"right"}},{default:c(()=>[e(p)?me("",!0):(E(),S(k,{key:0,loading:e(n),type:"primary",onClick:A},{default:c(()=>r[6]||(r[6]=[V(" \u4FDD\u5B58 ")])),_:1},8,["loading"])),o(k,{onClick:R},{default:c(()=>r[7]||(r[7]=[V("\u8FD4\u56DE")])),_:1})]),_:1})]),_:1})]),_:1})),[[t,e(n)]])}}});export{pe as default};
