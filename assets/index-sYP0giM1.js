import{u as Z,d as ee,b as ae,e as le,D as z,_ as te}from"./index-C1TKk8vI.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as oe}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as ne}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as re}from"./index-BhsNgP9o.js";import{x as ie,r as k,X as pe,Y as ue,j as me,aq as ce,y as n,z as u,O as a,F as t,u as s,a5 as de,K as i,M as _,a4 as v,E as d,C as fe,G as V,L as w,J as ye}from"./form-create-7GAbgMwl.js";import{d as A}from"./formatTime-EbFUBcAO.js";import{i as ke,e as we}from"./index-C52Al6V4.js";import{C as _e}from"./index-C3kvgmux.js";import{c as be,a as ge}from"./index-CxCrYW_I.js";import{e as he}from"./constants-IYPHa1Ih.js";import{O as ve,k as xe,ai as Ce,f as Se,Q as Te,x as Ve,F as Ue,n as Ne,h as De,$ as Ie,a7 as Pe,_ as Be,aj as Me}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";const Ee={class:"flex justify-end w-full"},Ke={key:0,class:"flex flex-col"},qe={key:0},Ye={key:1},ze=ie({name:"BpmProcessInstanceMy",__name:"index",setup(Ae){const U=Z(),N=ee(),{t:D}=ae(),x=k(!0),I=k(0),P=k([]),B=k([]),r=pe({pageNo:1,pageSize:10,name:"",processDefinitionKey:void 0,category:void 0,status:void 0,createTime:[]}),M=k(),E=k([]),h=k(!1),b=async()=>{x.value=!0;try{const g=await ke(r);P.value=g.list,I.value=g.total}finally{x.value=!1}},f=()=>{r.pageNo=1,b()},F=()=>{M.value.resetFields(),f()},C=g=>{U.push({name:"BpmProcessInstanceDetail",query:{id:g.id}})};return ue(()=>{b()}),me(async()=>{await b(),E.value=await _e.getCategorySimpleList(),B.value=await be()}),(g,l)=>{const O=re,R=xe,m=Ce,K=te,p=Se,S=Te,T=Ve,j=Ue,G=Ne,H=De,q=ne,y=Ie,L=Pe,$=oe,J=Be,Q=se,Y=ce("hasPermi"),X=Me;return n(),u(_,null,[a(O,{title:"\u6D41\u7A0B\u53D1\u8D77\u3001\u53D6\u6D88\u3001\u91CD\u65B0\u53D1\u8D77",url:"https://doc.iocoder.cn/bpm/process-instance/"}),a(q,null,{default:t(()=>[a(H,{class:"-mb-15px",model:s(r),ref_key:"queryFormRef",ref:M,inline:!0,"label-width":"68px"},{default:t(()=>[a(m,{label:"",prop:"name"},{default:t(()=>[a(R,{modelValue:s(r).name,"onUpdate:modelValue":l[0]||(l[0]=e=>s(r).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:de(f,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(p,{onClick:f},{default:t(()=>[a(K,{icon:"ep:search",class:"mr-5px"}),l[9]||(l[9]=i(" \u641C\u7D22"))]),_:1})]),_:1}),a(m,{label:"",prop:"category",class:"absolute right-[300px]"},{default:t(()=>[a(T,{modelValue:s(r).category,"onUpdate:modelValue":l[1]||(l[1]=e=>s(r).category=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u5206\u7C7B",clearable:"",class:"!w-155px",onChange:f},{default:t(()=>[(n(!0),u(_,null,v(s(E),e=>(n(),d(S,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"",prop:"status",class:"absolute right-[130px]"},{default:t(()=>[a(T,{modelValue:s(r).status,"onUpdate:modelValue":l[2]||(l[2]=e=>s(r).status=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u72B6\u6001",clearable:"",class:"!w-155px",onChange:f},{default:t(()=>[(n(!0),u(_,null,v(s(le)(s(z).BPM_PROCESS_INSTANCE_STATUS),e=>(n(),d(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{class:"absolute right-0"},{default:t(()=>[a(G,{visible:s(h),persistent:"",width:400,"show-arrow":!1,placement:"bottom-end"},{reference:t(()=>[a(p,{onClick:l[3]||(l[3]=e=>h.value=!s(h))},{default:t(()=>[a(K,{icon:"ep:plus",class:"mr-5px"}),l[10]||(l[10]=i("\u9AD8\u7EA7\u7B5B\u9009 "))]),_:1})]),default:t(()=>[a(m,{label:"\u6240\u5C5E\u6D41\u7A0B",class:"font-bold","label-position":"top",prop:"processDefinitionKey"},{default:t(()=>[a(T,{modelValue:s(r).processDefinitionKey,"onUpdate:modelValue":l[4]||(l[4]=e=>s(r).processDefinitionKey=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u5B9A\u4E49",clearable:"",class:"!w-390px",onChange:f},{default:t(()=>[(n(!0),u(_,null,v(s(B),e=>(n(),d(S,{key:e.key,label:e.name,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u53D1\u8D77\u65F6\u95F4",class:"font-bold","label-position":"top",prop:"createTime"},{default:t(()=>[a(j,{modelValue:s(r).createTime,"onUpdate:modelValue":l[5]||(l[5]=e=>s(r).createTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),a(m,{class:"font-bold","label-position":"top"},{default:t(()=>[fe("div",Ee,[a(p,{onClick:F},{default:t(()=>l[11]||(l[11]=[i("\u6E05\u7A7A")])),_:1}),a(p,{onClick:l[6]||(l[6]=e=>h.value=!1)},{default:t(()=>l[12]||(l[12]=[i("\u53D6\u6D88")])),_:1}),a(p,{type:"primary",onClick:f},{default:t(()=>l[13]||(l[13]=[i("\u786E\u8BA4")])),_:1})])]),_:1})]),_:1},8,["visible"])]),_:1})]),_:1},8,["model"])]),_:1}),a(q,null,{default:t(()=>[V((n(),d(J,{data:s(P)},{default:t(()=>[a(y,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name","min-width":"200px",fixed:"left"}),a(y,{label:"\u6458\u8981",prop:"summary",width:"180",fixed:"left"},{default:t(e=>[e.row.summary&&e.row.summary.length>0?(n(),u("div",Ke,[(n(!0),u(_,null,v(e.row.summary,(c,o)=>(n(),u("div",{key:o},[a(L,{type:"info"},{default:t(()=>[i(w(c.key)+" : "+w(c.value),1)]),_:2},1024)]))),128))])):ye("",!0)]),_:1}),a(y,{label:"\u6D41\u7A0B\u5206\u7C7B",align:"center",prop:"categoryName","min-width":"100",fixed:"left"}),a(y,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status","min-width":"200"},{default:t(e=>{var c;return[e.row.status===s(he).RUNNING&&((c=e.row.tasks)==null?void 0:c.length)>0?(n(),u(_,{key:0},[e.row.tasks.length===1?(n(),u("span",qe,[a(p,{link:"",type:"primary",onClick:o=>C(e.row)},{default:t(()=>{var o;return[i(w((o=e.row.tasks[0].assigneeUser)==null?void 0:o.nickname),1)]}),_:2},1032,["onClick"]),i(" ("+w(e.row.tasks[0].name)+") \u5BA1\u6279\u4E2D ",1)])):(n(),u("span",Ye,[a(p,{link:"",type:"primary",onClick:o=>C(e.row)},{default:t(()=>{var o;return[i(w((o=e.row.tasks[0].assigneeUser)==null?void 0:o.nickname),1)]}),_:2},1032,["onClick"]),i(" \u7B49 "+w(e.row.tasks.length)+" \u4EBA ("+w(e.row.tasks[0].name)+")\u5BA1\u6279\u4E2D ",1)]))],64)):(n(),d($,{key:1,type:s(z).BPM_PROCESS_INSTANCE_STATUS,value:e.row.status},null,8,["type","value"]))]}),_:1}),a(y,{label:"\u53D1\u8D77\u65F6\u95F4",align:"center",prop:"startTime",width:"180",formatter:s(A)},null,8,["formatter"]),a(y,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"endTime",width:"180",formatter:s(A)},null,8,["formatter"]),a(y,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"180"},{default:t(e=>[V((n(),d(p,{link:"",type:"primary",onClick:c=>C(e.row)},{default:t(()=>l[14]||(l[14]=[i(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[Y,["bpm:process-instance:cancel"]]]),e.row.status===1?V((n(),d(p,{key:0,link:"",type:"primary",onClick:c=>(async o=>{const{value:W}=await ve.prompt("\u8BF7\u8F93\u5165\u53D6\u6D88\u539F\u56E0","\u53D6\u6D88\u6D41\u7A0B",{confirmButtonText:D("common.ok"),cancelButtonText:D("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u53D6\u6D88\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});await we(o.id,W),N.success("\u53D6\u6D88\u6210\u529F"),await b()})(e.row)},{default:t(()=>l[15]||(l[15]=[i(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[Y,["bpm:process-instance:query"]]]):(n(),d(p,{key:1,link:"",type:"primary",onClick:c=>(async o=>{if(o!=null&&o.id&&(await ge(o.processDefinitionId)).formType===20)return void N.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u8BE5\u6D41\u7A0B\u4F7F\u7528\u4E1A\u52A1\u8868\u5355\uFF0C\u4E0D\u652F\u6301\u91CD\u65B0\u53D1\u8D77");await U.push({name:"BpmProcessInstanceCreate",query:{processInstanceId:o==null?void 0:o.id}})})(e.row)},{default:t(()=>l[16]||(l[16]=[i(" \u91CD\u65B0\u53D1\u8D77 ")])),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])),[[X,s(x)]]),a(Q,{total:s(I),page:s(r).pageNo,"onUpdate:page":l[7]||(l[7]=e=>s(r).pageNo=e),limit:s(r).pageSize,"onUpdate:limit":l[8]||(l[8]=e=>s(r).pageSize=e),onPagination:b},null,8,["total","page","limit"])]),_:1})],64)}}});export{ze as default};
