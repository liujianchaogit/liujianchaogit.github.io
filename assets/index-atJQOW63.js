import{V as T,d as K,c as Q}from"./index-DiGvuAxb.js";import{_ as W}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as X}from"./index-BrNbcFk-.js";import{_ as Y}from"./main.vue_vue_type_script_setup_true_lang-CGoZ6TCQ.js";import ee from"./MenuEditor-CXady2Dp.js";import le from"./MenuPreviewer-GDGYdaWW.js";import{h as ae}from"./tree-COGD3qag.js";import{h as re,ai as ie,f as te,aj as ue}from"./form-designer-drfGvdgz.js";import{k as ne,r as i,af as se,l as x,m as v,H as u,z as y,u as t,A as C,v as f,F as ce,h as N,y as $,E as F,G as pe}from"./form-create-D7wT855o.js";import"./index-YBGE2sI_.js";import"./tagsView-B3xQDSQ0.js";import"./main-I-G8Vrj-.js";import"./TabNews-D-FaOhZv.js";import"./main-CdM2KXdt.js";import"./main-IGdPYDx_.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./main-BGh45ysb.js";import"./main.vue_vue_type_script_setup_true_lang-DBhac8-A.js";import"./index-B5z0KHO1.js";import"./index-BXtMzGO2.js";import"./formatTime-DeTj2b0K.js";import"./TabText.vue_vue_type_script_setup_true_lang-D41KAlt6.js";import"./TabImage-FZyWfbXj.js";import"./useUpload-Bn-ruquy.js";import"./TabVoice-Bn6aKj5C.js";import"./TabVideo-Bn1_7Qo2.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-DbyC1m1-.js";import"./vuedraggable.umd-f2FZsIjZ.js";const oe={class:"clearfix public-account-management"},de={class:"left"},me={class:"weixin-hd"},ve={class:"weixin-title"},ye={class:"clearfix weixin-menu"},fe={class:"save_div"},he={key:0,class:"right"},Me={key:1,class:"right"},E="__MENU_NOT_SELECTED__",_e=Q(ne({name:"MpMenu",__name:"index",setup(xe){const o=K(),n=i(!1),d=i(-1),k=i(""),s=i([]),h=i(E),U=i(-1),M=i(!1),b=i(!0),c=i({}),r=i({grand:"0",x:0,y:0}),j=i(!1),z=(l,e)=>{d.value=l,k.value=e,g()},g=async()=>{n.value=!1;try{const l=await(a=>T.get({url:"/mp/menu/list?accountId="+a}))(d.value),e=G(l);s.value=ae(e,"id")}finally{n.value=!1}},G=l=>{if(!l)return[];const e=[];return l.forEach(a=>{const m={...a};m.reply={type:a.replyMessageType,accountId:a.accountId,content:a.replyContent,mediaId:a.replyMediaId,url:a.replyMediaUrl,title:a.replyTitle,description:a.replyDescription,thumbMediaId:a.replyThumbMediaId,thumbMediaUrl:a.replyThumbMediaUrl,articles:a.replyArticles,musicUrl:a.replyMusicUrl,hqMusicUrl:a.replyHqMusicUrl},e.push(m)}),e},J=()=>{h.value=E,U.value=-1,M.value=!1,c.value={},r.value={grand:"0",x:0,y:0},j.value=!1},L=async()=>{var l;try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),r.value.grand==="1"?s.value.splice(r.value.x,1):r.value.grand==="2"&&((l=s.value[r.value.x].children)==null||l.splice(r.value.y,1)),o.notifySuccess("\u5220\u9664\u6210\u529F"),c.value={},M.value=!1,h.value=E}catch{}},O=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417?"),n.value=!0,await((l,e)=>T.post({url:"/mp/menu/save",data:{accountId:l,menus:e}}))(d.value,R()),g(),o.notifySuccess("\u53D1\u5E03\u6210\u529F")}finally{n.value=!1}},P=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),n.value=!0,await(l=>T.delete({url:"/mp/menu/delete?accountId="+l}))(d.value),J(),g(),o.notifySuccess("\u6E05\u7A7A\u6210\u529F")}finally{n.value=!1}},R=()=>{const l=[];return s.value.forEach(e=>{const a=V(e);l.push(a),!e.children||e.children.length<=0||(a.children=[],e.children.forEach(m=>{a.children.push(V(m))}))}),l},V=l=>{let e={...l,children:void 0,reply:void 0};return e.replyMessageType=l.reply.type,e.replyContent=l.reply.content,e.replyMediaId=l.reply.mediaId,e.replyMediaUrl=l.reply.url,e.replyTitle=l.reply.title,e.replyDescription=l.reply.description,e.replyThumbMediaId=l.reply.thumbMediaId,e.replyThumbMediaUrl=l.reply.thumbMediaUrl,e.replyArticles=l.reply.articles,e.replyMusicUrl=l.reply.musicUrl,e.replyHqMusicUrl=l.reply.hqMusicUrl,e};return(l,e)=>{const a=X,m=ie,Z=re,q=W,S=te,A=se("hasPermi"),B=ue;return v(),x(pe,null,[u(a,{title:"\u516C\u4F17\u53F7\u83DC\u5355",url:"https://doc.iocoder.cn/mp/menu/"}),u(q,null,{default:y(()=>[u(Z,{class:"-mb-15px",ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:y(()=>[u(m,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:y(()=>[u(t(Y),{onChange:z})]),_:1})]),_:1},512)]),_:1}),u(q,null,{default:y(()=>[C((v(),x("div",oe,[f("div",de,[f("div",me,[f("div",ve,ce(t(k)),1)]),f("div",ye,[u(le,{modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=p=>N(s)?s.value=p:null),"account-id":t(d),"active-index":t(h),"parent-index":t(U),onMenuClicked:e[1]||(e[1]=(p,I)=>((w,_)=>{M.value=!0,c.value=w,r.value.grand="1",r.value.x=_,b.value=!0,h.value=`${_}`,U.value=_})(p,I)),onSubmenuClicked:e[2]||(e[2]=(p,I,w)=>((_,D,H)=>{M.value=!0,c.value=_,r.value.grand="2",r.value.x=D,r.value.y=H,b.value=!1,h.value=`${D}-${H}`})(p,I,w))},null,8,["modelValue","account-id","active-index","parent-index"])]),f("div",fe,[C((v(),$(S,{class:"save_btn",type:"success",onClick:O},{default:y(()=>e[4]||(e[4]=[F("\u4FDD\u5B58\u5E76\u53D1\u5E03\u83DC\u5355")])),_:1})),[[A,["mp:menu:save"]]]),C((v(),$(S,{class:"save_btn",type:"danger",onClick:P},{default:y(()=>e[5]||(e[5]=[F("\u6E05\u7A7A\u83DC\u5355")])),_:1})),[[A,["mp:menu:delete"]]])])]),t(M)?(v(),x("div",he,[u(ee,{"account-id":t(d),"is-parent":t(b),modelValue:t(c),"onUpdate:modelValue":e[3]||(e[3]=p=>N(c)?c.value=p:null),onDelete:L},null,8,["account-id","is-parent","modelValue"])])):(v(),x("div",Me,e[6]||(e[6]=[f("p",null,"\u8BF7\u9009\u62E9\u83DC\u5355\u914D\u7F6E",-1)])))])),[[B,t(n)]])]),_:1})],64)}}}),[["__scopeId","data-v-03a2c21f"]]);export{_e as default};
