import{d as S,aD as G,a as Y,c as F}from"./index-C1TKk8vI.js";import{f as B}from"./formatTime-EbFUBcAO.js";import{M as K}from"./index-CY7R6inO.js";import{H as O}from"./index-DREge7zO.js";import{x as R,r as b,c as z,j as P,y as d,z as v,u as n,ab as Q,C as s,M as j,a4 as X,O as a,F as o,K as q,L as T,E as I,J as m,n as Z}from"./form-create-7GAbgMwl.js";import{_ as s2}from"./MessageKnowledge.vue_vue_type_script_setup_true_lang-tCO3a_hk.js";import{aR as e2,aS as a2,aT as t2,af as c2,a7 as l2,f as i2,b as n2}from"./form-designer-BpYekVAY.js";import{C as o2}from"./index-jEeLAL_g.js";import{a as r2}from"./avatar-BG6NdH5s.js";import{r as d2}from"./gpt-WhTktY3S.js";import"./fetch-D5K_4anA.js";const $="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1715352878351'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1499'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M624.5%20786.3c92.9%200%20168.2-75.3%20168.2-168.2V309c0-92.4-75.3-168.2-168.2-168.2H303.6c-92.4%200-168.2%2075.3-168.2%20168.2v309.1c0%2092.4%2075.3%20168.2%20168.2%20168.2h320.9zM178.2%20618.1V309c0-69.4%2056.1-125.5%20125.5-125.5h320.9c69.4%200%20125.5%2056.1%20125.5%20125.5v309.1c0%2069.4-56.1%20125.5-125.5%20125.5h-321c-69.4%200-125.4-56.1-125.4-125.5z'%20p-id='1500'%20fill='%238a8a8a'%3e%3c/path%3e%3cpath%20d='M849.8%20295.1v361.5c0%20102.7-83.6%20186.3-186.3%20186.3H279.1v42.7h384.4c126.3%200%20229.1-102.8%20229.1-229.1V295.1h-42.8zM307.9%20361.8h312.3c11.8%200%2021.4-9.6%2021.4-21.4%200-11.8-9.6-21.4-21.4-21.4H307.9c-11.8%200-21.4%209.6-21.4%2021.4%200%2011.9%209.6%2021.4%2021.4%2021.4zM307.9%20484.6h312.3c11.8%200%2021.4-9.6%2021.4-21.4%200-11.8-9.6-21.4-21.4-21.4H307.9c-11.8%200-21.4%209.6-21.4%2021.4%200%2011.9%209.6%2021.4%2021.4%2021.4z'%20p-id='1501'%20fill='%238a8a8a'%3e%3c/path%3e%3cpath%20d='M620.2%20607.4c11.8%200%2021.4-9.6%2021.4-21.4%200-11.8-9.6-21.4-21.4-21.4H307.9c-11.8%200-21.4%209.6-21.4%2021.4%200%2011.8%209.6%2021.4%2021.4%2021.4h312.3z'%20p-id='1502'%20fill='%238a8a8a'%3e%3c/path%3e%3c/svg%3e",A="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1715354120346'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='3256'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M907.1%20263.7H118.9c-9.1%200-16.4-7.3-16.4-16.4s7.3-16.4%2016.4-16.4H907c9.1%200%2016.4%207.3%2016.4%2016.4s-7.3%2016.4-16.3%2016.4z'%20fill='%238a8a8a'%20p-id='3257'%3e%3c/path%3e%3cpath%20d='M772.5%20928.3H257.4c-27.7%200-50.2-22.5-50.2-50.2V247.2c0-9.1%207.3-16.4%2016.4-16.4H801c12.1%200%2021.9%209.8%2021.9%2021.9v625.2c0%2027.8-22.6%2050.4-50.4%2050.4zM240%20263.7v614.4c0%209.6%207.8%2017.4%2017.4%2017.4h515.2c9.7%200%2017.5-7.9%2017.5-17.5V263.7H240zM657.4%20131.1H368.6c-9.1%200-16.4-7.3-16.4-16.4s7.3-16.4%2016.4-16.4h288.7c9.1%200%2016.4%207.3%2016.4%2016.4s-7.3%2016.4-16.3%2016.4z'%20fill='%238a8a8a'%20p-id='3258'%3e%3c/path%3e%3cpath%20d='M416%20754.5c-9.1%200-16.4-7.3-16.4-16.4V517.8c0-9.1%207.3-16.4%2016.4-16.4s16.4%207.3%2016.4%2016.4V738c0.1%209.1-7.3%2016.5-16.4%2016.5z'%20fill='%238a8a8a'%20p-id='3259'%3e%3c/path%3e%3cpath%20d='M416%20465.2c-9.1%200-16.4-7.3-16.4-16.4v-59.4c0-9.1%207.3-16.4%2016.4-16.4s16.4%207.3%2016.4%2016.4v59.4c0.1%209.1-7.3%2016.4-16.4%2016.4zM604.9%20754.5c-9.1%200-16.4-7.3-16.4-16.4v-67.2c0-9.1%207.3-16.4%2016.4-16.4s16.4%207.3%2016.4%2016.4V738c0%209.1-7.3%2016.5-16.4%2016.5z'%20fill='%238a8a8a'%20opacity='.4'%20p-id='3260'%3e%3c/path%3e%3cpath%20d='M604.9%20619.1c-9.1%200-16.4-7.3-16.4-16.4V389.4c0-9.1%207.3-16.4%2016.4-16.4s16.4%207.3%2016.4%2016.4v213.3c0%209.1-7.3%2016.4-16.4%2016.4z'%20fill='%238a8a8a'%20p-id='3261'%3e%3c/path%3e%3c/svg%3e",p2=["innerHTML"],v2=R({__name:"index",props:{content:{type:String,required:!0}},setup(k){const x=k,C=S(),{copy:g}=G(),f=b(),M=new K({highlight:function(l,r){if(r&&O.getLanguage(r))try{return`<pre style="position: relative;">${`<div id="copy" data-copy='${l}' style="position: absolute; right: 10px; top: 5px; color: #fff;cursor: pointer;">\u590D\u5236</div>`}<code class="hljs">${O.highlight(r,l,!0).value}</code></pre>`}catch{}return""}}),c=z(()=>M.render(x.content));return P(async()=>{f.value.addEventListener("click",l=>{var r,u;l.target.id==="copy"&&(g((u=(r=l.target)==null?void 0:r.dataset)==null?void 0:u.copy),C.success("\u590D\u5236\u6210\u529F!"))})}),(l,r)=>(d(),v("div",{ref_key:"contentRef",ref:f,class:"markdown-view",innerHTML:n(c)},null,8,p2))}}),u2={key:0,class:"left-message message-item"},h2={class:"avatar"},m2={class:"message"},g2={class:"left-btns"},f2={key:1,class:"right-message message-item"},w2={class:"avatar"},y2={class:"message"},k2={class:"right-text-container"},x2={class:"right-text"},C2={class:"right-btns"},M2=F(R({__name:"MessageList",props:{conversation:{type:Object,required:!0},list:{type:Array,required:!0}},emits:["onDeleteSuccess","onRefresh","onEdit"],setup(k,{expose:x,emit:C}){const g=S(),{copy:f}=G(),M=Y(),c=b(null),l=b(!1),r=z(()=>M.user.avatar||r2),u=z(()=>V.conversation.roleAvatar??d2),V=k,{list:J}=Q(V),_=C;function N(){const t=c.value,i=t.scrollTop,w=t.scrollHeight,y=t.offsetHeight;l.value=i+y<w-100}const U=async()=>{const t=c.value;t.scrollTop=t.scrollHeight};x({scrollToBottom:async t=>{await Z(),!t&&l.value||(c.value.scrollTop=c.value.scrollHeight-c.value.offsetHeight)},handlerGoTop:async()=>{c.value.scrollTop=0}});const D=async t=>{await f(t),g.success("\u590D\u5236\u6210\u529F\uFF01")},E=async t=>{await o2.deleteChatMessage(t),g.success("\u5220\u9664\u6210\u529F\uFF01"),_("onDeleteSuccess")};return P(async()=>{c.value.addEventListener("scroll",N)}),(t,i)=>{const w=c2,y=l2,p=i2,L=n2;return d(),v(j,null,[s("div",{ref_key:"messageContainer",ref:c,class:"h-100% overflow-y-auto relative"},[(d(!0),v(j,null,X(n(J),(e,W)=>(d(),v("div",{class:"chat-list",key:W},[e.type!=="user"?(d(),v("div",u2,[s("div",h2,[a(w,{src:n(u)},null,8,["src"])]),s("div",m2,[s("div",null,[a(y,{class:"time"},{default:o(()=>[q(T(n(B)(e.createTime)),1)]),_:2},1024)]),s("div",{class:"left-text-container",ref_for:!0,ref:"markdownViewRef"},[a(v2,{class:"left-text",content:e.content},null,8,["content"]),e.segments?(d(),I(s2,{key:0,segments:e.segments},null,8,["segments"])):m("",!0)],512),s("div",g2,[a(p,{class:"btn-cus",link:"",onClick:h=>D(e.content)},{default:o(()=>i[0]||(i[0]=[s("img",{class:"btn-image",src:$},null,-1)])),_:2},1032,["onClick"]),e.id>0?(d(),I(p,{key:0,class:"btn-cus",link:"",onClick:h=>E(e.id)},{default:o(()=>i[1]||(i[1]=[s("img",{class:"btn-image h-17px",src:A},null,-1)])),_:2},1032,["onClick"])):m("",!0)])])])):m("",!0),e.type==="user"?(d(),v("div",f2,[s("div",w2,[a(w,{src:n(r)},null,8,["src"])]),s("div",y2,[s("div",null,[a(y,{class:"time"},{default:o(()=>[q(T(n(B)(e.createTime)),1)]),_:2},1024)]),s("div",k2,[s("div",x2,T(e.content),1)]),s("div",C2,[a(p,{class:"btn-cus",link:"",onClick:h=>D(e.content)},{default:o(()=>i[2]||(i[2]=[s("img",{class:"btn-image",src:$},null,-1)])),_:2},1032,["onClick"]),a(p,{class:"btn-cus",link:"",onClick:h=>E(e.id)},{default:o(()=>i[3]||(i[3]=[s("img",{class:"btn-image h-17px mr-12px",src:A},null,-1)])),_:2},1032,["onClick"]),a(p,{class:"btn-cus",link:"",onClick:h=>(async H=>{_("onRefresh",H)})(e)},{default:o(()=>[a(L,{size:"17"},{default:o(()=>[a(n(e2))]),_:1})]),_:2},1032,["onClick"]),a(p,{class:"btn-cus",link:"",onClick:h=>(async H=>{_("onEdit",H)})(e)},{default:o(()=>[a(L,{size:"17"},{default:o(()=>[a(n(a2))]),_:1})]),_:2},1032,["onClick"])])])])):m("",!0)]))),128))],512),n(l)?(d(),v("div",{key:0,class:"to-bottom",onClick:U},[a(p,{icon:n(t2),circle:""},null,8,["icon"])])):m("",!0)],64)}}}),[["__scopeId","data-v-8e92d594"]]);export{M2 as default};
