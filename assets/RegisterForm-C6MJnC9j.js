import{a as A,u as B,o as G,ag as H,ak as O,x as $,r as D,y as J,z as F,af as K,c as M}from"./index-DiGvuAxb.js";import{_ as Q}from"./Verify-BKmoL0S4.js";import{_ as W}from"./XButton-BXTtfQPD.js";import{k as X,r as d,c as Y,u as e,P as Z,b as ee,e as ae,A as re,I as te,y as c,m as f,z as l,H as t,C as V}from"./form-create-D7wT855o.js";import{u as le,L as se,_ as ie}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-Bo4PwzaE.js";import{u as h}from"./useIcon-D9kiYfhb.js";import{i as oe,j as ne,ai as pe,k as de,h as me,d as ge}from"./form-designer-drfGvdgz.js";const ue=M(X({name:"RegisterForm",__name:"RegisterForm",setup(ce){const{t:p}=A(),v=h({icon:"ep:house"}),w=h({icon:"ep:avatar"}),x=h({icon:"ep:lock"}),z=d(),{handleBackLogin:E,getLoginState:P}=le(),{currentRoute:q,push:N}=B(),R=G(),m=d(""),y=d(!1),b=d(),U=d("blockPuzzle"),I=Y(()=>e(P)===se.REGISTER),S={tenantName:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u6240\u5C5E\u7684\u79DF\u6237"},{min:2,max:20,message:"\u79DF\u6237\u8D26\u53F7\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 2 \u548C 20 \u4E4B\u95F4",trigger:"blur"}],username:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u8D26\u53F7"},{min:4,max:30,message:"\u7528\u6237\u8D26\u53F7\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 4 \u548C 30 \u4E4B\u95F4",trigger:"blur"}],nickname:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u6635\u79F0"},{min:0,max:30,message:"\u6635\u79F0\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 0 \u548C 30 \u4E4B\u95F4",trigger:"blur"}],password:[{required:!0,trigger:"blur",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u5BC6\u7801"},{min:5,max:20,message:"\u7528\u6237\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u4ECB\u4E8E 5 \u548C 20 \u4E4B\u95F4",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`\u4E0D\u80FD\u5305\u542B\u975E\u6CD5\u5B57\u7B26\uFF1A< > " ' \\ |`,trigger:"blur"}],confirmPassword:[{required:!0,trigger:"blur",message:"\u8BF7\u518D\u6B21\u8F93\u5165\u60A8\u7684\u5BC6\u7801"},{required:!0,validator:(s,a,o)=>{r.registerForm.password!==a?o(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4")):o()},trigger:"blur"}]},r=Z({isShowPassword:!1,captchaEnable:"true",tenantEnable:"false",registerForm:{tenantName:"\u828B\u9053\u6E90\u7801",nickname:"",tenantId:0,username:"",password:"",confirmPassword:"",captchaVerification:""}}),_=async s=>{u.value=!0;try{r.tenantEnable&&(await L(),r.registerForm.tenantId=H()),r.captchaEnable&&(r.registerForm.captchaVerification=s.captchaVerification);const a=await O(r.registerForm);if(!a)return;u.value=ge.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),$(),D(a),m.value||(m.value="/"),m.value.indexOf("sso")!==-1?window.location.href=window.location.href.replace("/login?redirect=",""):N({path:m.value||R.addRouters[0].path})}finally{y.value=!1,u.value.close()}},L=async()=>{if(r.tenantEnable==="true"){const s=await J(r.registerForm.tenantName);F(s)}},u=d();return ee(()=>q.value,s=>{var a;m.value=(a=s==null?void 0:s.query)==null?void 0:a.redirect},{immediate:!0}),ae(()=>{(async()=>{const s=location.host,a=await K(s);a&&(r.registerForm.tenantName=a.name,F(a.id))})()}),(s,a)=>{const o=pe,n=ne,g=de,k=W,T=Q,C=oe,j=me;return re((f(),c(j,{ref_key:"formLogin",ref:z,model:e(r).registerForm,rules:S,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:l(()=>[t(C,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:l(()=>[t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,null,{default:l(()=>[t(ie,{style:{width:"100%"}})]),_:1})]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[e(r).tenantEnable==="true"?(f(),c(o,{key:0,prop:"tenantName"},{default:l(()=>[t(g,{modelValue:e(r).registerForm.tenantName,"onUpdate:modelValue":a[0]||(a[0]=i=>e(r).registerForm.tenantName=i),placeholder:e(p)("login.tenantname"),"prefix-icon":e(v),link:"",type:"primary",size:"large"},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})):V("",!0)]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,{prop:"username"},{default:l(()=>[t(g,{modelValue:e(r).registerForm.username,"onUpdate:modelValue":a[1]||(a[1]=i=>e(r).registerForm.username=i),placeholder:e(p)("login.username"),size:"large","prefix-icon":e(w)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,{prop:"username"},{default:l(()=>[t(g,{modelValue:e(r).registerForm.nickname,"onUpdate:modelValue":a[2]||(a[2]=i=>e(r).registerForm.nickname=i),placeholder:"\u6635\u79F0",size:"large","prefix-icon":e(w)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,{prop:"password"},{default:l(()=>[t(g,{modelValue:e(r).registerForm.password,"onUpdate:modelValue":a[3]||(a[3]=i=>e(r).registerForm.password=i),type:"password","auto-complete":"off",placeholder:e(p)("login.password"),size:"large","prefix-icon":e(x),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,{prop:"confirmPassword"},{default:l(()=>[t(g,{modelValue:e(r).registerForm.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=i=>e(r).registerForm.confirmPassword=i),type:"password",size:"large","auto-complete":"off",placeholder:e(p)("login.checkPassword"),"prefix-icon":e(x),"show-password":""},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),t(n,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:l(()=>[t(o,null,{default:l(()=>[t(k,{loading:e(y),title:e(p)("login.register"),class:"w-[100%]",type:"primary",onClick:a[5]||(a[5]=i=>(async()=>{r.captchaEnable==="false"?await _({}):b.value.show()})())},null,8,["loading","title"])]),_:1})]),_:1}),e(r).captchaEnable==="true"?(f(),c(T,{key:0,ref_key:"verify",ref:b,captchaType:e(U),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:_},null,8,["captchaType"])):V("",!0)]),_:1}),t(k,{title:e(p)("login.hasUser"),class:"w-[100%]",onClick:a[6]||(a[6]=i=>e(E)())},null,8,["title"])]),_:1},8,["model"])),[[te,e(I)]])}}}),[["__scopeId","data-v-5668f31a"]]);export{ue as default};
