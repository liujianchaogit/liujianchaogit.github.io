import{_ as U}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{i as A,a as V,g as $,b as r,c as S,d as K,e as q,f as z,h as H,P as R,j as J,k as W}from"./bpmn-embedded-CLKwycJq.js";import{B as M}from"./constants-IYPHa1Ih.js";import{g as Q}from"./index-BwT0n6gf.js";import{d as X}from"./index-C1TKk8vI.js";import{x as Y,r as T,s as Z,f as ee,W as te,y as F,E as j,F as ne,O as ae,B as ie,u as g,l as oe,J as ce,t as B,i as L}from"./form-create-7GAbgMwl.js";function N(o,b,s,m,v,f,p,a,c,E,n,e){o=o||{},m.registerProvider(this),this._contextPad=m,this._modeling=v,this._elementFactory=f,this._connect=p,this._create=a,this._popupMenu=c,this._canvas=E,this._rules=n,this._translate=e,o.autoPlace!==!1&&(this._autoPlace=b.get("autoPlace",!1)),s.on("create.end",250,function(i){const d=i.context.shape;if(!H(i)||!m.isOpen(d))return;const t=m.getEntries(d);t.replace&&t.replace.action.click(i,d)})}function O(o,b,s){const m=o.$instanceOf(b);let v=!1;const f=o.eventDefinitions||[];return z(f,function(p){p.$type===s&&(v=!0)}),m&&v}N.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],N.prototype.getContextPadEntries=function(o){const b=this._contextPad,s=this._modeling,m=this._elementFactory,v=this._connect,f=this._create,p=this._popupMenu,a=this._canvas,c=this._rules,E=this._autoPlace,n=this._translate,e={};if(o.type==="label")return e;const i=o.businessObject;function d(l,h){v.start(l,h)}function t(l,h,u,C){function P(x,k){const w=m.createShape(r({type:l},C));f.start(x,w,{source:k})}return typeof u!="string"&&(C=u,u=n("Append {type}",{type:l.replace(/^bpmn:/,"")})),{group:"model",className:h,title:u,action:{dragstart:P,click:E?function(x,k){const w=m.createShape(r({type:l},C));E.append(k,w)}:P}}}function y(l){return function(h,u){s.splitLane(u,l),b.open(u,!0)}}if(A(i,["bpmn:Lane","bpmn:Participant"])&&V(i)){const l=$(o);r(e,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:n("Add Lane above"),action:{click:function(h,u){s.addLane(u,"top")}}}}),l.length<2&&(o.height>=120&&r(e,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:n("Divide into two Lanes"),action:{click:y(2)}}}),o.height>=180&&r(e,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:n("Divide into three Lanes"),action:{click:y(3)}}})),r(e,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:n("Add Lane below"),action:{click:function(h,u){s.addLane(u,"bottom")}}}})}S(i,"bpmn:FlowNode")&&(S(i,"bpmn:EventBasedGateway")?r(e,{"append.receive-task":t("bpmn:ReceiveTask","bpmn-icon-receive-task",n("Append ReceiveTask")),"append.message-intermediate-event":t("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",n("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":t("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",n("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":t("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",n("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":t("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",n("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):O(i,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?r(e,{"append.compensation-activity":t("bpmn:Task","bpmn-icon-task",n("Append compensation activity"),{isForCompensation:!0})}):S(i,"bpmn:EndEvent")||i.isForCompensation||O(i,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||K(i)||r(e,{"append.end-event":t("bpmn:EndEvent","bpmn-icon-end-event-none",n("Append EndEvent")),"append.gateway":t("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",n("Append Gateway")),"append.append-task":t("bpmn:UserTask","bpmn-icon-user-task",n("Append Task")),"append.intermediate-event":t("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",n("Append Intermediate/Boundary Event"))})),p.isEmpty(o,"bpmn-replace")||r(e,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"\u4FEE\u6539\u7C7B\u578B",action:{click:function(l,h){const u=r(function(C){const P=a.getContainer(),I=b.getPad(C).html,x=P.getBoundingClientRect(),k=I.getBoundingClientRect(),w=k.top-x.top;return{x:k.left-x.left,y:w+k.height+5}}(h),{cursor:{x:l.x,y:l.y}});p.open(h,"bpmn-replace",u)}}}}),A(i,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&r(e,{"append.text-annotation":t("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:n("Connect using "+(i.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:d,dragstart:d}}}),A(i,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&r(e,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:n("Connect using DataInputAssociation"),action:{click:d,dragstart:d}}}),S(i,"bpmn:Group")&&r(e,{"append.text-annotation":t("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let _=c.allowed("elements.delete",{elements:[o]});return q(_)&&(_=_[0]===o),_&&r(e,{delete:{group:"edit",className:"bpmn-icon-trash",title:n("Remove"),action:{click:function(){s.removeElements([o])}}}}),e};const se={__init__:["contextPadProvider"],contextPadProvider:["type",N]};function D(o,b,s,m,v,f,p,a){R.call(this,o,b,s,m,v,f,p,a,2e3)}const G=function(){};(G.prototype=R.prototype).getPaletteEntries=function(){const o={},b=this._create,s=this._elementFactory,m=this._spaceTool,v=this._lassoTool,f=this._handTool,p=this._globalConnect,a=this._translate;function c(e,i,d,t,y){function _(h){const u=s.createShape(r({type:e},y));b.start(h,u)}const l=e.replace(/^bpmn:/,"");return{group:i,className:d,title:t||a("Create {type}",{type:l}),action:{dragstart:_,click:_}}}function E(e){const i=s.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),d=s.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:i});b.start(e,[i,d],{hints:{autoSelect:[d]}})}function n(e){b.start(e,s.createParticipantShape())}return r(o,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"\u6FC0\u6D3B\u6293\u624B\u5DE5\u5177",action:{click:function(e){f.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:a("Activate the lasso tool"),action:{click:function(e){v.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:a("Activate the create/remove space tool"),action:{click:function(e){m.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:a("Activate the global connect tool"),action:{click:function(e){p.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",a("Create StartEvent")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",a("Create Intermediate/Boundary Event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",a("Create EndEvent")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",a("Create Gateway")),"create.user-task":c("bpmn:UserTask","activity","bpmn-icon-user-task",a("Create User Task")),"create.call-activity":c("bpmn:CallActivity","activity","bpmn-icon-call-activity",a("Create Call Activity")),"create.service-task":c("bpmn:ServiceTask","activity","bpmn-icon-service",a("Create Service Task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",a("Create DataObjectReference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",a("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:a("Create expanded SubProcess"),action:{dragstart:E,click:E}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:a("Create Pool/Participant"),action:{dragstart:n,click:n}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",a("Create Group"))}),o},D.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],D.prototype=new G,D.prototype.constructor=D;const re={__init__:["paletteProvider"],paletteProvider:["type",D]},pe=Y({name:"BpmModelEditor",__name:"index",props:{modelId:{},modelKey:{},modelName:{},value:{}},emits:["success","init-finished"],setup(o,{emit:b}){const s=b,m=X(),v=T([]),f=T(M.NORMAL);B("formFields",v),B("formType",f);const p=L("processData"),a=L("modelData"),c=Z(),E=T(),n=T({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[se,re]}),e=T(),i=async t=>{e.value=a.value,c.value=t},d=async t=>{try{p.value=t,s("success",t)}catch{m.error("\u4FDD\u5B58\u5931\u8D25")}};return ee(()=>a.value.formId,async t=>{if(t&&a.value.formType===M.NORMAL){const y=await Q(t);v.value=y.fields}else v.value=[]},{immediate:!0}),te(()=>{c.value=null;const t=window;t.bpmnInstances&&(t.bpmnInstances=null)}),(t,y)=>{const _=U;return F(),j(_,null,{default:ne(()=>[ae(g(J),ie({key:"designer",modelValue:g(p),"onUpdate:modelValue":y[0]||(y[0]=l=>oe(p)?p.value=l:null),value:g(p)},g(n),{keyboard:"",ref_key:"processDesigner",ref:E,onInitFinished:i,additionalModel:g(n).additionalModel,model:g(e),onSave:d,"process-id":t.modelKey,"process-name":t.modelName}),null,16,["modelValue","value","additionalModel","model","process-id","process-name"]),g(c)?(F(),j(g(W),{key:"penal",bpmnModeler:g(c),prefix:g(n).prefix,class:"process-panel",model:g(e)},null,8,["bpmnModeler","prefix","model"])):ce("",!0)]),_:1})}}});export{pe as _};
