import{_ as U}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{d as j,_ as A,ag as B,aC as E}from"./index-DiGvuAxb.js";import{z as H,f as L}from"./form-designer-drfGvdgz.js";import{k as R,r as i,y as q,m as D,z as u,H as n,u as s,h as v,v as _,E as p,n as G}from"./form-create-D7wT855o.js";const J=R({name:"PluginImportForm",__name:"PluginImportForm",props:{id:{}},emits:["success"],setup(g,{expose:h,emit:b}){const y=g,r=j(),l=i(!1),a=i(!1),m=i(),c=i(),t=i([]);h({open:()=>{l.value=!0,t.value=[],F()}});const k=async()=>{t.value.length!=0?(c.value={Authorization:"Bearer "+E(),"tenant-id":B()},a.value=!0,m.value.submit()):r.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},x=b,z=o=>{if(o.code!==0)return r.error(o.msg),void(a.value=!1);r.alert("\u4E0A\u4F20\u6210\u529F"),a.value=!1,l.value=!1,x("success")},C=()=>{r.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),a.value=!1},F=async()=>{var o;a.value=!1,await G(),(o=m.value)==null||o.clearFiles()},V=()=>{r.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")};return(o,e)=>{const w=A,I=H,f=L,P=U;return D(),q(P,{modelValue:s(l),"onUpdate:modelValue":e[2]||(e[2]=d=>v(l)?l.value=d:null),title:"\u63D2\u4EF6\u5BFC\u5165",width:"400"},{footer:u(()=>[n(f,{disabled:s(a),type:"primary",onClick:k},{default:u(()=>e[4]||(e[4]=[p("\u786E \u5B9A")])),_:1},8,["disabled"]),n(f,{onClick:e[1]||(e[1]=d=>l.value=!1)},{default:u(()=>e[5]||(e[5]=[p("\u53D6 \u6D88")])),_:1})]),default:u(()=>[n(I,{ref_key:"uploadRef",ref:m,"file-list":s(t),"onUpdate:fileList":e[0]||(e[0]=d=>v(t)?t.value=d:null),action:"http://localhost:48080/admin-api/iot/plugin-config/upload-file?id="+y.id,"auto-upload":!1,disabled:s(a),headers:s(c),limit:1,"on-error":C,"on-exceed":V,"on-success":z,accept:".jar",drag:""},{default:u(()=>[n(w,{icon:"ep:upload"}),e[3]||(e[3]=_("div",{class:"el-upload__text"},[p("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),_("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","action","disabled","headers"])]),_:1},8,["modelValue"])}}});export{J as _};
