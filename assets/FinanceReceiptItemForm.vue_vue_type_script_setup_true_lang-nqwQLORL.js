import{d as A,av as _,aJ as F}from"./index-DiGvuAxb.js";import{_ as O}from"./SaleOutReceiptEnableList.vue_vue_type_script_setup_true_lang-BnQsBSkp.js";import{_ as q}from"./SaleReturnRefundEnableList.vue_vue_type_script_setup_true_lang-DxkAMk9I.js";import{E as v}from"./constants-C3gLHYOK.js";import{aj as B,h as G,Z as H,_ as J,ai as Z,k as D,l as K,f as M,i as Q}from"./form-designer-drfGvdgz.js";import{k as W,r as p,P as X,b as Y,l as ee,m as h,G as ae,A as le,y as U,C as re,H as e,u as n,z as l,E as V}from"./form-create-D7wT855o.js";const te=W({__name:"FinanceReceiptItemForm",props:{items:{},customerId:{},disabled:{type:Boolean}},setup(g,{expose:z}){const f=g,x=A(),E=p(!1),c=p([]),I=X({receiptPrice:[{required:!0,message:"\u672C\u6B21\u6536\u6B3E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),w=p([]);p([]),Y(()=>f.items,async t=>{c.value=t},{immediate:!0});const R=t=>{const{columns:a,data:o}=t,d=[];return a.forEach((s,u)=>{if(u!==0)if(["totalPrice","receiptedPrice","receiptPrice"].includes(s.property)){const b=F(o.map(P=>Number(P[s.property])));d[u]=_(b)}else d[u]="";else d[u]="\u5408\u8BA1"}),d},y=p(),N=()=>{f.customerId?y.value.open(f.customerId):x.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},C=t=>{t.forEach(a=>{c.value.push({bizId:a.id,bizType:v.SALE_OUT,bizNo:a.no,totalPrice:a.totalPrice,receiptedPrice:a.receiptPrice,receiptPrice:a.totalPrice-a.receiptPrice})})},k=p(),$=()=>{f.customerId?k.value.open(f.customerId):x.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},L=t=>{t.forEach(a=>{c.value.push({bizId:a.id,bizType:v.SALE_RETURN,bizNo:a.no,totalPrice:-a.totalPrice,receiptedPrice:-a.refundPrice,receiptPrice:-a.totalPrice+a.refundPrice})})};return z({validate:()=>w.value.validate()}),(t,a)=>{const o=J,d=D,s=Z,u=K,b=M,P=H,S=G,T=Q,j=B;return h(),ee(ae,null,[le((h(),U(S,{ref_key:"formRef",ref:w,model:n(c),rules:n(I),"label-width":"0px","inline-message":!0,disabled:t.disabled},{default:l(()=>[e(P,{data:n(c),"show-summary":"","summary-method":R,class:"-mt-10px"},{default:l(()=>[e(o,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(o,{label:"\u9500\u552E\u5355\u636E\u7F16\u53F7","min-width":"200"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.bizNo,"onUpdate:modelValue":i=>r.bizNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(o,{label:"\u5E94\u4ED8\u91D1\u989D",prop:"totalPrice",fixed:"right","min-width":"100"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.totalPrice,"onUpdate:modelValue":i=>r.totalPrice=i,formatter:n(_)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u5DF2\u4ED8\u91D1\u989D",prop:"receiptedPrice",fixed:"right","min-width":"100"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.receiptedPrice,"onUpdate:modelValue":i=>r.receiptedPrice=i,formatter:n(_)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u672C\u6B21\u6536\u6B3E",prop:"receiptPrice",fixed:"right","min-width":"115"},{default:l(({row:r,$index:i})=>[e(s,{prop:`${i}.receiptPrice`,class:"mb-0px!"},{default:l(()=>[e(u,{modelValue:r.receiptPrice,"onUpdate:modelValue":m=>r.receiptPrice=m,"controls-position":"right",precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{label:"\u5907\u6CE8","min-width":"150"},{default:l(({row:r,$index:i})=>[e(s,{prop:`${i}.remark`,class:"mb-0px!"},{default:l(()=>[e(d,{modelValue:r.remark,"onUpdate:modelValue":m=>r.remark=m,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:l(({$index:r})=>[e(b,{onClick:i=>{return m=r,void c.value.splice(m,1);var m},link:""},{default:l(()=>a[0]||(a[0]=[V("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[j,n(E)]]),t.disabled?re("",!0):(h(),U(T,{key:0,justify:"center",class:"mt-3"},{default:l(()=>[e(b,{onClick:N,round:""},{default:l(()=>a[1]||(a[1]=[V("+ \u6DFB\u52A0\u9500\u552E\u51FA\u5E93\u5355")])),_:1}),e(b,{onClick:$,round:""},{default:l(()=>a[2]||(a[2]=[V("+ \u6DFB\u52A0\u9500\u552E\u9000\u8D27\u5355")])),_:1})]),_:1})),e(O,{ref_key:"saleOutReceiptEnableListRef",ref:y,onSuccess:C},null,512),e(q,{ref_key:"saleReturnRefundEnableListRef",ref:k,onSuccess:L},null,512)],64)}}});export{te as _};
