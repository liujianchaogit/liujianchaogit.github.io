import{p as ee,h as ae,D as F,_ as le}from"./index-DiGvuAxb.js";import{_ as te}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{_ as ie}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{P as re}from"./index-aXvHl0SS.js";import{f as ne}from"./formatter-Db_aBdex.js";import{d as se}from"./formatTime-DeTj2b0K.js";import{f as pe,h as de,ai as me,x as ve,Q as ce,Z as fe,_ as he,w as _e,u as we,ak as ge,aj as be,a_ as Q}from"./form-designer-drfGvdgz.js";import{k as ye,r as s,c as Ve,y as _,m as f,_ as ke,z as u,H as l,E as h,A as Se,u as o,l as Ue,G as Ce,$ as Ne,h as U,F as Pe}from"./form-create-D7wT855o.js";const Te=ye({name:"PointTableSelect",__name:"PointTableSelect",props:{multiple:ee.bool.def(!1)},setup(C,{expose:q,emit:B}){const N=s(0),m=s([]),V=s(!1),d=s(!1),r=s({pageNo:1,pageSize:10,name:null,status:void 0}),D=Ve(()=>t=>(t.totalStock||0)-(t.stock||0));q({open:t=>{v.value=[],n.value={},p.value=!1,w.value=!1,t&&t.length>0&&(v.value=[...t],n.value=Object.fromEntries(t.map(e=>[e.id,!0]))),d.value=!0,P()}});const k=async()=>{V.value=!0;try{const t=await re.getPointActivityPage(r.value);m.value=t.list,N.value=t.total,m.value.forEach(e=>n.value[e.id]=n.value[e.id]||!1),O()}finally{V.value=!1}},G=()=>{r.value.pageNo=1,k()},P=()=>{r.value={pageNo:1,pageSize:10,name:null,status:void 0},k()},p=s(!1),w=s(!1),v=s([]),n=s({}),g=s(),H=()=>{d.value=!1,T(Q,[...v.value])},T=B,I=t=>{p.value=t,w.value=!1,m.value.forEach(e=>z(t,e,!1))},z=(t,e,S)=>{if(t)v.value.push(e),n.value[e.id]=!0;else{const b=L(e);b>-1&&(v.value.splice(b,1),n.value[e.id]=!1,p.value=!1)}S&&O()},L=t=>v.value.findIndex(e=>e.id===t.id),O=()=>{p.value=m.value.every(t=>n.value[t.id]),w.value=!p.value&&m.value.some(t=>n.value[t.id])};return(t,e)=>{const S=ce,b=ve,A=me,E=le,y=pe,R=de,M=_e,i=he,Z=we,$=ge,J=ie,K=fe,W=ue,X=oe,Y=te,x=be;return f(),_(Y,{modelValue:o(d),"onUpdate:modelValue":e[6]||(e[6]=a=>U(d)?d.value=a:null),appendToBody:!0,title:"\u9009\u62E9\u6D3B\u52A8",width:"70%"},ke({default:u(()=>[l(X,null,{default:u(()=>[l(R,{ref:"queryFormRef",inline:!0,model:o(r),class:"-mb-15px","label-width":"68px"},{default:u(()=>[l(A,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:u(()=>[l(b,{modelValue:o(r).status,"onUpdate:modelValue":e[0]||(e[0]=a=>o(r).status=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001"},{default:u(()=>[(f(!0),Ue(Ce,null,Ne(o(ae)(o(F).COMMON_STATUS),a=>(f(),_(S,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(A,null,{default:u(()=>[l(y,{onClick:G},{default:u(()=>[l(E,{class:"mr-5px",icon:"ep:search"}),e[7]||(e[7]=h(" \u641C\u7D22 "))]),_:1}),l(y,{onClick:P},{default:u(()=>[l(E,{class:"mr-5px",icon:"ep:refresh"}),e[8]||(e[8]=h(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),Se((f(),_(K,{data:o(m),"show-overflow-tooltip":""},{default:u(()=>[C.multiple?(f(),_(i,{key:0,width:"55"},{header:u(()=>[l(M,{modelValue:o(p),"onUpdate:modelValue":e[1]||(e[1]=a=>U(p)?p.value=a:null),indeterminate:o(w),onChange:I},null,8,["modelValue","indeterminate"])]),default:u(({row:a})=>[l(M,{modelValue:o(n)[a.id],"onUpdate:modelValue":c=>o(n)[a.id]=c,onChange:c=>z(c,a,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(f(),_(i,{key:1,label:"#",width:"55"},{default:u(({row:a})=>[l(Z,{modelValue:o(g),"onUpdate:modelValue":e[2]||(e[2]=c=>U(g)?g.value=c:null),value:a.id,onChange:c=>{return T(Q,j=a),d.value=!1,void(g.value=j.id);var j}},{default:u(()=>e[9]||(e[9]=[h(" \xA0 ")])),_:2},1032,["modelValue","value","onChange"])]),_:1})),l(i,{label:"\u6D3B\u52A8\u7F16\u53F7","min-width":"80",prop:"id"}),l(i,{label:"\u5546\u54C1\u56FE\u7247","min-width":"80",prop:"spuName"},{default:u(a=>[l($,{"preview-src-list":[a.row.picUrl],src:a.row.picUrl,class:"h-40px w-40px","preview-teleported":""},null,8,["preview-src-list","src"])]),_:1}),l(i,{label:"\u5546\u54C1\u6807\u9898","min-width":"300",prop:"spuName"}),l(i,{formatter:o(ne),label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"},null,8,["formatter"]),l(i,{label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"}),l(i,{align:"center",label:"\u6D3B\u52A8\u72B6\u6001","min-width":"100",prop:"status"},{default:u(a=>[l(J,{type:o(F).COMMON_STATUS,value:a.row.status},null,8,["type","value"])]),_:1}),l(i,{align:"center",label:"\u5E93\u5B58","min-width":"80",prop:"stock"}),l(i,{align:"center",label:"\u603B\u5E93\u5B58","min-width":"80",prop:"totalStock"}),l(i,{align:"center",label:"\u5DF2\u5151\u6362\u6570\u91CF","min-width":"100",prop:"redeemedQuantity"},{default:u(({row:a})=>[h(Pe(o(D)(a)),1)]),_:1}),l(i,{formatter:o(se),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"])]),_:1},8,["data"])),[[x,o(V)]]),l(W,{limit:o(r).pageSize,"onUpdate:limit":e[3]||(e[3]=a=>o(r).pageSize=a),page:o(r).pageNo,"onUpdate:page":e[4]||(e[4]=a=>o(r).pageNo=a),total:o(N),onPagination:k},null,8,["limit","page","total"])]),_:1})]),_:2},[C.multiple?{name:"footer",fn:u(()=>[l(y,{type:"primary",onClick:H},{default:u(()=>e[10]||(e[10]=[h("\u786E \u5B9A")])),_:1}),l(y,{onClick:e[5]||(e[5]=a=>d.value=!1)},{default:u(()=>e[11]||(e[11]=[h("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Te as _};
