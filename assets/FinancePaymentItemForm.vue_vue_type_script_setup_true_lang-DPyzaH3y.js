import{d as A,av as _,aJ as H}from"./index-C1TKk8vI.js";import{_ as J}from"./PurchaseInPaymentEnableList.vue_vue_type_script_setup_true_lang-BhEGCwai.js";import{_ as L}from"./PurchaseReturnRefundEnableList.vue_vue_type_script_setup_true_lang-C6k613Vs.js";import{E as U}from"./constants-IYPHa1Ih.js";import{$ as q,k as M,ai as B,l as G,f as K,_ as O,h as X,i as D,aj as Q}from"./form-designer-BpYekVAY.js";import{x as W,r as m,X as Y,f as Z,y,z as ee,G as ae,u as c,E as v,F as l,O as e,K as h,J as le,M as re}from"./form-create-7GAbgMwl.js";const te=W({__name:"FinancePaymentItemForm",props:{items:{},supplierId:{},disabled:{type:Boolean}},setup(g,{expose:z}){const f=g,V=A(),E=m(!1),p=m([]),I=Y({paymentPrice:[{required:!0,message:"\u672C\u6B21\u4ED8\u6B3E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),x=m([]);m([]),Z(()=>f.items,async t=>{p.value=t},{immediate:!0});const R=t=>{const{columns:a,data:o}=t,d=[];return a.forEach((s,n)=>{if(n!==0)if(["totalPrice","paidPrice","paymentPrice"].includes(s.property)){const b=H(o.map(P=>Number(P[s.property])));d[n]=_(b)}else d[n]="";else d[n]="\u5408\u8BA1"}),d},w=m(),N=()=>{f.supplierId?w.value.open(f.supplierId):V.error("\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546")},C=t=>{t.forEach(a=>{p.value.push({bizId:a.id,bizType:U.PURCHASE_IN,bizNo:a.no,totalPrice:a.totalPrice,paidPrice:a.paymentPrice,paymentPrice:a.totalPrice-a.paymentPrice})})},k=m(),$=()=>{f.supplierId?k.value.open(f.supplierId):V.error("\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546")},S=t=>{t.forEach(a=>{p.value.push({bizId:a.id,bizType:U.PURCHASE_RETURN,bizNo:a.no,totalPrice:-a.totalPrice,paidPrice:-a.refundPrice,paymentPrice:-a.totalPrice+a.refundPrice})})};return z({validate:()=>x.value.validate()}),(t,a)=>{const o=q,d=M,s=B,n=G,b=K,P=O,j=X,F=D,T=Q;return y(),ee(re,null,[ae((y(),v(j,{ref_key:"formRef",ref:x,model:c(p),rules:c(I),"label-width":"0px","inline-message":!0,disabled:t.disabled},{default:l(()=>[e(P,{data:c(p),"show-summary":"","summary-method":R,class:"-mt-10px"},{default:l(()=>[e(o,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(o,{label:"\u91C7\u8D2D\u5355\u636E\u7F16\u53F7","min-width":"200"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.bizNo,"onUpdate:modelValue":i=>r.bizNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(o,{label:"\u5E94\u4ED8\u91D1\u989D",prop:"totalPrice",fixed:"right","min-width":"100"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.totalPrice,"onUpdate:modelValue":i=>r.totalPrice=i,formatter:c(_)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u5DF2\u4ED8\u91D1\u989D",prop:"paidPrice",fixed:"right","min-width":"100"},{default:l(({row:r})=>[e(s,{class:"mb-0px!"},{default:l(()=>[e(d,{disabled:"",modelValue:r.paidPrice,"onUpdate:modelValue":i=>r.paidPrice=i,formatter:c(_)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(o,{label:"\u672C\u6B21\u4ED8\u6B3E",prop:"paymentPrice",fixed:"right","min-width":"115"},{default:l(({row:r,$index:i})=>[e(s,{prop:`${i}.paymentPrice`,class:"mb-0px!"},{default:l(()=>[e(n,{modelValue:r.paymentPrice,"onUpdate:modelValue":u=>r.paymentPrice=u,"controls-position":"right",precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{label:"\u5907\u6CE8","min-width":"150"},{default:l(({row:r,$index:i})=>[e(s,{prop:`${i}.remark`,class:"mb-0px!"},{default:l(()=>[e(d,{modelValue:r.remark,"onUpdate:modelValue":u=>r.remark=u,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:l(({$index:r})=>[e(b,{onClick:i=>{return u=r,void p.value.splice(u,1);var u},link:""},{default:l(()=>a[0]||(a[0]=[h("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[T,c(E)]]),t.disabled?le("",!0):(y(),v(F,{key:0,justify:"center",class:"mt-3"},{default:l(()=>[e(b,{onClick:N,round:""},{default:l(()=>a[1]||(a[1]=[h("+ \u6DFB\u52A0\u91C7\u8D2D\u5165\u5E93\u5355")])),_:1}),e(b,{onClick:$,round:""},{default:l(()=>a[2]||(a[2]=[h("+ \u6DFB\u52A0\u91C7\u8D2D\u9000\u8D27\u5355")])),_:1})]),_:1})),e(J,{ref_key:"purchaseInPaymentEnableListRef",ref:w,onSuccess:C},null,512),e(L,{ref_key:"purchaseReturnRefundEnableListRef",ref:k,onSuccess:S},null,512)],64)}}});export{te as _};
