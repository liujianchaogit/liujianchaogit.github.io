import{b as ra,d as na,u as sa,e as ia,D as L,_ as da}from"./index-C1TKk8vI.js";import{_ as pa}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as ua}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as ca}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as ma}from"./index-BhsNgP9o.js";import{x as fa,r as g,X as _a,j as ba,aq as ya,y as s,z as I,O as e,F as l,u as t,a5 as K,M as B,a4 as ga,E as i,K as d,G as m,L as ha,J as O}from"./form-create-7GAbgMwl.js";import{c as V}from"./permission-0vfiopec.js";import{_ as wa}from"./JobForm.vue_vue_type_script_setup_true_lang-B-gLsZ08.js";import{_ as ka}from"./JobDetail.vue_vue_type_script_setup_true_lang-oWU6xjwH.js";import{d as ja}from"./download-oWiM5xVU.js";import{b as va,e as xa,d as Ca,f as Na,r as Sa}from"./index-CVHeZ0xW.js";import{f as w}from"./constants-IYPHa1Ih.js";import{k as Ra,ai as Oa,Q as Va,x as qa,f as Ta,h as Ja,$ as Pa,a4 as Ua,a3 as za,a2 as Aa,_ as Fa,aj as Da}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./formatTime-EbFUBcAO.js";const La=fa({name:"InfraJob",__name:"index",setup(Ia){const{t:x}=ra(),f=na(),{push:E}=sa(),C=g(!0),q=g(0),T=g([]),n=_a({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),J=g(),N=g(!1),_=async()=>{C.value=!0;try{const r=await va(n);T.value=r.list,q.value=r.total}finally{C.value=!1}},k=()=>{n.pageNo=1,_()},M=()=>{J.value.resetFields(),k()},$=async()=>{try{await f.exportConfirm(),N.value=!0;const r=await xa(n);ja.excel(r,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},P=g(),U=(r,a)=>{P.value.open(r,a)},G=async r=>{try{await f.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+r.name+"?",x("common.reminder")),await Sa(r.id),f.success("\u6267\u884C\u6210\u529F"),await _()}catch{}},z=g(),Q=r=>{z.value.open(r)},A=r=>{E(r&&r>0?"/job/job-log?id="+r:"/job/job-log")};return ba(()=>{_()}),(r,a)=>{const S=ma,F=Ra,j=Oa,X=Va,Y=qa,h=da,p=Ta,H=Ja,D=ca,b=Pa,W=ua,R=Ua,Z=za,aa=Aa,ea=Fa,la=pa,y=ya("hasPermi"),oa=Da;return s(),I(B,null,[e(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),e(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),e(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),e(D,null,{default:l(()=>[e(H,{class:"-mb-15px",model:t(n),ref_key:"queryFormRef",ref:J,inline:!0,"label-width":"100px"},{default:l(()=>[e(j,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:l(()=>[e(F,{modelValue:t(n).name,"onUpdate:modelValue":a[0]||(a[0]=o=>t(n).name=o),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:K(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(j,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:l(()=>[e(Y,{modelValue:t(n).status,"onUpdate:modelValue":a[1]||(a[1]=o=>t(n).status=o),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(s(!0),I(B,null,ga(t(ia)(t(L).INFRA_JOB_STATUS),o=>(s(),i(X,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(j,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:l(()=>[e(F,{modelValue:t(n).handlerName,"onUpdate:modelValue":a[2]||(a[2]=o=>t(n).handlerName=o),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:K(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(j,null,{default:l(()=>[e(p,{onClick:k},{default:l(()=>[e(h,{icon:"ep:search",class:"mr-5px"}),a[7]||(a[7]=d(" \u641C\u7D22"))]),_:1}),e(p,{onClick:M},{default:l(()=>[e(h,{icon:"ep:refresh",class:"mr-5px"}),a[8]||(a[8]=d(" \u91CD\u7F6E"))]),_:1}),m((s(),i(p,{type:"primary",plain:"",onClick:a[3]||(a[3]=o=>U("create"))},{default:l(()=>[e(h,{icon:"ep:plus",class:"mr-5px"}),a[9]||(a[9]=d(" \u65B0\u589E "))]),_:1})),[[y,["infra:job:create"]]]),m((s(),i(p,{type:"success",plain:"",onClick:$,loading:t(N)},{default:l(()=>[e(h,{icon:"ep:download",class:"mr-5px"}),a[10]||(a[10]=d(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[y,["infra:job:export"]]]),m((s(),i(p,{type:"info",plain:"",onClick:a[4]||(a[4]=o=>A())},{default:l(()=>[e(h,{icon:"ep:zoom-in",class:"mr-5px"}),a[11]||(a[11]=d(" \u6267\u884C\u65E5\u5FD7 "))]),_:1})),[[y,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(D,null,{default:l(()=>[m((s(),i(ea,{data:t(T)},{default:l(()=>[e(b,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),e(b,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),e(b,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:l(o=>[e(W,{type:t(L).INFRA_JOB_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),e(b,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),e(b,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),e(b,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),e(b,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:l(o=>[m((s(),i(p,{type:"primary",link:"",onClick:v=>U("update",o.row.id)},{default:l(()=>a[12]||(a[12]=[d(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),m((s(),i(p,{type:"primary",link:"",onClick:v=>(async u=>{try{const c=u.status===w.STOP?"\u5F00\u542F":"\u5173\u95ED";await f.confirm("\u786E\u8BA4\u8981"+c+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+u.id+'"\u7684\u6570\u636E\u9879?',x("common.reminder"));const ta=u.status===w.STOP?w.NORMAL:w.STOP;await Ca(u.id,ta),f.success(c+"\u6210\u529F"),await _()}catch{}})(o.row)},{default:l(()=>[d(ha(o.row.status===t(w).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),m((s(),i(p,{type:"danger",link:"",onClick:v=>(async u=>{try{await f.delConfirm(),await Na(u),f.success(x("common.delSuccess")),await _()}catch{}})(o.row.id)},{default:l(()=>a[13]||(a[13]=[d(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[y,["infra:job:delete"]]]),m((s(),i(aa,{onCommand:v=>((u,c)=>{switch(u){case"handleRun":G(c);break;case"openDetail":Q(c.id);break;case"handleJobLog":A(c==null?void 0:c.id)}})(v,o.row)},{dropdown:l(()=>[e(Z,null,{default:l(()=>[t(V)(["infra:job:trigger"])?(s(),i(R,{key:0,command:"handleRun"},{default:l(()=>a[15]||(a[15]=[d(" \u6267\u884C\u4E00\u6B21 ")])),_:1})):O("",!0),t(V)(["infra:job:query"])?(s(),i(R,{key:1,command:"openDetail"},{default:l(()=>a[16]||(a[16]=[d(" \u4EFB\u52A1\u8BE6\u7EC6 ")])),_:1})):O("",!0),t(V)(["infra:job:query"])?(s(),i(R,{key:2,command:"handleJobLog"},{default:l(()=>a[17]||(a[17]=[d(" \u8C03\u5EA6\u65E5\u5FD7 ")])),_:1})):O("",!0)]),_:1})]),default:l(()=>[e(p,{type:"primary",link:""},{default:l(()=>[e(h,{icon:"ep:d-arrow-right"}),a[14]||(a[14]=d(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[y,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[oa,t(C)]]),e(la,{total:t(q),page:t(n).pageNo,"onUpdate:page":a[5]||(a[5]=o=>t(n).pageNo=o),limit:t(n).pageSize,"onUpdate:limit":a[6]||(a[6]=o=>t(n).pageSize=o),onPagination:_},null,8,["total","page","limit"])]),_:1}),e(wa,{ref_key:"formRef",ref:P,onSuccess:_},null,512),e(ka,{ref_key:"detailRef",ref:z},null,512)],64)}}});export{La as default};
