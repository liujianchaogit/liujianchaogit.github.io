import{_ as k}from"./index-C1TKk8vI.js";import{K as _}from"./index-Ctuiy-PU.js";import{H as C,f as j}from"./form-designer-BpYekVAY.js";import{x as K,r as T,c as L,j as M,W as O,y as m,z as p,C as r,M as P,a4 as S,O as x,L as y,F as q,K as z,u as V,i as B}from"./form-create-7GAbgMwl.js";const F={class:"mt-15px grid grid-cols-1 gap-2"},H={class:"flex items-center min-w-[200px] mr-10px"},I={class:"text-[13px] text-[#303133] break-all"},W={class:"flex-1"},A={class:"ml-10px text-[13px] text-[#606266]"},D={class:"flex justify-end mt-20px"},E=K({__name:"ProcessStep",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(f,{emit:b}){const l=f,g=b,n=B("parent"),d=T(null),u=e=>e.progress===100,v=L(()=>l.modelValue.list.every(e=>u(e))),w=()=>{var e;(e=n==null?void 0:n.exposed)!=null&&e.handleBack&&n.exposed.handleBack()},c=async()=>{try{const e=l.modelValue.list.filter(s=>s.id).map(s=>s.id);if(e.length===0)return;const o=await _.getKnowledgeSegmentProcessList(e),i=l.modelValue.list.map(s=>{const a=o.find(t=>t.documentId===s.id);if(a){const t=a.embeddingCount&&a.count?Math.floor(a.embeddingCount/a.count*100):0;return{...s,progress:t,count:a.count||0}}return s});g("update:modelValue",{...l.modelValue,list:i}),i.every(s=>u(s))||(d.value=window.setTimeout(c,3e3))}catch{d.value=window.setTimeout(c,5e3)}};return M(()=>{const e=l.modelValue.list.map(o=>({...o,progress:0}));g("update:modelValue",{...l.modelValue,list:e}),c()}),O(()=>{d.value&&(clearTimeout(d.value),d.value=null)}),(e,o)=>{const i=k,s=C,a=j;return m(),p("div",null,[r("div",F,[(m(!0),p(P,null,S(f.modelValue.list,(t,h)=>(m(),p("div",{key:h,class:"flex items-center py-4px px-12px border-l-4 border-l-[#409eff] rounded-sm shadow-sm hover:bg-[#ecf5ff] transition-all duration-300"},[r("div",H,[x(i,{icon:"ep:document",class:"mr-8px text-[#409eff]"}),r("span",I,y(t.name),1)]),r("div",W,[x(s,{percentage:t.progress||0,"stroke-width":10,status:u(t)?"success":""},null,8,["percentage","status"])]),r("div",A," \u5206\u6BB5\u6570\u91CF\uFF1A"+y(t.count?t.count:"-"),1)]))),128))]),r("div",D,[x(a,{type:V(v)?"success":"primary",disabled:!V(v),onClick:w},{default:q(()=>o[0]||(o[0]=[z(" \u5B8C\u6210 ")])),_:1},8,["type","disabled"])])])}}});export{E as _};
