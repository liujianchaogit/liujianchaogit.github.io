import{d as N,u as X,h as Y}from"./index-C1TKk8vI.js";import{g as Z,_ as ee}from"./index-ArudIG2A.js";import{u as ae}from"./tagsView-C2oS-OQq.js";import{g as ie,u as re,l as h,r as te,p as le}from"./index-Bdw660V1.js";import{_ as oe}from"./CustomerForm.vue_vue_type_script_setup_true_lang-Cl-FWwle.js";import{_ as se}from"./CustomerDetailsInfo.vue_vue_type_script_setup_true_lang-jpNC2BST.js";import{_ as me}from"./CustomerDetailsHeader.vue_vue_type_script_setup_true_lang-BDoXj40C.js";import{_ as ue}from"./ContactList.vue_vue_type_script_setup_true_lang-BvFFWZwX.js";import{_ as ne}from"./ContractList.vue_vue_type_script_setup_true_lang-JDWY1i8M.js";import{_ as pe}from"./BusinessList.vue_vue_type_script_setup_true_lang-BCkwyL0t.js";import{_ as ce}from"./ReceivableList.vue_vue_type_script_setup_true_lang-DMw2l6CX.js";import{_ as fe}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-CP8phXHG.js";import{_ as de}from"./PermissionList.vue_vue_type_script_setup_true_lang-BPeTlrGi.js";import{_ as ye}from"./TransferForm.vue_vue_type_script_setup_true_lang-5gdfxDt4.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-Cc1LpVql.js";import{B as v}from"./index-BuK0ap75.js";import{_ as ve}from"./CustomerDistributeForm.vue_vue_type_script_setup_true_lang-BsIkGO1q.js";import{f as be,a0 as ze,a1 as we,j as Ce}from"./form-designer-BpYekVAY.js";import{x as ke,r as m,j as Re,y as u,z as Me,O as i,F as t,u as e,G as Ue,E as f,K as d,J as y,M as Se,aq as Oe}from"./form-create-7GAbgMwl.js";import"./formatTime-EbFUBcAO.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./index-R1Ohxk4X.js";import"./tree-COGD3qag.js";import"./index-CZiMqbPE.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import"./color-BN7ZL7BD.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./index-C_v5t3_7.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-DNhdDOrK.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-Cgo1EbLC.js";import"./index-DdKGlDdM.js";import"./ContractForm.vue_vue_type_script_setup_true_lang-BL6ujW-4.js";import"./index-DLPyhh9r.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-BsCJVFcd.js";import"./index-C69xrZfi.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-C-tbO4kY.js";import"./index-2SiQtehE.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-w8Q4BfL1.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-D8lenXv5.js";import"./index-pmRUIUos.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-CpUQxp4U.js";import"./index-DZT3uREC.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-zqCBcaAo.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-C_qKaUAE.js";import"./index-uXIyVRuV.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-De4klYft.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-DrAuCfpX.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-B-IANjnk.js";const Te=ke({name:"CrmCustomerDetail",__name:"index",setup($e){const o=m(0),w=m(!0),s=N(),{delView:I}=ae(),{push:x,currentRoute:F}=X(),n=m(),a=m({}),_=async()=>{w.value=!0;try{a.value=await ie(o.value),await J()}finally{w.value=!1}},C=m(),j=()=>{var l;(l=C.value)==null||l.open("update",o.value)},q=async()=>{const l=!a.value.dealStatus;try{await s.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${l?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await re(o.value,l),s.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await _()}catch{}},k=m(),L=()=>{var l;(l=k.value)==null||l.open(o.value)},P=async()=>{await s.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!0),s.success(`\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},W=async()=>{await s.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!1),s.success(`\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},B=async()=>{await s.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await te([e(o.value)]),s.success(`\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},R=m(),D=async()=>{var l;(l=R.value)==null||l.open(o.value)},G=async()=>{await s.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await le(e(o.value)),s.success(`\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),z()},M=m([]),J=async()=>{if(!o.value)return;const l=await Z({bizType:v.CRM_CUSTOMER,bizId:o.value});M.value=l.list},U=m(),K=l=>{var r;(r=U.value)==null||r.createReceivable(l)},z=()=>{I(e(F)),x({name:"CrmCustomer"})},{params:S}=Y();return Re(()=>{if(!S.id)return s.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void z();o.value=S.id,_()}),(l,r)=>{const p=be,c=ze,Q=ee,V=we,A=Ce,H=Oe("hasPermi");return u(),Me(Se,null,[i(me,{customer:e(a),loading:e(w)},{default:t(()=>{var b,O,T,$,E,g;return[(b=e(n))!=null&&b.validateWrite?Ue((u(),f(p,{key:0,type:"primary",onClick:j},{default:t(()=>r[0]||(r[0]=[d(" \u7F16\u8F91 ")])),_:1})),[[H,["crm:customer:update"]]]):y("",!0),(O=e(n))!=null&&O.validateOwnerUser?(u(),f(p,{key:1,type:"primary",onClick:L},{default:t(()=>r[1]||(r[1]=[d(" \u8F6C\u79FB ")])),_:1})):y("",!0),(T=e(n))!=null&&T.validateWrite?(u(),f(p,{key:2,onClick:q},{default:t(()=>r[2]||(r[2]=[d(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")])),_:1})):y("",!0),e(a).lockStatus&&(($=e(n))!=null&&$.validateOwnerUser)?(u(),f(p,{key:3,onClick:W},{default:t(()=>r[3]||(r[3]=[d(" \u89E3\u9501 ")])),_:1})):y("",!0),!e(a).lockStatus&&((E=e(n))!=null&&E.validateOwnerUser)?(u(),f(p,{key:4,onClick:P},{default:t(()=>r[4]||(r[4]=[d(" \u9501\u5B9A ")])),_:1})):y("",!0),e(a).ownerUserId?y("",!0):(u(),f(p,{key:5,type:"primary",onClick:B},{default:t(()=>r[5]||(r[5]=[d(" \u9886\u53D6")])),_:1})),e(a).ownerUserId?y("",!0):(u(),f(p,{key:6,type:"primary",onClick:D},{default:t(()=>r[6]||(r[6]=[d(" \u5206\u914D ")])),_:1})),e(a).ownerUserId&&((g=e(n))!=null&&g.validateOwnerUser)?(u(),f(p,{key:7,onClick:G},{default:t(()=>r[7]||(r[7]=[d(" \u653E\u5165\u516C\u6D77 ")])),_:1})):y("",!0)]}),_:1},8,["customer","loading"]),i(A,null,{default:t(()=>[i(V,null,{default:t(()=>[i(c,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(_e,{"biz-id":e(o),"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(se,{customer:e(a)},null,8,["customer"])]),_:1}),i(c,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(ue,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var b;return[i(de,{ref_key:"permissionListRef",ref:n,"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER,"show-action":!((b=e(n))!=null&&b.isPool)||!1,onQuitTeam:z},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(c,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(pe,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(ne,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(fe,{"customer-id":e(a).id,onCreateReceivable:K},null,8,["customer-id"]),i(ce,{ref_key:"receivableListRef",ref:U,"customer-id":e(a).id},null,8,["customer-id"])]),_:1}),i(c,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(Q,{"log-list":e(M)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(oe,{ref_key:"formRef",ref:C,onSuccess:_},null,512),i(ve,{ref_key:"distributeForm",ref:R,onSuccess:_},null,512),i(ye,{ref_key:"transferFormRef",ref:k,"biz-type":e(v).CRM_CUSTOMER,onSuccess:z},null,8,["biz-type"])],64)}}});export{Te as default};
