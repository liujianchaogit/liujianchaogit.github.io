import{V as m,d as S,e as q}from"./index-DiGvuAxb.js";import{_ as I}from"./XTextButton-CO9jQPGe.js";import{S as f}from"./constants-C3gLHYOK.js";import{g as N}from"./profile-DkjUd9RW.js";import{_ as x,Z as z}from"./form-designer-drfGvdgz.js";import{k as j,r as h,e as E,b as F,y as G,m as d,z as u,H as l,v,F as H,l as w,G as U,E as g,u as L}from"./form-create-D7wT855o.js";const P=["src"],V={class:"mr-5"},Z=j({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup($,{emit:k}){const y=S(),n=h([]),r=h(),c=q(),_=k,C=()=>{const t=(e="type",new URL(decodeURIComponent(location.href)).searchParams.get(e)??"");var e;const a=c.query.code,s=c.query.state;a&&((i,o,p)=>m.post({url:"/system/social-user/bind",data:{type:i,code:o,state:p}}))(t,a,s).then(()=>{y.success("\u7ED1\u5B9A\u6210\u529F"),_("update:activeName","userSocial")})},b=t=>{const e=location.origin+"/user/profile?"+encodeURIComponent(`type=${t.type}`);((a,s)=>m.get({url:"/system/auth/social-auth-redirect?type="+a+"&redirectUri="+s}))(t.type,encodeURIComponent(e)).then(a=>{window.location.href=a})},R=async t=>{var e,a;await(e=t.type,a=t.openid,m.delete({url:"/system/social-user/unbind",data:{type:e,openid:a}}))&&(t.openid=void 0),y.success("\u89E3\u7ED1\u6210\u529F")};return E(async()=>{await(async()=>{var e;n.value=[];const t=await N();r.value=t;for(const a in f){const s={...f[a]};if(n.value.push(s),(e=r.value)==null?void 0:e.socialUsers){for(const i in r.value.socialUsers)if(s.type===r.value.socialUsers[i].type){s.openid=r.value.socialUsers[i].openid;break}}}})()}),F(()=>c,()=>{C()},{immediate:!0}),(t,e)=>{const a=x,s=I,i=z;return d(),G(i,{data:L(n),"show-header":!1},{default:u(()=>[l(a,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),l(a,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:u(({row:o})=>[v("img",{src:o.img,alt:"",class:"h-5 align-middle"},null,8,P),v("p",V,H(o.title),1)]),_:1}),l(a,{align:"center",label:"\u64CD\u4F5C"},{default:u(({row:o})=>[o.openid?(d(),w(U,{key:0},[e[0]||(e[0]=g(" \u5DF2\u7ED1\u5B9A ")),l(s,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:p=>R(o)},null,8,["onClick"])],64)):(d(),w(U,{key:1},[e[1]||(e[1]=g(" \u672A\u7ED1\u5B9A ")),l(s,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:p=>b(o)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{Z as _};
