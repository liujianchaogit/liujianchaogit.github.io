import{u as I,au as j,aH as q}from"./index-C1TKk8vI.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as U}from"./Echart.vue_vue_type_script_setup_true_lang-Bp4Tc-Mi.js";import{S as B}from"./funnel-DdUSY1jF.js";import{d as m}from"./formatTime-EbFUBcAO.js";import{ag as O,ad as R,$ as E,P as F,_ as G,aj as H}from"./form-designer-BpYekVAY.js";import{x as K,X as D,r as c,f as M,j as X,y as v,z as $,O as e,F as n,u as r,G as J,E as Q,K as L,L as _,M as V}from"./form-create-7GAbgMwl.js";const Y=K({name:"BusinessSummary",__name:"BusinessInversionRateSummary",props:{queryParams:{}},setup(S,{expose:C}){const u=S,o=D({pageNo:1,pageSize:10}),d=c(!1),x=c([]),f=c(0);M(()=>u.queryParams,s=>{if(!s)return;const t={...o,...s};Object.assign(o,t)},{immediate:!0});const a=D({color:["#6ca2ff","#6ac9d7","#ff7474"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["\u8D62\u5355\u8F6C\u5316\u7387","\u5546\u673A\u603B\u6570","\u8D62\u5355\u5546\u673A\u6570"],bottom:"0px",itemWidth:14},grid:{top:"40px",left:"40px",right:"40px",bottom:"40px",containLabel:!0,borderColor:"#fff"},xAxis:[{type:"category",data:[],axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}}],yAxis:[{type:"value",name:"\u8D62\u5355\u8F6C\u5316\u7387",axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD",formatter:"{value}%"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}},{type:"value",name:"\u5546\u673A\u6570",axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD",formatter:"{value}\u4E2A"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}}],series:[{name:"\u8D62\u5355\u8F6C\u5316\u7387",type:"line",yAxisIndex:0,data:[]},{name:"\u5546\u673A\u603B\u6570",type:"bar",yAxisIndex:1,barWidth:15,data:[]},{name:"\u8D62\u5355\u5546\u673A\u6570",type:"bar",yAxisIndex:1,barWidth:15,data:[]}]}),g=async()=>{const s=await B.getBusinessPageByDate(u.queryParams);x.value=s.list,f.value=s.total},{push:y}=I(),h=async()=>{d.value=!0;try{await(async()=>{const s=await B.getBusinessInversionRateSummaryByDate(u.queryParams);a.xAxis&&a.xAxis[0]&&a.xAxis[0].data&&(a.xAxis[0].data=s.map(t=>t.time)),a.series&&a.series[0]&&a.series[0].data&&(a.series[0].data=s.map(t=>q(t.businessWinCount,t.businessCount))),a.series&&a.series[1]&&a.series[1].data&&(a.series[1].data=s.map(t=>t.businessCount)),a.series&&a.series[2]&&a.series[2].data&&(a.series[2].data=s.map(t=>t.businessWinCount)),await g()})()}finally{d.value=!1}};return C({loadData:h}),X(()=>{h()}),(s,t)=>{const N=U,A=O,b=R,i=E,w=F,P=G,T=z,k=H;return v(),$(V,null,[e(b,{shadow:"never"},{default:n(()=>[e(A,{loading:r(d),animated:""},{default:n(()=>[e(N,{height:500,options:r(a)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(b,{class:"mt-16px",shadow:"never"},{default:n(()=>[J((v(),Q(P,{data:r(x)},{default:n(()=>[e(i,{align:"center",fixed:"left",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(i,{align:"center",fixed:"left",label:"\u5546\u673A\u540D\u79F0",prop:"name",width:"160"},{default:n(l=>[e(w,{underline:!1,type:"primary",onClick:W=>{return p=l.row.id,void y({name:"CrmBusinessDetail",params:{id:p}});var p}},{default:n(()=>[L(_(l.row.name),1)]),_:2},1032,["onClick"])]),_:1}),e(i,{align:"center",fixed:"left",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"120"},{default:n(l=>[e(w,{underline:!1,type:"primary",onClick:W=>{return p=l.row.customerId,void y({name:"CrmCustomerDetail",params:{id:p}});var p}},{default:n(()=>[L(_(l.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),e(i,{formatter:r(j),align:"center",label:"\u5546\u673A\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalPrice",width:"140"},null,8,["formatter"]),e(i,{formatter:r(m),align:"center",label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime",width:"180px"},null,8,["formatter"]),e(i,{align:"center",label:"\u5907\u6CE8",prop:"remark",width:"200"}),e(i,{formatter:r(m),align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"contactNextTime",width:"180px"},null,8,["formatter"]),e(i,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"100px"}),e(i,{align:"center",label:"\u6240\u5C5E\u90E8\u95E8",prop:"ownerUserDeptName",width:"100px"}),e(i,{formatter:r(m),align:"center",label:"\u6700\u540E\u8DDF\u8FDB\u65F6\u95F4",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),e(i,{formatter:r(m),align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),e(i,{formatter:r(m),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),e(i,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"100px"}),e(i,{align:"center",fixed:"right",label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeName",width:"140"}),e(i,{align:"center",fixed:"right",label:"\u5546\u673A\u9636\u6BB5",prop:"statusName",width:"120"})]),_:1},8,["data"])),[[k,r(d)]]),e(T,{limit:r(o).pageSize,"onUpdate:limit":t[0]||(t[0]=l=>r(o).pageSize=l),page:r(o).pageNo,"onUpdate:page":t[1]||(t[1]=l=>r(o).pageNo=l),total:r(f),onPagination:g},null,8,["limit","page","total"])]),_:1})],64)}}});export{Y as _};
