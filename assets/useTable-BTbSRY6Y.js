import{_ as q}from"./Form-D57Ko41z.js";import{p as h,b as $,$ as W,_ as K}from"./index-C1TKk8vI.js";import{r as A,n as j,u as n,x as E,c as R,y as w,z as M,O as P,a6 as I,a4 as J,F as x,A as T,E as k,K as L,L as _,J as b,V as X,M as G,X as H,f as B}from"./form-create-7GAbgMwl.js";import{K as Q,f as U,M as D,O as N}from"./form-designer-BpYekVAY.js";import{d as Y}from"./download-oWiM5xVU.js";const Z={key:0},ee=E({name:"Search",__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:h.bool.def(!1),labelWidth:h.oneOfType([String,Number]).def("auto"),layout:h.string.validate(e=>["inline","bottom"].includes(e)).def("inline"),buttomPosition:h.string.validate(e=>["left","center","right"].includes(e)).def("center"),showSearch:h.bool.def(!0),showReset:h.bool.def(!0),expand:h.bool.def(!1),expandField:h.string.def(""),inline:h.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(e,{emit:a}){const{t:g}=$(),d=e,v=a,m=A(!0),C=R(()=>{let s=Q(d.schema);if(d.expand&&d.expandField&&!n(m)){const p=W(s,r=>r.field===d.expandField);if(p>-1){const r=s.length;s.splice(p+1,r)}}return d.layout==="inline"&&(s=s.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),s}),{register:f,elFormRef:t,methods:i}=(s=>{const p=A(),r=A(),l=async()=>(await j(),n(p)),F={setProps:async(c={})=>{const o=await l();o==null||o.setProps(c),c.model&&(o==null||o.setValues(c.model))},setValues:async c=>{const o=await l();o==null||o.setValues(c)},setSchema:async c=>{const o=await l();o==null||o.setSchema(c)},addSchema:async(c,o)=>{const z=await l();z==null||z.addSchema(c,o)},delSchema:async c=>{const o=await l();o==null||o.delSchema(c)},getFormData:async()=>{const c=await l();return c==null?void 0:c.formModel}};return s&&F.setProps(s),{register:(c,o)=>{p.value=c,r.value=o},elFormRef:r,methods:F}})({model:d.model||{}}),y=async()=>{var s;await((s=n(t))==null?void 0:s.validate(async p=>{if(p){const{getFormData:r}=i,l=await r();v("search",l)}}))},S=async()=>{var r;(r=n(t))==null||r.resetFields();const{getFormData:s}=i,p=await s();v("reset",p)},V=R(()=>({textAlign:d.buttomPosition})),O=()=>{var s;(s=n(t))==null||s.resetFields(),m.value=!n(m)};return(s,p)=>{const r=K,l=U,F=q;return w(),M(G,null,[P(F,{inline:e.inline,"is-col":e.isCol,"is-custom":!1,"label-width":e.labelWidth,schema:n(C),class:"-mb-15px","hide-required-asterisk":"",onRegister:n(f)},I({action:x(()=>[e.layout==="inline"?(w(),M("div",Z,[e.showSearch?(w(),k(l,{key:0,onClick:y},{default:x(()=>[P(r,{class:"mr-5px",icon:"ep:search"}),L(" "+_(n(g)("common.query")),1)]),_:1})):b("",!0),e.showReset?(w(),k(l,{key:1,onClick:S},{default:x(()=>[P(r,{class:"mr-5px",icon:"ep:refresh"}),L(" "+_(n(g)("common.reset")),1)]),_:1})):b("",!0),e.expand?(w(),k(l,{key:2,text:"",onClick:O},{default:x(()=>[L(_(n(g)(n(m)?"common.shrink":"common.expand"))+" ",1),P(r,{icon:n(m)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):b("",!0),T(s.$slots,"actionMore")])):b("",!0)]),_:2},[J(Object.keys(s.$slots),c=>({name:c,fn:x(()=>[T(s.$slots,c)])}))]),1032,["inline","is-col","label-width","schema","onRegister"]),e.layout==="bottom"?(w(),M("div",{key:0,style:X(n(V))},[e.showSearch?(w(),k(l,{key:0,type:"primary",onClick:y},{default:x(()=>[P(r,{class:"mr-5px",icon:"ep:search"}),L(" "+_(n(g)("common.query")),1)]),_:1})):b("",!0),e.showReset?(w(),k(l,{key:1,onClick:S},{default:x(()=>[P(r,{class:"mr-5px",icon:"ep:refresh-right"}),L(" "+_(n(g)("common.reset")),1)]),_:1})):b("",!0),e.expand?(w(),k(l,{key:2,text:"",onClick:O},{default:x(()=>[L(_(n(g)(n(m)?"common.shrink":"common.expand"))+" ",1),P(r,{icon:n(m)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):b("",!0),T(s.$slots,"actionMore")],4)):b("",!0)],64)}}}),{t:u}=$(),te=e=>{const a=H({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(e==null?void 0:e.defaultParams)||{}},loading:!0,exportLoading:!1,currentRow:null}),g=R(()=>({...a.params,pageSize:a.pageSize,pageNo:a.currentPage}));B(()=>a.currentPage,()=>{f.getList()}),B(()=>a.pageSize,()=>{a.currentPage===1||(a.currentPage=1),f.getList()});const d=A(),v=A(),m=async()=>(await j(),n(d)),C=async t=>{let i=1;t instanceof Array?(i=t.length,await Promise.all(t.map(async y=>{await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(y)))}))):await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(t))),D.success(u("common.delSuccess")),a.currentPage=(a.total%a.pageSize===i||a.pageSize===1)&&a.currentPage>1?a.currentPage-1:a.currentPage,await f.getList()},f={getList:async()=>{a.loading=!0;const t=await(e==null?void 0:e.getListApi(n(g)).finally(()=>{a.loading=!1}));t&&(a.tableList=t.list,a.total=t.total??0)},setProps:async(t={})=>{const i=await m();i==null||i.setProps(t)},setColumn:async t=>{const i=await m();i==null||i.setColumn(t)},getSelections:async()=>{const t=await m();return(t==null?void 0:t.selections)||[]},setSearchParams:t=>{a.params=Object.assign(a.params,{pageSize:a.pageSize,pageNo:1,...t}),a.currentPage!==1?a.currentPage=1:f.getList()},delList:async(t,i,y=!0)=>{const S=await m();!i||S!=null&&S.selections.length?y?N.confirm(u("common.delMessage"),u("common.confirmTitle"),{confirmButtonText:u("common.ok"),cancelButtonText:u("common.cancel"),type:"warning"}).then(async()=>{await C(t)}):await C(t):D.warning(u("common.delNoData"))},exportList:async t=>{a.exportLoading=!0,N.confirm(u("common.exportMessage"),u("common.confirmTitle"),{confirmButtonText:u("common.ok"),cancelButtonText:u("common.cancel"),type:"warning"}).then(async()=>{var y;const i=await((y=e==null?void 0:e.exportListApi)==null?void 0:y.call(e,n(g)));i&&Y.excel(i,t)}).finally(()=>{a.exportLoading=!1})}};return e!=null&&e.props&&f.setProps(e.props),{register:(t,i)=>{d.value=t,v.value=i},elTableRef:v,tableObject:a,methods:f,tableMethods:f}};export{ee as _,te as u};
