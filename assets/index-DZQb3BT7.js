import{d as X,b as $,e as B,D as M,_ as H}from"./index-C1TKk8vI.js";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as J}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as W}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as Y}from"./index-BhsNgP9o.js";import{d as Z}from"./formatTime-EbFUBcAO.js";import{_ as aa}from"./PointActivityForm.vue_vue_type_script_setup_true_lang-CVQpdQlH.js";import{f as ea}from"./formatter-Cy2d_MRj.js";import{P as v}from"./index-xw5B9PK9.js";import{Q as ta,x as la,ai as ia,f as oa,h as ra,$ as pa,ak as sa,_ as na,aj as ma}from"./form-designer-BpYekVAY.js";import{x as ca,r as d,X as ua,c as da,j as fa,aq as wa,y as s,z as O,O as a,F as l,u as i,M as T,a4 as ya,E as u,K as n,G as f,L as _a}from"./form-create-7GAbgMwl.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./Form-D57Ko41z.js";import"./InputPassword-C2NBtECC.js";import"./tsxHelper-C4ukkQNk.js";import"./SpuSelect.vue_vue_type_script_setup_true_lang-CCllmZHn.js";import"./index-DK77YGos.js";import"./SkuList.vue_vue_type_script_setup_true_lang-Bof6RkjR.js";import"./tree-COGD3qag.js";import"./category-BHM6Cffl.js";import"./spu-75LBH-4N.js";import"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-B3bd3U-D.js";import"./formRules-NkbEJCk0.js";import"./useCrudSchemas-CYXvU7P5.js";const ka=ca({name:"PointActivity",__name:"index",setup(ha){const w=X(),{t:z}=$(),_=d(!0),g=d(0),b=d([]),r=ua({pageNo:1,pageSize:10,name:null,status:null}),x=d(),F=da(()=>p=>(p.totalStock||0)-(p.stock||0)),m=async()=>{_.value=!0;try{const p=await v.getPointActivityPage(r);b.value=p.list,g.value=p.total}finally{_.value=!1}},C=()=>{r.pageNo=1,m()},V=()=>{x.value.resetFields(),C()},S=d(),P=(p,e)=>{S.value.open(p,e)};return fa(async()=>{await m()}),(p,e)=>{const j=Y,q=ta,L=la,N=ia,k=H,c=oa,Q=ra,U=W,o=pa,R=sa,D=J,E=na,G=I,y=wa("hasPermi"),K=ma;return s(),O(T,null,[a(j,{title:"\u3010\u8425\u9500\u3011\u79EF\u5206\u5546\u57CE\u6D3B\u52A8",url:"https://doc.iocoder.cn/mall/promotion-point/"}),a(U,null,{default:l(()=>[a(Q,{ref_key:"queryFormRef",ref:x,inline:!0,model:i(r),class:"-mb-15px","label-width":"68px"},{default:l(()=>[a(N,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:l(()=>[a(L,{modelValue:i(r).status,"onUpdate:modelValue":e[0]||(e[0]=t=>i(r).status=t),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001"},{default:l(()=>[(s(!0),O(T,null,ya(i(B)(i(M).COMMON_STATUS),t=>(s(),u(q,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(N,null,{default:l(()=>[a(c,{onClick:C},{default:l(()=>[a(k,{class:"mr-5px",icon:"ep:search"}),e[4]||(e[4]=n(" \u641C\u7D22 "))]),_:1}),a(c,{onClick:V},{default:l(()=>[a(k,{class:"mr-5px",icon:"ep:refresh"}),e[5]||(e[5]=n(" \u91CD\u7F6E "))]),_:1}),f((s(),u(c,{plain:"",type:"primary",onClick:e[1]||(e[1]=t=>P("create"))},{default:l(()=>[a(k,{class:"mr-5px",icon:"ep:plus"}),e[6]||(e[6]=n(" \u65B0\u589E "))]),_:1})),[[y,["promotion:point-activity:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(U,null,{default:l(()=>[f((s(),u(E,{data:i(b),"show-overflow-tooltip":!0,stripe:!0},{default:l(()=>[a(o,{label:"\u6D3B\u52A8\u7F16\u53F7","min-width":"80",prop:"id"}),a(o,{label:"\u5546\u54C1\u56FE\u7247","min-width":"80",prop:"spuName"},{default:l(t=>[a(R,{"preview-src-list":[t.row.picUrl],src:t.row.picUrl,class:"h-40px w-40px","preview-teleported":""},null,8,["preview-src-list","src"])]),_:1}),a(o,{label:"\u5546\u54C1\u6807\u9898","min-width":"300",prop:"spuName"}),a(o,{formatter:i(ea),label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"},null,8,["formatter"]),a(o,{label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"}),a(o,{align:"center",label:"\u6D3B\u52A8\u72B6\u6001","min-width":"100",prop:"status"},{default:l(t=>[a(D,{type:i(M).COMMON_STATUS,value:t.row.status},null,8,["type","value"])]),_:1}),a(o,{align:"center",label:"\u5E93\u5B58","min-width":"80",prop:"stock"}),a(o,{align:"center",label:"\u603B\u5E93\u5B58","min-width":"80",prop:"totalStock"}),a(o,{align:"center",label:"\u5DF2\u5151\u6362\u6570\u91CF","min-width":"100",prop:"redeemedQuantity"},{default:l(({row:t})=>[n(_a(i(F)(t)),1)]),_:1}),a(o,{formatter:i(Z),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"150px"},{default:l(t=>[f((s(),u(c,{link:"",type:"primary",onClick:A=>P("update",t.row.id)},{default:l(()=>e[7]||(e[7]=[n(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[y,["promotion:point-activity:update"]]]),t.row.status===0?f((s(),u(c,{key:0,link:"",type:"danger",onClick:A=>(async h=>{try{await w.confirm("\u786E\u8BA4\u5173\u95ED\u8BE5\u79EF\u5206\u5546\u57CE\u6D3B\u52A8\u5417\uFF1F"),await v.closePointActivity(h),w.success("\u5173\u95ED\u6210\u529F"),await m()}catch{}})(t.row.id)},{default:l(()=>e[8]||(e[8]=[n(" \u5173\u95ED ")])),_:2},1032,["onClick"])),[[y,["promotion:point-activity:close"]]]):f((s(),u(c,{key:1,link:"",type:"danger",onClick:A=>(async h=>{try{await w.delConfirm(),await v.deletePointActivity(h),w.success(z("common.delSuccess")),await m()}catch{}})(t.row.id)},{default:l(()=>e[9]||(e[9]=[n(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[y,["promotion:point-activity:delete"]]])]),_:1})]),_:1},8,["data"])),[[K,i(_)]]),a(G,{limit:i(r).pageSize,"onUpdate:limit":e[2]||(e[2]=t=>i(r).pageSize=t),page:i(r).pageNo,"onUpdate:page":e[3]||(e[3]=t=>i(r).pageNo=t),total:i(g),onPagination:m},null,8,["limit","page","total"])]),_:1}),a(aa,{ref_key:"formRef",ref:S,onSuccess:m},null,512)],64)}}});export{ka as default};
