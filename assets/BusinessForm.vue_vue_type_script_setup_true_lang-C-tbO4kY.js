import{av as D,b as N,d as W,aw as Y,a as Z}from"./index-C1TKk8vI.js";import{_ as $}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{a as ae,c as le,u as de}from"./index-DLPyhh9r.js";import{g as te}from"./index-2SiQtehE.js";import{a as ue}from"./index-Bdw660V1.js";import{g as oe}from"./index-CZiMqbPE.js";import{_ as re}from"./BusinessProductForm.vue_vue_type_script_setup_true_lang-w8Q4BfL1.js";import{k as se,ai as ie,j as me,Q as ce,x as ne,i as pe,F as fe,a0 as ve,a1 as _e,l as be,h as Ve,f as Pe,aj as we}from"./form-designer-BpYekVAY.js";import{x as Ie,r as i,X as ye,f as Ue,y as c,E as v,F as t,O as e,K as C,u as d,G as ge,z as y,a4 as U,M as g,l as M}from"./form-create-7GAbgMwl.js";const ke=Ie({__name:"BusinessForm",emits:["success"],setup(he,{expose:Q,emit:R}){const{t:b}=N(),k=W(),n=i(!1),h=i(""),p=i(!1),f=i(""),u=i({id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1}),S=ye({name:[{required:!0,message:"\u5546\u673A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],statusTypeId:[{required:!0,message:"\u5546\u673A\u72B6\u6001\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i(),T=i([]),x=i([]),F=i([]),V=i("product"),j=i();Ue(()=>u.value,o=>{if(!o)return;const a=o.products.reduce((r,s)=>r+s.totalPrice,0),m=a-(o.discountPercent!=null?Y(a,o.discountPercent/100):0);u.value.totalProductPrice=a,u.value.totalPrice=m},{deep:!0}),Q({open:async(o,a,m,r)=>{if(n.value=!0,h.value=b("action."+o),f.value=o,E(),a){p.value=!0;try{u.value=await ae(a)}finally{p.value=!1}}else m&&(u.value.customerId=m,u.value.customerDefault=!0),r&&(u.value.contactId=r);F.value=await ue(),x.value=await te(),T.value=await oe(),f.value==="create"&&(u.value.ownerUserId=Z().getUser.id)}});const z=R,B=async()=>{if(_&&await _.value.validate()){await j.value.validate(),p.value=!0;try{const o=u.value;f.value==="create"?(await le(o),k.success(b("common.createSuccess"))):(await de(o),k.success(b("common.updateSuccess"))),n.value=!1,z("success")}finally{p.value=!1}}},E=()=>{var o;u.value={id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1},(o=_.value)==null||o.resetFields()};return(o,a)=>{const m=se,r=ie,s=me,P=ce,w=ne,I=pe,G=fe,K=ve,O=_e,X=ee,A=be,H=Ve,q=Pe,J=$,L=we;return c(),v(J,{title:d(h),modelValue:d(n),"onUpdate:modelValue":a[11]||(a[11]=l=>M(n)?n.value=l:null),width:"1280"},{footer:t(()=>[e(q,{onClick:B,type:"primary",disabled:d(p)},{default:t(()=>a[12]||(a[12]=[C("\u786E \u5B9A")])),_:1},8,["disabled"]),e(q,{onClick:a[10]||(a[10]=l=>n.value=!1)},{default:t(()=>a[13]||(a[13]=[C("\u53D6 \u6D88")])),_:1})]),default:t(()=>[ge((c(),v(H,{ref_key:"formRef",ref:_,model:d(u),rules:d(S),"label-width":"120px"},{default:t(()=>[e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u5546\u673A\u540D\u79F0",prop:"name"},{default:t(()=>[e(m,{modelValue:d(u).name,"onUpdate:modelValue":a[0]||(a[0]=l=>d(u).name=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:t(()=>[e(w,{modelValue:d(u).ownerUserId,"onUpdate:modelValue":a[1]||(a[1]=l=>d(u).ownerUserId=l),disabled:d(f)!=="create",class:"w-1/1"},{default:t(()=>[(c(!0),y(g,null,U(d(T),l=>(c(),v(P,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:t(()=>[e(w,{disabled:d(u).customerDefault,modelValue:d(u).customerId,"onUpdate:modelValue":a[2]||(a[2]=l=>d(u).customerId=l),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1"},{default:t(()=>[(c(!0),y(g,null,U(d(F),l=>(c(),v(P,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeId"},{default:t(()=>[e(w,{modelValue:d(u).statusTypeId,"onUpdate:modelValue":a[3]||(a[3]=l=>d(u).statusTypeId=l),placeholder:"\u8BF7\u9009\u62E9\u5546\u673A\u72B6\u6001\u7EC4",clearable:"",class:"w-1/1",disabled:d(f)!=="create"},{default:t(()=>[(c(!0),y(g,null,U(d(x),l=>(c(),v(P,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime"},{default:t(()=>[e(G,{modelValue:d(u).dealTime,"onUpdate:modelValue":a[4]||(a[4]=l=>d(u).dealTime=l),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[e(m,{type:"textarea",modelValue:d(u).remark,"onUpdate:modelValue":a[5]||(a[5]=l=>d(u).remark=l),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(X,null,{default:t(()=>[e(O,{modelValue:d(V),"onUpdate:modelValue":a[6]||(a[6]=l=>M(V)?V.value=l:null),class:"-mt-15px -mb-10px"},{default:t(()=>[e(K,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:t(()=>[e(re,{ref_key:"productFormRef",ref:j,products:d(u).products,disabled:o.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:t(()=>[e(m,{disabled:"",modelValue:d(u).totalProductPrice,"onUpdate:modelValue":a[7]||(a[7]=l=>d(u).totalProductPrice=l),formatter:d(D)},null,8,["modelValue","formatter"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:t(()=>[e(A,{modelValue:d(u).discountPercent,"onUpdate:modelValue":a[8]||(a[8]=l=>d(u).discountPercent=l),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"price"},{default:t(()=>[e(m,{disabled:"",modelValue:d(u).totalPrice,"onUpdate:modelValue":a[9]||(a[9]=l=>d(u).totalPrice=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:d(D)},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[L,d(p)]])]),_:1},8,["title","modelValue"])}}});export{ke as _};
