import{a as z,d as A,E as _,F as r}from"./index-DiGvuAxb.js";import{_ as H}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{g as P}from"./index-9oj5Z7ye.js";import{g as R,u as S}from"./index-Dgzhg4xA.js";import{h as D,ai as G,k as J,s as K,u as L,l as M,aj as N,f as O}from"./form-designer-drfGvdgz.js";import{k as Q,r as p,P as W,c as X,y,m as V,z as u,A as Y,u as n,H as l,E as v,h as Z}from"./form-create-D7wT855o.js";const $=Q({name:"UpdateBalanceForm",__name:"UserBalanceUpdateForm",emits:["success"],setup(ee,{expose:k,emit:B}){const{t:w}=z(),f=A(),d=p(!1),c=p(!1),a=p({id:void 0,nickname:void 0,balance:"0",changeBalance:0,changeType:1}),x=W({changeBalance:[{required:!0,message:"\u53D8\u52A8\u4F59\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),m=p();k({open:async o=>{if(d.value=!0,F(),o){c.value=!0;try{const e=await P(o),i=await R({userId:e.id||0});a.value.id=e.id,a.value.nickname=e.nickname,a.value.balance=_(i.balance),a.value.changeType=1,a.value.changeBalance=0}finally{c.value=!1}}}});const T=B,U=async()=>{if(m&&await m.value.validate())if(a.value.changeBalance<=0)f.error("\u53D8\u52A8\u4F59\u989D\u4E0D\u80FD\u4E3A\u96F6");else if(r(b.value)<0)f.error("\u53D8\u52A8\u540E\u7684\u4F59\u989D\u4E0D\u80FD\u5C0F\u4E8E 0");else{c.value=!0;try{await S({userId:a.value.id,balance:r(a.value.changeBalance)*a.value.changeType}),f.success(w("common.updateSuccess")),d.value=!1,T("success")}finally{c.value=!1}}},F=()=>{var o;a.value={id:void 0,nickname:void 0,balance:"0",changeBalance:0,changeType:1},(o=m.value)==null||o.resetFields()},b=X(()=>_(r(a.value.balance)+r(a.value.changeBalance)*a.value.changeType));return(o,e)=>{const i=J,t=G,g=L,C=K,E=M,I=D,h=O,j=H,q=N;return V(),y(j,{modelValue:n(d),"onUpdate:modelValue":e[5]||(e[5]=s=>Z(d)?d.value=s:null),title:"\u4FEE\u6539\u7528\u6237\u4F59\u989D",width:"600"},{footer:u(()=>[l(h,{disabled:n(c),type:"primary",onClick:U},{default:u(()=>e[8]||(e[8]=[v("\u786E \u5B9A")])),_:1},8,["disabled"]),l(h,{onClick:e[4]||(e[4]=s=>d.value=!1)},{default:u(()=>e[9]||(e[9]=[v("\u53D6 \u6D88")])),_:1})]),default:u(()=>[Y((V(),y(I,{ref_key:"formRef",ref:m,model:n(a),rules:n(x),"label-width":"130px"},{default:u(()=>[l(t,{label:"\u7528\u6237\u7F16\u53F7",prop:"id"},{default:u(()=>[l(i,{modelValue:n(a).id,"onUpdate:modelValue":e[0]||(e[0]=s=>n(a).id=s),class:"!w-240px",disabled:""},null,8,["modelValue"])]),_:1}),l(t,{label:"\u7528\u6237\u6635\u79F0",prop:"nickname"},{default:u(()=>[l(i,{modelValue:n(a).nickname,"onUpdate:modelValue":e[1]||(e[1]=s=>n(a).nickname=s),class:"!w-240px",disabled:""},null,8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u524D\u4F59\u989D(\u5143)",prop:"balance"},{default:u(()=>[l(i,{"model-value":n(a).balance,class:"!w-240px",disabled:""},null,8,["model-value"])]),_:1}),l(t,{label:"\u53D8\u52A8\u7C7B\u578B",prop:"changeType"},{default:u(()=>[l(C,{modelValue:n(a).changeType,"onUpdate:modelValue":e[2]||(e[2]=s=>n(a).changeType=s)},{default:u(()=>[l(g,{label:1},{default:u(()=>e[6]||(e[6]=[v("\u589E\u52A0")])),_:1}),l(g,{label:-1},{default:u(()=>e[7]||(e[7]=[v("\u51CF\u5C11")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u4F59\u989D(\u5143)",prop:"changeBalance"},{default:u(()=>[l(E,{modelValue:n(a).changeBalance,"onUpdate:modelValue":e[3]||(e[3]=s=>n(a).changeBalance=s),min:0,precision:2,step:.1,class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u540E\u4F59\u989D(\u5143)"},{default:u(()=>[l(i,{"model-value":n(b),class:"!w-240px",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules"])),[[q,n(c)]])]),_:1},8,["modelValue"])}}});export{$ as _};
