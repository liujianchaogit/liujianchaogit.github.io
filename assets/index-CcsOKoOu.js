import{d as E,aP as S,aQ as k}from"./index-C1TKk8vI.js";import g from"./KeFuConversationList-CfKVc70f.js";import C from"./KeFuMessageList-DAhKXtbh.js";import M from"./MemberInfo-DXJo9f8V.js";import{u as F,W as l}from"./kefu-Dtwn5LP3.js";import{V as x}from"./form-designer-BpYekVAY.js";import{x as I,r as a,f as N,j as R,W as A,y as L,E as O,F as b,O as m,u as p}from"./form-create-7GAbgMwl.js";import"./emoji-DIhFXR2A.js";import"./formatTime-EbFUBcAO.js";import"./EmojiSelectPopover.vue_vue_type_script_setup_true_lang-BC8FAYKn.js";import"./PictureSelectUpload.vue_vue_type_script_setup_true_lang-Bi9xU8rs.js";import"./picture-CTjip5lJ.js";import"./ProductItem-CdAfGMsV.js";import"./OrderItem-BZdVJw6H.js";import"./constants-IYPHa1Ih.js";import"./ProductBrowsingHistory.vue_vue_type_script_setup_true_lang-DQIVZUj8.js";import"./OrderBrowsingHistory.vue_vue_type_script_setup_true_lang-Ceo-Xnlv.js";import"./index-DsFOJog9.js";import"./CardTitle-DO8rewsa.js";import"./UserBasicInfo-Boh54j5D.js";import"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import"./color-BN7ZL7BD.js";import"./Descriptions.vue_vue_type_style_index_0_scoped_74d4336e_lang-D9DRRQNJ.js";import"./el-collapse-transition-l0sNRNKZ.js";import"./DescriptionsItemLabel-CynU90YO.js";import"./UserAccountInfo-MQVim9np.js";import"./index-Bkh0xs8b.js";import"./index-BToVngBc.js";const w=I({name:"KeFu",__name:"index",setup(J){const c=E(),s=F(),v=a("http://localhost:48080/infra/ws".replace("http","ws")+"?token="+S()),{data:d,close:_,open:h}=k(v.value,{autoReconnect:!0,heartbeat:!0});N(()=>d.value,t=>{var o;if(t)try{if(t==="pong")return;const e=JSON.parse(t),n=e.type;if(!n)return void c.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+t);if(n===l.KEFU_MESSAGE_TYPE){const r=JSON.parse(e.content);return s.updateConversation(r.conversationId),void((o=i.value)==null?void 0:o.refreshMessageList(r))}if(n===l.KEFU_MESSAGE_ADMIN_READ){const r=JSON.parse(e.content);s.updateConversationStatus(r.conversationId)}}catch{}},{immediate:!1});const i=a(),u=a(),y=t=>{var o,e;(o=i.value)==null||o.getNewMessageList(t),(e=u.value)==null||e.initHistory(t)},f=a();return R(()=>{s.setConversationList().then(()=>{var t;(t=f.value)==null||t.calculationLastMessageTime()}),h()}),A(()=>{_()}),(t,o)=>{const e=x;return L(),O(e,{class:"kefu-layout"},{default:b(()=>[m(p(g),{ref_key:"keFuConversationRef",ref:f,onChange:y},null,512),m(p(C),{ref_key:"keFuChatBoxRef",ref:i},null,512),m(p(M),{ref_key:"memberInfoRef",ref:u},null,512)]),_:1})}}});export{w as default};
