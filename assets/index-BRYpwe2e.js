import{e as oe,d as ae,_ as te,aG as re,c as se}from"./index-DiGvuAxb.js";import{_ as le}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{b as ie}from"./index-Dm7yQOF4.js";import{h as ne}from"./index-pGMn8Zyx.js";import{C as ce}from"./index-2iWJkeed.js";import pe from"./ProcessDefinitionDetail-BbjUghMh.js";import{aX as fe,k as me,aj as ue,i as de,j as ve,e as ye,o as xe,ac as ge,ak as he,a6 as ke,aN as _e}from"./form-designer-drfGvdgz.js";import{k as be,g as we,r as c,c as F,e as Ce,l as m,y as g,u as i,m as r,H as u,A as $e,z as n,h as Ie,v as b,G as I,$ as j,B as G,F as T,E as Te,n as De}from"./form-create-D7wT855o.js";import"./formCreate-DGy7HbUv.js";import"./constants-C3gLHYOK.js";import"./consts-CvaDWb4S.js";import"./ProcessInstanceBpmnViewer-B5XpeIaZ.js";import"./bpmn-embedded-CEyxHmW-.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./XTextButton-CO9jQPGe.js";import"./XButton-BXTtfQPD.js";import"./index-brTT8YwK.js";import"./index-BEHCTgo8.js";import"./node-CQ9Ble-i.js";import"./index-7o_S5bjn.js";import"./index-BCN8BzfC.js";import"./utils-aZyOMVaO.js";import"./index-DTNfh8Br.js";import"./tree-COGD3qag.js";import"./index-CLkdJnRM.js";import"./index-eU2zJvzd.js";import"./index-CNUeQNrn.js";import"./index-RiOYYfh_.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./index-GbnTArhn.js";import"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import"./color-BN7ZL7BD.js";import"./index-BES_6pzR.js";import"./formatTime-DeTj2b0K.js";import"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-dOF1_6Hu.js";import"./simple-process-designer-DszNnWcD.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-uNUCv3aR.js";import"./index-PFHQ4aD1.js";import"./download-oWiM5xVU.js";import"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-CfiJLsSe.js";import"./index-DS_oxMOO.js";import"./tagsView-B3xQDSQ0.js";const ze={class:"flex flex-col"},Pe=["onClick"],Ve={class:"text-18px font-bold mb-10px mt-5px"},je={class:"grid grid-cols-3 gap3"},Ae={class:"flex"},Be={key:1,class:"flow-icon"},Ee={style:{"font-size":"12px",color:"#fff"}},Le=se(be({name:"BpmProcessInstanceCreate",__name:"index",setup(Se){const{proxy:D}=we(),H=oe(),A=ae(),h=c(""),w=H.query.processInstanceId,z=c(!0),p=c([]),d=c({}),v=c([]),W=async()=>{try{p.value=await ce.getCategorySimpleList()}finally{}},q=async()=>{var e;try{v.value=await ie({suspensionState:1}),y.value=v.value,V.value.length>0&&!((e=d.value)!=null&&e.code)&&(d.value=V.value[0])}finally{}},y=c([]),B=()=>{h.value.trim()?y.value=v.value.filter(e=>e.name.toLowerCase().includes(h.value.toLowerCase())):y.value=v.value},P=F(()=>{var a;if(!((a=v.value)!=null&&a.length))return{};const e=fe(y.value,"category"),o={};return p.value.forEach(t=>{e[t.code]&&(o[t.code]=e[t.code])}),o}),N=e=>{var o,a;return(a=(o=p.value)==null?void 0:o.find(t=>t.code===e))==null?void 0:a.name},C=c(),E=c(),L=async(e,o)=>{var a;C.value=e,await De(),(a=E.value)==null||a.initProcessInfo(e,o)},O=e=>{const o=e.scrollTop,a=p.value.map(l=>{const f=D.$refs[`category-${l.code}`];return f!=null&&f[0]?{code:l.code,offsetTop:f[0].offsetTop,height:f[0].offsetHeight}:null}).filter(Boolean);let t=a[0];for(const l of a){if(!(o>=l.offsetTop-50))break;t=l}t&&d.value.code!==t.code&&(d.value=p.value.find(l=>l.code===t.code))},V=F(()=>{var o;if(!((o=p.value)!=null&&o.length)||!P.value)return[];const e=Object.keys(P.value);return p.value.filter(a=>e.includes(a.code))});return Ce(()=>{(async()=>{z.value=!0;try{if(await W(),await q(),(w==null?void 0:w.length)>0){const e=await ne(w);if(!e)return void A.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const o=v.value.find(a=>{var t;return a.key==((t=e.processDefinition)==null?void 0:t.key)});if(!o)return void A.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await L(o,e.formVariables)}}finally{z.value=!1}})()}),(e,o)=>{var S;const a=te,t=me,l=ve,f=he,R=ke,U=ge,X=xe,J=ye,M=de,Q=_e,Y=le,Z=ue;return i(C)?(r(),g(pe,{key:1,ref_key:"processDefinitionDetailRef",ref:E,selectProcessDefinition:i(C),onCancel:o[1]||(o[1]=k=>C.value=void 0)},null,8,["selectProcessDefinition"])):(r(),m(I,{key:0},[u(t,{modelValue:i(h),"onUpdate:modelValue":o[0]||(o[0]=k=>Ie(h)?h.value=k:null),class:"!w-50% mb-15px",placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onInput:B,onClear:B},{prefix:n(()=>[u(a,{icon:"ep:search"})]),_:1},8,["modelValue"]),$e((r(),g(Y,{class:G([{"process-definition-container":(S=i(y))==null?void 0:S.length},"position-relative pb-20px h-700px"])},{default:n(()=>{var k;return[(k=i(y))!=null&&k.length?(r(),g(M,{key:0,gutter:20,class:"!flex-nowrap"},{default:n(()=>[u(l,{span:5},{default:n(()=>[b("div",ze,[(r(!0),m(I,null,j(i(V),x=>(r(),m("div",{key:x.code,class:G(["flex items-center p-10px cursor-pointer text-14px rounded-md",i(d).code===x.code?"text-#3e7bff bg-#e8eeff":""]),onClick:$=>(s=>{d.value=s;const _=D.$refs[`category-${s.code}`];if(_!=null&&_.length){const K=D.$refs.scrollWrapper,ee=_[0].offsetTop;K.scrollTo({top:ee,behavior:"smooth"})}})(x)},T(x.name),11,Pe))),128))])]),_:1}),u(l,{span:19},{default:n(()=>[u(J,{ref:"scrollWrapper",height:"700",onScroll:O},{default:n(()=>[(r(!0),m(I,null,j(i(P),(x,$)=>(r(),m("div",{class:"mb-20px pl-10px",key:$,ref_for:!0,ref:`category-${$}`},[b("h3",Ve,T(N($)),1),b("div",je,[(r(!0),m(I,null,j(x,s=>(r(),g(X,{key:s.id,content:s.description,disabled:!s.description||s.description.trim().length===0,placement:"top"},{default:n(()=>[u(U,{shadow:"hover",class:"cursor-pointer definition-item-card",onClick:_=>L(s)},{default:n(()=>[b("div",Ae,[s.icon?(r(),g(f,{key:0,src:s.icon,class:"w-32px h-32px"},null,8,["src"])):(r(),m("div",Be,[b("span",Ee,T(i(re)(s.name,0,2)),1)])),u(R,{class:"!ml-10px",size:"large"},{default:n(()=>[Te(T(s.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1032,["content","disabled"]))),128))])]))),128))]),_:1},512)]),_:1})]),_:1})):(r(),g(Q,{key:1,class:"!py-200px","image-size":200,description:"\u6CA1\u6709\u627E\u5230\u641C\u7D22\u7ED3\u679C"}))]}),_:1},8,["class"])),[[Z,i(z)]])],64))}}}),[["__scopeId","data-v-e2815b87"]]);export{Le as default};
