import{h as ae,d as oe,aG as te,_ as re,c as se}from"./index-C1TKk8vI.js";import{_ as le}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{b as ie}from"./index-CxCrYW_I.js";import{h as ne}from"./index-C52Al6V4.js";import{C as ce}from"./index-C3kvgmux.js";import pe from"./ProcessDefinitionDetail-0B5twO2i.js";import{aX as fe,k as me,j as ue,ak as de,a7 as ve,ad as ye,o as xe,e as ge,i as he,aN as ke,aj as _e}from"./form-designer-BpYekVAY.js";import{x as be,r as c,c as O,j as we,u as i,y as r,z as m,O as u,F as n,l as Ce,G as Ie,E as g,C as b,M as T,a4 as P,H as Q,L as $,K as Te,n as $e,g as De}from"./form-create-7GAbgMwl.js";import"./formCreate-DNZv5C32.js";import"./constants-IYPHa1Ih.js";import"./consts-D6_WKT2v.js";import"./ProcessInstanceBpmnViewer-CPqCMmGq.js";import"./bpmn-embedded-CLKwycJq.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./XTextButton-BjjL95Dk.js";import"./XButton-we2I6miX.js";import"./index-DREge7zO.js";import"./index-CZiMqbPE.js";import"./node-Do_BcwVI.js";import"./index-DwSWB2Hs.js";import"./index-BCN8BzfC.js";import"./utils-QiRL3TXx.js";import"./index-BwT0n6gf.js";import"./tree-COGD3qag.js";import"./index-BtHQyrBm.js";import"./index-B0Mya_PA.js";import"./index-CYJDvQdV.js";import"./index-DbP8QQV-.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./index-D2S4HpRp.js";import"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import"./color-BN7ZL7BD.js";import"./index-DMrIORbd.js";import"./formatTime-EbFUBcAO.js";import"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-CkpBAPzO.js";import"./simple-process-designer-DWOFOAFc.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-C6CtoOwH.js";import"./index-j0g2sdlj.js";import"./download-oWiM5xVU.js";import"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-t8BTVj8T.js";import"./index-vcegfSq2.js";import"./tagsView-C2oS-OQq.js";const je={class:"flex flex-col"},ze=["onClick"],Le={class:"text-18px font-bold mb-10px mt-5px"},Pe={class:"grid grid-cols-3 gap3"},Ve={class:"flex"},Ee={key:1,class:"flow-icon"},Se={style:{"font-size":"12px",color:"#fff"}},Be=se(be({name:"BpmProcessInstanceCreate",__name:"index",setup(Ge){const{proxy:D}=De(),U=ae(),V=oe(),h=c(""),w=U.query.processInstanceId,j=c(!0),p=c([]),d=c({}),v=c([]),W=async()=>{try{p.value=await ce.getCategorySimpleList()}finally{}},X=async()=>{var e;try{v.value=await ie({suspensionState:1}),y.value=v.value,L.value.length>0&&!((e=d.value)!=null&&e.code)&&(d.value=L.value[0])}finally{}},y=c([]),E=()=>{h.value.trim()?y.value=v.value.filter(e=>e.name.toLowerCase().includes(h.value.toLowerCase())):y.value=v.value},z=O(()=>{var o;if(!((o=v.value)!=null&&o.length))return{};const e=fe(y.value,"category"),a={};return p.value.forEach(t=>{e[t.code]&&(a[t.code]=e[t.code])}),a}),q=e=>{var a,o;return(o=(a=p.value)==null?void 0:a.find(t=>t.code===e))==null?void 0:o.name},C=c(),S=c(),B=async(e,a)=>{var o;C.value=e,await $e(),(o=S.value)==null||o.initProcessInfo(e,a)},F=e=>{const a=e.scrollTop,o=p.value.map(l=>{const f=D.$refs[`category-${l.code}`];return f!=null&&f[0]?{code:l.code,offsetTop:f[0].offsetTop,height:f[0].offsetHeight}:null}).filter(Boolean);let t=o[0];for(const l of o){if(!(a>=l.offsetTop-50))break;t=l}t&&d.value.code!==t.code&&(d.value=p.value.find(l=>l.code===t.code))},L=O(()=>{var a;if(!((a=p.value)!=null&&a.length)||!z.value)return[];const e=Object.keys(z.value);return p.value.filter(o=>e.includes(o.code))});return we(()=>{(async()=>{j.value=!0;try{if(await W(),await X(),(w==null?void 0:w.length)>0){const e=await ne(w);if(!e)return void V.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const a=v.value.find(o=>{var t;return o.key==((t=e.processDefinition)==null?void 0:t.key)});if(!a)return void V.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await B(a,e.formVariables)}}finally{j.value=!1}})()}),(e,a)=>{var G;const o=re,t=me,l=ue,f=de,H=ve,K=ye,M=xe,R=ge,A=he,J=ke,Y=le,Z=_e;return i(C)?(r(),g(pe,{key:1,ref_key:"processDefinitionDetailRef",ref:S,selectProcessDefinition:i(C),onCancel:a[1]||(a[1]=k=>C.value=void 0)},null,8,["selectProcessDefinition"])):(r(),m(T,{key:0},[u(t,{modelValue:i(h),"onUpdate:modelValue":a[0]||(a[0]=k=>Ce(h)?h.value=k:null),class:"!w-50% mb-15px",placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onInput:E,onClear:E},{prefix:n(()=>[u(o,{icon:"ep:search"})]),_:1},8,["modelValue"]),Ie((r(),g(Y,{class:Q([{"process-definition-container":(G=i(y))==null?void 0:G.length},"position-relative pb-20px h-700px"])},{default:n(()=>{var k;return[(k=i(y))!=null&&k.length?(r(),g(A,{key:0,gutter:20,class:"!flex-nowrap"},{default:n(()=>[u(l,{span:5},{default:n(()=>[b("div",je,[(r(!0),m(T,null,P(i(L),x=>(r(),m("div",{key:x.code,class:Q(["flex items-center p-10px cursor-pointer text-14px rounded-md",i(d).code===x.code?"text-#3e7bff bg-#e8eeff":""]),onClick:I=>(s=>{d.value=s;const _=D.$refs[`category-${s.code}`];if(_!=null&&_.length){const N=D.$refs.scrollWrapper,ee=_[0].offsetTop;N.scrollTo({top:ee,behavior:"smooth"})}})(x)},$(x.name),11,ze))),128))])]),_:1}),u(l,{span:19},{default:n(()=>[u(R,{ref:"scrollWrapper",height:"700",onScroll:F},{default:n(()=>[(r(!0),m(T,null,P(i(z),(x,I)=>(r(),m("div",{class:"mb-20px pl-10px",key:I,ref_for:!0,ref:`category-${I}`},[b("h3",Le,$(q(I)),1),b("div",Pe,[(r(!0),m(T,null,P(x,s=>(r(),g(M,{key:s.id,content:s.description,disabled:!s.description||s.description.trim().length===0,placement:"top"},{default:n(()=>[u(K,{shadow:"hover",class:"cursor-pointer definition-item-card",onClick:_=>B(s)},{default:n(()=>[b("div",Ve,[s.icon?(r(),g(f,{key:0,src:s.icon,class:"w-32px h-32px"},null,8,["src"])):(r(),m("div",Ee,[b("span",Se,$(i(te)(s.name,0,2)),1)])),u(H,{class:"!ml-10px",size:"large"},{default:n(()=>[Te($(s.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1032,["content","disabled"]))),128))])]))),128))]),_:1},512)]),_:1})]),_:1})):(r(),g(J,{key:1,class:"!py-200px","image-size":200,description:"\u6CA1\u6709\u627E\u5230\u641C\u7D22\u7ED3\u679C"}))]}),_:1},8,["class"])),[[Z,i(j)]])],64))}}}),[["__scopeId","data-v-e2815b87"]]);export{Be as default};
