import{d as M,W as F}from"./index-C1TKk8vI.js";import{_ as S}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{g as U,s as q}from"./index-DhLJYgkY.js";import{ai as j,k as T,h as z,f as E,aj as G}from"./form-designer-BpYekVAY.js";import{x as K,r as i,X as O,y as c,E as v,F as m,O as u,u as t,K as g,G as R,z as W,M as X,a4 as A,l as B}from"./form-create-7GAbgMwl.js";const D=K({name:"SystemMailTemplateSendForm",__name:"MailTemplateSendForm",setup(H,{expose:b}){const V=M(),p=i(!1),d=i(!1),e=i({content:"",params:{},mail:"",templateCode:"",templateParams:new Map}),f=O({mail:[{required:!0,message:"\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],templateCode:[{required:!0,message:"\u6A21\u7248\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],templateParams:{}}),n=i();b({open:async s=>{p.value=!0,h(),d.value=!0;try{const a=await U(s);e.value.content=a.content,e.value.params=a.params,e.value.templateCode=a.code,e.value.templateParams=a.params.reduce((o,r)=>(o[r]="",o),{}),f.templateParams=a.params.reduce((o,r)=>(o[r]={required:!0,message:"\u53C2\u6570 "+r+" \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},o),{})}finally{d.value=!1}}});const P=async()=>{if(n&&await n.value.validate()){d.value=!0;try{const s=e.value,a=await q(s);a&&V.success("\u63D0\u4EA4\u53D1\u9001\u6210\u529F\uFF01\u53D1\u9001\u7ED3\u679C\uFF0C\u89C1\u53D1\u9001\u65E5\u5FD7\u7F16\u53F7\uFF1A"+a),p.value=!1}finally{d.value=!1}}},h=()=>{var s;e.value={content:"",params:{},mail:"",templateCode:"",templateParams:new Map},f.templateParams={},(s=n.value)==null||s.resetFields()};return(s,a)=>{const o=F,r=j,y=T,w=z,_=E,C=S,k=G;return c(),v(C,{modelValue:t(p),"onUpdate:modelValue":a[2]||(a[2]=l=>B(p)?p.value=l:null),title:"\u6D4B\u8BD5"},{footer:m(()=>[u(_,{disabled:t(d),type:"primary",onClick:P},{default:m(()=>a[3]||(a[3]=[g("\u786E \u5B9A")])),_:1},8,["disabled"]),u(_,{onClick:a[1]||(a[1]=l=>p.value=!1)},{default:m(()=>a[4]||(a[4]=[g("\u53D6 \u6D88")])),_:1})]),default:m(()=>[R((c(),v(w,{ref_key:"formRef",ref:n,model:t(e),rules:t(f),"label-width":"120px"},{default:m(()=>[u(r,{label:"\u6A21\u677F\u5185\u5BB9",prop:"content"},{default:m(()=>[u(o,{"model-value":t(e).content,height:"150px",readonly:""},null,8,["model-value"])]),_:1}),u(r,{label:"\u6536\u4EF6\u90AE\u7BB1",prop:"mail"},{default:m(()=>[u(y,{modelValue:t(e).mail,"onUpdate:modelValue":a[0]||(a[0]=l=>t(e).mail=l),placeholder:"\u8BF7\u8F93\u5165\u6536\u4EF6\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),(c(!0),W(X,null,A(t(e).params,l=>(c(),v(r,{key:l,label:"\u53C2\u6570 {"+l+"}",prop:"templateParams."+l},{default:m(()=>[u(y,{modelValue:t(e).templateParams[l],"onUpdate:modelValue":x=>t(e).templateParams[l]=x,placeholder:"\u8BF7\u8F93\u5165 "+l+" \u53C2\u6570"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])),[[k,t(d)]])]),_:1},8,["modelValue"])}}});export{D as _};
