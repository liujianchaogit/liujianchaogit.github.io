import{au as g,D as y}from"./index-C1TKk8vI.js";import{_ as R}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as D}from"./Echart.vue_vue_type_script_setup_true_lang-Bp4Tc-Mi.js";import{S as x}from"./customer-Dg0cZPSy.js";import{d as w}from"./formatTime-EbFUBcAO.js";import{ag as P,ad as U,$ as I,_ as M,aj as N}from"./form-designer-BpYekVAY.js";import{x as j,r as h,X as E,j as O,y as C,z as T,O as e,F as i,u as t,G as q,E as F,M as X}from"./form-create-7GAbgMwl.js";const z=j({name:"CustomerConversionStat",__name:"CustomerConversionStat",props:{queryParams:{}},setup(b,{expose:_}){const m=b,l=h(!1),d=h([]),r=E({grid:{left:20,right:40,bottom:20,containLabel:!0},legend:{},series:[{name:"\u5BA2\u6237\u8F6C\u5316\u7387",type:"line",data:[]}],toolbox:{feature:{dataZoom:{xAxisIndex:!1},brush:{type:["lineX","clear"]},saveAsImage:{show:!0,name:"\u5BA2\u6237\u8F6C\u5316\u7387\u5206\u6790"}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},yAxis:{type:"value",name:"\u8F6C\u5316\u7387(%)"},xAxis:{type:"category",name:"\u65E5\u671F",data:[]}}),p=async()=>{l.value=!0;try{await(async()=>{const n=await x.getCustomerSummaryByDate(m.queryParams),u=await x.getContractSummary(m.queryParams);r.xAxis&&r.xAxis.data&&(r.xAxis.data=n.map(o=>o.time)),r.series&&r.series[0]&&r.series[0].data&&(r.series[0].data=n.map(o=>({name:o.time,value:o.customerCreateCount?(o.customerDealCount/o.customerCreateCount*100).toFixed(2):0}))),d.value=u})()}finally{l.value=!1}};return _({loadData:p}),O(()=>{p()}),(n,u)=>{const o=D,v=P,c=U,a=I,f=R,S=M,A=N;return C(),T(X,null,[e(c,{shadow:"never"},{default:i(()=>[e(v,{loading:t(l),animated:""},{default:i(()=>[e(o,{height:500,options:t(r)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(c,{shadow:"never",class:"mt-16px"},{default:i(()=>[q((C(),F(S,{data:t(d)},{default:i(()=>[e(a,{label:"\u5E8F\u53F7",align:"center",type:"index",width:"80",fixed:"left"}),e(a,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName","min-width":"200",fixed:"left"}),e(a,{label:"\u5408\u540C\u540D\u79F0",align:"center",prop:"contractName","min-width":"200"}),e(a,{label:"\u5408\u540C\u603B\u91D1\u989D",align:"center",prop:"totalPrice","min-width":"200",formatter:t(g)},null,8,["formatter"]),e(a,{label:"\u56DE\u6B3E\u91D1\u989D",align:"center",prop:"receivablePrice","min-width":"200",formatter:t(g)},null,8,["formatter"]),e(a,{align:"center",label:"\u5BA2\u6237\u6765\u6E90",prop:"source",width:"100"},{default:i(s=>[e(f,{type:t(y).CRM_CUSTOMER_SOURCE,value:s.row.source},null,8,["type","value"])]),_:1}),e(a,{align:"center",label:"\u5BA2\u6237\u884C\u4E1A",prop:"industryId",width:"100"},{default:i(s=>[e(f,{type:t(y).CRM_CUSTOMER_INDUSTRY,value:s.row.industryId},null,8,["type","value"])]),_:1}),e(a,{label:"\u8D1F\u8D23\u4EBA",align:"center",prop:"ownerUserName","min-width":"200"}),e(a,{label:"\u521B\u5EFA\u4EBA",align:"center",prop:"creatorUserName","min-width":"200"}),e(a,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(w),"min-width":"200"},null,8,["formatter"]),e(a,{label:"\u4E0B\u5355\u65E5\u671F",align:"center",prop:"orderDate",formatter:t(w),"min-width":"200",fixed:"right"},null,8,["formatter"])]),_:1},8,["data"])),[[A,t(l)]])]),_:1})],64)}}});export{z as _};
