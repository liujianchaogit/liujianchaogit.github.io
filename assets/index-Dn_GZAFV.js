import{d as ne,D as pe,A as de,c as ue}from"./index-DiGvuAxb.js";import{_ as ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as fe}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{k as ve,r as n,e as ye,a6 as xe,y as g,m as f,z as t,v as m,H as a,u as e,F as I,C as T,E as X,h as Z,A as O,l as $,I as q,n as be}from"./form-create-D7wT855o.js";import{f as _e}from"./formatTime-DeTj2b0K.js";import{B as S,a as A}from"./constants-C3gLHYOK.js";import{b as ge}from"./formCreate-DGy7HbUv.js";import{g as Ie,a as Te}from"./index-pGMn8Zyx.js";import{g as ke}from"./index-BEHCTgo8.js";import he from"./ProcessInstanceBpmnViewer-B5XpeIaZ.js";import{_ as Ne}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-dOF1_6Hu.js";import{_ as Ce}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-BwukhbCT.js";import we from"./ProcessInstanceOperationButton-CSK4GPHA.js";import{_ as Ee}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-CfiJLsSe.js";import{F as R}from"./consts-CvaDWb4S.js";import{T as w}from"./index-7o_S5bjn.js";import{e as Pe,V as Ue,ag as Ve,a0 as Oe,$ as Se,i as Ae,j as Re,aj as Be}from"./form-designer-drfGvdgz.js";import"./color-BN7ZL7BD.js";import"./bpmn-embedded-CEyxHmW-.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./XTextButton-CO9jQPGe.js";import"./XButton-BXTtfQPD.js";import"./index-brTT8YwK.js";import"./node-CQ9Ble-i.js";import"./index-BCN8BzfC.js";import"./utils-aZyOMVaO.js";import"./index-DTNfh8Br.js";import"./tree-COGD3qag.js";import"./index-CLkdJnRM.js";import"./index-eU2zJvzd.js";import"./index-CNUeQNrn.js";import"./index-RiOYYfh_.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./index-GbnTArhn.js";import"./index-BES_6pzR.js";import"./simple-process-designer-DszNnWcD.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-uNUCv3aR.js";import"./index-PFHQ4aD1.js";import"./download-oWiM5xVU.js";import"./SignDialog.vue_vue_type_script_setup_true_lang-CHpvG83i.js";import"./index-DS_oxMOO.js";const De={class:"processInstance-wrap-main"},je=["src"],Me={class:"text-#878c93 h-15px"},Fe={class:"flex items-center gap-5 mb-10px h-40px"},Le={class:"text-26px font-bold mb-5px"},ze={class:"flex items-center gap-5 mb-10px text-13px h-35px"},Ke={class:"bg-gray-100 h-35px rounded-3xl flex items-center p-8px gap-2 dark:color-gray-600"},Ye={class:"text-#878c93"},Ge={class:"form-scroll-area"},He={class:"form-box flex flex-col mb-30px flex-1"},Je={key:1},Qe={class:"form-scroll-area"},We={class:"form-scroll-area"},Xe={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Ze=ue(ve({name:"BpmProcessInstanceDetail",__name:"index",props:{id:{},taskId:{},activityId:{}},setup(ee){const k=ee,B=ne(),v=n(!1),o=n({}),i=n({}),h=n({}),D=n(),ae={[w.RUNNING]:"/assets/running-Cm4KjmYZ.svg",[w.APPROVE]:"/assets/approve-BQD8ihNj.svg",[w.REJECT]:"/assets/reject-C_en7x-2.svg",[w.CANCEL]:"/assets/cancel-Cn_ivYkt.svg"},p=n(),d=n({rule:[],option:{},value:{}}),E=[],j=()=>{se(),oe()},M=n(null),se=async()=>{var r,s;v.value=!0;try{const y={processInstanceId:k.id,activityId:k.activityId,taskId:k.taskId},l=await Ie(y);if(!l)return void B.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(!l.processDefinition||!l.processInstance)return void B.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");if(o.value=l.processInstance,i.value=l.processDefinition,i.value.formType===S.NORMAL){const u=l.formFieldsPermission;E.splice(0),((r=d.value.rule)==null?void 0:r.length)>0?d.value.value=o.value.formVariables:ge(d,i.value.formConf,i.value.formFields,o.value.formVariables),be().then(()=>{var N,x,C;(N=p.value)==null||N.btn.show(!1),(x=p.value)==null||x.resetBtn.show(!1),(C=p.value)==null||C.disabled(!0),u&&Object.keys(l.formFieldsPermission).forEach(b=>{le(b,u[b])})})}else M.value=de(l.processDefinition.formCustomViewPath);F.value=l.activityNodes,(s=D.value)==null||s.loadTodoTask(l.todoTask)}finally{v.value=!1}},oe=async()=>{var s;A.BPMN===((s=i.value)==null?void 0:s.modelType)&&(h.value={bpmnXml:""});const r=await Te(k.id);r&&(h.value=r)},F=n([]),le=(r,s)=>{var y,l,u;s===R.READ&&((y=p.value)==null||y.disabled(!0,r)),s===R.WRITE&&((l=p.value)==null||l.disabled(!1,r),E.push(r)),s===R.NONE&&((u=p.value)==null||u.hidden(!0,r))},re=()=>{j()},P=n("form"),L=n([]);return ye(async()=>{j(),L.value=await ke()}),(r,s)=>{const y=Ue,l=fe,u=Ve,N=xe("form-create"),x=Re,C=Ae,b=Pe,U=Se,te=Oe,ie=ce,me=Be;return f(),g(ie,{bodyStyle:{padding:"10px 20px 0"},class:"position-relative"},{default:t(()=>[m("div",De,[a(b,null,{default:t(()=>{var z,K,Y,G,H,J,Q,W;return[m("img",{class:"position-absolute right-20px",width:"150",src:ae[e(o).status],alt:""},null,8,je),m("div",Me,"\u7F16\u53F7\uFF1A"+I(r.id),1),a(y,{class:"!my-8px"}),m("div",Fe,[m("div",Le,I(e(o).name),1),e(o).status?(f(),g(l,{key:0,type:e(pe).BPM_PROCESS_INSTANCE_STATUS,value:e(o).status},null,8,["type","value"])):T("",!0)]),m("div",ze,[m("div",Ke,[(K=(z=e(o))==null?void 0:z.startUser)!=null&&K.avatar?(f(),g(u,{key:0,size:28,src:(G=(Y=e(o))==null?void 0:Y.startUser)==null?void 0:G.avatar},null,8,["src"])):(J=(H=e(o))==null?void 0:H.startUser)!=null&&J.nickname?(f(),g(u,{key:1,size:28},{default:t(()=>{var c,_;return[X(I((_=(c=e(o))==null?void 0:c.startUser)==null?void 0:_.nickname.substring(0,1)),1)]}),_:1})):T("",!0),X(" "+I((W=(Q=e(o))==null?void 0:Q.startUser)==null?void 0:W.nickname),1)]),m("div",Ye,I(e(_e)(e(o).startTime))+" \u63D0\u4EA4 ",1)]),a(te,{modelValue:e(P),"onUpdate:modelValue":s[2]||(s[2]=c=>Z(P)?P.value=c:null)},{default:t(()=>[a(U,{label:"\u5BA1\u6279\u8BE6\u60C5",name:"form"},{default:t(()=>[m("div",Ge,[a(b,null,{default:t(()=>[a(C,null,{default:t(()=>[a(x,{span:17,class:"!flex !flex-col formCol"},{default:t(()=>{var c,_;return[O((f(),$("div",He,[((c=e(i))==null?void 0:c.formType)===e(S).NORMAL?(f(),g(x,{key:0},{default:t(()=>[a(N,{modelValue:e(d).value,"onUpdate:modelValue":s[0]||(s[0]=V=>e(d).value=V),api:e(p),"onUpdate:api":s[1]||(s[1]=V=>Z(p)?p.value=V:null),option:e(d).option,rule:e(d).rule},null,8,["modelValue","api","option","rule"])]),_:1})):T("",!0),((_=e(i))==null?void 0:_.formType)===e(S).CUSTOM?(f(),$("div",Je,[a(e(M),{id:e(o).businessKey},null,8,["id"])])):T("",!0)])),[[me,e(v)]])]}),_:1}),a(x,{span:7},{default:t(()=>[a(Ee,{"activity-nodes":e(F)},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(U,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:t(()=>[m("div",Qe,[O(a(Ne,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[q,e(i).modelType&&e(i).modelType===e(A).SIMPLE]]),O(a(he,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[q,e(i).modelType&&e(i).modelType===e(A).BPMN]])])]),_:1}),a(U,{label:"\u6D41\u8F6C\u8BB0\u5F55",name:"record"},{default:t(()=>[m("div",We,[a(b,null,{default:t(()=>[a(Ce,{loading:e(v),id:r.id},null,8,["loading","id"])]),_:1})])]),_:1}),T("",!0)]),_:1},8,["modelValue"]),m("div",Xe,[a(we,{ref_key:"operationButtonRef",ref:D,"process-instance":e(o),"process-definition":e(i),userOptions:e(L),"normal-form":e(d),"normal-form-api":e(p),"writable-fields":E,onSuccess:re},null,8,["process-instance","process-definition","userOptions","normal-form","normal-form-api"])])]}),_:1})])]),_:1})}}}),[["__scopeId","data-v-6799f0b5"]]);export{Ze as default};
