import{V as d,d as S,h as q}from"./index-C1TKk8vI.js";import{_ as x}from"./XTextButton-BjjL95Dk.js";import{S as f}from"./constants-IYPHa1Ih.js";import{g as I}from"./profile-X7-zZBAY.js";import{$ as N,_ as L}from"./form-designer-BpYekVAY.js";import{x as j,r as h,j as $,f as z,y as m,E,F as u,O as l,C as v,L as F,z as w,K as U,M as g,u as K}from"./form-create-7GAbgMwl.js";const M=["src"],O={class:"mr-5"},P=j({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup(V,{emit:C}){const y=S(),n=h([]),r=h(),c=q(),_=C,k=()=>{const t=(e="type",new URL(decodeURIComponent(location.href)).searchParams.get(e)??"");var e;const a=c.query.code,s=c.query.state;a&&((i,o,p)=>d.post({url:"/system/social-user/bind",data:{type:i,code:o,state:p}}))(t,a,s).then(()=>{y.success("\u7ED1\u5B9A\u6210\u529F"),_("update:activeName","userSocial")})},b=t=>{const e=location.origin+"/user/profile?"+encodeURIComponent(`type=${t.type}`);((a,s)=>d.get({url:"/system/auth/social-auth-redirect?type="+a+"&redirectUri="+s}))(t.type,encodeURIComponent(e)).then(a=>{window.location.href=a})},R=async t=>{var e,a;await(e=t.type,a=t.openid,d.delete({url:"/system/social-user/unbind",data:{type:e,openid:a}}))&&(t.openid=void 0),y.success("\u89E3\u7ED1\u6210\u529F")};return $(async()=>{await(async()=>{var e;n.value=[];const t=await I();r.value=t;for(const a in f){const s={...f[a]};if(n.value.push(s),(e=r.value)==null?void 0:e.socialUsers){for(const i in r.value.socialUsers)if(s.type===r.value.socialUsers[i].type){s.openid=r.value.socialUsers[i].openid;break}}}})()}),z(()=>c,()=>{k()},{immediate:!0}),(t,e)=>{const a=N,s=x,i=L;return m(),E(i,{data:K(n),"show-header":!1},{default:u(()=>[l(a,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),l(a,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:u(({row:o})=>[v("img",{src:o.img,alt:"",class:"h-5 align-middle"},null,8,M),v("p",O,F(o.title),1)]),_:1}),l(a,{align:"center",label:"\u64CD\u4F5C"},{default:u(({row:o})=>[o.openid?(m(),w(g,{key:0},[e[0]||(e[0]=U(" \u5DF2\u7ED1\u5B9A ")),l(s,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:p=>R(o)},null,8,["onClick"])],64)):(m(),w(g,{key:1},[e[1]||(e[1]=U(" \u672A\u7ED1\u5B9A ")),l(s,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:p=>b(o)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{P as _};
