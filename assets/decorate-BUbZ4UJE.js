import{P as T,_ as U}from"./util-CzKwmJpi.js";import{d as j,L as p,u as B,_ as C}from"./index-C1TKk8vI.js";import{g as E,u as J}from"./template-Bo3t_0Mg.js";import{u as S}from"./page-Jk-gVUUZ.js";import{u as O}from"./tagsView-C2oS-OQq.js";import{I as X,t as Q,o as q,s as A}from"./form-designer-BpYekVAY.js";import{x as G,r,X as H,j as K,u as a,y as g,E as V,F as d,O as w,z as N,a4 as W,M as Y,J as Z}from"./form-create-7GAbgMwl.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./Qrcode-DoP3T4bV.js";import"./IFrame.vue_vue_type_script_setup_true_lang-BjY8-QVP.js";import"./vuedraggable.umd-DP3omUoG.js";const y="diy_page_index",ee=G({name:"DiyTemplateDecorate",__name:"decorate",setup(ae){const l=r(0),s=H([{name:"\u57FA\u7840\u8BBE\u7F6E",icon:"ep:iphone"},{name:"\u9996\u9875",icon:"ep:home-filled"},{name:"\u6211\u7684",icon:"ep:user-filled"}]),h=j(),u=r(!1),n=r(),_=r(),i=r({property:""}),m=r(new Map),b=r(""),x=[],c=r(x),I=o=>{m.value.set(s[l.value].name,i.value);const e=m.value.get(s[o].name);if(l.value=o,o===0)return c.value=x,void(i.value=p(e)?n.value:e);c.value=T,i.value=p(e)?n.value.pages.find(t=>t.name===s[o].name):e},M=async()=>{var o;if(_){u.value=!0;try{for(let e=0;e<s.length;e++){const t=m.value.get(s[e].name);e!==0?(o=i.value)!=null&&o.name.includes(s[e].name)?await S(a(i)):p(t)||await S(t):await J(p(t)?a(n):t)}h.success("\u4FDD\u5B58\u6210\u529F")}finally{u.value=!1}}},$=()=>z(),z=()=>sessionStorage.setItem(y,`${l.value}`),{currentRoute:f}=B(),{delView:D}=O();return K(async()=>{var o;if(n.value={id:void 0,name:"",used:!1,usedTime:void 0,remark:"",previewPicUrls:[],property:"",pages:[]},(o=_.value)==null||o.resetFields(),!f.value.params.id)return h.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u9875\u9762\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void D(a(f));await(async e=>{u.value=!0;try{n.value=await E(e);const t="http://mall.yudao.iocoder.cn";b.value=`${t}/#/pages/index/index?templateId=${n.value.id}`}finally{u.value=!1}})(f.value.params.id),(()=>{const e=X(sessionStorage.getItem(y))||0;sessionStorage.removeItem(y),i.value=n.value,m.value=new Map,e!==l.value&&I(e)})()}),(o,e)=>{const t=C,F=Q,L=q,P=A,R=U;return a(n)&&!a(u)?(g(),V(R,{key:0,modelValue:a(i).property,"onUpdate:modelValue":e[0]||(e[0]=v=>a(i).property=v),libs:a(c),"preview-url":a(b),"show-navigation-bar":a(l)!==0,"show-page-config":a(l)!==0,"show-tab-bar":a(l)===0,title:a(s)[a(l)].name,onReset:$,onSave:M},{toolBarLeft:d(()=>[w(P,{"model-value":a(l),class:"h-full!",onChange:I},{default:d(()=>[(g(!0),N(Y,null,W(a(s),(v,k)=>(g(),V(L,{key:k,content:v.name},{default:d(()=>[w(F,{value:k},{default:d(()=>[w(t,{icon:v.icon,size:24},null,8,["icon"])]),_:2},1032,["value"])]),_:2},1032,["content"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","libs","preview-url","show-navigation-bar","show-page-config","show-tab-bar","title"])):Z("",!0)}}});export{ee as default};
