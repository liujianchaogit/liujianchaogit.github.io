import{V as T,d as B,c as Q}from"./index-C1TKk8vI.js";import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as Y}from"./index-BhsNgP9o.js";import{_ as Z}from"./main.vue_vue_type_script_setup_true_lang-CtGuAjr5.js";import ee from"./MenuEditor-BwxdP0--.js";import le from"./MenuPreviewer-kQvm3j6S.js";import{h as ae}from"./tree-COGD3qag.js";import{ai as re,h as ie,f as te,aj as ue}from"./form-designer-BpYekVAY.js";import{x as ne,r as i,aq as se,y as v,z as x,O as u,F as y,u as t,G as C,C as f,L as ce,l as $,E as F,K as H,M as pe}from"./form-create-7GAbgMwl.js";import"./index-KUcy92Cr.js";import"./tagsView-C2oS-OQq.js";import"./main-CCmna8Q9.js";import"./TabNews-DPESzVct.js";import"./main-B4oJ8nf7.js";import"./main-DVXlvIgg.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./main-C07Ho4xi.js";import"./main.vue_vue_type_script_setup_true_lang-3w2LCMBi.js";import"./index-CyoqorTW.js";import"./index-CLYonXYH.js";import"./formatTime-EbFUBcAO.js";import"./TabText.vue_vue_type_script_setup_true_lang-DhizLkhS.js";import"./TabImage-DIcNZJHU.js";import"./useUpload-B78SiPB2.js";import"./TabVoice-DYksc7dm.js";import"./TabVideo-wcr8o65A.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-D3VJTT20.js";import"./vuedraggable.umd-DP3omUoG.js";const oe={class:"clearfix public-account-management"},de={class:"left"},me={class:"weixin-hd"},ve={class:"weixin-title"},ye={class:"clearfix weixin-menu"},fe={class:"save_div"},he={key:0,class:"right"},Me={key:1,class:"right"},E="__MENU_NOT_SELECTED__",_e=Q(ne({name:"MpMenu",__name:"index",setup(xe){const o=B(),n=i(!1),d=i(-1),V=i(""),s=i([]),h=i(E),U=i(-1),M=i(!1),b=i(!0),c=i({}),r=i({grand:"0",x:0,y:0}),L=i(!1),O=(l,e)=>{d.value=l,V.value=e,g()},g=async()=>{n.value=!1;try{const l=await(a=>T.get({url:"/mp/menu/list?accountId="+a}))(d.value),e=j(l);s.value=ae(e,"id")}finally{n.value=!1}},j=l=>{if(!l)return[];const e=[];return l.forEach(a=>{const m={...a};m.reply={type:a.replyMessageType,accountId:a.accountId,content:a.replyContent,mediaId:a.replyMediaId,url:a.replyMediaUrl,title:a.replyTitle,description:a.replyDescription,thumbMediaId:a.replyThumbMediaId,thumbMediaUrl:a.replyThumbMediaUrl,articles:a.replyArticles,musicUrl:a.replyMusicUrl,hqMusicUrl:a.replyHqMusicUrl},e.push(m)}),e},z=()=>{h.value=E,U.value=-1,M.value=!1,c.value={},r.value={grand:"0",x:0,y:0},L.value=!1},G=async()=>{var l;try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),r.value.grand==="1"?s.value.splice(r.value.x,1):r.value.grand==="2"&&((l=s.value[r.value.x].children)==null||l.splice(r.value.y,1)),o.notifySuccess("\u5220\u9664\u6210\u529F"),c.value={},M.value=!1,h.value=E}catch{}},J=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417?"),n.value=!0,await((l,e)=>T.post({url:"/mp/menu/save",data:{accountId:l,menus:e}}))(d.value,P()),g(),o.notifySuccess("\u53D1\u5E03\u6210\u529F")}finally{n.value=!1}},K=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),n.value=!0,await(l=>T.delete({url:"/mp/menu/delete?accountId="+l}))(d.value),z(),g(),o.notifySuccess("\u6E05\u7A7A\u6210\u529F")}finally{n.value=!1}},P=()=>{const l=[];return s.value.forEach(e=>{const a=k(e);l.push(a),!e.children||e.children.length<=0||(a.children=[],e.children.forEach(m=>{a.children.push(k(m))}))}),l},k=l=>{let e={...l,children:void 0,reply:void 0};return e.replyMessageType=l.reply.type,e.replyContent=l.reply.content,e.replyMediaId=l.reply.mediaId,e.replyMediaUrl=l.reply.url,e.replyTitle=l.reply.title,e.replyDescription=l.reply.description,e.replyThumbMediaId=l.reply.thumbMediaId,e.replyThumbMediaUrl=l.reply.thumbMediaUrl,e.replyArticles=l.reply.articles,e.replyMusicUrl=l.reply.musicUrl,e.replyHqMusicUrl=l.reply.hqMusicUrl,e};return(l,e)=>{const a=Y,m=re,R=ie,q=X,S=te,D=se("hasPermi"),W=ue;return v(),x(pe,null,[u(a,{title:"\u516C\u4F17\u53F7\u83DC\u5355",url:"https://doc.iocoder.cn/mp/menu/"}),u(q,null,{default:y(()=>[u(R,{class:"-mb-15px",ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:y(()=>[u(m,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:y(()=>[u(t(Z),{onChange:O})]),_:1})]),_:1},512)]),_:1}),u(q,null,{default:y(()=>[C((v(),x("div",oe,[f("div",de,[f("div",me,[f("div",ve,ce(t(V)),1)]),f("div",ye,[u(le,{modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=p=>$(s)?s.value=p:null),"account-id":t(d),"active-index":t(h),"parent-index":t(U),onMenuClicked:e[1]||(e[1]=(p,I)=>((w,_)=>{M.value=!0,c.value=w,r.value.grand="1",r.value.x=_,b.value=!0,h.value=`${_}`,U.value=_})(p,I)),onSubmenuClicked:e[2]||(e[2]=(p,I,w)=>((_,A,N)=>{M.value=!0,c.value=_,r.value.grand="2",r.value.x=A,r.value.y=N,b.value=!1,h.value=`${A}-${N}`})(p,I,w))},null,8,["modelValue","account-id","active-index","parent-index"])]),f("div",fe,[C((v(),F(S,{class:"save_btn",type:"success",onClick:J},{default:y(()=>e[4]||(e[4]=[H("\u4FDD\u5B58\u5E76\u53D1\u5E03\u83DC\u5355")])),_:1})),[[D,["mp:menu:save"]]]),C((v(),F(S,{class:"save_btn",type:"danger",onClick:K},{default:y(()=>e[5]||(e[5]=[H("\u6E05\u7A7A\u83DC\u5355")])),_:1})),[[D,["mp:menu:delete"]]])])]),t(M)?(v(),x("div",he,[u(ee,{"account-id":t(d),"is-parent":t(b),modelValue:t(c),"onUpdate:modelValue":e[3]||(e[3]=p=>$(c)?c.value=p:null),onDelete:G},null,8,["account-id","is-parent","modelValue"])])):(v(),x("div",Me,e[6]||(e[6]=[f("p",null,"\u8BF7\u9009\u62E9\u83DC\u5355\u914D\u7F6E",-1)])))])),[[W,t(n)]])]),_:1})],64)}}}),[["__scopeId","data-v-03a2c21f"]]);export{_e as default};
