import{d as te,b as oe,u as ie,au as ne,D as pe,av as k,_ as ce}from"./index-C1TKk8vI.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as de}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as me}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as ue}from"./index-BhsNgP9o.js";import{x as fe,r as m,X as be,j as we,aq as _e,y as n,z as M,O as e,F as r,u as t,a5 as A,M as B,a4 as ve,E as c,K as p,G as b,l as ye,L as w}from"./form-create-7GAbgMwl.js";import{b as R,d as G}from"./formatTime-EbFUBcAO.js";import{d as ge}from"./download-oWiM5xVU.js";import{e as he,d as ke,h as xe}from"./index-DZT3uREC.js";import{_ as Ce}from"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-zqCBcaAo.js";import{a as Ne}from"./index-Bdw660V1.js";import{_ as Te}from"./ReceivableForm.vue_vue_type_script_setup_true_lang-CpUQxp4U.js";import{Q as Ve,x as Re,ai as Ue,k as Ee,f as Ie,h as Pe,a0 as Se,a1 as ze,P as De,$ as Fe,a7 as je,_ as Ke,aj as qe}from"./form-designer-BpYekVAY.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./index-CZiMqbPE.js";import"./index-DdKGlDdM.js";import"./index-pmRUIUos.js";const Le=fe({name:"ReceivablePlan",__name:"index",setup(Me){const x=te(),{t:H}=oe(),C=m(!0),U=m(0),E=m([]),i=be({pageNo:1,pageSize:10,sceneType:"1",customerId:void 0,contractNo:void 0}),I=m(),N=m(!1),T=m("1"),P=m([]),O=d=>{i.sceneType=d.paneName,_()},f=async()=>{C.value=!0;try{const d=await he(i);E.value=d.list,U.value=d.total}finally{C.value=!1}},_=()=>{i.pageNo=1,f()},Q=()=>{I.value.resetFields(),_()},S=m(),z=(d,l)=>{S.value.open(d,l)},D=m(),X=async()=>{try{await x.exportConfirm(),N.value=!0;const d=await xe(i);ge.excel(d,"\u56DE\u6B3E\u8BA1\u5212.xls")}catch{}finally{N.value=!1}},{push:F}=ie();return we(async()=>{await f(),P.value=await Ne()}),(d,l)=>{const j=ue,Y=Ve,$=Re,V=Ue,J=Ee,y=ce,u=Ie,W=Pe,K=me,q=Se,Z=ze,L=De,o=Fe,ee=de,g=je,ae=Ke,le=se,v=_e("hasPermi"),re=qe;return n(),M(B,null,[e(j,{title:"\u3010\u56DE\u6B3E\u3011\u56DE\u6B3E\u7BA1\u7406\u3001\u56DE\u6B3E\u8BA1\u5212",url:"https://doc.iocoder.cn/crm/receivable/"}),e(j,{title:"\u3010\u901A\u7528\u3011\u6570\u636E\u6743\u9650",url:"https://doc.iocoder.cn/crm/permission/"}),e(K,null,{default:r(()=>[e(W,{ref_key:"queryFormRef",ref:I,inline:!0,model:t(i),class:"-mb-15px","label-width":"68px"},{default:r(()=>[e(V,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:r(()=>[e($,{modelValue:t(i).customerId,"onUpdate:modelValue":l[0]||(l[0]=a=>t(i).customerId=a),class:"!w-240px",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onKeyup:A(_,["enter"])},{default:r(()=>[(n(!0),M(B,null,ve(t(P),a=>(n(),c(Y,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"\u5408\u540C\u7F16\u53F7",prop:"contractNo"},{default:r(()=>[e(J,{modelValue:t(i).contractNo,"onUpdate:modelValue":l[1]||(l[1]=a=>t(i).contractNo=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5408\u540C\u7F16\u53F7",onKeyup:A(_,["enter"])},null,8,["modelValue"])]),_:1}),e(V,null,{default:r(()=>[e(u,{onClick:_},{default:r(()=>[e(y,{class:"mr-5px",icon:"ep:search"}),l[6]||(l[6]=p(" \u641C\u7D22 "))]),_:1}),e(u,{onClick:Q},{default:r(()=>[e(y,{class:"mr-5px",icon:"ep:refresh"}),l[7]||(l[7]=p(" \u91CD\u7F6E "))]),_:1}),b((n(),c(u,{plain:"",type:"primary",onClick:l[2]||(l[2]=a=>z("create"))},{default:r(()=>[e(y,{class:"mr-5px",icon:"ep:plus"}),l[8]||(l[8]=p(" \u65B0\u589E "))]),_:1})),[[v,["crm:receivable-plan:create"]]]),b((n(),c(u,{loading:t(N),plain:"",type:"success",onClick:X},{default:r(()=>[e(y,{class:"mr-5px",icon:"ep:download"}),l[9]||(l[9]=p(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[v,["crm:receivable-plan:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(K,null,{default:r(()=>[e(Z,{modelValue:t(T),"onUpdate:modelValue":l[3]||(l[3]=a=>ye(T)?T.value=a:null),onTabClick:O},{default:r(()=>[e(q,{label:"\u6211\u8D1F\u8D23\u7684",name:"1"}),e(q,{label:"\u4E0B\u5C5E\u8D1F\u8D23\u7684",name:"3"})]),_:1},8,["modelValue"]),b((n(),c(ae,{data:t(E),"show-overflow-tooltip":!0,stripe:!0},{default:r(()=>[e(o,{align:"center",fixed:"left",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"150"},{default:r(a=>[e(L,{underline:!1,type:"primary",onClick:h=>{return s=a.row.customerId,void F({name:"CrmCustomerDetail",params:{id:s}});var s}},{default:r(()=>[p(w(a.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),e(o,{align:"center",label:"\u5408\u540C\u7F16\u53F7",prop:"contractNo",width:"200px"}),e(o,{align:"center",label:"\u671F\u6570",prop:"period"},{default:r(a=>[e(L,{underline:!1,type:"primary",onClick:h=>{return s=a.row.id,void F({name:"CrmReceivablePlanDetail",params:{id:s}});var s}},{default:r(()=>[p(w(a.row.period),1)]),_:2},1032,["onClick"])]),_:1}),e(o,{align:"center",label:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D\uFF08\u5143\uFF09",prop:"price",width:"160",formatter:t(ne)},null,8,["formatter"]),e(o,{formatter:t(R),align:"center",label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime",width:"180px"},null,8,["formatter"]),e(o,{align:"center",label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays",width:"150"}),e(o,{align:"center",label:"\u63D0\u9192\u65E5\u671F",prop:"remindTime",width:"180px",formatter:t(R)},null,8,["formatter"]),e(o,{align:"center",label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType",width:"130px"},{default:r(a=>[e(ee,{type:t(pe).CRM_RECEIVABLE_RETURN_TYPE,value:a.row.returnType},null,8,["type","value"])]),_:1}),e(o,{align:"center",label:"\u5907\u6CE8",prop:"remark"}),e(o,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"120"}),e(o,{align:"center",label:"\u5B9E\u9645\u56DE\u6B3E\u91D1\u989D\uFF08\u5143\uFF09",prop:"receivable.price",width:"160"},{default:r(a=>[a.row.receivable?(n(),c(g,{key:0},{default:r(()=>[p(w(t(k)(a.row.receivable.price)),1)]),_:2},1024)):(n(),c(g,{key:1},{default:r(()=>[p(w(t(k)(0)),1)]),_:1}))]),_:1}),e(o,{align:"center",label:"\u5B9E\u9645\u56DE\u6B3E\u65E5\u671F",prop:"receivable.returnTime",width:"180px",formatter:t(R)},null,8,["formatter"]),e(o,{align:"center",label:"\u5B9E\u9645\u56DE\u6B3E\u91D1\u989D\uFF08\u5143\uFF09",prop:"receivable.price",width:"160"},{default:r(a=>[a.row.receivable?(n(),c(g,{key:0},{default:r(()=>[p(w(t(k)(a.row.price-a.row.receivable.price)),1)]),_:2},1024)):(n(),c(g,{key:1},{default:r(()=>[p(w(t(k)(a.row.price)),1)]),_:2},1024))]),_:1}),e(o,{formatter:t(G),align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),e(o,{formatter:t(G),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),e(o,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"100px"}),e(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"180px"},{default:r(a=>[b((n(),c(u,{link:"",type:"success",onClick:h=>{return s=a.row,void D.value.open("create",void 0,s);var s},disabled:a.row.receivableId},{default:r(()=>l[10]||(l[10]=[p(" \u521B\u5EFA\u56DE\u6B3E ")])),_:2},1032,["onClick","disabled"])),[[v,["crm:receivable:create"]]]),b((n(),c(u,{link:"",type:"primary",onClick:h=>z("update",a.row.id)},{default:r(()=>l[11]||(l[11]=[p(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:update"]]]),b((n(),c(u,{link:"",type:"danger",onClick:h=>(async s=>{try{await x.delConfirm(),await ke(s),x.success(H("common.delSuccess")),await f()}catch{}})(a.row.id)},{default:r(()=>l[12]||(l[12]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:delete"]]])]),_:1})]),_:1},8,["data"])),[[re,t(C)]]),e(le,{limit:t(i).pageSize,"onUpdate:limit":l[4]||(l[4]=a=>t(i).pageSize=a),page:t(i).pageNo,"onUpdate:page":l[5]||(l[5]=a=>t(i).pageNo=a),total:t(U),onPagination:f},null,8,["limit","page","total"])]),_:1}),e(Ce,{ref_key:"formRef",ref:S,onSuccess:f},null,512),e(Te,{ref_key:"receivableFormRef",ref:D,onSuccess:f},null,512)],64)}}});export{Le as default};
