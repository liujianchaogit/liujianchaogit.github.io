import{V as v,a as J,d as Q,h,D as k,G as R,aS as O}from"./index-DiGvuAxb.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{_ as X}from"./RewardRule.vue_vue_type_script_setup_true_lang-Dc2DPThC.js";import Z from"./SpuShowcase-CwcMU80d.js";import{k as c,l as V}from"./constants-C3gLHYOK.js";import{_ as ee}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-CWjb9Nvo.js";import{h as ae,ai as le,k as te,F as oe,s as re,u as ue,aj as de,f as se,K as pe}from"./form-designer-drfGvdgz.js";import{k as ce,r as n,P as ie,y as g,m as i,z as r,A as ne,u as l,H as u,C as U,l as q,G as x,$ as G,E as S,F as N,h as Y,n as me}from"./form-create-D7wT855o.js";const ye=async m=>await v.get({url:"/promotion/reward-activity/page",params:m}),fe=async m=>await v.delete({url:"/promotion/reward-activity/delete?id="+m}),ve=async m=>await v.put({url:"/promotion/reward-activity/close?id="+m}),ge=ce({name:"ProductBrandForm",__name:"RewardForm",emits:["success"],setup(m,{expose:D,emit:F}){const{t:T}=J(),w=Q(),y=n(!1),b=n(""),f=n(!1),C=n(""),a=n({conditionType:V.PRICE.type,productScope:c.ALL.scope,rules:[]}),L=ie({name:[{required:!0,message:"\u6D3B\u52A8\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],startAndEndTime:[{required:!0,message:"\u6D3B\u52A8\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionType:[{required:!0,message:"\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5546\u54C1\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=n(),I=n();D({open:async(s,e)=>{var o;if(y.value=!0,b.value=T("action."+s),C.value=s,z(),e){f.value=!0;try{const d=await(async p=>await v.get({url:"/promotion/reward-activity/get?id="+p}))(e);d.startAndEndTime=[d.startTime,d.endTime],(o=d.rules)==null||o.forEach(p=>{p.discountPrice=R(p.discountPrice||0),d.conditionType===V.PRICE.type&&(p.limit=R(p.limit||0))}),a.value=d,await B()}finally{f.value=!1}}}});const M=F,j=async()=>{var s;if(_.value&&await _.value.validate()){f.value=!0;try{(s=I.value)==null||s.setRuleCoupon();const e=pe(a.value);e.startTime=e.startAndEndTime[0],e.endTime=e.startAndEndTime[1],delete e.startAndEndTime,e.rules.forEach(o=>{o.discountPrice=O(o.discountPrice||0),e.conditionType===V.PRICE.type&&(o.limit=O(o.limit||0))}),function(o){switch(a.value.productScope){case c.SPU.scope:o.productScopeValues=a.value.productSpuIds;break;case c.CATEGORY.scope:o.productScopeValues=Array.isArray(a.value.productCategoryIds)?a.value.productCategoryIds:[a.value.productCategoryIds]}}(e),C.value==="create"?(await(async o=>await v.post({url:"/promotion/reward-activity/create",data:o}))(e),w.success(T("common.createSuccess"))):(await(async o=>await v.put({url:"/promotion/reward-activity/update",data:o}))(e),w.success(T("common.updateSuccess"))),y.value=!1,M("success")}finally{f.value=!1}}},z=()=>{a.value={conditionType:V.PRICE.type,productScope:c.ALL.scope,rules:[]}},B=async()=>{switch(a.value.productScope){case c.SPU.scope:a.value.productSpuIds=a.value.productScopeValues;break;case c.CATEGORY.scope:await me();let s=a.value.productScopeValues;Array.isArray(s)&&s.length===1&&(s=s[0]),a.value.productCategoryIds=s}};return(s,e)=>{const o=te,d=le,p=oe,E=ue,A=re,H=ae,P=se,K=W,$=de;return i(),g(K,{modelValue:l(y),"onUpdate:modelValue":e[9]||(e[9]=t=>Y(y)?y.value=t:null),title:l(b),width:"65%"},{footer:r(()=>[u(P,{disabled:l(f),type:"primary",onClick:j},{default:r(()=>e[10]||(e[10]=[S("\u786E \u5B9A")])),_:1},8,["disabled"]),u(P,{onClick:e[8]||(e[8]=t=>y.value=!1)},{default:r(()=>e[11]||(e[11]=[S("\u53D6 \u6D88")])),_:1})]),default:r(()=>[ne((i(),g(H,{ref_key:"formRef",ref:_,model:l(a),rules:l(L),"label-width":"80px"},{default:r(()=>[u(d,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:r(()=>[u(o,{modelValue:l(a).name,"onUpdate:modelValue":e[0]||(e[0]=t=>l(a).name=t),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(d,{label:"\u6D3B\u52A8\u65F6\u95F4",prop:"startAndEndTime"},{default:r(()=>[u(p,{modelValue:l(a).startAndEndTime,"onUpdate:modelValue":e[1]||(e[1]=t=>l(a).startAndEndTime=t),"end-placeholder":l(T)("common.endTimeText"),"start-placeholder":l(T)("common.startTimeText"),"range-separator":"-",type:"datetimerange","value-format":"x"},null,8,["modelValue","end-placeholder","start-placeholder"])]),_:1}),u(d,{label:"\u6761\u4EF6\u7C7B\u578B",prop:"conditionType"},{default:r(()=>[u(A,{modelValue:l(a).conditionType,"onUpdate:modelValue":e[2]||(e[2]=t=>l(a).conditionType=t)},{default:r(()=>[(i(!0),q(x,null,G(l(h)(l(k).PROMOTION_CONDITION_TYPE),t=>(i(),g(E,{key:t.value,label:t.value},{default:r(()=>[S(N(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(d,{label:"\u4F18\u60E0\u8BBE\u7F6E"},{default:r(()=>[u(X,{ref_key:"rewardRuleRef",ref:I,modelValue:l(a),"onUpdate:modelValue":e[3]||(e[3]=t=>Y(a)?a.value=t:null)},null,8,["modelValue"])]),_:1}),u(d,{label:"\u6D3B\u52A8\u8303\u56F4",prop:"productScope"},{default:r(()=>[u(A,{modelValue:l(a).productScope,"onUpdate:modelValue":e[4]||(e[4]=t=>l(a).productScope=t)},{default:r(()=>[(i(!0),q(x,null,G(l(h)(l(k).PROMOTION_PRODUCT_SCOPE),t=>(i(),g(E,{key:t.value,label:t.value},{default:r(()=>[S(N(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(a).productScope===l(c).SPU.scope?(i(),g(d,{key:0,prop:"productSpuIds"},{default:r(()=>[u(Z,{modelValue:l(a).productSpuIds,"onUpdate:modelValue":e[5]||(e[5]=t=>l(a).productSpuIds=t)},null,8,["modelValue"])]),_:1})):U("",!0),l(a).productScope===l(c).CATEGORY.scope?(i(),g(d,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:r(()=>[u(ee,{modelValue:l(a).productCategoryIds,"onUpdate:modelValue":e[6]||(e[6]=t=>l(a).productCategoryIds=t),multiple:!0},null,8,["modelValue"])]),_:1})):U("",!0),u(d,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[u(o,{modelValue:l(a).remark,"onUpdate:modelValue":e[7]||(e[7]=t=>l(a).remark=t),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[$,l(f)]])]),_:1},8,["modelValue","title"])}}});export{ge as _,ve as c,fe as d,ye as g};
