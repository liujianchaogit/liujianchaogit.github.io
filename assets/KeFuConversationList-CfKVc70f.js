import{d as q,l as B,aB as H,_ as N,c as W}from"./index-C1TKk8vI.js";import{x as J,r as c,c as _,f as Q,j as Z,W as $,aq as ee,y as g,E as ae,F as b,C as s,L as y,u as n,z as I,M as se,a4 as te,H as ne,U as m,O as r,G as f,V as ie,K as x,P as h}from"./form-create-7GAbgMwl.js";import{u as le,K as o,a as Y}from"./kefu-Dtwn5LP3.js";import{u as oe}from"./emoji-DIhFXR2A.js";import{g as ce}from"./formatTime-EbFUBcAO.js";import{af as re,a5 as ue,U as de}from"./form-designer-BpYekVAY.js";const me={class:"color-[#999] font-bold my-10px"},pe=["onClick","onContextmenu"],ve={class:"flex justify-center items-center w-100%"},fe={class:"flex justify-center items-center w-50px h-50px"},xe={class:"ml-10px w-100%"},Ce={class:"flex justify-between items-center w-100%"},ge={class:"username"},ye={class:"color-[#999]",style:{"font-size":"13px"}},he={class:"last-message flex items-center color-[#999]"},ke=W(J({name:"KeFuConversationList",__name:"KeFuConversationList",emits:["change"],setup(we,{expose:j,emit:D}){const k=q(),O=B(),u=le(),{replaceEmoji:K}=oe(),C=c(-1),U=_(()=>O.getCollapse),w=c(new Map),M=()=>{var t;(t=u.getConversationList)==null||t.forEach(e=>{w.value.set(e.id,ce(e.lastMessageTime,"YYYY-MM-DD"))})};j({calculationLastMessageTime:M});const F=D,R=_(()=>(t,e)=>{switch(t){case o.SYSTEM:return"[\u7CFB\u7EDF\u6D88\u606F]";case o.VIDEO:return"[\u89C6\u9891\u6D88\u606F]";case o.IMAGE:return"[\u56FE\u7247\u6D88\u606F]";case o.PRODUCT:return"[\u5546\u54C1\u6D88\u606F]";case o.ORDER:return"[\u8BA2\u5355\u6D88\u606F]";case o.VOICE:return"[\u8BED\u97F3\u6D88\u606F]";case o.TEXT:return K(H(e).text||e);default:return""}}),p=c(!1),E=c({}),i=c({}),d=()=>{p.value=!1},L=async t=>{await Y.updateConversationPinned({id:i.value.id,adminPinned:t}),k.notifySuccess(t?"\u7F6E\u9876\u6210\u529F":"\u53D6\u6D88\u7F6E\u9876\u6210\u529F"),d(),await u.updateConversation(i.value.id)},S=async()=>{await k.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u4F1A\u8BDD\u5417\uFF1F"),await Y.deleteConversation(i.value.id),d(),u.deleteConversation(i.value.id)};Q(p,t=>{t?document.body.addEventListener("click",d):document.body.removeEventListener("click",d)});const P=c();return Z(()=>{P.value=setInterval(M,1e4)}),$(()=>{clearInterval(P.value)}),(t,e)=>{const V=re,X=ue,v=N,z=de,A=ee("dompurify-html");return g(),ae(z,{class:"kefu pt-5px h-100%",width:"260px"},{default:b(()=>[s("div",me," \u4F1A\u8BDD\u8BB0\u5F55("+y(n(u).getConversationList.length)+") ",1),(g(!0),I(se,null,te(n(u).getConversationList,a=>(g(),I("div",{key:a.id,class:ne([{active:a.id===n(C),pinned:a.adminPinned},"kefu-conversation px-10px flex items-center"]),onClick:T=>(l=>{C.value!==l.id&&(C.value=l.id,F("change",l))})(a),onContextmenu:m(T=>((l,G)=>{i.value=G,p.value=!0,E.value={top:l.clientY-110+"px",left:U.value?l.clientX-80+"px":l.clientX-210+"px"}})(T,a),["prevent"])},[s("div",ve,[s("div",fe,[r(X,{hidden:a.adminUnreadMessageCount===0,max:99,value:a.adminUnreadMessageCount},{default:b(()=>[r(V,{src:a.userAvatar,alt:"avatar"},null,8,["src"])]),_:2},1032,["hidden","value"])]),s("div",xe,[s("div",Ce,[s("span",ge,y(a.userNickname),1),s("span",ye,y(n(w).get(a.id)??"\u8BA1\u7B97\u4E2D"),1)]),f(s("div",he,null,512),[[A,n(R)(a.lastMessageContentType,a.lastMessageContent)]])])])],42,pe))),128)),f(s("ul",{style:ie(n(E)),class:"right-menu-ul"},[f(s("li",{class:"flex items-center",onClick:e[0]||(e[0]=m(a=>L(!0),["stop"]))},[r(v,{class:"mr-5px",icon:"ep:top"}),e[2]||(e[2]=x(" \u7F6E\u9876\u4F1A\u8BDD "))],512),[[h,!n(i).adminPinned]]),f(s("li",{class:"flex items-center",onClick:e[1]||(e[1]=m(a=>L(!1),["stop"]))},[r(v,{class:"mr-5px",icon:"ep:bottom"}),e[3]||(e[3]=x(" \u53D6\u6D88\u7F6E\u9876 "))],512),[[h,n(i).adminPinned]]),s("li",{class:"flex items-center",onClick:m(S,["stop"])},[r(v,{class:"mr-5px",color:"red",icon:"ep:delete"}),e[4]||(e[4]=x(" \u5220\u9664\u4F1A\u8BDD "))]),s("li",{class:"flex items-center",onClick:m(d,["stop"])},[r(v,{class:"mr-5px",color:"red",icon:"ep:close"}),e[5]||(e[5]=x(" \u53D6\u6D88 "))])],4),[[h,n(p)]])]),_:1})}}}),[["__scopeId","data-v-87bdc0f6"]]);export{ke as default};
