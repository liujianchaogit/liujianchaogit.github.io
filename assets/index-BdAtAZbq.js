import{d as Ie,a as Te,u as De,h as le,D as I,_ as Ve,H as Ee}from"./index-DiGvuAxb.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{_ as Se}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{_ as Oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{k as Pe,r as u,P as Ue,e as Fe,af as Re,l as k,m as s,H as a,z as i,u as t,G as w,$ as T,y as c,Z as ae,A as v,E as p,v as d,B as te,F as C,C as Le}from"./form-create-D7wT855o.js";import{d as ze}from"./formatTime-DeTj2b0K.js";import{a as q,D as P}from"./index-4TQdK-Zm.js";import{_ as Ae}from"./DeviceForm.vue_vue_type_script_setup_true_lang-DH8SL_fP.js";import{P as Ke}from"./index-y2Iw13c9.js";import{D as qe}from"./index-DvyuJUgN.js";import{d as Ye}from"./download-oWiM5xVU.js";import{_ as je}from"./DeviceGroupForm.vue_vue_type_script_setup_true_lang-I38trCVK.js";import{_ as Ge}from"./DeviceImportForm.vue_vue_type_script_setup_true_lang-DUsVDOQ6.js";import{h as He,ai as Ze,x as Be,Q as Qe,k as $e,ap as Je,f as Me,i as We,j as Xe,ac as el,ak as ll,a6 as al,V as tl,Z as il,_ as sl,P as ol,a5 as dl,aj as cl}from"./form-designer-drfGvdgz.js";import"./color-BN7ZL7BD.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";const pl={class:"p-4 relative"},nl={class:"flex items-center mb-3"},rl={class:"mr-2.5 flex items-center"},ul={class:"text-[16px] font-600 flex-1"},ml={class:"inline-flex items-center"},fl={class:"flex items-center text-[14px]"},vl={class:"flex-1"},xl={class:"mb-2.5 last:mb-0"},yl={class:"text-[#0070ff]"},_l={class:"mb-2.5 last:mb-0"},gl={class:"mb-2.5 last:mb-0"},bl={class:"text-[#0b1d30] inline-block align-middle overflow-hidden text-ellipsis whitespace-nowrap max-w-[130px]"},kl={class:"w-[100px] h-[100px]"},wl={class:"flex items-center px-0"},Cl=Pe({name:"IoTDevice",__name:"index",setup(hl){const D=Ie(),{t:Y}=Te(),U=u(!0),F=u([]),j=u(0),o=Ue({pageNo:1,pageSize:10,deviceName:void 0,productId:void 0,deviceType:void 0,nickname:void 0,status:void 0,groupId:void 0}),G=u(),R=u(!1),E=u([]),L=u([]),h=u([]),V=u("card"),ie=u("/src/assets/imgs/iot/device.png"),se=u("/src/assets/svgs/iot/card-fill.svg"),g=async()=>{U.value=!0;try{const r=await P.getDevicePage(o);F.value=r.list,j.value=r.total}finally{U.value=!1}},N=()=>{o.pageNo=1,g()},oe=()=>{G.value.resetFields(),h.value=[],N()},H=u(),z=(r,l)=>{H.value.open(r,l)},{push:Z}=De(),A=r=>{Z({name:"IoTDeviceDetail",params:{id:r}})},B=async r=>{try{await D.delConfirm(),await P.deleteDevice(r),D.success(Y("common.delSuccess")),await g()}catch{}},de=async()=>{try{await D.exportConfirm(),R.value=!0;const r=await P.exportDeviceExcel(o);Ye.excel(r,"\u7269\u8054\u7F51\u8BBE\u5907.xls")}catch{}finally{R.value=!1}},ce=r=>{h.value=r.map(l=>l.id)},pe=async()=>{try{await D.delConfirm(),await P.deleteDeviceList(h.value),D.success(Y("common.delSuccess")),await g()}catch{}},Q=u(),ne=()=>{Q.value.open(h.value)},$=r=>{Z({name:"IoTDeviceDetail",params:{id:r},query:{tab:"model"}})},J=u(),re=()=>{J.value.open()};return Fe(async()=>{g(),E.value=await Ke.getSimpleProductList(),L.value=await qe.getSimpleDeviceGroupList()}),(r,l)=>{const S=Qe,O=Be,b=Ze,M=$e,m=Ve,n=Me,ue=Je,me=He,W=Oe,X=ll,fe=al,K=Se,ve=tl,xe=el,ye=Xe,_e=We,_=sl,ge=ol,be=dl,ke=il,we=Ne,x=Re("hasPermi"),Ce=cl;return s(),k(w,null,[a(W,null,{default:i(()=>[a(me,{class:"-mb-15px",model:t(o),ref_key:"queryFormRef",ref:G,inline:!0,"label-width":"68px"},{default:i(()=>[a(b,{label:"\u4EA7\u54C1",prop:"productId"},{default:i(()=>[a(O,{modelValue:t(o).productId,"onUpdate:modelValue":l[0]||(l[0]=e=>t(o).productId=e),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(E),e=>(s(),c(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"DeviceName",prop:"deviceName"},{default:i(()=>[a(M,{modelValue:t(o).deviceName,"onUpdate:modelValue":l[1]||(l[1]=e=>t(o).deviceName=e),placeholder:"\u8BF7\u8F93\u5165 DeviceName",clearable:"",onKeyup:ae(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(b,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:i(()=>[a(M,{modelValue:t(o).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>t(o).nickname=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0",clearable:"",onKeyup:ae(N,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u7C7B\u578B",prop:"deviceType"},{default:i(()=>[a(O,{modelValue:t(o).deviceType,"onUpdate:modelValue":l[3]||(l[3]=e=>t(o).deviceType=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u7C7B\u578B",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(le)(t(I).IOT_PRODUCT_DEVICE_TYPE),e=>(s(),c(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u72B6\u6001",prop:"status"},{default:i(()=>[a(O,{modelValue:t(o).status,"onUpdate:modelValue":l[4]||(l[4]=e=>t(o).status=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u72B6\u6001",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(le)(t(I).IOT_DEVICE_STATE),e=>(s(),c(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupId"},{default:i(()=>[a(O,{modelValue:t(o).groupId,"onUpdate:modelValue":l[5]||(l[5]=e=>t(o).groupId=e),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",clearable:"",class:"!w-240px"},{default:i(()=>[(s(!0),k(w,null,T(t(L),e=>(s(),c(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{class:"float-right !mr-0 !mb-0"},{default:i(()=>[a(ue,null,{default:i(()=>[a(n,{type:t(V)==="card"?"primary":"default",onClick:l[6]||(l[6]=e=>V.value="card")},{default:i(()=>[a(m,{icon:"ep:grid"})]),_:1},8,["type"]),a(n,{type:t(V)==="list"?"primary":"default",onClick:l[7]||(l[7]=e=>V.value="list")},{default:i(()=>[a(m,{icon:"ep:list"})]),_:1},8,["type"])]),_:1})]),_:1}),a(b,null,{default:i(()=>[a(n,{onClick:N},{default:i(()=>[a(m,{icon:"ep:search",class:"mr-5px"}),l[11]||(l[11]=p(" \u641C\u7D22 "))]),_:1}),a(n,{onClick:oe},{default:i(()=>[a(m,{icon:"ep:refresh",class:"mr-5px"}),l[12]||(l[12]=p(" \u91CD\u7F6E "))]),_:1}),v((s(),c(n,{type:"primary",plain:"",onClick:l[8]||(l[8]=e=>z("create"))},{default:i(()=>[a(m,{icon:"ep:plus",class:"mr-5px"}),l[13]||(l[13]=p(" \u65B0\u589E "))]),_:1})),[[x,["iot:device:create"]]]),v((s(),c(n,{type:"success",plain:"",onClick:de,loading:t(R)},{default:i(()=>[a(m,{icon:"ep:download",class:"mr-5px"}),l[14]||(l[14]=p(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[x,["iot:device:export"]]]),v((s(),c(n,{type:"warning",plain:"",onClick:re},{default:i(()=>[a(m,{icon:"ep:upload"}),l[15]||(l[15]=p(" \u5BFC\u5165 "))]),_:1})),[[x,["iot:device:import"]]]),v((s(),c(n,{type:"primary",plain:"",onClick:ne,disabled:t(h).length===0},{default:i(()=>[a(m,{icon:"ep:folder-add",class:"mr-5px"}),l[16]||(l[16]=p(" \u6DFB\u52A0\u5230\u5206\u7EC4 "))]),_:1},8,["disabled"])),[[x,["iot:device:update"]]]),v((s(),c(n,{type:"danger",plain:"",onClick:pe,disabled:t(h).length===0},{default:i(()=>[a(m,{icon:"ep:delete",class:"mr-5px"}),l[17]||(l[17]=p(" \u6279\u91CF\u5220\u9664 "))]),_:1},8,["disabled"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(W,null,{default:i(()=>[t(V)==="card"?(s(),c(_e,{key:0,gutter:16},{default:i(()=>[(s(!0),k(w,null,T(t(F),e=>(s(),c(ye,{key:e.id,xs:24,sm:12,md:12,lg:6,class:"mb-4"},{default:i(()=>[a(xe,{class:"h-full transition-colors relative overflow-hidden","body-style":{padding:"0"}},{default:i(()=>{var f;return[d("div",{class:te(["absolute top-0 left-0 right-0 h-[50px] pointer-events-none",[e.state===t(q).ONLINE?"bg-gradient-to-b from-[#eefaff] to-transparent":"bg-gradient-to-b from-[#fff1f1] to-transparent"]])},null,2),d("div",pl,[d("div",nl,[d("div",rl,[a(X,{src:t(se),class:"w-[18px] h-[18px]"},null,8,["src"])]),d("div",ul,C(e.deviceName),1),d("div",ml,[d("div",{class:te(["w-1 h-1 rounded-full mr-1.5",e.state===t(q).ONLINE?"bg-[var(--el-color-success)]":"bg-[var(--el-color-danger)]"])},null,2),a(fe,{class:"!text-xs font-bold",type:e.state===t(q).ONLINE?"success":"danger"},{default:i(()=>[p(C(t(Ee)(t(I).IOT_DEVICE_STATE,e.state)),1)]),_:2},1032,["type"])])]),d("div",fl,[d("div",vl,[d("div",xl,[l[18]||(l[18]=d("span",{class:"text-[#717c8e] mr-2.5"},"\u6240\u5C5E\u4EA7\u54C1",-1)),d("span",yl,C((f=t(E).find(y=>y.id===e.productId))==null?void 0:f.name),1)]),d("div",_l,[l[19]||(l[19]=d("span",{class:"text-[#717c8e] mr-2.5"},"\u8BBE\u5907\u7C7B\u578B",-1)),a(K,{type:t(I).IOT_PRODUCT_DEVICE_TYPE,value:e.deviceType},null,8,["type","value"])]),d("div",gl,[l[20]||(l[20]=d("span",{class:"text-[#717c8e] mr-2.5"},"DeviceKey",-1)),d("span",bl,C(e.deviceKey),1)])]),d("div",kl,[a(X,{src:t(ie),class:"w-full h-full"},null,8,["src"])])]),a(ve,{class:"!my-3"}),d("div",wl,[v((s(),c(n,{class:"flex-1 !px-2 !h-[32px] text-[13px]",type:"primary",plain:"",onClick:y=>z("update",e.id)},{default:i(()=>[a(m,{icon:"ep:edit-pen",class:"mr-1"}),l[21]||(l[21]=p(" \u7F16\u8F91 "))]),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),a(n,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"warning",plain:"",onClick:y=>A(e.id)},{default:i(()=>[a(m,{icon:"ep:view",class:"mr-1"}),l[22]||(l[22]=p(" \u8BE6\u60C5 "))]),_:2},1032,["onClick"]),a(n,{class:"flex-1 !px-2 !h-[32px] !ml-[10px] text-[13px]",type:"info",plain:"",onClick:y=>$(e.id)},{default:i(()=>[a(m,{icon:"ep:tickets",class:"mr-1"}),l[23]||(l[23]=p(" \u6570\u636E "))]),_:2},1032,["onClick"]),l[24]||(l[24]=d("div",{class:"mx-[10px] h-[20px] w-[1px] bg-[#dcdfe6]"},null,-1)),v((s(),c(n,{class:"!px-2 !h-[32px] text-[13px]",type:"danger",plain:"",onClick:y=>B(e.id)},{default:i(()=>[a(m,{icon:"ep:delete"})]),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})):v((s(),c(ke,{key:1,data:t(F),stripe:!0,"show-overflow-tooltip":!0,onSelectionChange:ce},{default:i(()=>[a(_,{type:"selection",width:"55"}),a(_,{label:"DeviceName",align:"center",prop:"deviceName"},{default:i(e=>[a(ge,{onClick:f=>A(e.row.id)},{default:i(()=>[p(C(e.row.deviceName),1)]),_:2},1032,["onClick"])]),_:1}),a(_,{label:"\u5907\u6CE8\u540D\u79F0",align:"center",prop:"nickname"}),a(_,{label:"\u6240\u5C5E\u4EA7\u54C1",align:"center",prop:"productId"},{default:i(e=>{var f;return[p(C(((f=t(E).find(y=>y.id===e.row.productId))==null?void 0:f.name)||"-"),1)]}),_:1}),a(_,{label:"\u8BBE\u5907\u7C7B\u578B",align:"center",prop:"deviceType"},{default:i(e=>[a(K,{type:t(I).IOT_PRODUCT_DEVICE_TYPE,value:e.row.deviceType},null,8,["type","value"])]),_:1}),a(_,{label:"\u6240\u5C5E\u5206\u7EC4",align:"center",prop:"groupId"},{default:i(e=>{var f;return[(f=e.row.groupIds)!=null&&f.length?(s(!0),k(w,{key:0},T(e.row.groupIds,y=>(s(),c(be,{key:y,class:"ml-5px",size:"small"},{default:i(()=>{var ee;return[p(C((ee=t(L).find(he=>he.id===y))==null?void 0:ee.name),1)]}),_:2},1024))),128)):Le("",!0)]}),_:1}),a(_,{label:"\u8BBE\u5907\u72B6\u6001",align:"center",prop:"status"},{default:i(e=>[a(K,{type:t(I).IOT_DEVICE_STATE,value:e.row.status},null,8,["type","value"])]),_:1}),a(_,{label:"\u6700\u540E\u4E0A\u7EBF\u65F6\u95F4",align:"center",prop:"onlineTime",formatter:t(ze),width:"180px"},null,8,["formatter"]),a(_,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:i(e=>[v((s(),c(n,{link:"",type:"primary",onClick:f=>A(e.row.id)},{default:i(()=>l[25]||(l[25]=[p(" \u67E5\u770B ")])),_:2},1032,["onClick"])),[[x,["iot:product:query"]]]),a(n,{link:"",type:"primary",onClick:f=>$(e.row.id)},{default:i(()=>l[26]||(l[26]=[p(" \u65E5\u5FD7 ")])),_:2},1032,["onClick"]),v((s(),c(n,{link:"",type:"primary",onClick:f=>z("update",e.row.id)},{default:i(()=>l[27]||(l[27]=[p(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[x,["iot:device:update"]]]),v((s(),c(n,{link:"",type:"danger",onClick:f=>B(e.row.id)},{default:i(()=>l[28]||(l[28]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[x,["iot:device:delete"]]])]),_:1})]),_:1},8,["data"])),[[Ce,t(U)]]),a(we,{total:t(j),page:t(o).pageNo,"onUpdate:page":l[9]||(l[9]=e=>t(o).pageNo=e),limit:t(o).pageSize,"onUpdate:limit":l[10]||(l[10]=e=>t(o).pageSize=e),onPagination:g},null,8,["total","page","limit"])]),_:1}),a(Ae,{ref_key:"formRef",ref:H,onSuccess:g},null,512),a(je,{ref_key:"groupFormRef",ref:Q,onSuccess:g},null,512),a(Ge,{ref_key:"importFormRef",ref:J,onSuccess:g},null,512)],64)}}});export{Cl as default};
