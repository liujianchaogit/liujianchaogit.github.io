import{_ as k}from"./index-DiGvuAxb.js";import{K as _}from"./index-Dh3qeqbp.js";import{H as C,f as T}from"./form-designer-drfGvdgz.js";import{k as j,i as B,r as K,c as O,e as P,O as S,l as m,m as p,v as r,G as q,$ as z,H as f,F as y,z as E,E as F,u as V}from"./form-create-D7wT855o.js";const G={class:"mt-15px grid grid-cols-1 gap-2"},H={class:"flex items-center min-w-[200px] mr-10px"},I={class:"text-[13px] text-[#303133] break-all"},L={class:"flex-1"},M={class:"ml-10px text-[13px] text-[#606266]"},$={class:"flex justify-end mt-20px"},A=j({__name:"ProcessStep",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(x,{emit:b}){const l=x,g=b,n=B("parent"),d=K(null),u=e=>e.progress===100,v=O(()=>l.modelValue.list.every(e=>u(e))),w=()=>{var e;(e=n==null?void 0:n.exposed)!=null&&e.handleBack&&n.exposed.handleBack()},c=async()=>{try{const e=l.modelValue.list.filter(s=>s.id).map(s=>s.id);if(e.length===0)return;const o=await _.getKnowledgeSegmentProcessList(e),i=l.modelValue.list.map(s=>{const a=o.find(t=>t.documentId===s.id);if(a){const t=a.embeddingCount&&a.count?Math.floor(a.embeddingCount/a.count*100):0;return{...s,progress:t,count:a.count||0}}return s});g("update:modelValue",{...l.modelValue,list:i}),i.every(s=>u(s))||(d.value=window.setTimeout(c,3e3))}catch{d.value=window.setTimeout(c,5e3)}};return P(()=>{const e=l.modelValue.list.map(o=>({...o,progress:0}));g("update:modelValue",{...l.modelValue,list:e}),c()}),S(()=>{d.value&&(clearTimeout(d.value),d.value=null)}),(e,o)=>{const i=k,s=C,a=T;return p(),m("div",null,[r("div",G,[(p(!0),m(q,null,z(x.modelValue.list,(t,h)=>(p(),m("div",{key:h,class:"flex items-center py-4px px-12px border-l-4 border-l-[#409eff] rounded-sm shadow-sm hover:bg-[#ecf5ff] transition-all duration-300"},[r("div",H,[f(i,{icon:"ep:document",class:"mr-8px text-[#409eff]"}),r("span",I,y(t.name),1)]),r("div",L,[f(s,{percentage:t.progress||0,"stroke-width":10,status:u(t)?"success":""},null,8,["percentage","status"])]),r("div",M," \u5206\u6BB5\u6570\u91CF\uFF1A"+y(t.count?t.count:"-"),1)]))),128))]),r("div",$,[f(a,{type:V(v)?"success":"primary",disabled:!V(v),onClick:w},{default:E(()=>o[0]||(o[0]=[F(" \u5B8C\u6210 ")])),_:1},8,["type","disabled"])])])}}});export{A as _};
