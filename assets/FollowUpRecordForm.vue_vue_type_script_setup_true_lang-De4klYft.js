import{V as w,e as Z,D as A,b as H,d as N,Y as $,Z as ee,_ as ae}from"./index-C1TKk8vI.js";import{_ as le}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{B as T}from"./index-BuK0ap75.js";import{_ as se}from"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-DrAuCfpX.js";import{_ as oe}from"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-B-IANjnk.js";import{_ as te}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-D8lenXv5.js";import{_ as ue}from"./ContactListModal.vue_vue_type_script_setup_true_lang-Cgo1EbLC.js";import{Q as re,x as de,ai as ne,j as ce,F as ie,k as pe,f as me,i as fe,h as be,aj as _e}from"./form-designer-BpYekVAY.js";import{x as ve,r as c,X as ye,y as m,z as g,O as a,F as o,u as s,K as v,G as Ue,E as y,M as F,a4 as we,J as k,l as Ve}from"./form-create-7GAbgMwl.js";const z={getFollowUpRecordPage:async i=>await w.get({url:"/crm/follow-up-record/page",params:i}),createFollowUpRecord:async i=>await w.post({url:"/crm/follow-up-record/create",data:i}),deleteFollowUpRecord:async i=>await w.delete({url:"/crm/follow-up-record/delete?id="+i})},xe=ve({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(i,{expose:h,emit:C}){const{t:I}=H(),S=N(),p=c(!1);c("");const b=c(!1),l=c({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),E=ye({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),U=c();h({open:async(u,e)=>{p.value=!0,B(),l.value.bizType=u,l.value.bizId=e}});const M=C,O=async()=>{await U.value.validate(),b.value=!0;try{const u={...l.value,contactIds:l.value.contacts.map(e=>e.id),businessIds:l.value.businesses.map(e=>e.id)};await z.createFollowUpRecord(u),S.success(I("common.createSuccess")),p.value=!1,M("success")}finally{b.value=!1}},V=c(),P=()=>{var u;(u=V.value)==null||u.open()},q=(u,e)=>{e.forEach(r=>{l.value.contacts.some(f=>f.id===r.id)||l.value.contacts.push(r)})},x=c(),Y=()=>{var u;(u=x.value)==null||u.open()},j=(u,e)=>{e.forEach(r=>{l.value.businesses.some(f=>f.id===r.id)||l.value.businesses.push(r)})},B=()=>{var u;(u=U.value)==null||u.resetFields(),l.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}};return(u,e)=>{const r=re,f=de,d=ne,n=ce,D=ie,L=pe,X=$,G=ee,R=ae,_=me,J=fe,K=be,Q=le,W=_e;return m(),g(F,null,[a(Q,{modelValue:s(p),"onUpdate:modelValue":e[6]||(e[6]=t=>Ve(p)?p.value=t:null),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[a(_,{disabled:s(b),type:"primary",onClick:O},{default:o(()=>e[9]||(e[9]=[v("\u786E \u5B9A")])),_:1},8,["disabled"]),a(_,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:o(()=>e[10]||(e[10]=[v("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Ue((m(),y(K,{ref_key:"formRef",ref:U,model:s(l),rules:s(E),"label-width":"120px"},{default:o(()=>[a(J,null,{default:o(()=>[a(n,{span:12},{default:o(()=>[a(d,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[a(f,{modelValue:s(l).type,"onUpdate:modelValue":e[0]||(e[0]=t=>s(l).type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(m(!0),g(F,null,we(s(Z)(s(A).CRM_FOLLOW_UP_TYPE),t=>(m(),y(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[a(D,{modelValue:s(l).nextTime,"onUpdate:modelValue":e[1]||(e[1]=t=>s(l).nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:24},{default:o(()=>[a(d,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[a(L,{modelValue:s(l).content,"onUpdate:modelValue":e[2]||(e[2]=t=>s(l).content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[a(X,{modelValue:s(l).picUrls,"onUpdate:modelValue":e[3]||(e[3]=t=>s(l).picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(d,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[a(G,{modelValue:s(l).fileUrls,"onUpdate:modelValue":e[4]||(e[4]=t=>s(l).fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),s(l).bizType==s(T).CRM_CUSTOMER?(m(),y(n,{key:0,span:24},{default:o(()=>[a(d,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[a(_,{onClick:P},{default:o(()=>[a(R,{class:"mr-5px",icon:"ep:plus"}),e[7]||(e[7]=v(" \u6DFB\u52A0\u8054\u7CFB\u4EBA "))]),_:1}),a(oe,{contacts:s(l).contacts},null,8,["contacts"])]),_:1})]),_:1})):k("",!0),s(l).bizType==s(T).CRM_CUSTOMER?(m(),y(n,{key:1,span:24},{default:o(()=>[a(d,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[a(_,{onClick:Y},{default:o(()=>[a(R,{class:"mr-5px",icon:"ep:plus"}),e[8]||(e[8]=v(" \u6DFB\u52A0\u5546\u673A "))]),_:1}),a(se,{businesses:s(l).businesses},null,8,["businesses"])]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1},8,["model","rules"])),[[W,s(b)]])]),_:1},8,["modelValue"]),a(ue,{ref_key:"contactTableSelectRef",ref:V,"customer-id":s(l).bizId,onSuccess:q},null,8,["customer-id"]),a(te,{ref_key:"businessTableSelectRef",ref:x,"customer-id":s(l).bizId,onSuccess:j},null,8,["customer-id"])],64)}}});export{z as F,xe as _};
