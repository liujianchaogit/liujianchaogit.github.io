import{D as j,au as M,d as q,b as A,_ as B}from"./index-C1TKk8vI.js";import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as G}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{g as K,d as O}from"./index-pmRUIUos.js";import{_ as V}from"./ReceivableForm.vue_vue_type_script_setup_true_lang-CpUQxp4U.js";import{b as X}from"./formatTime-EbFUBcAO.js";import{f as Y,i as $,$ as H,_ as J,aj as Q}from"./form-designer-BpYekVAY.js";import{x as W,r as p,X as Z,f as ee,y as m,z as ae,O as a,F as n,K as I,G as g,u as r,E as _,M as te,aq as oe}from"./form-create-7GAbgMwl.js";const re=W({name:"CrmReceivableList",__name:"ReceivableList",props:{customerId:{},contractId:{}},setup(x,{expose:C}){const t=x,v=q(),{t:R}=A(),d=p(!0),b=p(0),y=p([]),o=Z({pageNo:1,pageSize:10,customerId:void 0,contractId:void 0}),s=async()=>{d.value=!0;try{t.customerId&&!t.contractId?o.customerId=t.customerId:t.customerId&&t.contractId&&(o.customerId=t.customerId,o.contractId=t.contractId);const l=await K(o);y.value=l.list,b.value=l.total}finally{d.value=!1}},u=p(),w=(l,e)=>{u.value.open(l,e,{customerId:t.customerId,contractId:t.contractId})};return C({createReceivable:l=>{const e=l;u.value.open("create",void 0,e)}}),ee(()=>[t.customerId,t.contractId],l=>{l[0]&&(o.pageNo=1,o.customerId=void 0,o.contractId=void 0,s())},{immediate:!0,deep:!0}),(l,e)=>{const h=B,f=Y,N=$,c=H,E=G,S=J,z=F,T=D,k=oe("hasPermi"),U=Q;return m(),ae(te,null,[a(N,{justify:"end"},{default:n(()=>[a(f,{onClick:e[0]||(e[0]=i=>w("create"))},{default:n(()=>[a(h,{class:"mr-5px",icon:"icon-park:income-one"}),e[3]||(e[3]=I(" \u521B\u5EFA\u56DE\u6B3E "))]),_:1})]),_:1}),a(T,{class:"mt-10px"},{default:n(()=>[g((m(),_(S,{data:r(y),"show-overflow-tooltip":!0,stripe:!0},{default:n(()=>[a(c,{align:"center",label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"}),a(c,{align:"center",label:"\u5BA2\u6237",prop:"customerName"}),a(c,{align:"center",label:"\u5408\u540C",prop:"contract.no"}),a(c,{formatter:r(X),align:"center",label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime",width:"150px"},null,8,["formatter"]),a(c,{align:"center",label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType",width:"130px"},{default:n(i=>[a(E,{type:r(j).CRM_RECEIVABLE_RETURN_TYPE,value:i.row.returnType},null,8,["type","value"])]),_:1}),a(c,{align:"center",label:"\u56DE\u6B3E\u91D1\u989D(\u5143)",prop:"price",formatter:r(M)},null,8,["formatter"]),a(c,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName"}),a(c,{align:"center",label:"\u5907\u6CE8",prop:"remark"}),a(c,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"130px"},{default:n(i=>[g((m(),_(f,{link:"",type:"primary",onClick:L=>w("update",i.row.id)},{default:n(()=>e[4]||(e[4]=[I(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:update"]]]),g((m(),_(f,{link:"",type:"danger",onClick:L=>(async P=>{try{await v.delConfirm(),await O(P),v.success(R("common.delSuccess")),await s()}catch{}})(i.row.id)},{default:n(()=>e[5]||(e[5]=[I(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:delete"]]])]),_:1})]),_:1},8,["data"])),[[U,r(d)]]),a(z,{limit:r(o).pageSize,"onUpdate:limit":e[1]||(e[1]=i=>r(o).pageSize=i),page:r(o).pageNo,"onUpdate:page":e[2]||(e[2]=i=>r(o).pageNo=i),total:r(b),onPagination:s},null,8,["limit","page","total"])]),_:1}),a(V,{ref_key:"formRef",ref:u,onSuccess:s},null,512)],64)}}});export{re as _};
