import{b as q,d as z,e as G,D as J}from"./index-C1TKk8vI.js";import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{d as Q,h as X}from"./tree-COGD3qag.js";import{q as C}from"./constants-IYPHa1Ih.js";import{g as Y}from"./index-B0Mya_PA.js";import{b as B}from"./index-BLpDMWlm.js";import{a6 as H,ai as W,Q as Z,x as $,h as ee,D as ae,y as le,ad as te,f as oe,aj as de}from"./form-designer-BpYekVAY.js";import{x as se,r as u,X as ue,y as f,E as S,F as d,O as s,u as a,K as c,G as ne,L as D,z as ce,M as ie,a4 as pe,l as y,J as me,n as re}from"./form-create-7GAbgMwl.js";const ve=se({name:"SystemRoleDataPermissionForm",__name:"RoleDataPermissionForm",emits:["success"],setup(fe,{expose:w,emit:U}){const{t:E}=q(),T=z(),i=u(!1),_=u(!1),o=ue({id:void 0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]}),b=u(),x=u([]),p=u(!0),m=u(),r=u(!1),v=u(!0);w({open:async l=>{var e;i.value=!0,O(),x.value=X(await Y()),o.id=l.id,o.name=l.name,o.code=l.code,o.dataScope=l.dataScope,await re(),(e=l.dataScopeDeptIds)==null||e.forEach(n=>{m.value.setChecked(n,!0,!1)})}});const I=U,M=async()=>{_.value=!0;try{const l={roleId:o.id,dataScope:o.dataScope,dataScopeDeptIds:o.dataScope!==C.DEPT_CUSTOM?[]:m.value.getCheckedKeys(!1)};await B(l),T.success(E("common.updateSuccess")),i.value=!1,I("success")}finally{_.value=!1}},O=()=>{var l,e;r.value=!1,p.value=!0,v.value=!0,o.value={id:void 0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]},(l=m.value)==null||l.setCheckedNodes([]),(e=b.value)==null||e.resetFields()},P=()=>{var e;const l=(e=m.value)==null?void 0:e.store.nodesMap;for(let n in l)l[n].expanded!==p.value&&(l[n].expanded=p.value)};return(l,e)=>{const n=H,h=W,R=Z,g=$,F=ee,V=ae,K=le,N=te,k=oe,A=L,j=de;return f(),S(A,{modelValue:a(i),"onUpdate:modelValue":e[6]||(e[6]=t=>y(i)?i.value=t:null),title:"\u6570\u636E\u6743\u9650",width:"800"},{footer:d(()=>[s(k,{disabled:a(_),type:"primary",onClick:M},{default:d(()=>e[10]||(e[10]=[c("\u786E \u5B9A")])),_:1},8,["disabled"]),s(k,{onClick:e[5]||(e[5]=t=>i.value=!1)},{default:d(()=>e[11]||(e[11]=[c("\u53D6 \u6D88")])),_:1})]),default:d(()=>[ne((f(),S(F,{ref_key:"formRef",ref:b,model:a(o),"label-width":"80px"},{default:d(()=>[s(h,{label:"\u89D2\u8272\u540D\u79F0"},{default:d(()=>[s(n,null,{default:d(()=>[c(D(a(o).name),1)]),_:1})]),_:1}),s(h,{label:"\u89D2\u8272\u6807\u8BC6"},{default:d(()=>[s(n,null,{default:d(()=>[c(D(a(o).code),1)]),_:1})]),_:1}),s(h,{label:"\u6743\u9650\u8303\u56F4"},{default:d(()=>[s(g,{modelValue:a(o).dataScope,"onUpdate:modelValue":e[0]||(e[0]=t=>a(o).dataScope=t)},{default:d(()=>[(f(!0),ce(ie,null,pe(a(G)(a(J).SYSTEM_DATA_SCOPE),t=>(f(),S(R,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[j,a(_)]]),a(o).dataScope===a(C).DEPT_CUSTOM?(f(),S(h,{key:0,label:"\u90E8\u95E8\u8303\u56F4","label-width":"80px"},{default:d(()=>[s(N,{class:"w-full h-400px !overflow-y-scroll",shadow:"never"},{header:d(()=>[e[7]||(e[7]=c(" \u5168\u9009/\u5168\u4E0D\u9009: ")),s(V,{modelValue:a(r),"onUpdate:modelValue":e[1]||(e[1]=t=>y(r)?r.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:e[2]||(e[2]=t=>{m.value.setCheckedNodes(r.value?x.value:[])})},null,8,["modelValue"]),e[8]||(e[8]=c(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: ")),s(V,{modelValue:a(p),"onUpdate:modelValue":e[3]||(e[3]=t=>y(p)?p.value=t:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:P},null,8,["modelValue"]),e[9]||(e[9]=c(" \u7236\u5B50\u8054\u52A8(\u9009\u4E2D\u7236\u8282\u70B9\uFF0C\u81EA\u52A8\u9009\u62E9\u5B50\u8282\u70B9): ")),s(V,{modelValue:a(v),"onUpdate:modelValue":e[4]||(e[4]=t=>y(v)?v.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":""},null,8,["modelValue"])]),default:d(()=>[s(K,{ref_key:"treeRef",ref:m,"check-strictly":!a(v),data:a(x),props:a(Q),"default-expand-all":"","empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E","node-key":"id","show-checkbox":""},null,8,["check-strictly","data","props"])]),_:1})]),_:1})):me("",!0)]),_:1},8,["modelValue"])}}});export{ve as _};
