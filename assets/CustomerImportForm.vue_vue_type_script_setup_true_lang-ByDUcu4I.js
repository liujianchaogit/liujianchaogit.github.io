import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{d as M,a as P,_ as Q}from"./index-C1TKk8vI.js";import{k as R,m as q}from"./index-Bdw660V1.js";import{d as A}from"./download-oWiM5xVU.js";import{g as B}from"./index-CZiMqbPE.js";import{Q as G,x as H,w as J,P as T,z as W,f as X}from"./form-designer-BpYekVAY.js";import{x as Y,r as u,y,E as b,F as o,O as n,u as i,K as x,C as m,l as _,z as Z,M as $,a4 as ee,n as ae}from"./form-create-7GAbgMwl.js";const le={class:"flex items-center my-10px"},se={class:"el-upload__tip text-center"},te={class:"el-upload__tip"},oe=Y({name:"SystemUserImportForm",__name:"CustomerImportForm",emits:["success"],setup(re,{expose:V,emit:k}){const f=M(),d=u(!1),r=u(!1),g=u(),p=u([]),v=u(!1),c=u(),w=u([]);V({open:async()=>{d.value=!0,await z(),w.value=await B(),c.value=P().getUser.id}});const U=async()=>{if(p.value.length!=0){r.value=!0;try{const a=new FormData;a.append("updateSupport",String(v.value)),a.append("file",p.value[0].raw),a.append("ownerUserId",String(c.value));const e=await R(a);h(e)}catch{F()}finally{r.value=!1}}else f.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},N=k,h=a=>{if(a.code!==0)return f.error(a.msg),void(r.value=!1);const e=a.data;let s="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createCustomerNames.length+";";for(let t of e.createCustomerNames)s+="< "+t+" >";s+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateCustomerNames.length+";";for(const t of e.updateCustomerNames)s+="< "+t+" >";s+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureCustomerNames).length+";";for(const t in e.failureCustomerNames)s+="< "+t+": "+e.failureCustomerNames[t]+" >";f.alert(s),r.value=!1,d.value=!1,N("success")},F=()=>{f.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),r.value=!1},z=async()=>{var a;p.value=[],v.value=!1,c.value=void 0,await ae(),(a=g.value)==null||a.clearFiles()},S=()=>{f.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},I=async()=>{const a=await q();A.excel(a,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const s=G,t=H,O=Q,j=J,D=T,E=W,C=X,K=L;return y(),b(K,{modelValue:i(d),"onUpdate:modelValue":e[4]||(e[4]=l=>_(d)?d.value=l:null),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:o(()=>[n(C,{disabled:i(r),type:"primary",onClick:U},{default:o(()=>e[10]||(e[10]=[x("\u786E \u5B9A")])),_:1},8,["disabled"]),n(C,{onClick:e[3]||(e[3]=l=>d.value=!1)},{default:o(()=>e[11]||(e[11]=[x("\u53D6 \u6D88")])),_:1})]),default:o(()=>[m("div",le,[e[5]||(e[5]=m("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1)),n(t,{modelValue:i(c),"onUpdate:modelValue":e[0]||(e[0]=l=>_(c)?c.value=l:null),class:"!w-240px",clearable:""},{default:o(()=>[(y(!0),Z($,null,ee(i(w),l=>(y(),b(s,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n(E,{ref_key:"uploadRef",ref:g,"file-list":i(p),"onUpdate:fileList":e[2]||(e[2]=l=>_(p)?p.value=l:null),"auto-upload":!1,disabled:i(r),limit:1,"on-exceed":S,accept:".xlsx, .xls",action:"none",drag:""},{tip:o(()=>[m("div",se,[m("div",te,[n(j,{modelValue:i(v),"onUpdate:modelValue":e[1]||(e[1]=l=>_(v)?v.value=l:null)},null,8,["modelValue"]),e[6]||(e[6]=x(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 "))]),e[8]||(e[8]=m("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),n(D,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:I},{default:o(()=>e[7]||(e[7]=[x(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:o(()=>[n(O,{icon:"ep:upload"}),e[9]||(e[9]=m("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),m("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}}});export{oe as _};
