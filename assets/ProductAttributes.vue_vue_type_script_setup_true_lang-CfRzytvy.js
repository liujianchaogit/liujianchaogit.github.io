import{p as H,b as J,d as N}from"./index-C1TKk8vI.js";import{x as T,r as p,c as X,f as Y,z as P,a4 as z,u as f,M as A,y as v,E as D,F as r,C as V,O as d,K as y,L as B,G as R,P as j,l as Z,a5 as g}from"./form-create-7GAbgMwl.js";import{c as aa,b as ea}from"./property-Jm61HwC0.js";import{a7 as la,a6 as sa,Q as ua,x as ta,f as na,W as oa,j as ia}from"./form-designer-BpYekVAY.js";const ra=T({name:"ProductAttributes",__name:"ProductAttributes",props:{propertyList:{type:Array,default:()=>{}},isDetail:H.bool.def(!1)},emits:["success"],setup(b,{emit:E}){const{t:F}=J(),_=N(),s=p(""),c=p(null),K=X(()=>a=>c.value!==null&&(c.value===a||void 0)),C=p([]),G=a=>{a!=null&&(C.value.some(l=>{var o,t;return((o=l.inputRef)==null?void 0:o.attributes.id)===((t=a.inputRef)==null?void 0:t.attributes.id)})||C.value.push(a))},u=p([]),w=p([]),I=b;Y(()=>I.propertyList,a=>{a&&(u.value=a)},{deep:!0,immediate:!0});const x=E,h=async(a,l)=>{if(s.value){if(u.value[a].values.find(t=>t.name===s.value))return _.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u5C5E\u6027\u503C\uFF0C\u8BF7\u91CD\u8BD5"),c.value=null,void(s.value="");const o=w.value.find(t=>t.name===s.value);if(o)return c.value=null,s.value="",u.value[a].values.push({id:o.id,name:o.name}),void x("success",u.value);try{const t=await aa({propertyId:l,name:s.value});u.value[a].values.push({id:t,name:s.value}),_.success(F("common.createSuccess")),x("success",u.value)}catch{_.error("\u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}c.value=null,s.value=""},M=async a=>{w.value=await ea(a)};return(a,l)=>{const o=la,t=sa,O=ua,Q=ta,S=na,q=oa,U=ia;return v(!0),P(A,null,z(f(u),(m,n)=>(v(),D(U,{key:n},{default:r(()=>[V("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[1]||(l[1]=[y("\u5C5E\u6027\u540D\uFF1A")])),_:1}),d(t,{closable:!b.isDetail,class:"mx-1",type:"success",onClose:e=>(i=>{var k;(k=u.value)==null||k.splice(i,1),x("success",u.value)})(n)},{default:r(()=>[y(B(m.name),1)]),_:2},1032,["closable","onClose"])]),V("div",null,[d(o,{class:"mx-1"},{default:r(()=>l[2]||(l[2]=[y("\u5C5E\u6027\u503C\uFF1A")])),_:1}),(v(!0),P(A,null,z(m.values,(e,i)=>(v(),D(t,{key:e.id,closable:!b.isDetail,class:"mx-1",onClose:k=>((W,$)=>{var L;(L=u.value[W].values)==null||L.splice($,1)})(n,i)},{default:r(()=>[y(B(e.name),1)]),_:2},1032,["closable","onClose"]))),128)),R(d(Q,{id:`input${n}`,ref_for:!0,ref:G,modelValue:f(s),"onUpdate:modelValue":l[0]||(l[0]=e=>Z(s)?s.value=e:null),"reserve-keyword":!1,"allow-create":"",class:"!w-30","default-first-option":"",filterable:"",size:"small",onBlur:e=>h(n,m.id),onChange:e=>h(n,m.id),onKeyup:g(e=>h(n,m.id),["enter"])},{default:r(()=>[(v(!0),P(A,null,z(f(w),e=>(v(),D(O,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:2},1032,["id","modelValue","onBlur","onChange","onKeyup"]),[[j,f(K)(n)]]),R(d(S,{class:"button-new-tag ml-1",size:"small",onClick:e=>(async i=>{c.value=i,C.value[i].focus(),await M(u.value[i].id)})(n)},{default:r(()=>l[3]||(l[3]=[y(" + \u6DFB\u52A0 ")])),_:2},1032,["onClick"]),[[j,!f(K)(n)]])]),d(q,{class:"my-10px"})]),_:2},1024))),128)}}});export{ra as _};
