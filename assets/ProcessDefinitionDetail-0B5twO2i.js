import{u as Q,d as Y,_ as Z,c as ee}from"./index-C1TKk8vI.js";import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{d as ie,b as oe}from"./formCreate-DNZv5C32.js";import{a as j,B as te}from"./constants-IYPHa1Ih.js";import{N as le,C as se,F as h}from"./consts-D6_WKT2v.js";import re from"./ProcessInstanceBpmnViewer-CPqCMmGq.js";import{_ as ne}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-CkpBAPzO.js";import{_ as me}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-t8BTVj8T.js";import{u as pe}from"./tagsView-C2oS-OQq.js";import{g as ue,f as ce}from"./index-C52Al6V4.js";import{a as de}from"./index-CxCrYW_I.js";import{W as fe,j as ve,i as ye,e as be,a0 as _e,a1 as Se,f as De,aj as Pe}from"./form-designer-BpYekVAY.js";import{x as he,r as m,f as xe,ae as ge,y as v,E as x,F as n,C as _,O as o,L as we,u as t,l as A,G as Ce,z as U,J as g,K as F,n as Ee}from"./form-create-7GAbgMwl.js";import"./bpmn-embedded-CLKwycJq.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./XTextButton-BjjL95Dk.js";import"./XButton-we2I6miX.js";import"./index-DREge7zO.js";import"./index-CZiMqbPE.js";import"./node-Do_BcwVI.js";import"./index-DwSWB2Hs.js";import"./index-BCN8BzfC.js";import"./utils-QiRL3TXx.js";import"./index-BwT0n6gf.js";import"./tree-COGD3qag.js";import"./index-BtHQyrBm.js";import"./index-B0Mya_PA.js";import"./index-CYJDvQdV.js";import"./index-DbP8QQV-.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./index-D2S4HpRp.js";import"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import"./color-BN7ZL7BD.js";import"./index-DMrIORbd.js";import"./formatTime-EbFUBcAO.js";import"./simple-process-designer-DWOFOAFc.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-C6CtoOwH.js";import"./index-j0g2sdlj.js";import"./download-oWiM5xVU.js";import"./index-vcegfSq2.js";const Ve={class:"processInstance-wrap-main"},Ie={class:"text-#878c93 h-15px"},Ne={class:"form-scroll-area"},Re={class:"form-scroll-area"},Te={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},ke={key:0,class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},Oe=ee(he({name:"ProcessDefinitionDetail",__name:"ProcessDefinitionDetail",props:{selectProcessDefinition:{}},emits:["cancel"],setup(M,{expose:L,emit:B}){const S=M,J=B,D=m(!1),{push:w,currentRoute:W}=Q(),P=Y(),{delView:z}=pe(),c=m({rule:[],option:{},value:{}}),p=m(),d=m([]),u=m({}),y=m({}),C=m(null),E=m(),b=m("form"),V=m([]);xe(c.value,a=>{a&&Object.keys(a.value).length>0&&(y.value=u.value,u.value={},I({id:S.selectProcessDefinition.id,processVariablesStr:JSON.stringify(a.value)}))},{immediate:!0});const I=async a=>{var e,s;try{const r=await ue({processDefinitionId:a.id,activityId:le.START_USER_NODE_ID,processVariablesStr:a.processVariablesStr});if(!r)return void P.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(V.value=r.activityNodes,d.value=(e=r.activityNodes)==null?void 0:e.filter(i=>se.START_USER_SELECT===i.candidateStrategy),((s=d.value)==null?void 0:s.length)>0)for(const i of d.value)y.value[i.id]&&y.value[i.id].length>0?u.value[i.id]=y.value[i.id]:u.value[i.id]=[];const l=r.formFieldsPermission;l&&Object.keys(l).forEach(i=>{G(i,l[i])})}finally{}},G=(a,e)=>{var s,r,l;e===h.READ&&((s=p.value)==null||s.disabled(!0,a)),e===h.WRITE&&((r=p.value)==null||r.disabled(!1,a)),e===h.NONE&&((l=p.value)==null||l.hidden(!0,a))},N=async()=>{var a;if(p.value&&S.selectProcessDefinition){if(await p.value.validate(),((a=d.value)==null?void 0:a.length)>0){for(const e of d.value)if(Array.isArray(u.value[e.id])&&u.value[e.id].length===0)return P.warning(`\u8BF7\u9009\u62E9${e.name}\u7684\u5019\u9009\u4EBA`)}D.value=!0;try{await ce({processDefinitionId:S.selectProcessDefinition.id,variables:c.value.value,startUserSelectAssignees:u.value}),P.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),z(t(W)),await w({name:"BpmProcessInstanceMy"})}finally{D.value=!1}}},K=()=>{J("cancel")},X=(a,e)=>{u.value[a]=e==null?void 0:e.map(s=>s.id)};return L({initProcessInfo:async(a,e)=>{var s;if(d.value=[],u.value={},a.formType==te.NORMAL){const r=ie(a.formFields).map(i=>i.field);for(const i in e)r.includes(i)||delete e[i];oe(c,a.formConf,a.formFields,e),await Ee(),(s=p.value)==null||s.btn.show(!1),await I({id:a.id,processVariablesStr:JSON.stringify(e)});const l=await de(a.id);l&&(C.value=l.bpmnXml,E.value=l.simpleModel)}else a.formCustomCreatePath&&await w({path:a.formCustomCreatePath})}}),(a,e)=>{const s=fe,r=ge("form-create"),l=ve,i=ye,R=be,T=_e,$=Se,k=Z,O=De,q=ae,H=Pe;return v(),x(q,{bodyStyle:{padding:"10px 20px 0"}},{default:n(()=>[_("div",Ve,[o(R,null,{default:n(()=>[_("div",Ie,"\u6D41\u7A0B\uFF1A"+we(a.selectProcessDefinition.name),1),o(s,{class:"!my-8px"}),o($,{modelValue:t(b),"onUpdate:modelValue":e[2]||(e[2]=f=>A(b)?b.value=f:null)},{default:n(()=>[o(T,{label:"\u8868\u5355\u586B\u5199",name:"form"},{default:n(()=>[Ce((v(),U("div",Ne,[o(R,null,{default:n(()=>[o(i,null,{default:n(()=>[o(l,{span:17},{default:n(()=>[o(r,{rule:t(c).rule,api:t(p),"onUpdate:api":e[0]||(e[0]=f=>A(p)?p.value=f:null),modelValue:t(c).value,"onUpdate:modelValue":e[1]||(e[1]=f=>t(c).value=f),option:t(c).option,onSubmit:N},null,8,["rule","api","modelValue","option"])]),_:1}),o(l,{span:6,offset:1},{default:n(()=>[o(me,{ref:"timelineRef","activity-nodes":t(V),"show-status-icon":!1,onSelectUserConfirm:X},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])),[[H,t(D)]])]),_:1}),o(T,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:n(()=>[_("div",Re,[t(j).BPMN===a.selectProcessDefinition.modelType?(v(),x(re,{key:0,"bpmn-xml":t(C)},null,8,["bpmn-xml"])):g("",!0),t(j).SIMPLE===a.selectProcessDefinition.modelType?(v(),x(ne,{key:1,"simple-json":t(E)},null,8,["simple-json"])):g("",!0)])]),_:1})]),_:1},8,["modelValue"]),_("div",Te,[t(b)==="form"?(v(),U("div",ke,[o(O,{plain:"",type:"success",onClick:N},{default:n(()=>[o(k,{icon:"ep:select"}),e[3]||(e[3]=F("\xA0 \u53D1\u8D77 "))]),_:1}),o(O,{plain:"",type:"danger",onClick:K},{default:n(()=>[o(k,{icon:"ep:close"}),e[4]||(e[4]=F("\xA0 \u53D6\u6D88 "))]),_:1})])):g("",!0)])]),_:1})])]),_:1})}}}),[["__scopeId","data-v-7496937a"]]);export{Oe as default};
