import{a as W,d as j,Y as B,az as H}from"./index-DiGvuAxb.js";import{_ as Q}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{D as y}from"./index-4TQdK-Zm.js";import{D as R}from"./index-DvyuJUgN.js";import{D as z,P as J}from"./index-y2Iw13c9.js";import{h as M,ai as O,x as X,Q as ee,k as le,f as ae,aa as de,ab as ie,aj as ue}from"./form-designer-drfGvdgz.js";import{k as oe,r as t,P as re,y as f,m as s,z as i,A as te,u as l,H as u,C as se,l as k,G as D,$ as I,E as w,h as ce}from"./form-create-D7wT855o.js";const me=oe({name:"IoTDeviceForm",__name:"DeviceForm",emits:["success"],setup(pe,{expose:x,emit:C}){const{t:g}=W(),N=j(),p=t(!1),U=t(""),v=t(!1),n=t(""),d=t({id:void 0,productId:void 0,deviceKey:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,groupIds:[]}),S=re({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],deviceKey:[{required:!0,message:"DeviceKey \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"DeviceKey \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u548C\u6570\u5B57",trigger:"blur"}],deviceName:[{required:!0,message:"DeviceName \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{pattern:/^[a-zA-Z0-9_.\-:@]{4,32}$/,message:"\u652F\u6301\u82F1\u6587\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\uFF08_\uFF09\u3001\u4E2D\u5212\u7EBF\uFF08-\uFF09\u3001\u70B9\u53F7\uFF08.\uFF09\u3001\u534A\u89D2\u5192\u53F7\uFF08:\uFF09\u548C\u7279\u6B8A\u5B57\u7B26@\uFF0C\u957F\u5EA6\u9650\u5236\u4E3A 4~32 \u4E2A\u5B57\u7B26",trigger:"blur"}],nickname:[{validator:(o,e,r)=>{if(e==null)return void r();const c=e.replace(/[\u4e00-\u9fa5\u3040-\u30ff]/g,"aa").length;c<4||c>64?r(new Error("\u5907\u6CE8\u540D\u79F0\u957F\u5EA6\u9650\u5236\u4E3A 4~64 \u4E2A\u5B57\u7B26\uFF0C\u4E2D\u6587\u53CA\u65E5\u6587\u7B97 2 \u4E2A\u5B57\u7B26")):/^[\u4e00-\u9fa5\u3040-\u30ff_a-zA-Z0-9]+$/.test(e)?r():r(new Error("\u5907\u6CE8\u540D\u79F0\u53EA\u80FD\u5305\u542B\u4E2D\u6587\u3001\u82F1\u6587\u5B57\u6BCD\u3001\u65E5\u6587\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\uFF08_\uFF09"))},trigger:"blur"}],serialNumber:[{pattern:/^[a-zA-Z0-9-_]+$/,message:"\u5E8F\u5217\u53F7\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E2D\u5212\u7EBF\u548C\u4E0B\u5212\u7EBF",trigger:"blur"}]}),_=t(),V=t([]),K=t([]),A=t([]);x({open:async(o,e)=>{if(p.value=!0,U.value=g("action."+o),n.value=o,G(),e){v.value=!0;try{d.value=await y.getDevice(e)}finally{v.value=!1}}else T();try{K.value=await y.getSimpleDeviceList(z.GATEWAY)}catch{}V.value=await J.getSimpleProductList();try{A.value=await R.getSimpleDeviceGroupList()}catch{}}});const E=C,$=async()=>{await _.value.validate(),v.value=!0;try{const o=d.value;n.value==="create"?(await y.createDevice(o),N.success(g("common.createSuccess"))):(await y.updateDevice(o),N.success(g("common.updateSuccess"))),p.value=!1,E("success")}finally{v.value=!1}},G=()=>{var o;d.value={id:void 0,productId:void 0,deviceKey:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,groupIds:[]},(o=_.value)==null||o.resetFields()},Z=o=>{var r;if(!o)return void(d.value.deviceType=void 0);const e=(r=V.value)==null?void 0:r.find(c=>c.id===o);d.value.deviceType=e==null?void 0:e.deviceType},T=()=>{d.value.deviceKey=H(16)};return(o,e)=>{const r=ee,c=X,m=O,h=ae,b=le,q=ie,F=de,L=M,P=Q,Y=ue;return s(),f(P,{title:l(U),modelValue:l(p),"onUpdate:modelValue":e[9]||(e[9]=a=>ce(p)?p.value=a:null)},{footer:i(()=>[u(h,{onClick:$,type:"primary",disabled:l(v)},{default:i(()=>e[11]||(e[11]=[w("\u786E \u5B9A")])),_:1},8,["disabled"]),u(h,{onClick:e[8]||(e[8]=a=>p.value=!1)},{default:i(()=>e[12]||(e[12]=[w("\u53D6 \u6D88")])),_:1})]),default:i(()=>[te((s(),f(L,{ref_key:"formRef",ref:_,model:l(d),rules:l(S),"label-width":"100px"},{default:i(()=>[u(m,{label:"\u4EA7\u54C1",prop:"productId"},{default:i(()=>[u(c,{modelValue:l(d).productId,"onUpdate:modelValue":e[0]||(e[0]=a=>l(d).productId=a),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",disabled:l(n)==="update",clearable:"",onChange:Z},{default:i(()=>[(s(!0),k(D,null,I(l(V),a=>(s(),f(r,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u(m,{label:"DeviceKey",prop:"deviceKey"},{default:i(()=>[u(b,{modelValue:l(d).deviceKey,"onUpdate:modelValue":e[1]||(e[1]=a=>l(d).deviceKey=a),placeholder:"\u8BF7\u8F93\u5165 DeviceKey",disabled:l(n)==="update"},{append:i(()=>[u(h,{onClick:T,disabled:l(n)==="update"},{default:i(()=>e[10]||(e[10]=[w(" \u91CD\u65B0\u751F\u6210 ")])),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"])]),_:1}),u(m,{label:"DeviceName",prop:"deviceName"},{default:i(()=>[u(b,{modelValue:l(d).deviceName,"onUpdate:modelValue":e[2]||(e[2]=a=>l(d).deviceName=a),placeholder:"\u8BF7\u8F93\u5165 DeviceName",disabled:l(n)==="update"},null,8,["modelValue","disabled"])]),_:1}),l(d).deviceType===l(z).GATEWAY_SUB?(s(),f(m,{key:0,label:"\u7F51\u5173\u8BBE\u5907",prop:"gatewayId"},{default:i(()=>[u(c,{modelValue:l(d).gatewayId,"onUpdate:modelValue":e[3]||(e[3]=a=>l(d).gatewayId=a),placeholder:"\u5B50\u8BBE\u5907\u53EF\u9009\u62E9\u7236\u8BBE\u5907",clearable:""},{default:i(()=>[(s(!0),k(D,null,I(l(K),a=>(s(),f(r,{key:a.id,label:a.nickname||a.deviceName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):se("",!0),u(F,null,{default:i(()=>[u(q,{title:"\u66F4\u591A\u914D\u7F6E"},{default:i(()=>[u(m,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:i(()=>[u(b,{modelValue:l(d).nickname,"onUpdate:modelValue":e[4]||(e[4]=a=>l(d).nickname=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u56FE\u7247",prop:"picUrl"},{default:i(()=>[u(l(B),{modelValue:l(d).picUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>l(d).picUrl=a),height:"120px",width:"120px"},null,8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupIds"},{default:i(()=>[u(c,{modelValue:l(d).groupIds,"onUpdate:modelValue":e[6]||(e[6]=a=>l(d).groupIds=a),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",multiple:"",clearable:""},{default:i(()=>[(s(!0),k(D,null,I(l(A),a=>(s(),f(r,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u5E8F\u5217\u53F7",prop:"serialNumber"},{default:i(()=>[u(b,{modelValue:l(d).serialNumber,"onUpdate:modelValue":e[7]||(e[7]=a=>l(d).serialNumber=a),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907\u5E8F\u5217\u53F7"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Y,l(v)]])]),_:1},8,["title","modelValue"])}}});export{me as _};
