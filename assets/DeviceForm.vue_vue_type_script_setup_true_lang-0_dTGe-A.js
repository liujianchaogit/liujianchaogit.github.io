import{X,b as Y,d as j,az as B}from"./index-C1TKk8vI.js";import{_ as J}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{D as y}from"./index-DR2HTwYi.js";import{D as M}from"./index-BAzhGSOD.js";import{D as x,P as O}from"./index-DDlNWlg-.js";import{Q,x as R,ai as H,f as ee,k as ae,ac as le,ab as de,h as ie,aj as ue}from"./form-designer-BpYekVAY.js";import{x as oe,r as t,X as re,y as s,E as b,F as i,O as u,K as I,u as a,G as te,z as h,a4 as k,M as w,J as se,l as ce}from"./form-create-7GAbgMwl.js";const me=oe({name:"IoTDeviceForm",__name:"DeviceForm",emits:["success"],setup(pe,{expose:z,emit:E}){const{t:g}=Y(),N=j(),p=t(!1),U=t(""),v=t(!1),n=t(""),d=t({id:void 0,productId:void 0,deviceKey:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,groupIds:[]}),S=re({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],deviceKey:[{required:!0,message:"DeviceKey \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"DeviceKey \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u548C\u6570\u5B57",trigger:"blur"}],deviceName:[{required:!0,message:"DeviceName \u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{pattern:/^[a-zA-Z0-9_.\-:@]{4,32}$/,message:"\u652F\u6301\u82F1\u6587\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\uFF08_\uFF09\u3001\u4E2D\u5212\u7EBF\uFF08-\uFF09\u3001\u70B9\u53F7\uFF08.\uFF09\u3001\u534A\u89D2\u5192\u53F7\uFF08:\uFF09\u548C\u7279\u6B8A\u5B57\u7B26@\uFF0C\u957F\u5EA6\u9650\u5236\u4E3A 4~32 \u4E2A\u5B57\u7B26",trigger:"blur"}],nickname:[{validator:(o,e,r)=>{if(e==null)return void r();const c=e.replace(/[\u4e00-\u9fa5\u3040-\u30ff]/g,"aa").length;c<4||c>64?r(new Error("\u5907\u6CE8\u540D\u79F0\u957F\u5EA6\u9650\u5236\u4E3A 4~64 \u4E2A\u5B57\u7B26\uFF0C\u4E2D\u6587\u53CA\u65E5\u6587\u7B97 2 \u4E2A\u5B57\u7B26")):/^[\u4e00-\u9fa5\u3040-\u30ff_a-zA-Z0-9]+$/.test(e)?r():r(new Error("\u5907\u6CE8\u540D\u79F0\u53EA\u80FD\u5305\u542B\u4E2D\u6587\u3001\u82F1\u6587\u5B57\u6BCD\u3001\u65E5\u6587\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\uFF08_\uFF09"))},trigger:"blur"}],serialNumber:[{pattern:/^[a-zA-Z0-9-_]+$/,message:"\u5E8F\u5217\u53F7\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E2D\u5212\u7EBF\u548C\u4E0B\u5212\u7EBF",trigger:"blur"}]}),_=t(),V=t([]),K=t([]),T=t([]);z({open:async(o,e)=>{if(p.value=!0,U.value=g("action."+o),n.value=o,G(),e){v.value=!0;try{d.value=await y.getDevice(e)}finally{v.value=!1}}else A();try{K.value=await y.getSimpleDeviceList(x.GATEWAY)}catch{}V.value=await O.getSimpleProductList();try{T.value=await M.getSimpleDeviceGroupList()}catch{}}});const C=E,F=async()=>{await _.value.validate(),v.value=!0;try{const o=d.value;n.value==="create"?(await y.createDevice(o),N.success(g("common.createSuccess"))):(await y.updateDevice(o),N.success(g("common.updateSuccess"))),p.value=!1,C("success")}finally{v.value=!1}},G=()=>{var o;d.value={id:void 0,productId:void 0,deviceKey:void 0,deviceName:void 0,nickname:void 0,picUrl:void 0,gatewayId:void 0,deviceType:void 0,serialNumber:void 0,groupIds:[]},(o=_.value)==null||o.resetFields()},Z=o=>{var r;if(!o)return void(d.value.deviceType=void 0);const e=(r=V.value)==null?void 0:r.find(c=>c.id===o);d.value.deviceType=e==null?void 0:e.deviceType},A=()=>{d.value.deviceKey=B(16)};return(o,e)=>{const r=Q,c=R,m=H,D=ee,f=ae,$=le,q=de,L=ie,P=J,W=ue;return s(),b(P,{title:a(U),modelValue:a(p),"onUpdate:modelValue":e[9]||(e[9]=l=>ce(p)?p.value=l:null)},{footer:i(()=>[u(D,{onClick:F,type:"primary",disabled:a(v)},{default:i(()=>e[11]||(e[11]=[I("\u786E \u5B9A")])),_:1},8,["disabled"]),u(D,{onClick:e[8]||(e[8]=l=>p.value=!1)},{default:i(()=>e[12]||(e[12]=[I("\u53D6 \u6D88")])),_:1})]),default:i(()=>[te((s(),b(L,{ref_key:"formRef",ref:_,model:a(d),rules:a(S),"label-width":"100px"},{default:i(()=>[u(m,{label:"\u4EA7\u54C1",prop:"productId"},{default:i(()=>[u(c,{modelValue:a(d).productId,"onUpdate:modelValue":e[0]||(e[0]=l=>a(d).productId=l),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",disabled:a(n)==="update",clearable:"",onChange:Z},{default:i(()=>[(s(!0),h(w,null,k(a(V),l=>(s(),b(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u(m,{label:"DeviceKey",prop:"deviceKey"},{default:i(()=>[u(f,{modelValue:a(d).deviceKey,"onUpdate:modelValue":e[1]||(e[1]=l=>a(d).deviceKey=l),placeholder:"\u8BF7\u8F93\u5165 DeviceKey",disabled:a(n)==="update"},{append:i(()=>[u(D,{onClick:A,disabled:a(n)==="update"},{default:i(()=>e[10]||(e[10]=[I(" \u91CD\u65B0\u751F\u6210 ")])),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"])]),_:1}),u(m,{label:"DeviceName",prop:"deviceName"},{default:i(()=>[u(f,{modelValue:a(d).deviceName,"onUpdate:modelValue":e[2]||(e[2]=l=>a(d).deviceName=l),placeholder:"\u8BF7\u8F93\u5165 DeviceName",disabled:a(n)==="update"},null,8,["modelValue","disabled"])]),_:1}),a(d).deviceType===a(x).GATEWAY_SUB?(s(),b(m,{key:0,label:"\u7F51\u5173\u8BBE\u5907",prop:"gatewayId"},{default:i(()=>[u(c,{modelValue:a(d).gatewayId,"onUpdate:modelValue":e[3]||(e[3]=l=>a(d).gatewayId=l),placeholder:"\u5B50\u8BBE\u5907\u53EF\u9009\u62E9\u7236\u8BBE\u5907",clearable:""},{default:i(()=>[(s(!0),h(w,null,k(a(K),l=>(s(),b(r,{key:l.id,label:l.nickname||l.deviceName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):se("",!0),u(q,null,{default:i(()=>[u($,{title:"\u66F4\u591A\u914D\u7F6E"},{default:i(()=>[u(m,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:i(()=>[u(f,{modelValue:a(d).nickname,"onUpdate:modelValue":e[4]||(e[4]=l=>a(d).nickname=l),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u56FE\u7247",prop:"picUrl"},{default:i(()=>[u(a(X),{modelValue:a(d).picUrl,"onUpdate:modelValue":e[5]||(e[5]=l=>a(d).picUrl=l),height:"120px",width:"120px"},null,8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u5206\u7EC4",prop:"groupIds"},{default:i(()=>[u(c,{modelValue:a(d).groupIds,"onUpdate:modelValue":e[6]||(e[6]=l=>a(d).groupIds=l),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u5206\u7EC4",multiple:"",clearable:""},{default:i(()=>[(s(!0),h(w,null,k(a(T),l=>(s(),b(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(m,{label:"\u8BBE\u5907\u5E8F\u5217\u53F7",prop:"serialNumber"},{default:i(()=>[u(f,{modelValue:a(d).serialNumber,"onUpdate:modelValue":e[7]||(e[7]=l=>a(d).serialNumber=l),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907\u5E8F\u5217\u53F7"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[W,a(v)]])]),_:1},8,["title","modelValue"])}}});export{me as _};
