import{B as We,u as Ze,d as el,L as pe,_ as ll,c as al}from"./index-C1TKk8vI.js";import{b as sl}from"./formCreate-DNZv5C32.js";import{a as rl,b as tl,r as il,c as nl,t as ol,d as dl,s as ul,e as cl,f as pl,T as fl}from"./index-DwSWB2Hs.js";import{d as ml,e as gl}from"./index-C52Al6V4.js";import{O as m,C as Ee,b as vl,a as bl}from"./consts-D6_WKT2v.js";import{B as yl,e as fe}from"./constants-IYPHa1Ih.js";import{_ as xl}from"./SignDialog.vue_vue_type_script_setup_true_lang-am84u5wT.js";import{_ as kl}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-t8BTVj8T.js";import{f as _l,ad as hl,k as wl,ai as Ul,ak as Il,h as Rl,n as Vl,Q as Sl,x as Cl,aj as El}from"./form-designer-BpYekVAY.js";import{x as Tl,r as v,X as x,c as Te,f as Al,y as n,z as y,C as R,u as l,E as b,F as a,O as s,K as c,L as k,G as A,l as Fl,J as h,M as Y,a4 as H,ae as Pl}from"./form-create-7GAbgMwl.js";import"./download-oWiM5xVU.js";import"./index-vcegfSq2.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import"./tree-COGD3qag.js";import"./index-B0Mya_PA.js";import"./index-CZiMqbPE.js";import"./formatTime-EbFUBcAO.js";const Dl={class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},Ol={class:"flex flex-col flex-1 pt-20px px-20px"},Nl={class:"el-icon-picture-outline"},ql={class:"ml-10px -mt-15px -mb-35px"},jl={class:"flex flex-col flex-1 pt-20px px-20px"},Kl={class:"flex flex-col flex-1 pt-20px px-20px"},zl={class:"flex flex-col flex-1 pt-20px px-20px"},Gl={class:"flex flex-col flex-1 pt-20px px-20px"},Ll={class:"flex flex-col flex-1 pt-20px px-20px"},Bl={class:"flex flex-col flex-1 pt-20px px-20px"},Jl={class:"flex flex-col flex-1 pt-20px px-20px"},$l={class:"flex flex-col flex-1 pt-20px px-20px"},Yl=al(Tl({name:"ProcessInstanceBtnContainer",__name:"ProcessInstanceOperationButton",props:{processInstance:{},processDefinition:{},userOptions:{},normalForm:{},normalFormApi:{},writableFields:{}},emits:["success"],setup(Ae,{expose:Fe,emit:Pe}){const De=Ze(),w=el(),me=We().getUser.id,Oe=Pe,D=Ae,o=v(!1),g=v({approve:!1,reject:!1,transfer:!1,delegate:!1,addSign:!1,return:!1,copy:!1,cancel:!1,deleteSign:!1}),oe=v([]),u=v(),F=v({}),M=v({}),te=v("\u5BA1\u6279"),de=v(),ue=v(),ge=v(),ve=v(),O=v([]),U=x({reason:"",signPicUrl:"",nextAssignees:{}}),Ne=Te(()=>({reason:[{required:de.value,message:te+"\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],signPicUrl:[{required:!0,message:"\u7B7E\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],nextAssignees:[{required:!0,message:"\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]})),ce=v(),ie=x({reason:""}),qe=Te(()=>({reason:[{required:de.value,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]})),W=v(),N=x({copyUserIds:[],copyReason:""}),je=x({copyUserIds:[{required:!0,message:"\u6284\u9001\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),Z=v(),q=x({assigneeUserId:void 0,reason:""}),Ke=x({assigneeUserId:[{required:!0,message:"\u65B0\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),ee=v(),j=x({delegateUserId:void 0,reason:""}),ze=x({delegateUserId:[{required:!0,message:"\u63A5\u6536\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),le=v(),K=x({addSignUserIds:void 0,reason:""}),Ge=x({addSignUserIds:[{required:!0,message:"\u52A0\u7B7E\u5904\u7406\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),ae=v(),z=x({deleteSignTaskId:void 0,reason:""}),Le=x({deleteSignTaskId:[{required:!0,message:"\u51CF\u7B7E\u4EBA\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],reason:[{required:!0,message:"\u5BA1\u6279\u610F\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),se=v(),G=x({targetTaskDefinitionKey:void 0,returnReason:""}),Be=x({targetTaskDefinitionKey:[{required:!0,message:"\u9000\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],returnReason:[{required:!0,message:"\u9000\u56DE\u7406\u7531\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),re=v(),ne=x({cancelReason:""}),Je=x({cancelReason:[{required:!0,message:"\u53D6\u6D88\u7406\u7531\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]});Al(()=>M.value,r=>{var e,i;(e=r==null?void 0:r.btn)==null||e.show(!1),(i=r==null?void 0:r.resetBtn)==null||i.show(!1)},{deep:!0});const V=async r=>{if(r==="approve"){if(!await ke())return void w.warning("\u8868\u5355\u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u8BF7\u5148\u5B8C\u5584\u8868\u5355!!");$e()}r!=="return"||(oe.value=await rl(u.value.id),oe.value.length!==0)?Object.keys(g.value).forEach(e=>{g.value[e]=e===r}):w.warning("\u5F53\u524D\u6CA1\u6709\u53EF\u9000\u56DE\u7684\u8282\u70B9")},S=(r,e)=>{e&&e.resetFields(),g.value[r]=!1,O.value=[]},$e=async()=>{const r=_e(),e=await ml({processInstanceId:D.processInstance.id,taskId:u.value.id,processVariablesStr:JSON.stringify(r)});e&&e.length>0&&e.forEach(i=>{(pe(i.tasks)&&pe(i.candidateUsers)&&Ee.START_USER_SELECT===i.candidateStrategy||Ee.APPROVE_USER_SELECT===i.candidateStrategy)&&O.value.push(i)})},Ye=(r,e)=>{U.nextAssignees[r]=e==null?void 0:e.map(i=>i.id)},be=async(r,e)=>{var i;o.value=!0;try{if(!e)return;if(await e.validate(),!await ke())return void w.warning("\u8868\u5355\u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u8BF7\u5148\u5B8C\u5584\u8868\u5355!!");if(r){if(!(()=>{if(Object.keys(O.value).length===0)return!0;for(const I of O.value)if(pe(U.nextAssignees[I.id]))return w.warning("\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684\u5BA1\u6279\u4EBA\u4E0D\u80FD\u4E3A\u7A7A!"),!1;return!0})())return;const d=_e(),P={id:u.value.id,reason:U.reason,variables:d,nextAssignees:U.nextAssignees};u.value.signEnable&&(P.signPicUrl=U.signPicUrl);const $=M.value;((i=Object.keys($))==null?void 0:i.length)>0&&(await $.validate(),P.variables=F.value.value),await tl(P),g.value.approve=!1,O.value=[],w.success("\u5BA1\u6279\u901A\u8FC7\u6210\u529F")}else{const d={id:u.value.id,reason:ie.reason};await il(d),g.value.reject=!1,w.success("\u5BA1\u6279\u4E0D\u901A\u8FC7\u6210\u529F")}e.resetFields(),L()}finally{o.value=!1}},Me=async()=>{o.value=!0;try{if(!W.value)return;await W.value.validate();const r={id:u.value.id,reason:N.copyReason,copyUserIds:N.copyUserIds};await nl(r),W.value.resetFields(),g.value.copy=!1,w.success("\u64CD\u4F5C\u6210\u529F")}finally{o.value=!1}},ye=async r=>{o.value=!0;try{if(!le.value)return;await le.value.validate();const e={id:u.value.id,type:r,reason:K.reason,userIds:K.addSignUserIds};await ul(e),w.success("\u64CD\u4F5C\u6210\u529F"),le.value.resetFields(),g.value.addSign=!1,L()}finally{o.value=!1}},Qe=r=>{var i,d,P,$;const e=((i=r==null?void 0:r.assigneeUser)==null?void 0:i.deptName)||((d=r==null?void 0:r.ownerUser)==null?void 0:d.deptName);return`${((P=r==null?void 0:r.assigneeUser)==null?void 0:P.nickname)||(($=r==null?void 0:r.ownerUser)==null?void 0:$.nickname)} ( \u6240\u5C5E\u90E8\u95E8\uFF1A${e} )`},L=()=>{Oe("success")},B=()=>{var e;let r=!1;return fl.RUNNING===((e=u.value)==null?void 0:e.status)&&(r=!0),r},xe=r=>{let e=!1;return fe.APPROVE!==r&&fe.REJECT!==r&&fe.CANCEL!==r||(e=!0),e},J=r=>{var i,d;let e=!0;return(i=u.value)!=null&&i.buttonsSetting&&((d=u.value)!=null&&d.buttonsSetting[r])&&(e=u.value.buttonsSetting[r].enable),e},_=r=>{var i,d;let e=vl.get(r);return(i=u.value)!=null&&i.buttonsSetting&&((d=u.value)!=null&&d.buttonsSetting[r])&&(e=u.value.buttonsSetting[r].displayName),e},ke=async()=>{var r,e;if(((r=D.processDefinition)==null?void 0:r.formType)===yl.NORMAL){let i=!0;try{await((e=D.normalFormApi)==null?void 0:e.validate())}catch{i=!1}return i}return!0},_e=()=>{const r={};return D.writableFields.forEach(e=>{r[e]=D.normalFormApi.getValue(e)}),r},Xe=r=>{U.signPicUrl=r,ve.value.validate("change")};return Fe({loadTodoTask:r=>{if(F.value={},u.value=r,M.value={},de.value=(r==null?void 0:r.reasonRequire)??!1,te.value=(r==null?void 0:r.nodeType)===bl.TRANSACTOR_NODE?"\u529E\u7406":"\u5BA1\u6279",r&&r.formId&&r.formConf){const e={};sl(e,r.formConf,r.formFields,r.formVariables),F.value=e}else F.value={}}}),(r,e)=>{var he,we,Ue,Ie,Re,Ve,Se,Ce;const i=ll,d=_l,P=Pl("form-create"),$=hl,I=wl,p=Ul,He=Il,C=Rl,E=Vl,Q=Sl,X=Cl,T=El;return n(),y(Y,null,[R("div",Dl,[l(u)&&B()&&J(l(m).APPROVE)?(n(),b(E,{key:0,visible:l(g).approve,placement:"top-end",width:420,trigger:"click"},{reference:a(()=>[s(d,{plain:"",type:"success",onClick:e[0]||(e[0]=t=>V("approve"))},{default:a(()=>[s(i,{icon:"ep:select"}),c("\xA0 "+k(_(l(m).APPROVE)),1)]),_:1})]),default:a(()=>[A((n(),y("div",Ol,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"approveFormRef",ref:ue,model:l(U),rules:l(Ne),"label-width":"100px"},{default:a(()=>{var t;return[((t=l(u))==null?void 0:t.formId)>0?(n(),b($,{key:0,class:"mb-15px !-mt-10px"},{header:a(()=>{var f;return[R("span",Nl," \u586B\u5199\u8868\u5355\u3010"+k((f=l(u))==null?void 0:f.formName)+"\u3011 ",1)]}),default:a(()=>[s(P,{modelValue:l(F).value,"onUpdate:modelValue":e[1]||(e[1]=f=>l(F).value=f),api:l(M),"onUpdate:api":e[2]||(e[2]=f=>Fl(M)?M.value=f:null),option:l(F).option,rule:l(F).rule},null,8,["modelValue","api","option","rule"])]),_:1})):h("",!0),s(p,{label:`${l(te)}\u610F\u89C1`,prop:"reason"},{default:a(()=>[s(I,{modelValue:l(U).reason,"onUpdate:modelValue":e[3]||(e[3]=f=>l(U).reason=f),placeholder:`\u8BF7\u8F93\u5165${l(te)}\u610F\u89C1`,type:"textarea",rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(O).length>0?(n(),b(p,{key:1,label:"\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684\u5BA1\u6279\u4EBA",prop:"nextAssignees"},{default:a(()=>[R("div",ql,[s(kl,{"activity-nodes":l(O),"show-status-icon":!1,onSelectUserConfirm:Ye},null,8,["activity-nodes"])])]),_:1})):h("",!0),l(u).signEnable?(n(),b(p,{key:2,label:"\u7B7E\u540D",prop:"signPicUrl",ref_key:"approveSignFormRef",ref:ve},{default:a(()=>[s(d,{onClick:e[4]||(e[4]=f=>l(ge).open())},{default:a(()=>e[46]||(e[46]=[c("\u70B9\u51FB\u7B7E\u540D")])),_:1}),l(U).signPicUrl?(n(),b(He,{key:0,class:"w-90px h-40px ml-5px",src:l(U).signPicUrl,"preview-src-list":[l(U).signPicUrl]},null,8,["src","preview-src-list"])):h("",!0)]),_:1},512)):h("",!0),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"success",onClick:e[5]||(e[5]=f=>be(!0,l(ue)))},{default:a(()=>[c(k(_(l(m).APPROVE)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[6]||(e[6]=f=>S("approve",l(ue)))},{default:a(()=>e[47]||(e[47]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]}),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).REJECT)?(n(),b(E,{key:1,visible:l(g).reject,placement:"top-end",width:420,trigger:"click"},{reference:a(()=>[s(d,{class:"mr-20px",plain:"",type:"danger",onClick:e[7]||(e[7]=t=>V("reject"))},{default:a(()=>[s(i,{icon:"ep:close"}),c("\xA0 "+k(_(l(m).REJECT)),1)]),_:1})]),default:a(()=>[A((n(),y("div",jl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"rejectFormRef",ref:ce,model:l(ie),rules:l(qe),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:a(()=>[s(I,{modelValue:l(ie).reason,"onUpdate:modelValue":e[8]||(e[8]=t=>l(ie).reason=t),placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"danger",onClick:e[9]||(e[9]=t=>be(!1,l(ce)))},{default:a(()=>[c(k(_(l(m).REJECT)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[10]||(e[10]=t=>S("reject",l(ce)))},{default:a(()=>e[48]||(e[48]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).COPY)?(n(),b(E,{key:2,visible:l(g).copy,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[11]||(e[11]=t=>V("copy")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"svg-icon:send"}),c("\xA0 "+k(_(l(m).COPY)),1)])]),default:a(()=>[A((n(),y("div",Kl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"copyFormRef",ref:W,model:l(N),rules:l(je),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u6284\u9001\u4EBA",prop:"copyUserIds"},{default:a(()=>[s(X,{modelValue:l(N).copyUserIds,"onUpdate:modelValue":e[12]||(e[12]=t=>l(N).copyUserIds=t),clearable:"",style:{width:"100%"},multiple:"",placeholder:"\u8BF7\u9009\u62E9\u6284\u9001\u4EBA"},{default:a(()=>[(n(!0),y(Y,null,H(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u6284\u9001\u610F\u89C1",prop:"copyReason"},{default:a(()=>[s(I,{modelValue:l(N).copyReason,"onUpdate:modelValue":e[13]||(e[13]=t=>l(N).copyReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6284\u9001\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:Me},{default:a(()=>[c(k(_(l(m).COPY)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[14]||(e[14]=t=>S("copy",l(W)))},{default:a(()=>e[49]||(e[49]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).TRANSFER)?(n(),b(E,{key:3,visible:l(g).transfer,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[15]||(e[15]=t=>V("transfer")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"fa:share-square-o"}),c("\xA0 "+k(_(l(m).TRANSFER)),1)])]),default:a(()=>[A((n(),y("div",zl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"transferFormRef",ref:Z,model:l(q),rules:l(Ke),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u65B0\u5BA1\u6279\u4EBA",prop:"assigneeUserId"},{default:a(()=>[s(X,{modelValue:l(q).assigneeUserId,"onUpdate:modelValue":e[16]||(e[16]=t=>l(q).assigneeUserId=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),y(Y,null,H(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:a(()=>[s(I,{modelValue:l(q).reason,"onUpdate:modelValue":e[17]||(e[17]=t=>l(q).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[18]||(e[18]=t=>(async()=>{o.value=!0;try{if(!Z.value)return;await Z.value.validate();const f={id:u.value.id,reason:q.reason,assigneeUserId:q.assigneeUserId};await ol(f),Z.value.resetFields(),g.value.transfer=!1,w.success("\u64CD\u4F5C\u6210\u529F"),L()}finally{o.value=!1}})())},{default:a(()=>[c(k(_(l(m).TRANSFER)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[19]||(e[19]=t=>S("transfer",l(Z)))},{default:a(()=>e[50]||(e[50]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).DELEGATE)?(n(),b(E,{key:4,visible:l(g).delegate,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[20]||(e[20]=t=>V("delegate")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"ep:position"}),c("\xA0 "+k(_(l(m).DELEGATE)),1)])]),default:a(()=>[A((n(),y("div",Gl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"delegateFormRef",ref:ee,model:l(j),rules:l(ze),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u63A5\u6536\u4EBA",prop:"delegateUserId"},{default:a(()=>[s(X,{modelValue:l(j).delegateUserId,"onUpdate:modelValue":e[21]||(e[21]=t=>l(j).delegateUserId=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),y(Y,null,H(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:a(()=>[s(I,{modelValue:l(j).reason,"onUpdate:modelValue":e[22]||(e[22]=t=>l(j).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[23]||(e[23]=t=>(async()=>{o.value=!0;try{if(!ee.value)return;await ee.value.validate();const f={id:u.value.id,reason:j.reason,delegateUserId:j.delegateUserId};await dl(f),g.value.delegate=!1,ee.value.resetFields(),w.success("\u64CD\u4F5C\u6210\u529F"),L()}finally{o.value=!1}})())},{default:a(()=>[c(k(_(l(m).DELEGATE)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[24]||(e[24]=t=>S("delegate",l(ee)))},{default:a(()=>e[51]||(e[51]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).ADD_SIGN)?(n(),b(E,{key:5,visible:l(g).addSign,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[25]||(e[25]=t=>V("addSign")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"ep:plus"}),c("\xA0 "+k(_(l(m).ADD_SIGN)),1)])]),default:a(()=>[A((n(),y("div",Ll,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"addSignFormRef",ref:le,model:l(K),rules:l(Ge),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u52A0\u7B7E\u5904\u7406\u4EBA",prop:"addSignUserIds"},{default:a(()=>[s(X,{modelValue:l(K).addSignUserIds,"onUpdate:modelValue":e[26]||(e[26]=t=>l(K).addSignUserIds=t),multiple:"",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),y(Y,null,H(r.userOptions,t=>(n(),b(Q,{key:t.id,label:t.nickname,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:a(()=>[s(I,{modelValue:l(K).reason,"onUpdate:modelValue":e[27]||(e[27]=t=>l(K).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[28]||(e[28]=t=>ye("before"))},{default:a(()=>[c(" \u5411\u524D"+k(_(l(m).ADD_SIGN)),1)]),_:1},8,["disabled"]),s(d,{disabled:l(o),type:"primary",onClick:e[29]||(e[29]=t=>ye("after"))},{default:a(()=>[c(" \u5411\u540E"+k(_(l(m).ADD_SIGN)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[30]||(e[30]=t=>S("addSign",l(le)))},{default:a(()=>e[52]||(e[52]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),((he=l(u))==null?void 0:he.children.length)>0?(n(),b(E,{key:6,visible:l(g).deleteSign,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[31]||(e[31]=t=>V("deleteSign")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"ep:semi-select"}),e[53]||(e[53]=c("\xA0 \u51CF\u7B7E "))])]),default:a(()=>[A((n(),y("div",Bl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"deleteSignFormRef",ref:ae,model:l(z),rules:l(Le),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u51CF\u7B7E\u4EBA\u5458",prop:"deleteSignTaskId"},{default:a(()=>[s(X,{modelValue:l(z).deleteSignTaskId,"onUpdate:modelValue":e[32]||(e[32]=t=>l(z).deleteSignTaskId=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),y(Y,null,H(l(u).children,t=>(n(),b(Q,{key:t.id,label:Qe(t),value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u5BA1\u6279\u610F\u89C1",prop:"reason"},{default:a(()=>[s(I,{modelValue:l(z).reason,"onUpdate:modelValue":e[33]||(e[33]=t=>l(z).reason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[34]||(e[34]=t=>(async()=>{o.value=!0;try{if(!ae.value)return;await ae.value.validate();const f={id:z.deleteSignTaskId,reason:z.reason};await pl(f),w.success("\u51CF\u7B7E\u6210\u529F"),ae.value.resetFields(),g.value.deleteSign=!1,L()}finally{o.value=!1}})())},{default:a(()=>e[54]||(e[54]=[c(" \u51CF\u7B7E ")])),_:1},8,["disabled"]),s(d,{onClick:e[35]||(e[35]=t=>S("deleteSign",l(ae)))},{default:a(()=>e[55]||(e[55]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(u)&&B()&&J(l(m).RETURN)?(n(),b(E,{key:7,visible:l(g).return,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[36]||(e[36]=t=>V("return")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"ep:back"}),c("\xA0 "+k(_(l(m).RETURN)),1)])]),default:a(()=>[A((n(),y("div",Jl,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"returnFormRef",ref:se,model:l(G),rules:l(Be),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u9000\u56DE\u8282\u70B9",prop:"targetTaskDefinitionKey"},{default:a(()=>[s(X,{modelValue:l(G).targetTaskDefinitionKey,"onUpdate:modelValue":e[37]||(e[37]=t=>l(G).targetTaskDefinitionKey=t),clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),y(Y,null,H(l(oe),t=>(n(),b(Q,{key:t.taskDefinitionKey,label:t.name,value:t.taskDefinitionKey},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(p,{label:"\u9000\u56DE\u7406\u7531",prop:"returnReason"},{default:a(()=>[s(I,{modelValue:l(G).returnReason,"onUpdate:modelValue":e[38]||(e[38]=t=>l(G).returnReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9000\u56DE\u7406\u7531",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[39]||(e[39]=t=>(async()=>{o.value=!0;try{if(!se.value)return;await se.value.validate();const f={id:u.value.id,reason:G.returnReason,targetTaskDefinitionKey:G.targetTaskDefinitionKey};await cl(f),g.value.return=!1,se.value.resetFields(),w.success("\u64CD\u4F5C\u6210\u529F"),L()}finally{o.value=!1}})())},{default:a(()=>[c(k(_(l(m).RETURN)),1)]),_:1},8,["disabled"]),s(d,{onClick:e[40]||(e[40]=t=>S("return",l(se)))},{default:a(()=>e[56]||(e[56]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])):h("",!0),l(me)!==((Ue=(we=r.processInstance)==null?void 0:we.startUser)==null?void 0:Ue.id)||xe((Ie=r.processInstance)==null?void 0:Ie.status)?h("",!0):(n(),b(E,{key:8,visible:l(g).cancel,placement:"top-start",width:420,trigger:"click"},{reference:a(()=>[R("div",{onClick:e[41]||(e[41]=t=>V("cancel")),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"fa:mail-reply"}),e[57]||(e[57]=c("\xA0 \u53D6\u6D88 "))])]),default:a(()=>[A((n(),y("div",$l,[s(C,{"label-position":"top",class:"mb-auto",ref_key:"cancelFormRef",ref:re,model:l(ne),rules:l(Je),"label-width":"100px"},{default:a(()=>[s(p,{label:"\u53D6\u6D88\u7406\u7531",prop:"cancelReason"},{default:a(()=>[e[58]||(e[58]=R("span",{class:"text-#878c93 text-12px"},"\xA0 \u53D6\u6D88\u540E\uFF0C\u8BE5\u5BA1\u6279\u6D41\u7A0B\u5C06\u81EA\u52A8\u7ED3\u675F",-1)),s(I,{modelValue:l(ne).cancelReason,"onUpdate:modelValue":e[42]||(e[42]=t=>l(ne).cancelReason=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u53D6\u6D88\u7406\u7531",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),s(p,null,{default:a(()=>[s(d,{disabled:l(o),type:"primary",onClick:e[43]||(e[43]=t=>(async()=>{o.value=!0;try{if(!re.value)return;await re.value.validate(),await gl(D.processInstance.id,ne.cancelReason),g.value.return=!1,w.success("\u64CD\u4F5C\u6210\u529F"),re.value.resetFields(),L()}finally{o.value=!1}})())},{default:a(()=>e[59]||(e[59]=[c(" \u786E\u8BA4 ")])),_:1},8,["disabled"]),s(d,{onClick:e[44]||(e[44]=t=>S("cancel",l(re)))},{default:a(()=>e[60]||(e[60]=[c(" \u53D6\u6D88 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[T,l(o)]])]),_:1},8,["visible"])),l(me)===((Ve=(Re=r.processInstance)==null?void 0:Re.startUser)==null?void 0:Ve.id)&&xe((Se=r.processInstance)==null?void 0:Se.status)&&((Ce=r.processDefinition)==null?void 0:Ce.formType)===10?(n(),y("div",{key:9,onClick:e[45]||(e[45]=t=>(async()=>{var f;await De.push({name:"BpmProcessInstanceCreate",query:{processInstanceId:(f=D.processInstance)==null?void 0:f.id}})})()),class:"hover-bg-gray-100 rounded-xl p-6px"},[s(i,{size:14,icon:"ep:refresh"}),e[61]||(e[61]=c("\xA0 \u518D\u6B21\u63D0\u4EA4 "))])):h("",!0)]),s(xl,{ref_key:"signRef",ref:ge,onSuccess:Xe},null,512)],64)}}}),[["__scopeId","data-v-26548cf2"]]);export{Yl as default};
