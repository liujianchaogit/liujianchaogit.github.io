import{d as N,u as X,e as Y}from"./index-DiGvuAxb.js";import{_ as Z,g as ee}from"./index-CW_9iX_V.js";import{u as ae}from"./tagsView-B3xQDSQ0.js";import{g as ie,u as re,l as h,r as te,p as le}from"./index-CwL9yoSU.js";import{_ as oe}from"./CustomerForm.vue_vue_type_script_setup_true_lang-DAgeqNmN.js";import{_ as se}from"./CustomerDetailsInfo.vue_vue_type_script_setup_true_lang-BgBTDH-o.js";import{_ as me}from"./CustomerDetailsHeader.vue_vue_type_script_setup_true_lang-7eGeXKY8.js";import{_ as ue}from"./ContactList.vue_vue_type_script_setup_true_lang-CnVMUTlm.js";import{_ as ne}from"./ContractList.vue_vue_type_script_setup_true_lang-CKenmohU.js";import{_ as pe}from"./BusinessList.vue_vue_type_script_setup_true_lang-JLgF6oBm.js";import{_ as fe}from"./ReceivableList.vue_vue_type_script_setup_true_lang-C_GsQtZN.js";import{_ as ce}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-2zK3CKOM.js";import{_ as de}from"./PermissionList.vue_vue_type_script_setup_true_lang-DuRPTcsq.js";import{_ as ye}from"./TransferForm.vue_vue_type_script_setup_true_lang-BAOmVy5z.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-m0iBWoAP.js";import{B as v}from"./index-BbXovwRQ.js";import{_ as ve}from"./CustomerDistributeForm.vue_vue_type_script_setup_true_lang-DBb4bweM.js";import{f as be,a0 as ze,$ as we,j as Ce}from"./form-designer-drfGvdgz.js";import{k as ke,r as m,e as Re,af as Ue,l as Me,m as u,H as i,z as t,A as Se,C as c,y as d,u as e,E as y,G as Oe}from"./form-create-D7wT855o.js";import"./formatTime-DeTj2b0K.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./index-BXr639vD.js";import"./tree-COGD3qag.js";import"./index-BEHCTgo8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import"./color-BN7ZL7BD.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./index-5ADGgtek.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-CyzVB0Fa.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-B6rwY0dr.js";import"./index-D4xnjFDX.js";import"./ContractForm.vue_vue_type_script_setup_true_lang-D9pcCpO-.js";import"./index-CTd4bIoJ.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-DjxMSPjL.js";import"./index-BecHlYrv.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-Cjx3XcOv.js";import"./index-ql53Efwg.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-DxqNVEr9.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-DjDqRBUp.js";import"./index-BZ5-F52f.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-BAH5QTB1.js";import"./index-LzLQUCg-.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-Cw6CG5o7.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-CDu_CIl5.js";import"./index-lUjDMm-F.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-DbaMdrhi.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-CRRE-olZ.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-DnGaMf8w.js";const $e=ke({name:"CrmCustomerDetail",__name:"index",setup(Te){const o=m(0),w=m(!0),s=N(),{delView:I}=ae(),{push:x,currentRoute:F}=X(),n=m(),a=m({}),_=async()=>{w.value=!0;try{a.value=await ie(o.value),await G()}finally{w.value=!1}},C=m(),L=()=>{var l;(l=C.value)==null||l.open("update",o.value)},P=async()=>{const l=!a.value.dealStatus;try{await s.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${l?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await re(o.value,l),s.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await _()}catch{}},k=m(),W=()=>{var l;(l=k.value)==null||l.open(o.value)},j=async()=>{await s.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!0),s.success(`\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},q=async()=>{await s.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!1),s.success(`\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},A=async()=>{await s.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await te([e(o.value)]),s.success(`\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},R=m(),B=async()=>{var l;(l=R.value)==null||l.open(o.value)},D=async()=>{await s.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await le(e(o.value)),s.success(`\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),z()},U=m([]),G=async()=>{if(!o.value)return;const l=await ee({bizType:v.CRM_CUSTOMER,bizId:o.value});U.value=l.list},M=m(),H=l=>{var r;(r=M.value)==null||r.createReceivable(l)},z=()=>{I(e(F)),x({name:"CrmCustomer"})},{params:S}=Y();return Re(()=>{if(!S.id)return s.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void z();o.value=S.id,_()}),(l,r)=>{const p=be,f=we,Q=Z,V=ze,J=Ce,K=Ue("hasPermi");return u(),Me(Oe,null,[i(me,{customer:e(a),loading:e(w)},{default:t(()=>{var b,O,$,T,E,g;return[(b=e(n))!=null&&b.validateWrite?Se((u(),d(p,{key:0,type:"primary",onClick:L},{default:t(()=>r[0]||(r[0]=[y(" \u7F16\u8F91 ")])),_:1})),[[K,["crm:customer:update"]]]):c("",!0),(O=e(n))!=null&&O.validateOwnerUser?(u(),d(p,{key:1,type:"primary",onClick:W},{default:t(()=>r[1]||(r[1]=[y(" \u8F6C\u79FB ")])),_:1})):c("",!0),($=e(n))!=null&&$.validateWrite?(u(),d(p,{key:2,onClick:P},{default:t(()=>r[2]||(r[2]=[y(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")])),_:1})):c("",!0),e(a).lockStatus&&((T=e(n))!=null&&T.validateOwnerUser)?(u(),d(p,{key:3,onClick:q},{default:t(()=>r[3]||(r[3]=[y(" \u89E3\u9501 ")])),_:1})):c("",!0),!e(a).lockStatus&&((E=e(n))!=null&&E.validateOwnerUser)?(u(),d(p,{key:4,onClick:j},{default:t(()=>r[4]||(r[4]=[y(" \u9501\u5B9A ")])),_:1})):c("",!0),e(a).ownerUserId?c("",!0):(u(),d(p,{key:5,type:"primary",onClick:A},{default:t(()=>r[5]||(r[5]=[y(" \u9886\u53D6")])),_:1})),e(a).ownerUserId?c("",!0):(u(),d(p,{key:6,type:"primary",onClick:B},{default:t(()=>r[6]||(r[6]=[y(" \u5206\u914D ")])),_:1})),e(a).ownerUserId&&((g=e(n))!=null&&g.validateOwnerUser)?(u(),d(p,{key:7,onClick:D},{default:t(()=>r[7]||(r[7]=[y(" \u653E\u5165\u516C\u6D77 ")])),_:1})):c("",!0)]}),_:1},8,["customer","loading"]),i(J,null,{default:t(()=>[i(V,null,{default:t(()=>[i(f,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(_e,{"biz-id":e(o),"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(f,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(se,{customer:e(a)},null,8,["customer"])]),_:1}),i(f,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(ue,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(f,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var b;return[i(de,{ref_key:"permissionListRef",ref:n,"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER,"show-action":!((b=e(n))!=null&&b.isPool)||!1,onQuitTeam:z},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(f,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(pe,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(f,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(ne,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(f,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(ce,{"customer-id":e(a).id,onCreateReceivable:H},null,8,["customer-id"]),i(fe,{ref_key:"receivableListRef",ref:M,"customer-id":e(a).id},null,8,["customer-id"])]),_:1}),i(f,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(Q,{"log-list":e(U)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(oe,{ref_key:"formRef",ref:C,onSuccess:_},null,512),i(ve,{ref_key:"distributeForm",ref:R,onSuccess:_},null,512),i(ye,{ref_key:"transferFormRef",ref:k,"biz-type":e(v).CRM_CUSTOMER,onSuccess:z},null,8,["biz-type"])],64)}}});export{$e as default};
