import{D as G,d as q,u as J,_ as K}from"./index-C1TKk8vI.js";import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{_ as H}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{d as Q,g as V,e as W,f as Y}from"./index-C_v5t3_7.js";import{_ as Z}from"./ContactForm.vue_vue_type_script_setup_true_lang-DNhdDOrK.js";import{B as N}from"./index-BuK0ap75.js";import{_ as ee}from"./ContactListModal.vue_vue_type_script_setup_true_lang-Cgo1EbLC.js";import{f as se,i as ae,$ as te,P as oe,_ as ie,aj as re}from"./form-designer-BpYekVAY.js";import{x as ne,r as c,X as le,f as ce,y as u,z as ue,O as s,F as r,K as m,u as o,G as k,E as p,J as f,L as de,M as pe,aq as me}from"./form-create-7GAbgMwl.js";const fe=ne({name:"CrmContactList",__name:"ContactList",props:{bizType:{},bizId:{},customerId:{},businessId:{}},setup(x){const i=x,I=c(!0),w=c(0),C=c([]),a=le({pageNo:1,pageSize:10,customerId:void 0,businessId:void 0}),b=q(),_=async()=>{I.value=!0;try{a.customerId=void 0;let t={list:[],total:0};switch(i.bizType){case N.CRM_CUSTOMER:a.customerId=i.bizId,t=await V(a);break;case N.CRM_BUSINESS:a.businessId=i.bizId,t=await Q(a);break;default:return}C.value=t.list,w.value=t.total}finally{I.value=!1}},y=()=>{a.pageNo=1,_()},z=c(),U=()=>{z.value.open("create",void 0,i.customerId,i.businessId)},{push:E}=J(),S=c(),M=()=>{S.value.open()},T=async t=>{const e={businessId:i.bizId,contactIds:t};g.value.getSelectionRows().forEach(d=>{e.contactIds.push(d.id)}),await W(e),b.success("\u5173\u8054\u8054\u7CFB\u4EBA\u6210\u529F"),y()},g=c(),L=async()=>{const t={businessId:i.bizId,contactIds:g.value.getSelectionRows().map(e=>e.id)};if(t.contactIds.length===0)return b.error("\u672A\u9009\u62E9\u8054\u7CFB\u4EBA");await Y(t),b.success("\u53D6\u5173\u8054\u7CFB\u4EBA\u6210\u529F"),y()};return ce(()=>[i.bizId,i.bizType],()=>{y()},{immediate:!0,deep:!0}),(t,e)=>{const d=K,v=se,O=ae,l=te,A=oe,B=H,P=ie,j=$,D=X,R=me("hasPermi"),F=re;return u(),ue(pe,null,[s(O,{justify:"end"},{default:r(()=>[s(v,{onClick:U},{default:r(()=>[s(d,{class:"mr-5px",icon:"system-uicons:contacts"}),e[2]||(e[2]=m(" \u521B\u5EFA\u8054\u7CFB\u4EBA "))]),_:1}),o(a).businessId?k((u(),p(v,{key:0,onClick:M},{default:r(()=>[s(d,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=m(" \u5173\u8054 "))]),_:1})),[[R,["crm:contact:create-business"]]]):f("",!0),o(a).businessId?k((u(),p(v,{key:1,onClick:L},{default:r(()=>[s(d,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=m(" \u89E3\u9664\u5173\u8054 "))]),_:1})),[[R,["crm:contact:delete-business"]]]):f("",!0)]),_:1}),s(D,{class:"mt-10px"},{default:r(()=>[k((u(),p(P,{ref_key:"contactRef",ref:g,data:o(C),"show-overflow-tooltip":!0,stripe:!0},{default:r(()=>[o(a).businessId?(u(),p(l,{key:0,type:"selection",width:"55"})):f("",!0),s(l,{align:"center",fixed:"left",label:"\u59D3\u540D",prop:"name"},{default:r(n=>[s(A,{underline:!1,type:"primary",onClick:Ie=>{return h=n.row.id,void E({name:"CrmContactDetail",params:{id:h}});var h}},{default:r(()=>[m(de(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),s(l,{align:"center",label:"\u624B\u673A\u53F7",prop:"mobile"}),s(l,{align:"center",label:"\u804C\u4F4D",prop:"post"}),s(l,{align:"center",label:"\u76F4\u5C5E\u4E0A\u7EA7",prop:"parentName"}),s(l,{align:"center",label:"\u662F\u5426\u5173\u952E\u51B3\u7B56\u4EBA","min-width":"100",prop:"master"},{default:r(n=>[s(B,{type:o(G).INFRA_BOOLEAN_STRING,value:n.row.master},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[F,o(I)]]),s(j,{limit:o(a).pageSize,"onUpdate:limit":e[0]||(e[0]=n=>o(a).pageSize=n),page:o(a).pageNo,"onUpdate:page":e[1]||(e[1]=n=>o(a).pageNo=n),total:o(w),onPagination:_},null,8,["limit","page","total"])]),_:1}),s(Z,{ref_key:"formRef",ref:z,onSuccess:_},null,512),t.customerId?(u(),p(ee,{key:0,ref_key:"contactModalRef",ref:S,"customer-id":t.customerId,onSuccess:T},null,8,["customer-id"])):f("",!0)],64)}}});export{fe as _};
