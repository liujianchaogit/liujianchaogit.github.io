import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{d as O,_ as P,b as Q}from"./index-DiGvuAxb.js";import{k as R,m as $}from"./index-CwL9yoSU.js";import{d as q}from"./download-oWiM5xVU.js";import{g as A}from"./index-BEHCTgo8.js";import{x as B,Q as J,z as K,w as M,P as T,f as W}from"./form-designer-drfGvdgz.js";import{k as X,r as u,y as b,m as y,z as s,v as n,H as i,h as _,u as m,l as Y,G as Z,$ as ee,E as x,n as ae}from"./form-create-D7wT855o.js";const le={class:"flex items-center my-10px"},te={class:"el-upload__tip text-center"},oe={class:"el-upload__tip"},se=X({name:"SystemUserImportForm",__name:"CustomerImportForm",emits:["success"],setup(re,{expose:k,emit:V}){const f=O(),d=u(!1),r=u(!1),g=u(),p=u([]),v=u(!1),c=u(),w=u([]);k({open:async()=>{d.value=!0,await F(),w.value=await A(),c.value=Q().getUser.id}});const N=async()=>{if(p.value.length!=0){r.value=!0;try{const a=new FormData;a.append("updateSupport",String(v.value)),a.append("file",p.value[0].raw),a.append("ownerUserId",String(c.value));const e=await R(a);U(e)}catch{z()}finally{r.value=!1}}else f.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},h=V,U=a=>{if(a.code!==0)return f.error(a.msg),void(r.value=!1);const e=a.data;let t="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createCustomerNames.length+";";for(let o of e.createCustomerNames)t+="< "+o+" >";t+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateCustomerNames.length+";";for(const o of e.updateCustomerNames)t+="< "+o+" >";t+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureCustomerNames).length+";";for(const o in e.failureCustomerNames)t+="< "+o+": "+e.failureCustomerNames[o]+" >";f.alert(t),r.value=!1,d.value=!1,h("success")},z=()=>{f.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),r.value=!1},F=async()=>{var a;p.value=[],v.value=!1,c.value=void 0,await ae(),(a=g.value)==null||a.clearFiles()},S=()=>{f.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},I=async()=>{const a=await $();q.excel(a,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const t=J,o=B,j=P,D=M,E=T,G=K,C=W,H=L;return y(),b(H,{modelValue:m(d),"onUpdate:modelValue":e[4]||(e[4]=l=>_(d)?d.value=l:null),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:s(()=>[i(C,{disabled:m(r),type:"primary",onClick:N},{default:s(()=>e[10]||(e[10]=[x("\u786E \u5B9A")])),_:1},8,["disabled"]),i(C,{onClick:e[3]||(e[3]=l=>d.value=!1)},{default:s(()=>e[11]||(e[11]=[x("\u53D6 \u6D88")])),_:1})]),default:s(()=>[n("div",le,[e[5]||(e[5]=n("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1)),i(o,{modelValue:m(c),"onUpdate:modelValue":e[0]||(e[0]=l=>_(c)?c.value=l:null),class:"!w-240px",clearable:""},{default:s(()=>[(y(!0),Y(Z,null,ee(m(w),l=>(y(),b(t,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i(G,{ref_key:"uploadRef",ref:g,"file-list":m(p),"onUpdate:fileList":e[2]||(e[2]=l=>_(p)?p.value=l:null),"auto-upload":!1,disabled:m(r),limit:1,"on-exceed":S,accept:".xlsx, .xls",action:"none",drag:""},{tip:s(()=>[n("div",te,[n("div",oe,[i(D,{modelValue:m(v),"onUpdate:modelValue":e[1]||(e[1]=l=>_(v)?v.value=l:null)},null,8,["modelValue"]),e[6]||(e[6]=x(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 "))]),e[8]||(e[8]=n("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),i(E,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:I},{default:s(()=>e[7]||(e[7]=[x(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:s(()=>[i(j,{icon:"ep:upload"}),e[9]||(e[9]=n("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),n("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}}});export{se as _};
