import{_ as I}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{u as J,e as L,d as M,_ as O,c as T}from"./index-DiGvuAxb.js";import{u as U}from"./tagsView-B3xQDSQ0.js";import{C as W}from"./constants-C3gLHYOK.js";import{g as $,u as F,c as G}from"./index-pCQDXk1-.js";import{_ as q}from"./BasicInfo.vue_vue_type_script_setup_true_lang-DSjg3hv5.js";import K from"./WorkflowDesign-DWhZdP_s.js";import{M as P}from"./index-DJwvf2H9.js";import{A as Q}from"./constants-CHvLs4wt.js";import{f as X}from"./form-designer-drfGvdgz.js";import{k as Y,r as o,e as Z,y as V,m as u,z as A,v as r,H as x,u as s,F as y,l as E,G as ee,$ as ae,B as j,E as te,C as R,h as N,p as re}from"./form-create-D7wT855o.js";const se={class:"mx-auto"},le={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},oe={class:"w-200px flex items-center overflow-hidden"},ie=["title"],ne={class:"flex-1 flex items-center justify-center h-full"},ce={class:"w-400px flex items-center justify-between h-full"},ue=["onClick"],pe={class:"text-16px font-bold whitespace-nowrap"},me={class:"w-200px flex items-center justify-end gap-2"},de={class:"mt-50px"},fe={key:0,class:"mx-auto w-560px"},we=Y({__name:"index",setup(xe){const c=J(),{delView:h}=U(),b=L(),p=M(),g=o(),k=o(),m=async()=>{var a;await((a=g.value)==null?void 0:a.validate())},d=async()=>{var a;await((a=k.value)==null?void 0:a.validate())},l=o(-1),S=[{title:"\u57FA\u672C\u4FE1\u606F",validator:m},{title:"\u5DE5\u4F5C\u6D41\u8BBE\u8BA1",validator:d}],t=o({id:void 0,name:"",code:"",remark:"",graph:"",status:W.ENABLE}),_=o([]),f=o({});re("workflowData",f);const C=b.params.type,z=async()=>{try{await(async()=>{try{try{await m()}catch{throw l.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await d()}catch{throw l.value=1,new Error("\u8BF7\u5B8C\u5584\u5DE5\u4F5C\u6D41\u4FE1\u606F")}return!0}catch(e){throw e}})();const a={...t.value,graph:JSON.stringify(f.value)};C==="update"?await F(a):await G(a),p.success("\u4FDD\u5B58\u6210\u529F"),h(s(c.currentRoute)),await c.push({name:"AiWorkflow"})}catch(a){p.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},B=()=>{h(s(c.currentRoute)),c.push({name:"AiWorkflow"})};return Z(async()=>{await(async()=>{if(C==="update"){const e=b.params.id;t.value=await $(e),f.value=JSON.parse(t.value.graph)}const a=await P.getModelSimpleList(Q.CHAT);_.value={llm:()=>a.map(({id:e,name:w})=>({value:e,label:w})),knowledge:()=>[],internal:()=>[]},l.value=0})()}),(a,e)=>{const w=O,D=X,H=I;return u(),V(H,null,{default:A(()=>[r("div",se,[r("div",le,[r("div",oe,[x(w,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:B}),r("span",{class:"ml-10px text-16px truncate",title:s(t).name||"\u521B\u5EFA\u6D41\u7A0B"},y(s(t).name||"\u521B\u5EFA\u6D41\u7A0B"),9,ie)]),r("div",ne,[r("div",ce,[(u(),E(ee,null,ae(S,(i,n)=>r("div",{key:n,class:j(["flex items-center cursor-pointer mx-15px relative h-full",[s(l)===n?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:ye=>(async v=>{try{v!==0&&await m(),v!==1&&await d(),l.value=v}catch{p.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(n)},[r("div",{class:j(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[s(l)===n?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},y(n+1),3),r("span",pe,y(i.title),1)],10,ue)),64))])]),r("div",me,[x(D,{type:"primary",onClick:z},{default:A(()=>e[2]||(e[2]=[te(" \u4FDD \u5B58 ")])),_:1})])]),r("div",de,[s(l)===0?(u(),E("div",fe,[x(q,{modelValue:s(t),"onUpdate:modelValue":e[0]||(e[0]=i=>N(t)?t.value=i:null),ref_key:"basicInfoRef",ref:g},null,8,["modelValue"])])):R("",!0),s(l)===1?(u(),V(K,{key:1,modelValue:s(t),"onUpdate:modelValue":e[1]||(e[1]=i=>N(t)?t.value=i:null),provider:s(_),ref_key:"workflowDesignRef",ref:k},null,8,["modelValue","provider"])):R("",!0)])])]),_:1})}}}),ve=T(we,[["__scopeId","data-v-e38ea3e7"]]);export{ve as default};
