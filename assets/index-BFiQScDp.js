import{u as W,e as X,d as ee,a as ae,h as le,D as A,_ as te}from"./index-DiGvuAxb.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{_ as se}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as ie}from"./index-BrNbcFk-.js";import{k as ne,r as u,P as de,e as me,af as pe,l as f,m as o,H as a,z as s,u as l,G as _,$ as g,y as p,Z as H,E as b,A as S,F as ue,C as ce}from"./form-create-D7wT855o.js";import{d as O}from"./formatTime-DeTj2b0K.js";import{b as fe,c as _e}from"./index-pGMn8Zyx.js";import{g as be}from"./index-BEHCTgo8.js";import{a as we}from"./index-Dm7yQOF4.js";import{p as ye}from"./index-BCN8BzfC.js";import{h as he,ai as ge,x as ve,Q as Ve,k as ke,F as Se,f as Te,Z as xe,_ as Pe,aj as Ue,O as De}from"./form-designer-drfGvdgz.js";import"./color-BN7ZL7BD.js";const Fe=ne({name:"BpmProcessInstanceReport",__name:"index",setup(Ce){const q=W(),{query:T}=X(),z=ee(),{t:x}=ae(),v=u(!0),P=u(0),U=u([]),V=u(),K=T.processDefinitionId,r=de({pageNo:1,pageSize:10,startUserId:void 0,name:"",processDefinitionKey:T.processDefinitionKey,status:void 0,createTime:[],endTime:[],formFieldsParams:{}}),D=u(),F=u([]),w=async()=>{v.value=!0;try{const i=await fe({...r,formFieldsParams:JSON.stringify(r.formFieldsParams)});U.value=i.list,P.value=i.total}finally{v.value=!1}},R=i=>{const t=[];return i&&i.forEach(k=>{ye(JSON.parse(k),t)}),t},y=()=>{r.pageNo=1,w()},$=()=>{D.value.resetFields(),r.formFieldsParams={},y()};return me(async()=>{await(async()=>{const i=await we(K);V.value=R(i.formFields)})(),await w(),F.value=await be()}),(i,t)=>{const k=ie,C=Ve,N=ve,d=ge,I=ke,Y=Se,E=te,h=Te,J=he,M=oe,m=Pe,Z=se,j=xe,G=re,B=pe("hasPermi"),Q=Ue;return o(),f(_,null,[a(k,{title:"\u5DE5\u4F5C\u6D41\u624B\u518C",url:"https://doc.iocoder.cn/bpm/"}),a(M,null,{default:s(()=>[a(J,{class:"-mb-15px",model:l(r),ref_key:"queryFormRef",ref:D,inline:!0,"label-width":"68px"},{default:s(()=>[a(d,{label:"\u53D1\u8D77\u4EBA",prop:"startUserId"},{default:s(()=>[a(N,{modelValue:l(r).startUserId,"onUpdate:modelValue":t[0]||(t[0]=e=>l(r).startUserId=e),placeholder:"\u8BF7\u9009\u62E9\u53D1\u8D77\u4EBA",class:"!w-240px"},{default:s(()=>[(o(!0),f(_,null,g(l(F),e=>(o(),p(C,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name"},{default:s(()=>[a(I,{modelValue:l(r).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(r).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:H(y,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status"},{default:s(()=>[a(N,{modelValue:l(r).status,"onUpdate:modelValue":t[2]||(t[2]=e=>l(r).status=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u72B6\u6001",clearable:"",class:"!w-240px"},{default:s(()=>[(o(!0),f(_,null,g(l(le)(l(A).BPM_PROCESS_INSTANCE_STATUS),e=>(o(),p(C,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u53D1\u8D77\u65F6\u95F4",prop:"createTime"},{default:s(()=>[a(Y,{modelValue:l(r).createTime,"onUpdate:modelValue":t[3]||(t[3]=e=>l(r).createTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),a(d,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:s(()=>[a(Y,{modelValue:l(r).endTime,"onUpdate:modelValue":t[4]||(t[4]=e=>l(r).endTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),(o(!0),f(_,null,g(l(V),(e,c)=>(o(),p(d,{key:c,label:e.title,prop:e.field},{default:s(()=>[a(I,{disabled:e.type!=="input",modelValue:l(r).formFieldsParams[e.field],"onUpdate:modelValue":n=>l(r).formFieldsParams[e.field]=n,placeholder:`\u8BF7\u8F93\u5165${e.title}`,clearable:"",onKeyup:H(y,["enter"]),class:"!w-240px"},null,8,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),a(d,null,{default:s(()=>[a(h,{onClick:y},{default:s(()=>[a(E,{icon:"ep:search",class:"mr-5px"}),t[7]||(t[7]=b(" \u641C\u7D22"))]),_:1}),a(h,{onClick:$},{default:s(()=>[a(E,{icon:"ep:refresh",class:"mr-5px"}),t[8]||(t[8]=b(" \u91CD\u7F6E"))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(M,null,{default:s(()=>[S((o(),p(j,{border:"",data:l(U)},{default:s(()=>[a(m,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name",fixed:"left",width:"200"}),a(m,{label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA",align:"center",prop:"startUser.nickname",width:"120"}),a(m,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status",width:"120"},{default:s(e=>[a(Z,{type:l(A).BPM_PROCESS_INSTANCE_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(m,{label:"\u53D1\u8D77\u65F6\u95F4",align:"center",prop:"startTime",width:"180",formatter:l(O)},null,8,["formatter"]),a(m,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"endTime",width:"180",formatter:l(O)},null,8,["formatter"]),(o(!0),f(_,null,g(l(V),(e,c)=>(o(),p(m,{key:c,label:e.title,prop:e.field,width:"120"},{default:s(n=>[b(ue(n.row.formVariables[e.field]??""),1)]),_:2},1032,["label","prop"]))),128)),a(m,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"180"},{default:s(e=>[S((o(),p(h,{link:"",type:"primary",onClick:c=>{return n=e.row,void q.push({name:"BpmProcessInstanceDetail",query:{id:n.id}});var n}},{default:s(()=>t[9]||(t[9]=[b(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[B,["bpm:process-instance:cancel"]]]),e.row.status===1?S((o(),p(h,{key:0,link:"",type:"primary",onClick:c=>(async n=>{const{value:L}=await De.prompt("\u8BF7\u8F93\u5165\u53D6\u6D88\u539F\u56E0","\u53D6\u6D88\u6D41\u7A0B",{confirmButtonText:x("common.ok"),cancelButtonText:x("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u53D6\u6D88\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});await _e(n.id,L),z.success("\u53D6\u6D88\u6210\u529F"),await w()})(e.row)},{default:s(()=>t[10]||(t[10]=[b(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[B,["bpm:process-instance:query"]]]):ce("",!0)]),_:1})]),_:1},8,["data"])),[[Q,l(v)]]),a(G,{total:l(P),page:l(r).pageNo,"onUpdate:page":t[5]||(t[5]=e=>l(r).pageNo=e),limit:l(r).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>l(r).pageSize=e),onPagination:w},null,8,["total","page","limit"])]),_:1})],64)}}});export{Fe as default};
