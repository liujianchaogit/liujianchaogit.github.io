import{b as ee,d as le,e as ae,D as P,g as se,_ as te,X as re,c as ue}from"./index-C1TKk8vI.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{d as de,h as pe}from"./tree-COGD3qag.js";import{g as ne}from"./index-B0Mya_PA.js";import{y as ce,j as me,i as ve,f as J,aj as fe,k as ye,o as ge,ai as ke,Q as be,x as xe,u as _e,s as he,af as Ve,h as Ue}from"./form-designer-BpYekVAY.js";import{x as Q,r as c,y as u,E as _,F as t,O as a,u as d,K as m,G as Ie,l as Ce,n as we,aE as qe,aF as De,f as Le,z as v,C as X,M as V,a4 as L,L as U,J as Y}from"./form-create-7GAbgMwl.js";import{_ as Re}from"./index-vcegfSq2.js";import"./index-CZiMqbPE.js";const Se=Q({name:"DeptSelectForm",__name:"index",props:{checkStrictly:{type:Boolean,default:!1},multiple:{type:Boolean,default:!0}},emits:["confirm"],setup(I,{expose:B,emit:R}){const z=R,{t:C}=ee(),w=le(),q=I,f=c(),D=c([]),p=c([]),h=c(!1),e=c(!1),E=(k,i)=>{if(p.value=f.value.getCheckedKeys(),!q.multiple&&p.value.length>1){const y=p.value[p.value.length-1];p.value=[y],f.value.setCheckedKeys([y])}},F=async()=>{try{const k=f.value.getCheckedNodes();w.success(C("common.updateSuccess")),h.value=!1,z("confirm",k)}finally{}},K=()=>{D.value=[],p.value=[],f.value&&f.value.setCheckedKeys([])};return B({open:async k=>{var i;K(),e.value=!0;try{const y=await ne();D.value=pe(y)}finally{e.value=!1}if(h.value=!0,k==null?void 0:k.length){await we();const y=k.map(r=>r.id).filter(r=>r!==void 0);p.value=y,(i=f.value)==null||i.setCheckedKeys(y)}}}),(k,i)=>{const y=ce,r=oe,s=me,n=ve,o=J,b=ie,g=fe;return u(),_(b,{modelValue:d(h),"onUpdate:modelValue":i[1]||(i[1]=x=>Ce(h)?h.value=x:null),title:"\u90E8\u95E8\u9009\u62E9",width:"600"},{footer:t(()=>{var x;return[a(o,{disabled:d(e)||!((x=d(p))!=null&&x.length),type:"primary",onClick:F},{default:t(()=>i[2]||(i[2]=[m(" \u786E \u5B9A ")])),_:1},8,["disabled"]),a(o,{onClick:i[0]||(i[0]=M=>h.value=!1)},{default:t(()=>i[3]||(i[3]=[m("\u53D6 \u6D88")])),_:1})]}),default:t(()=>[Ie((u(),_(n,null,{default:t(()=>[a(s,{span:24},{default:t(()=>[a(r,{class:"h-1/1"},{default:t(()=>[a(y,{ref_key:"treeRef",ref:f,data:d(D),props:d(de),"show-checkbox":"","check-strictly":I.checkStrictly,"check-on-click-node":"","default-expand-all":"","highlight-current":"","node-key":"id",onCheck:E},null,8,["data","props","check-strictly"])]),_:1})]),_:1})]),_:1})),[[g,d(e)]])]),_:1},8,["modelValue"])}}}),Te={class:"flex items-center"},ze={key:0,class:"mt-2 flex flex-wrap gap-2"},Ae={key:1,class:"mt-2 flex flex-wrap gap-2"},Be={class:"flex flex-wrap gap-2"},Ee=ue(Q({__name:"BasicInfo",props:qe({categoryList:{type:Array,required:!0},userList:{type:Array,required:!0},deptList:{type:Array,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(I,{expose:B}){const R=I,z=c(),C=c([]),w=c([]),q=c([]),f=c(),D=c(),p=c("start"),h={name:[{required:!0,message:"\u6D41\u7A0B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],key:[{required:!0,message:"\u6D41\u7A0B\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],category:[{required:!0,message:"\u6D41\u7A0B\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],type:[{required:!0,message:"\u662F\u5426\u53EF\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],visible:[{required:!0,message:"\u662F\u5426\u53EF\u89C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],managerUserIds:[{required:!0,message:"\u6D41\u7A0B\u7BA1\u7406\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},e=De(I,"modelValue");Le(()=>e.value,r=>{var s,n,o;(s=r.startUserIds)!=null&&s.length?C.value=R.userList.filter(b=>r.startUserIds.includes(b.id)):C.value=[],(n=r.startDeptIds)!=null&&n.length?w.value=R.deptList.filter(b=>r.startDeptIds.includes(b.id)):w.value=[],(o=r.managerUserIds)!=null&&o.length?q.value=R.userList.filter(b=>r.managerUserIds.includes(b.id)):q.value=[]},{immediate:!0});const E=()=>{p.value="start",f.value.open(0,C.value)},F=()=>{D.value.open(w.value)},K=()=>{p.value="manager",f.value.open(0,q.value)},k=(r,s)=>{p.value==="start"?e.value={...e.value,startUserIds:s.map(n=>n.id)}:e.value={...e.value,managerUserIds:s.map(n=>n.id)}},i=r=>{e.value={...e.value,startDeptIds:r.map(s=>s.id)}},y=r=>{r===0?e.value={...e.value,startUserIds:[],startDeptIds:[]}:r===1?e.value={...e.value,startDeptIds:[]}:r===2&&(e.value={...e.value,startUserIds:[]})};return B({validate:async()=>{var r;await((r=z.value)==null?void 0:r.validate())}}),(r,s)=>{const n=ye,o=te,b=ge,g=ke,x=be,M=xe,$=re,O=_e,j=he,A=Ve,N=J,H=Ue,W=Re,Z=Se;return u(),v(V,null,[a(H,{ref_key:"formRef",ref:z,model:e.value,rules:h,"label-width":"120px",class:"mt-20px"},{default:t(()=>[a(g,{label:"\u6D41\u7A0B\u6807\u8BC6",prop:"key",class:"mb-20px"},{default:t(()=>[X("div",Te,[a(n,{class:"!w-440px",modelValue:e.value.key,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.key=l),disabled:!!e.value.id,placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u6807\u8BC6\uFF0C\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934"},null,8,["modelValue","disabled"]),a(b,{class:"item",content:e.value.id?"\u6D41\u7A0B\u6807\u8BC6\u4E0D\u53EF\u4FEE\u6539\uFF01":"\u65B0\u5EFA\u540E\uFF0C\u6D41\u7A0B\u6807\u8BC6\u4E0D\u53EF\u4FEE\u6539\uFF01",effect:"light",placement:"top"},{default:t(()=>[a(o,{icon:"ep:question-filled",class:"ml-5px"})]),_:1},8,["content"])])]),_:1}),a(g,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name",class:"mb-20px"},{default:t(()=>[a(n,{modelValue:e.value.name,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value.name=l),disabled:!!e.value.id,clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0"},null,8,["modelValue","disabled"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u5206\u7C7B",prop:"category",class:"mb-20px"},{default:t(()=>[a(M,{class:"!w-full",modelValue:e.value.category,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.category=l),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u5206\u7C7B"},{default:t(()=>[(u(!0),v(V,null,L(I.categoryList,l=>(u(),_(x,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u56FE\u6807",class:"mb-20px"},{default:t(()=>[a($,{modelValue:e.value.icon,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.icon=l),limit:1,height:"64px",width:"64px"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u63CF\u8FF0",prop:"description",class:"mb-20px"},{default:t(()=>[a(n,{modelValue:e.value.description,"onUpdate:modelValue":s[4]||(s[4]=l=>e.value.description=l),clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u6D41\u7A0B\u7C7B\u578B",prop:"type",class:"mb-20px"},{default:t(()=>[a(j,{modelValue:e.value.type,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.type=l)},{default:t(()=>[(u(!0),v(V,null,L(d(ae)(d(P).BPM_MODEL_TYPE),l=>(u(),_(O,{key:l.value,value:l.value},{default:t(()=>[m(U(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u662F\u5426\u53EF\u89C1",prop:"visible",class:"mb-20px"},{default:t(()=>[a(j,{modelValue:e.value.visible,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.visible=l)},{default:t(()=>[(u(!0),v(V,null,L(d(se)(d(P).INFRA_BOOLEAN_STRING),l=>(u(),_(O,{key:l.value,value:l.value},{default:t(()=>[m(U(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"\u8C01\u53EF\u4EE5\u53D1\u8D77",prop:"startUserType",class:"mb-20px"},{default:t(()=>[a(M,{modelValue:e.value.startUserType,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.startUserType=l),placeholder:"\u8BF7\u9009\u62E9\u8C01\u53EF\u4EE5\u53D1\u8D77",onChange:y},{default:t(()=>[a(x,{label:"\u5168\u5458",value:0}),a(x,{label:"\u6307\u5B9A\u4EBA\u5458",value:1}),a(x,{label:"\u6307\u5B9A\u90E8\u95E8",value:2})]),_:1},8,["modelValue"]),e.value.startUserType===1?(u(),v("div",ze,[(u(!0),v(V,null,L(d(C),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[l.avatar?(u(),_(A,{key:0,class:"!m-5px",size:28,src:l.avatar},null,8,["src"])):(u(),_(A,{key:1,class:"!m-5px",size:28},{default:t(()=>[m(U(l.nickname.substring(0,1)),1)]),_:2},1024)),m(" "+U(l.nickname)+" ",1),a(o,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:G=>(S=>{e.value={...e.value,startUserIds:e.value.startUserIds.filter(T=>T!==S.id)}})(l)},null,8,["onClick"])]))),128)),a(N,{type:"primary",link:"",onClick:E},{default:t(()=>[a(o,{icon:"ep:plus"}),s[8]||(s[8]=m(" \u9009\u62E9\u4EBA\u5458 "))]),_:1})])):Y("",!0),e.value.startUserType===2?(u(),v("div",Ae,[(u(!0),v(V,null,L(d(w),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[a(o,{icon:"ep:office-building",class:"!m-5px text-20px"}),m(" "+U(l.name)+" ",1),a(o,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:G=>(S=>{e.value={...e.value,startDeptIds:e.value.startDeptIds.filter(T=>T!==S.id)}})(l)},null,8,["onClick"])]))),128)),a(N,{type:"primary",link:"",onClick:F},{default:t(()=>[a(o,{icon:"ep:plus"}),s[9]||(s[9]=m(" \u9009\u62E9\u90E8\u95E8 "))]),_:1})])):Y("",!0)]),_:1}),a(g,{label:"\u6D41\u7A0B\u7BA1\u7406\u5458",prop:"managerUserIds",class:"mb-20px"},{default:t(()=>[X("div",Be,[(u(!0),v(V,null,L(d(q),l=>(u(),v("div",{key:l.id,class:"bg-gray-100 h-35px rounded-3xl flex items-center pr-8px dark:color-gray-600 position-relative"},[l.avatar?(u(),_(A,{key:0,class:"!m-5px",size:28,src:l.avatar},null,8,["src"])):(u(),_(A,{key:1,class:"!m-5px",size:28},{default:t(()=>[m(U(l.nickname.substring(0,1)),1)]),_:2},1024)),m(" "+U(l.nickname)+" ",1),a(o,{icon:"ep:close",class:"ml-2 cursor-pointer hover:text-red-500",onClick:G=>(S=>{e.value={...e.value,managerUserIds:e.value.managerUserIds.filter(T=>T!==S.id)}})(l)},null,8,["onClick"])]))),128)),a(N,{type:"primary",link:"",onClick:K},{default:t(()=>[a(o,{icon:"ep:plus"}),s[10]||(s[10]=m("\u9009\u62E9\u4EBA\u5458 "))]),_:1})])]),_:1})]),_:1},8,["model"]),a(W,{ref_key:"userSelectFormRef",ref:f,onConfirm:k},null,512),a(Z,{ref_key:"deptSelectFormRef",ref:D,multiple:!0,"check-strictly":!0,onConfirm:i},null,512)],64)}}}),[["__scopeId","data-v-231d9322"]]);export{Ee as default};
