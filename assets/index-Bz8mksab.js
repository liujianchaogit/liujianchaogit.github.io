import{_ as $}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{B as ee,u as ae,h as te,d as se,_ as le,c as re}from"./index-C1TKk8vI.js";import{x as ie,r as m,f as oe,j as me,W as pe,y as d,E as T,F as D,C as r,O as y,u as t,L as P,z as w,a4 as ue,H as G,M as ne,K as de,J as k,l as _,G as ce,P as fe,t as H,n as ve}from"./form-create-7GAbgMwl.js";import{u as ye}from"./tagsView-C2oS-OQq.js";import{g as we,u as B,c as R,d as xe}from"./index-j0g2sdlj.js";import{a as he}from"./index-BwT0n6gf.js";import{C as ge}from"./index-C3kvgmux.js";import{g as be}from"./index-CZiMqbPE.js";import{g as ke}from"./index-B0Mya_PA.js";import{a as _e}from"./index-CxCrYW_I.js";import{a as j,B as Ie,b as Ue}from"./constants-IYPHa1Ih.js";import Ve from"./BasicInfo-DUWVXjy2.js";import{_ as Ce}from"./FormDesign.vue_vue_type_script_setup_true_lang-K6l1A2ai.js";import{_ as Le}from"./ProcessDesign.vue_vue_type_script_setup_true_lang-B5XTzt4E.js";import{_ as Me}from"./ExtraSettings.vue_vue_type_script_setup_true_lang-CPHEaS-8.js";import{u as Te}from"./useTagsView-XqK57Dxl.js";import{f as De}from"./form-designer-BpYekVAY.js";import"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import"./tree-COGD3qag.js";import"./index-vcegfSq2.js";import"./formCreate-DNZv5C32.js";import"./index.vue_vue_type_style_index_0_lang-CPb3k5fl.js";import"./bpmn-embedded-CLKwycJq.js";import"./XTextButton-BjjL95Dk.js";import"./XButton-we2I6miX.js";import"./index-DREge7zO.js";import"./consts-D6_WKT2v.js";import"./node-Do_BcwVI.js";import"./index-DwSWB2Hs.js";import"./index-BCN8BzfC.js";import"./utils-QiRL3TXx.js";import"./index-BtHQyrBm.js";import"./index-CYJDvQdV.js";import"./index-DbP8QQV-.js";import"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import"./index-D2S4HpRp.js";import"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import"./color-BN7ZL7BD.js";import"./index-DMrIORbd.js";import"./formatTime-EbFUBcAO.js";import"./SimpleModelDesign.vue_vue_type_script_setup_true_lang-CIybqRfg.js";import"./simple-process-designer-DWOFOAFc.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-C6CtoOwH.js";import"./download-oWiM5xVU.js";const Pe={class:"mx-auto"},Be={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},Re={class:"w-200px flex items-center overflow-hidden"},je=["title"],Ee={class:"flex-1 flex items-center justify-center h-full"},Ne={class:"w-400px flex items-center justify-between h-full"},Se=["onClick"],Oe={class:"text-16px font-bold whitespace-nowrap"},ze={class:"w-200px flex items-center justify-end gap-2"},Ae={key:0},Je={key:1},Fe={class:"mt-50px"},Ge={key:0,class:"mx-auto w-560px"},He={key:1,class:"mx-auto w-560px"},Ke={class:"mx-auto w-700px"},We=ie({__name:"index",setup(qe){const x=ae(),{delView:K}=ye(),W=Te(),h=te(),p=se(),X=ee(),I=m(),U=m(),c=m(),E=m(),V=async()=>{var a;await((a=I.value)==null?void 0:a.validate())},C=async()=>{var a;await((a=U.value)==null?void 0:a.validate())},L=async()=>{var a;await((a=c.value)==null?void 0:a.validate())},i=m(-1),q=[{title:"\u57FA\u672C\u4FE1\u606F",validator:V},{title:"\u8868\u5355\u8BBE\u8BA1",validator:C},{title:"\u6D41\u7A0B\u8BBE\u8BA1",validator:L},{title:"\u66F4\u591A\u8BBE\u7F6E",validator:null}],e=m({id:void 0,name:"",key:"",category:void 0,icon:void 0,description:"",type:j.BPMN,formType:Ie.NORMAL,formId:"",formCustomCreatePath:"",formCustomViewPath:"",visible:!0,startUserType:void 0,startUserIds:[],startDeptIds:[],managerUserIds:[],allowCancelRunningProcess:!0,processIdRule:{enable:!1,prefix:"",infix:"",postfix:"",length:5},autoApprovalType:Ue.NONE,titleSetting:{enable:!1,title:""},summarySetting:{enable:!1,summary:[]}}),M=m();H("processData",M),H("modelData",e);const N=m([]),S=m([]),O=m([]),z=m([]),n=h.params.type;oe(async()=>e.value.type,()=>{e.value.type===j.BPMN?M.value=e.value.bpmnXml:e.value.type===j.SIMPLE&&(M.value=e.value.simpleModel)},{immediate:!0});const A=async()=>{try{try{await V()}catch{throw i.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await C()}catch{throw i.value=1,new Error("\u8BF7\u5B8C\u5584\u81EA\u5B9A\u4E49\u8868\u5355\u4FE1\u606F")}try{await L()}catch{throw i.value=2,new Error("\u8BF7\u8BBE\u8BA1\u6D41\u7A0B")}return!0}catch(a){throw a}},Q=async()=>{try{await A();const a={...e.value};n==="definition"?(await B(a),p.success("\u6062\u590D\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="update"?(await B(a),p.success("\u4FEE\u6539\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="copy"?(e.value.id=await R(a),p.success("\u590D\u5236\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):(e.value.id=await R(a),p.success("\u65B0\u5EFA\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")),n!=="update"&&await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},Y=async()=>{try{e.value.id||await p.confirm("\u662F\u5426\u786E\u8BA4\u53D1\u5E03\u8BE5\u6D41\u7A0B\uFF1F"),await A();const a={...e.value};if(e.value.id)await B(a);else{const s=await R(a);e.value.id=s.id}await xe(e.value.id),p.success("\u53D1\u5E03\u6210\u529F"),await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u53D1\u5E03\u5931\u8D25")}},Z=()=>{K(t(x.currentRoute)),x.push({name:"BpmModel"})};return me(async()=>{await(async()=>{var a,s,g,f,b,l;if(n==="definition"){const u=h.params.id,o=await _e(u);o.type=o.modelType,delete o.modelType,o.id=o.modelId,delete o.modelId,o.simpleModel&&(o.simpleModel=JSON.parse(o.simpleModel)),e.value=o,e.value.startUserType=((a=e.value.startUserIds)==null?void 0:a.length)>0?1:((g=(s=e.value)==null?void 0:s.startDeptIds)==null?void 0:g.length)>0?2:0}else if(["update","copy"].includes(n)){const u=h.params.id;e.value=await we(u),e.value.startUserType=((f=e.value.startUserIds)==null?void 0:f.length)>0?1:((l=(b=e.value)==null?void 0:b.startDeptIds)==null?void 0:l.length)>0?2:0,h.params.type==="copy"&&(delete e.value.id,e.value.name+="\u526F\u672C",e.value.key+="_copy",W.setTitle("\u590D\u5236\u6D41\u7A0B"))}else e.value.startUserType=0,e.value.managerUserIds.push(X.getUser.id);N.value=await he(),S.value=await ge.getCategorySimpleList(),O.value=await be(),z.value=await ke(),i.value=0,E.value.initData()})()}),pe(()=>{I.value=null,U.value=null,c.value=null}),(a,s)=>{const g=le,f=De,b=$;return d(),T(b,null,{default:D(()=>[r("div",Pe,[r("div",Be,[r("div",Re,[y(g,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:Z}),r("span",{class:"ml-10px text-16px truncate",title:t(e).name||"\u521B\u5EFA\u6D41\u7A0B"},P(t(e).name||"\u521B\u5EFA\u6D41\u7A0B"),9,je)]),r("div",Ee,[r("div",Ne,[(d(),w(ne,null,ue(q,(l,u)=>r("div",{key:u,class:G(["flex items-center cursor-pointer mx-15px relative h-full",[t(i)===u?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:o=>(async v=>{var J;try{v!==0&&await V(),v!==1&&await C(),v!==2&&await L(),i.value=v,v===2&&(await ve(),await new Promise(F=>setTimeout(F,200)),(J=c.value)!=null&&J.refresh&&await c.value.refresh())}catch{p.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(u)},[r("div",{class:G(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[t(i)===u?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},P(u+1),3),r("span",Oe,P(l.title),1)],10,Se)),64))])]),r("div",ze,[t(n)==="update"?(d(),T(f,{key:0,type:"success",onClick:Y},{default:D(()=>s[4]||(s[4]=[de(" \u53D1 \u5E03 ")])),_:1})):k("",!0),y(f,{type:"primary",onClick:Q},{default:D(()=>[t(n)==="definition"?(d(),w("span",Ae,"\u6062 \u590D")):(d(),w("span",Je,"\u4FDD \u5B58"))]),_:1})])]),r("div",Fe,[t(i)===0?(d(),w("div",Ge,[y(Ve,{modelValue:t(e),"onUpdate:modelValue":s[0]||(s[0]=l=>_(e)?e.value=l:null),categoryList:t(S),userList:t(O),deptList:t(z),ref_key:"basicInfoRef",ref:I},null,8,["modelValue","categoryList","userList","deptList"])])):k("",!0),t(i)===1?(d(),w("div",He,[y(Ce,{modelValue:t(e),"onUpdate:modelValue":s[1]||(s[1]=l=>_(e)?e.value=l:null),formList:t(N),ref_key:"formDesignRef",ref:U},null,8,["modelValue","formList"])])):k("",!0),t(i)===2?(d(),T(Le,{key:2,modelValue:t(e),"onUpdate:modelValue":s[2]||(s[2]=l=>_(e)?e.value=l:null),ref_key:"processDesignRef",ref:c},null,8,["modelValue"])):k("",!0),ce(r("div",Ke,[y(Me,{modelValue:t(e),"onUpdate:modelValue":s[3]||(s[3]=l=>_(e)?e.value=l:null),ref_key:"extraSettingsRef",ref:E},null,8,["modelValue"])],512),[[fe,t(i)===3]])])])]),_:1})}}}),Xe=re(We,[["__scopeId","data-v-5bee86f1"]]);export{Xe as default};
