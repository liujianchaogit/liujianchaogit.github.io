import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{u as ee,e as ae,d as te,B as se,_ as le,c as re}from"./index-DiGvuAxb.js";import{k as ie,r as m,b as oe,e as me,O as pe,y as T,m as d,z as B,v as r,H as y,u as t,F as D,l as w,G as ue,$ as ne,B as H,C as k,E as de,A as ce,h as _,I as fe,n as ve,p as J}from"./form-create-D7wT855o.js";import{u as ye}from"./tagsView-B3xQDSQ0.js";import{g as we,u as R,c as P,d as xe}from"./index-PFHQ4aD1.js";import{a as he}from"./index-DTNfh8Br.js";import{C as ge}from"./index-2iWJkeed.js";import{g as be}from"./index-BEHCTgo8.js";import{g as ke}from"./index-eU2zJvzd.js";import{a as _e}from"./index-Dm7yQOF4.js";import{B as Ie,a as S,b as Ue}from"./constants-C3gLHYOK.js";import Ve from"./BasicInfo-F6eaCzl_.js";import{_ as Ce}from"./FormDesign.vue_vue_type_script_setup_true_lang-s7O-RfZv.js";import{_ as Le}from"./ProcessDesign.vue_vue_type_script_setup_true_lang-C4N0k1Xy.js";import{_ as Me}from"./ExtraSettings.vue_vue_type_script_setup_true_lang-Co1leBoM.js";import{u as Te}from"./useTagsView-DOAawQvM.js";import{f as Be}from"./form-designer-drfGvdgz.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./tree-COGD3qag.js";import"./index-DS_oxMOO.js";import"./formCreate-DGy7HbUv.js";import"./index.vue_vue_type_style_index_0_lang-CwM3zxJr.js";import"./bpmn-embedded-CEyxHmW-.js";import"./XTextButton-CO9jQPGe.js";import"./XButton-BXTtfQPD.js";import"./index-brTT8YwK.js";import"./consts-CvaDWb4S.js";import"./node-CQ9Ble-i.js";import"./index-7o_S5bjn.js";import"./index-BCN8BzfC.js";import"./utils-aZyOMVaO.js";import"./index-CLkdJnRM.js";import"./index-CNUeQNrn.js";import"./index-RiOYYfh_.js";import"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import"./index-GbnTArhn.js";import"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import"./color-BN7ZL7BD.js";import"./index-BES_6pzR.js";import"./formatTime-DeTj2b0K.js";import"./SimpleModelDesign.vue_vue_type_script_setup_true_lang-Bo39Qd88.js";import"./simple-process-designer-DszNnWcD.js";import"./HttpRequestSetting.vue_vue_type_script_setup_true_lang-uNUCv3aR.js";import"./download-oWiM5xVU.js";const De={class:"mx-auto"},Re={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},Pe={class:"w-200px flex items-center overflow-hidden"},Se=["title"],Ee={class:"flex-1 flex items-center justify-center h-full"},Ne={class:"w-400px flex items-center justify-between h-full"},je=["onClick"],Oe={class:"text-16px font-bold whitespace-nowrap"},Ae={class:"w-200px flex items-center justify-end gap-2"},ze={key:0},Fe={key:1},Ge={class:"mt-50px"},He={key:0,class:"mx-auto w-560px"},Je={key:1,class:"mx-auto w-560px"},Xe={class:"mx-auto w-700px"},$e=ie({__name:"index",setup(Ke){const x=ee(),{delView:X}=ye(),$=Te(),h=ae(),p=te(),q=se(),I=m(),U=m(),c=m(),E=m(),V=async()=>{var a;await((a=I.value)==null?void 0:a.validate())},C=async()=>{var a;await((a=U.value)==null?void 0:a.validate())},L=async()=>{var a;await((a=c.value)==null?void 0:a.validate())},i=m(-1),K=[{title:"\u57FA\u672C\u4FE1\u606F",validator:V},{title:"\u8868\u5355\u8BBE\u8BA1",validator:C},{title:"\u6D41\u7A0B\u8BBE\u8BA1",validator:L},{title:"\u66F4\u591A\u8BBE\u7F6E",validator:null}],e=m({id:void 0,name:"",key:"",category:void 0,icon:void 0,description:"",type:S.BPMN,formType:Ie.NORMAL,formId:"",formCustomCreatePath:"",formCustomViewPath:"",visible:!0,startUserType:void 0,startUserIds:[],startDeptIds:[],managerUserIds:[],allowCancelRunningProcess:!0,processIdRule:{enable:!1,prefix:"",infix:"",postfix:"",length:5},autoApprovalType:Ue.NONE,titleSetting:{enable:!1,title:""},summarySetting:{enable:!1,summary:[]}}),M=m();J("processData",M),J("modelData",e);const N=m([]),j=m([]),O=m([]),A=m([]),n=h.params.type;oe(async()=>e.value.type,()=>{e.value.type===S.BPMN?M.value=e.value.bpmnXml:e.value.type===S.SIMPLE&&(M.value=e.value.simpleModel)},{immediate:!0});const z=async()=>{try{try{await V()}catch{throw i.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await C()}catch{throw i.value=1,new Error("\u8BF7\u5B8C\u5584\u81EA\u5B9A\u4E49\u8868\u5355\u4FE1\u606F")}try{await L()}catch{throw i.value=2,new Error("\u8BF7\u8BBE\u8BA1\u6D41\u7A0B")}return!0}catch(a){throw a}},Q=async()=>{try{await z();const a={...e.value};n==="definition"?(await R(a),p.success("\u6062\u590D\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="update"?(await R(a),p.success("\u4FEE\u6539\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):n==="copy"?(e.value.id=await P(a),p.success("\u590D\u5236\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")):(e.value.id=await P(a),p.success("\u65B0\u5EFA\u6210\u529F\uFF0C\u53EF\u70B9\u51FB\u3010\u53D1\u5E03\u3011\u6309\u94AE\uFF0C\u8FDB\u884C\u53D1\u5E03\u6A21\u578B")),n!=="update"&&await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},W=async()=>{try{e.value.id||await p.confirm("\u662F\u5426\u786E\u8BA4\u53D1\u5E03\u8BE5\u6D41\u7A0B\uFF1F"),await z();const a={...e.value};if(e.value.id)await R(a);else{const s=await P(a);e.value.id=s.id}await xe(e.value.id),p.success("\u53D1\u5E03\u6210\u529F"),await x.push({name:"BpmModel"})}catch(a){p.warning(a.message||"\u53D1\u5E03\u5931\u8D25")}},Y=()=>{X(t(x.currentRoute)),x.push({name:"BpmModel"})};return me(async()=>{await(async()=>{var a,s,g,f,b,l;if(n==="definition"){const u=h.params.id,o=await _e(u);o.type=o.modelType,delete o.modelType,o.id=o.modelId,delete o.modelId,o.simpleModel&&(o.simpleModel=JSON.parse(o.simpleModel)),e.value=o,e.value.startUserType=((a=e.value.startUserIds)==null?void 0:a.length)>0?1:((g=(s=e.value)==null?void 0:s.startDeptIds)==null?void 0:g.length)>0?2:0}else if(["update","copy"].includes(n)){const u=h.params.id;e.value=await we(u),e.value.startUserType=((f=e.value.startUserIds)==null?void 0:f.length)>0?1:((l=(b=e.value)==null?void 0:b.startDeptIds)==null?void 0:l.length)>0?2:0,h.params.type==="copy"&&(delete e.value.id,e.value.name+="\u526F\u672C",e.value.key+="_copy",$.setTitle("\u590D\u5236\u6D41\u7A0B"))}else e.value.startUserType=0,e.value.managerUserIds.push(q.getUser.id);N.value=await he(),j.value=await ge.getCategorySimpleList(),O.value=await be(),A.value=await ke(),i.value=0,E.value.initData()})()}),pe(()=>{I.value=null,U.value=null,c.value=null}),(a,s)=>{const g=le,f=Be,b=Z;return d(),T(b,null,{default:B(()=>[r("div",De,[r("div",Re,[r("div",Pe,[y(g,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:Y}),r("span",{class:"ml-10px text-16px truncate",title:t(e).name||"\u521B\u5EFA\u6D41\u7A0B"},D(t(e).name||"\u521B\u5EFA\u6D41\u7A0B"),9,Se)]),r("div",Ee,[r("div",Ne,[(d(),w(ue,null,ne(K,(l,u)=>r("div",{key:u,class:H(["flex items-center cursor-pointer mx-15px relative h-full",[t(i)===u?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:o=>(async v=>{var F;try{v!==0&&await V(),v!==1&&await C(),v!==2&&await L(),i.value=v,v===2&&(await ve(),await new Promise(G=>setTimeout(G,200)),(F=c.value)!=null&&F.refresh&&await c.value.refresh())}catch{p.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(u)},[r("div",{class:H(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[t(i)===u?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},D(u+1),3),r("span",Oe,D(l.title),1)],10,je)),64))])]),r("div",Ae,[t(n)==="update"?(d(),T(f,{key:0,type:"success",onClick:W},{default:B(()=>s[4]||(s[4]=[de(" \u53D1 \u5E03 ")])),_:1})):k("",!0),y(f,{type:"primary",onClick:Q},{default:B(()=>[t(n)==="definition"?(d(),w("span",ze,"\u6062 \u590D")):(d(),w("span",Fe,"\u4FDD \u5B58"))]),_:1})])]),r("div",Ge,[t(i)===0?(d(),w("div",He,[y(Ve,{modelValue:t(e),"onUpdate:modelValue":s[0]||(s[0]=l=>_(e)?e.value=l:null),categoryList:t(j),userList:t(O),deptList:t(A),ref_key:"basicInfoRef",ref:I},null,8,["modelValue","categoryList","userList","deptList"])])):k("",!0),t(i)===1?(d(),w("div",Je,[y(Ce,{modelValue:t(e),"onUpdate:modelValue":s[1]||(s[1]=l=>_(e)?e.value=l:null),formList:t(N),ref_key:"formDesignRef",ref:U},null,8,["modelValue","formList"])])):k("",!0),t(i)===2?(d(),T(Le,{key:2,modelValue:t(e),"onUpdate:modelValue":s[2]||(s[2]=l=>_(e)?e.value=l:null),ref_key:"processDesignRef",ref:c},null,8,["modelValue"])):k("",!0),ce(r("div",Xe,[y(Me,{modelValue:t(e),"onUpdate:modelValue":s[3]||(s[3]=l=>_(e)?e.value=l:null),ref_key:"extraSettingsRef",ref:E},null,8,["modelValue"])],512),[[fe,t(i)===3]])])])]),_:1})}}}),qe=re($e,[["__scopeId","data-v-5bee86f1"]]);export{qe as default};
