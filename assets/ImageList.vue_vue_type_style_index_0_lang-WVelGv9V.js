import{d as G,u as U}from"./index-DiGvuAxb.js";import{_ as b}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{I as d}from"./index-B9Vi4PGf.js";import A from"./ImageDetail-92ViXEuX.js";import H from"./ImageCard-Dv_h11MJ.js";import{a as S}from"./constants-CHvLs4wt.js";import{d as q}from"./download-oWiM5xVU.js";import{ac as D,f as K,d as $}from"./form-designer-drfGvdgz.js";import{k as F,P as J,r as o,e as Q,K as T,l as R,m as y,G as N,H as g,z as w,v as E,$ as V,u as l,y as W,E as O}from"./form-create-D7wT855o.js";const X={class:"task-image-pagination"},Y=F({__name:"ImageList",emits:["onRegeneration"],setup(Z,{expose:P,emit:x}){const I=G(),z=U(),n=J({pageNo:1,pageSize:10}),k=o(0),r=o([]),m=o(),_=o(),v=o({}),p=o(),f=o(!1),h=o(0),C=()=>{z.push({name:"AiImageSquare"})},L=async()=>{f.value=!1},u=async()=>{try{m.value=$.service({target:_.value,text:"\u52A0\u8F7D\u4E2D..."});const{list:e,total:a}=await d.getImagePageMy(n);r.value=e,k.value=a;const s={};r.value.forEach(t=>{t.status===S.IN_PROGRESS&&(s[t.id]=t)}),v.value=s}finally{m.value&&(m.value.close(),m.value=null)}},M=async(e,a)=>e==="more"?(h.value=a.id,void await(async()=>{f.value=!0})()):e==="delete"?(await I.confirm("\u662F\u5426\u5220\u9664\u7167\u7247?"),await d.deleteImageMy(a.id),await u(),void I.success("\u5220\u9664\u6210\u529F!")):void(e!=="download"?e!=="regeneration"||await B("onRegeneration",a):await q.image({url:a.picUrl})),j=async(e,a)=>{const s={id:a.id,customId:e.customId};await d.midjourneyAction(s),await u()};P({getImageList:u});const B=x;return Q(async()=>{await u(),p.value=setInterval(async()=>{await(async()=>{const e=Object.keys(v.value).map(Number);if(e.length==0)return;const a=await d.getImageListMyByIds(e),s={};a.forEach(t=>{if(t.status===S.IN_PROGRESS)s[t.id]=t;else{const c=r.value.findIndex(i=>t.id===i.id);c>=0&&(r.value[c]=t)}}),v.value=s})()},3e3)}),T(async()=>{p.value&&clearInterval(p.value)}),(e,a)=>{const s=K,t=b,c=D;return y(),R(N,null,[g(c,{class:"dr-task","body-class":"task-card",shadow:"never"},{header:w(()=>[a[3]||(a[3]=O(" \u7ED8\u753B\u4EFB\u52A1 ")),g(s,{onClick:C},{default:w(()=>a[2]||(a[2]=[O("\u7ED8\u753B\u4F5C\u54C1")])),_:1})]),default:w(()=>[E("div",{class:"task-image-list",ref_key:"imageListRef",ref:_},[(y(!0),R(N,null,V(l(r),i=>(y(),W(H,{key:i.id,detail:i,onOnBtnClick:M,onOnMjBtnClick:j},null,8,["detail"]))),128))],512),E("div",X,[g(t,{total:l(k),page:l(n).pageNo,"onUpdate:page":a[0]||(a[0]=i=>l(n).pageNo=i),limit:l(n).pageSize,"onUpdate:limit":a[1]||(a[1]=i=>l(n).pageSize=i),onPagination:u},null,8,["total","page","limit"])])]),_:1}),g(A,{show:l(f),id:l(h),onHandleDrawerClose:L},null,8,["show","id"])],64)}}});export{Y as _};
