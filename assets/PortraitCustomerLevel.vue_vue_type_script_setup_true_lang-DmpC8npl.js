import{D as p,H as c,L as W,aJ as g,aH as b}from"./index-C1TKk8vI.js";import{_ as j}from"./DictTag.vue_vue_type_script_lang-B3VNccaT.js";import{_ as z}from"./Echart.vue_vue_type_script_setup_true_lang-Bp4Tc-Mi.js";import{S as T}from"./portrait-Cx2AQDdE.js";import{ag as U,j as V,i as q,ad as A,$ as D,_ as H,aj as I}from"./form-designer-BpYekVAY.js";import{x as F,r as _,X as C,j as G,y as w,z as J,O as e,F as o,u as s,G as X,E as $,M as k}from"./form-create-7GAbgMwl.js";const B=F({name:"PortraitCustomerLevel",__name:"PortraitCustomerLevel",props:{queryParams:{}},setup(L,{expose:y}){const E=L,i=_(!1),f=_([]),n=C({title:{text:"\u5168\u90E8\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u5168\u90E8\u5BA2\u6237"}}},series:[{name:"\u5168\u90E8\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),d=C({title:{text:"\u6210\u4EA4\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u6210\u4EA4\u5BA2\u6237"}}},series:[{name:"\u6210\u4EA4\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),h=async()=>{i.value=!0;const l=await T.getCustomerLevel(E.queryParams);n.series&&n.series[0]&&n.series[0].data&&(n.series[0].data=l.map(t=>({name:c(p.CRM_CUSTOMER_LEVEL,t.level),value:t.customerCount}))),d.series&&d.series[0]&&d.series[0].data&&(d.series[0].data=l.map(t=>({name:c(p.CRM_CUSTOMER_LEVEL,t.level),value:t.dealCount}))),x(l),f.value=l,i.value=!1};y({loadData:h});const x=l=>{if(W(l))return;const t=l,u=g(t.map(a=>a.customerCount)),m=g(t.map(a=>a.dealCount));t.forEach(a=>{a.levelPortion=a.customerCount===0?0:b(a.customerCount,u),a.dealPortion=a.dealCount===0?0:b(a.dealCount,m)})};return G(()=>{h()}),(l,t)=>{const u=z,m=U,a=V,P=q,v=A,r=D,R=j,S=H,M=I;return w(),J(k,null,[e(v,{shadow:"never"},{default:o(()=>[e(P,{gutter:20},{default:o(()=>[e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(u,{height:500,options:s(n)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(u,{height:500,options:s(d)},null,8,["options"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(v,{class:"mt-16px",shadow:"never"},{default:o(()=>[X((w(),$(S,{data:s(f)},{default:o(()=>[e(r,{align:"center",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(r,{align:"center",label:"\u5BA2\u6237\u7EA7\u522B",prop:"level",width:"200"},{default:o(O=>[e(R,{type:s(p).CRM_CUSTOMER_LEVEL,value:O.row.level},null,8,["type","value"])]),_:1}),e(r,{align:"center",label:"\u5BA2\u6237\u4E2A\u6570","min-width":"200",prop:"customerCount"}),e(r,{align:"center",label:"\u6210\u4EA4\u4E2A\u6570","min-width":"200",prop:"dealCount"}),e(r,{align:"center",label:"\u7EA7\u522B\u5360\u6BD4(%)","min-width":"200",prop:"levelPortion"}),e(r,{align:"center",label:"\u6210\u4EA4\u5360\u6BD4(%)","min-width":"200",prop:"dealPortion"})]),_:1},8,["data"])),[[M,s(i)]])]),_:1})],64)}}});export{B as _};
