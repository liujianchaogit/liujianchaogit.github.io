import{a as G,d as J}from"./index-DiGvuAxb.js";import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{_ as M}from"./Tooltip.vue_vue_type_script_setup_true_lang-D7nG6-e5.js";import{D as O,b as Q,c as T,u as W}from"./index-ql53Efwg.js";import{d as X,h as Y}from"./tree-COGD3qag.js";import{g as ee}from"./index-eU2zJvzd.js";import{h as ae,ai as le,k as te,y as se,Z as de,_ as ue,a6 as oe,l as re,f as ne,aj as ie}from"./form-designer-drfGvdgz.js";import{k as ce,r as n,P as me,y as o,m as r,z as l,A as pe,u as t,H as s,E as i,F as g,C as K,h as fe}from"./form-create-D7wT855o.js";const ve=ce({__name:"BusinessStatusForm",emits:["success"],setup(ye,{expose:$,emit:z}){const{t:_}=G(),V=J(),c=n(!1),C=n(""),m=n(!1),x=n(""),d=n({id:void 0,name:"",deptIds:[],statuses:[]}),A=me({name:[{required:!0,message:"\u72B6\u6001\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=n(),S=n([]),f=n(),U=n(!0);$({open:async(u,e)=>{if(c.value=!0,C.value=_("action."+u),x.value=u,q(),e){m.value=!0;try{d.value=await Q(e),f.value.setCheckedKeys(d.value.deptIds),d.value.statuses.length==0&&w()}finally{m.value=!1}}else w();S.value=Y(await ee())}});const R=z,j=async()=>{await h.value.validate(),m.value=!0;try{const u=d.value;u.deptIds=f.value.getCheckedKeys(!1),x.value==="create"?(await T(u),V.success(_("common.createSuccess"))):(await W(u),V.success(_("common.updateSuccess"))),c.value=!1,R("success")}finally{m.value=!1}},q=()=>{var u,e;U.value=!0,d.value={id:void 0,name:"",deptIds:[],statuses:[]},(u=f.value)==null||u.setCheckedNodes([]),(e=h.value)==null||e.resetFields()},w=()=>{d.value.statuses.push({name:"",percent:void 0})};return(u,e)=>{const I=te,b=le,B=M,D=se,v=oe,y=ue,E=re,k=ne,H=de,N=ae,P=L,Z=ie;return r(),o(P,{title:t(C),modelValue:t(c),"onUpdate:modelValue":e[2]||(e[2]=a=>fe(c)?c.value=a:null)},{footer:l(()=>[s(k,{onClick:j,type:"primary",disabled:t(m)},{default:l(()=>e[6]||(e[6]=[i("\u786E \u5B9A")])),_:1},8,["disabled"]),s(k,{onClick:e[1]||(e[1]=a=>c.value=!1)},{default:l(()=>e[7]||(e[7]=[i("\u53D6 \u6D88")])),_:1})]),default:l(()=>[pe((r(),o(N,{ref_key:"formRef",ref:h,model:t(d),rules:t(A),"label-width":"100px"},{default:l(()=>[s(b,{label:"\u72B6\u6001\u7EC4\u540D",prop:"name"},{default:l(()=>[s(I,{modelValue:t(d).name,"onUpdate:modelValue":e[0]||(e[0]=a=>t(d).name=a),placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u7EC4\u540D"},null,8,["modelValue"])]),_:1}),s(b,{label:"\u5E94\u7528\u90E8\u95E8",prop:"deptIds"},{label:l(()=>[s(B,{message:"\u4E0D\u9009\u62E9\u90E8\u95E8\u65F6\uFF0C\u9ED8\u8BA4\u5168\u516C\u53F8\u751F\u6548",title:"\u5E94\u7528\u90E8\u95E8"})]),default:l(()=>[s(D,{ref_key:"treeRef",ref:f,data:t(S),props:t(X),"check-strictly":!t(U),"node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","show-checkbox":""},null,8,["data","props","check-strictly"])]),_:1}),s(b,{label:"\u9636\u6BB5\u8BBE\u7F6E",prop:"statuses"},{default:l(()=>[s(H,{border:"",style:{width:"100%"},data:t(d).statuses.concat(O)},{default:l(()=>[s(y,{align:"center",label:"\u9636\u6BB5",width:"70"},{default:l(a=>[a.row.defaultStatus?(r(),o(v,{key:1},{default:l(()=>e[3]||(e[3]=[i("\u7ED3\u675F")])),_:1})):(r(),o(v,{key:0},{default:l(()=>[i("\u9636\u6BB5 "+g(a.$index+1),1)]),_:2},1024))]),_:1}),s(y,{align:"center",label:"\u9636\u6BB5\u540D\u79F0",width:"160",prop:"name"},{default:l(({row:a})=>[a.endStatus?(r(),o(v,{key:1},{default:l(()=>[i(g(a.name),1)]),_:2},1024)):(r(),o(I,{key:0,modelValue:a.name,"onUpdate:modelValue":p=>a.name=p,placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),s(y,{width:"140",align:"center",label:"\u8D62\u5355\u7387\uFF08%\uFF09",prop:"percent"},{default:l(({row:a})=>[a.endStatus?(r(),o(v,{key:1},{default:l(()=>[i(g(a.percent),1)]),_:2},1024)):(r(),o(E,{key:0,modelValue:a.percent,"onUpdate:modelValue":p=>a.percent=p,placeholder:"\u8BF7\u8F93\u5165\u8D62\u5355\u7387","controls-position":"right",min:0,max:100,precision:2,class:"!w-1/1"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),s(y,{label:"\u64CD\u4F5C",width:"110",align:"center"},{default:l(a=>[a.row.endStatus?K("",!0):(r(),o(k,{key:0,link:"",type:"primary",onClick:p=>w(a.$index)},{default:l(()=>e[4]||(e[4]=[i(" \u6DFB\u52A0 ")])),_:2},1032,["onClick"])),a.row.endStatus?K("",!0):(r(),o(k,{key:1,link:"",type:"danger",onClick:p=>{return F=a.$index,void d.value.statuses.splice(F,1);var F},disabled:t(d).statuses.length<=1},{default:l(()=>e[5]||(e[5]=[i(" \u5220\u9664 ")])),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[Z,t(m)]])]),_:1},8,["title","modelValue"])}}});export{ve as _};
