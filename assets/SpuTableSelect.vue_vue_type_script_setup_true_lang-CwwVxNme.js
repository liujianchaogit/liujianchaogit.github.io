import{p as ae,_ as le}from"./index-C1TKk8vI.js";import{_ as oe}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{_ as te}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-CrL0kGRz.js";import{x as ie,r as n,j as ne,y as b,E as x,a6 as re,F as u,O as l,K as h,u as o,a5 as pe,G as de,l as T,C as se,L as me}from"./form-create-7GAbgMwl.js";import{h as ce,d as ve}from"./tree-COGD3qag.js";import{g as fe}from"./category-BHM6Cffl.js";import{d as ge}from"./spu-75LBH-4N.js";import{a_ as K,k as he,ai as we,av as ye,F as _e,f as Ve,h as be,w as xe,$ as Ue,u as ke,ak as Ce,_ as Te,aj as Ie}from"./form-designer-BpYekVAY.js";const Se=ie({name:"SpuTableSelect",__name:"SpuTableSelect",props:{multiple:ae.bool.def(!1)},emits:["change"],setup(I,{expose:M,emit:O}){const S=n(0),c=n([]),U=n(!1),s=n(!1),i=n({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]});M({open:t=>{v.value=[],r.value={},d.value=!1,y.value=!1,t&&t.length>0&&(v.value=[...t],r.value=Object.fromEntries(t.map(e=>[e.id,!0]))),s.value=!0,z()}});const w=async()=>{U.value=!0;try{const t=await ge(i.value);c.value=t.list,S.value=t.total,c.value.forEach(e=>r.value[e.id]=r.value[e.id]||!1),Y()}finally{U.value=!1}},N=()=>{i.value.pageNo=1,w()},z=()=>{i.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},w()},d=n(!1),y=n(!1),v=n([]),r=n({}),_=n(),$=()=>{s.value=!1,D(K,[...v.value])},D=O,q=t=>{d.value=t,y.value=!1,c.value.forEach(e=>E(t,e,!1))},E=(t,e,C)=>{if(t)v.value.push(e),r.value[e.id]=!0;else{const m=B(e);m>-1&&(v.value.splice(m,1),r.value[e.id]=!1,d.value=!1)}C&&Y()},B=t=>v.value.findIndex(e=>e.id===t.id),Y=()=>{d.value=c.value.every(t=>r.value[t.id]),y.value=!d.value&&c.value.some(t=>r.value[t.id])},k=n(),j=n();return ne(async()=>{await w(),k.value=await fe({}),j.value=ce(k.value,"id","parentId")}),(t,e)=>{const C=he,m=we,G=ye,L=_e,F=le,V=Ve,P=be,H=xe,f=Ue,R=ke,A=Ce,J=Te,Q=ue,W=te,X=oe,Z=Ie;return b(),x(X,{modelValue:o(s),"onUpdate:modelValue":e[8]||(e[8]=a=>T(s)?s.value=a:null),appendToBody:!0,title:"\u9009\u62E9\u5546\u54C1",width:"70%"},re({default:u(()=>[l(W,null,{default:u(()=>[l(P,{ref:"queryFormRef",inline:!0,model:o(i),class:"-mb-15px","label-width":"68px"},{default:u(()=>[l(m,{label:"\u5546\u54C1\u540D\u79F0",prop:"name"},{default:u(()=>[l(C,{modelValue:o(i).name,"onUpdate:modelValue":e[0]||(e[0]=a=>o(i).name=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:pe(N,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"\u5546\u54C1\u5206\u7C7B",prop:"categoryId"},{default:u(()=>[l(G,{modelValue:o(i).categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>o(i).categoryId=a),data:o(j),props:o(ve),"check-strictly":"",class:"!w-240px","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),l(m,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:u(()=>[l(L,{modelValue:o(i).createTime,"onUpdate:modelValue":e[2]||(e[2]=a=>o(i).createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),l(m,null,{default:u(()=>[l(V,{onClick:N},{default:u(()=>[l(F,{class:"mr-5px",icon:"ep:search"}),e[9]||(e[9]=h(" \u641C\u7D22 "))]),_:1}),l(V,{onClick:z},{default:u(()=>[l(F,{class:"mr-5px",icon:"ep:refresh"}),e[10]||(e[10]=h(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),de((b(),x(J,{data:o(c),"show-overflow-tooltip":""},{default:u(()=>[I.multiple?(b(),x(f,{key:0,width:"55"},{header:u(()=>[l(H,{modelValue:o(d),"onUpdate:modelValue":e[3]||(e[3]=a=>T(d)?d.value=a:null),indeterminate:o(y),onChange:q},null,8,["modelValue","indeterminate"])]),default:u(({row:a})=>[l(H,{modelValue:o(r)[a.id],"onUpdate:modelValue":p=>o(r)[a.id]=p,onChange:p=>E(p,a,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(b(),x(f,{key:1,label:"#",width:"55"},{default:u(({row:a})=>[l(R,{value:a.id,modelValue:o(_),"onUpdate:modelValue":e[4]||(e[4]=p=>T(_)?_.value=p:null),onChange:p=>{return D(K,g=a),s.value=!1,void(_.value=g.id);var g}},{default:u(()=>e[11]||(e[11]=[h(" \xA0 ")])),_:2},1032,["value","modelValue","onChange"])]),_:1})),l(f,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id","min-width":"60"}),l(f,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:u(({row:a})=>[l(A,{src:a.picUrl,class:"h-30px w-30px","preview-src-list":[a.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),l(f,{label:"\u5546\u54C1\u540D\u79F0","min-width":"200",prop:"name"}),l(f,{label:"\u5546\u54C1\u5206\u7C7B","min-width":"100",prop:"categoryId"},{default:u(({row:a})=>{var p,g;return[se("span",null,me((g=(p=o(k))==null?void 0:p.find(ee=>ee.id===a.categoryId))==null?void 0:g.name),1)]}),_:1})]),_:1},8,["data"])),[[Z,o(U)]]),l(Q,{limit:o(i).pageSize,"onUpdate:limit":e[5]||(e[5]=a=>o(i).pageSize=a),page:o(i).pageNo,"onUpdate:page":e[6]||(e[6]=a=>o(i).pageNo=a),total:o(S),onPagination:w},null,8,["limit","page","total"])]),_:1})]),_:2},[I.multiple?{name:"footer",fn:u(()=>[l(V,{type:"primary",onClick:$},{default:u(()=>e[12]||(e[12]=[h("\u786E \u5B9A")])),_:1}),l(V,{onClick:e[7]||(e[7]=a=>s.value=!1)},{default:u(()=>e[13]||(e[13]=[h("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Se as _};
