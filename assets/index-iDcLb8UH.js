import{d as de,_ as me,G as K,C as ve,D as Q,b as fe,c as ye}from"./index-DiGvuAxb.js";import{_ as ge}from"./index.vue_vue_type_script_setup_true_lang-BymgqOtI.js";import{_ as be}from"./DictTag.vue_vue_type_script_lang-CByQaegm.js";import{_ as _e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-C0SI8VIx.js";import{_ as we}from"./index-BrNbcFk-.js";import{k as he,r as i,P as xe,e as ke,af as Ue,l as _,m as u,H as e,z as r,G as N,$ as R,y as m,A as f,u as s,I as Pe,E as y,v as j,F as w}from"./form-create-D7wT855o.js";import{f as Se,e as Ie}from"./index-BRCNmqP-.js";import{a as Ne}from"./index-Cnp4ly6p.js";import{f as Ve}from"./formatter-Db_aBdex.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-CGoo1aDU.js";import{d as Ce}from"./formatTime-DeTj2b0K.js";import{D as Te}from"./constants-C3gLHYOK.js";import{_ as qe}from"./OrderPickUpForm.vue_vue_type_script_setup_true_lang-CqjYJG1N.js";import{h as De,ai as Re,F as Fe,x as Ae,Q as Ee,k as Oe,f as je,j as ze,aj as Ye,i as Be,Z as Ge,_ as He,ak as Me,a5 as $e}from"./form-designer-drfGvdgz.js";import"./color-BN7ZL7BD.js";import"./CountTo.vue_vue_type_script_setup_true_lang-D0z23cqy.js";import"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import"./index-C1IwgbtY.js";import"./OrderUpdateRemarkForm.vue_vue_type_script_setup_true_lang-CwoF7Qyx.js";import"./OrderDeliveryForm.vue_vue_type_script_setup_true_lang-BdRLDby3.js";import"./index-DkMz7Dex.js";import"./OrderUpdateAddressForm.vue_vue_type_script_setup_true_lang-B3Cq_odN.js";import"./index-BXr639vD.js";import"./tree-COGD3qag.js";import"./OrderUpdatePriceForm.vue_vue_type_script_setup_true_lang-ByF3O0s4.js";import"./tagsView-B3xQDSQ0.js";const Le={class:"mr-10px"},Xe={class:"flex flex-col flex-wrap gap-1"},Ke=ye(he({name:"PickUpOrder",__name:"index",setup(Qe){const h=de(),g=i(""),Z=i([]),V=i(""),v=i(!0),z=i(2),Y=i([]),B=i(),G={pageNo:1,pageSize:10,createTime:void 0,deliveryType:Te.PICK_UP.type,pickUpStoreId:-1},t=i({...G}),x=xe({queryParam:"no"}),k=i(),C=i(!1),U=i(!0),H=i([{value:"no",label:"\u8BA2\u5355\u53F7"},{value:"userId",label:"\u7528\u6237UID"},{value:"userNickname",label:"\u7528\u6237\u6635\u79F0"},{value:"userMobile",label:"\u7528\u6237\u7535\u8BDD"}]),J=o=>{var l;(l=H.value.filter(n=>n.value!==o))==null||l.forEach(n=>{t.value.hasOwnProperty(n.value)&&delete t.value[n.value]})},T=async()=>{v.value=!0;try{k.value=await Se(s(t));const o=await Ie(s(t));Y.value=o.list,z.value=o.total}finally{v.value=!1}},A=async()=>{t.value.pageNo=1,await T()},W=()=>{var o;(o=B.value)==null||o.resetFields(),t.value={...G},d.value.length>0&&(t.value.pickUpStoreId=d.value[0].id),A()},d=i([]),E=i(),ee=()=>{E.value.open()},ae=async()=>{try{if(!("serial"in navigator)||navigator.serial==null||typeof navigator.serial!="object"||!("requestPort"in navigator.serial))return void h.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u626B\u7801\u67AA\u8FDE\u63A5\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668\u91CD\u8BD5");g.value=await navigator.serial.requestPort(),Z.value=await navigator.serial.getPorts(),await g.value.open({baudRate:9600,dataBits:8,stopBits:2}),h.success("\u6210\u529F\u8FDE\u63A5\u626B\u7801\u67AA"),C.value=!0,le()}catch{}},le=async()=>{V.value=g.value.readable.getReader();let o="";for(;;){const{value:l,done:n}=await V.value.read();if(n){V.value.releaseLock();break}const q=new TextDecoder().decode(l);if(o=`${o}${q}`,q.includes("\r")){let b=o.replace("\r","");o="",E.value.open(b)}}},re=async()=>{g.value!==""?(await V.value.cancel(),await g.value.close(),g.value="",h.success("\u5DF2\u6210\u529F\u65AD\u5F00\u626B\u7801\u67AA\u8FDE\u63A5"),C.value=!1):h.warning("\u8BF7\u5148\u8FDE\u63A5\u6216\u6253\u5F00\u626B\u7801\u67AA")};return ke(async()=>{if(await(async()=>{d.value=await Ne();const o=fe().getUser.id;d.value=d.value.filter(l=>{var n;return(n=l.verifyUserIds)==null?void 0:n.includes(o)})})(),d.value.length===0)return h.error("\u5F53\u524D\u767B\u5F55\u4EBA\u6CA1\u7ED1\u5B9A\u4EFB\u4F55\u81EA\u63D0\u70B9"),v.value=!1,void(U.value=!0);t.value.pickUpStoreId=d.value[0].id,U.value=!1,await T()}),(o,l)=>{const n=we,q=Fe,b=Re,M=Ee,$=Ae,te=Oe,O=me,P=je,oe=De,L=_e,D=ze,ue=Be,p=He,ie=Me,se=$e,X=be,ne=Ge,pe=ge,ce=Ue("hasPermi"),S=Ye;return u(),_(N,null,[e(n,{title:"\u3010\u4EA4\u6613\u3011\u4EA4\u6613\u8BA2\u5355",url:"https://doc.iocoder.cn/mall/trade-order/"}),e(n,{title:"\u3010\u4EA4\u6613\u3011\u8D2D\u7269\u8F66",url:"https://doc.iocoder.cn/mall/trade-cart/"}),e(L,null,{default:r(()=>[e(oe,{ref_key:"queryFormRef",ref:B,inline:!0,model:t.value,class:"-mb-15px","label-width":"68px"},{default:r(()=>[e(b,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:r(()=>[e(q,{modelValue:t.value.createTime,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-280px","end-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4","start-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),e(b,{label:"\u81EA\u63D0\u95E8\u5E97",prop:"pickUpStoreId"},{default:r(()=>[e($,{modelValue:t.value.pickUpStoreId,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.pickUpStoreId=a),class:"!w-280px",placeholder:"\u5168\u90E8",onChange:A},{default:r(()=>[(u(!0),_(N,null,R(d.value,a=>(u(),m(M,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"\u805A\u5408\u641C\u7D22"},{default:r(()=>[f(e(te,{modelValue:t.value[s(x).queryParam],"onUpdate:modelValue":l[3]||(l[3]=a=>t.value[s(x).queryParam]=a),class:"!w-280px",clearable:"",placeholder:"\u8BF7\u8F93\u5165",type:s(x).queryParam==="userId"?"number":"text"},{prepend:r(()=>[e($,{modelValue:s(x).queryParam,"onUpdate:modelValue":l[2]||(l[2]=a=>s(x).queryParam=a),class:"!w-110px",placeholder:"\u5168\u90E8",onChange:J},{default:r(()=>[(u(!0),_(N,null,R(H.value,a=>(u(),m(M,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","type"]),[[Pe,!0]])]),_:1}),e(b,null,{default:r(()=>[e(P,{onClick:A},{default:r(()=>[e(O,{class:"mr-5px",icon:"ep:search"}),l[6]||(l[6]=y(" \u641C\u7D22 "))]),_:1}),e(P,{onClick:W},{default:r(()=>[e(O,{class:"mr-5px",icon:"ep:refresh"}),l[7]||(l[7]=y(" \u91CD\u7F6E "))]),_:1}),f((u(),m(P,{onClick:ee,type:"success",plain:"",disabled:U.value},{default:r(()=>[e(O,{class:"mr-5px",icon:"ep:check"}),l[8]||(l[8]=y(" \u6838\u9500 "))]),_:1},8,["disabled"])),[[ce,["trade:order:pick-up"]]]),e(P,{type:"primary",onClick:ae,disabled:C.value||U.value},{default:r(()=>l[9]||(l[9]=[y(" \u8FDE\u63A5\u626B\u63CF\u67AA ")])),_:1},8,["disabled"]),e(P,{type:"danger",onClick:re,disabled:!C.value||U.value},{default:r(()=>l[10]||(l[10]=[y(" \u65AD\u5F00\u626B\u63CF\u67AA ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ue,{gutter:16,class:"summary"},{default:r(()=>[f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u8BA2\u5355\u6570\u91CF",icon:"icon-park-outline:transaction-order","icon-color":"bg-blue-100","icon-bg-color":"text-blue-500",value:((a=k.value)==null?void 0:a.orderCount)||0},null,8,["value"])]}),_:1})),[[S,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u8BA2\u5355\u91D1\u989D",icon:"streamline:money-cash-file-dollar-common-money-currency-cash-file","icon-color":"bg-purple-100","icon-bg-color":"text-purple-500",prefix:"\uFFE5",decimals:2,value:s(K)(((a=k.value)==null?void 0:a.orderPayPrice)||0)},null,8,["value"])]}),_:1})),[[S,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u9000\u6B3E\u5355\u6570",icon:"heroicons:receipt-refund","icon-color":"bg-yellow-100","icon-bg-color":"text-yellow-500",value:((a=k.value)==null?void 0:a.afterSaleCount)||0},null,8,["value"])]}),_:1})),[[S,v.value]]),f((u(),m(D,{sm:6,xs:12},{default:r(()=>{var a;return[e(F,{title:"\u9000\u6B3E\u91D1\u989D",icon:"ri:refund-2-line","icon-color":"bg-green-100","icon-bg-color":"text-green-500",prefix:"\uFFE5",decimals:2,value:s(K)(((a=k.value)==null?void 0:a.afterSalePrice)||0)},null,8,["value"])]}),_:1})),[[S,v.value]])]),_:1}),e(L,null,{default:r(()=>[f((u(),m(ne,{data:Y.value},{default:r(()=>[e(p,{label:"\u8BA2\u5355\u53F7",align:"center",prop:"no","min-width":"180"}),e(p,{label:"\u7528\u6237\u4FE1\u606F",align:"center",prop:"user.nickname","min-width":"80"}),e(p,{label:"\u63A8\u8350\u4EBA\u4FE1\u606F",align:"center",prop:"brokerageUser.nickname","min-width":"100"}),e(p,{label:"\u5546\u54C1\u4FE1\u606F",align:"center",prop:"spuName","min-width":"300"},{default:r(({row:a})=>[(u(!0),_(N,null,R(a.items,c=>(u(),_("div",{class:"flex items-center",key:c.id},[e(ie,{src:c.picUrl,class:"mr-10px h-30px w-30px flex-shrink-0","preview-src-list":[c.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"]),j("span",Le,w(c.spuName),1),j("div",Xe,[(u(!0),_(N,null,R(c.properties,I=>(u(),m(se,{key:I.propertyId,class:"mr-10px"},{default:r(()=>[y(w(I.propertyName)+": "+w(I.valueName),1)]),_:2},1024))),128)),j("span",null,w(s(ve)(c.price))+" \u5143 x "+w(c.count),1)])]))),128))]),_:1}),e(p,{label:"\u5B9E\u4ED8\u91D1\u989D(\u5143)",align:"center",prop:"payPrice","min-width":"110",formatter:s(Ve)},null,8,["formatter"]),e(p,{label:"\u6838\u9500\u5458",align:"center",prop:"storeStaffName","min-width":"70"}),e(p,{label:"\u6838\u9500\u95E8\u5E97",align:"center",prop:"pickUpStoreId","min-width":"80"},{default:r(({row:a})=>{var c;return[y(w((c=d.value.find(I=>I.id===a.pickUpStoreId))==null?void 0:c.name),1)]}),_:1}),e(p,{label:"\u652F\u4ED8\u72B6\u6001",align:"center",prop:"payStatus","min-width":"80"},{default:r(({row:a})=>[e(X,{type:s(Q).INFRA_BOOLEAN_STRING,value:a.payStatus||!1},null,8,["type","value"])]),_:1}),e(p,{align:"center",label:"\u8BA2\u5355\u72B6\u6001",prop:"status",width:"120"},{default:r(({row:a})=>[e(X,{type:s(Q).TRADE_ORDER_STATUS,value:a.status},null,8,["type","value"])]),_:1}),e(p,{label:"\u4E0B\u5355\u65F6\u95F4",align:"center",prop:"createTime","min-width":"170",formatter:s(Ce)},null,8,["formatter"])]),_:1},8,["data"])),[[S,v.value]]),e(pe,{limit:t.value.pageSize,"onUpdate:limit":l[4]||(l[4]=a=>t.value.pageSize=a),page:t.value.pageNo,"onUpdate:page":l[5]||(l[5]=a=>t.value.pageNo=a),total:z.value,onPagination:T},null,8,["limit","page","total"])]),_:1}),e(qe,{ref_key:"pickUpForm",ref:E,onSuccess:T},null,512)],64)}}}),[["__scopeId","data-v-37c33c0d"]]);export{Ke as default};
