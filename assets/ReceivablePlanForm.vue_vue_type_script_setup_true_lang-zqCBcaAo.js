import{e as N,D as O,b as Q,d as S,a as X}from"./index-C1TKk8vI.js";import{_ as Y}from"./Dialog.vue_vue_type_style_index_0_lang-CB5cl-Ts.js";import{b as H,c as J,u as W}from"./index-DZT3uREC.js";import{g as Z}from"./index-CZiMqbPE.js";import{a as $}from"./index-Bdw660V1.js";import{d as ee}from"./index-DdKGlDdM.js";import{K as ae,k as le,ai as re,j as de,Q as te,x as se,i as oe,l as ue,F as ne,h as ie,f as me,aj as ce}from"./form-designer-BpYekVAY.js";import{x as pe,r as i,X as fe,y as n,E as v,F as r,O as a,K as D,u as l,G as ve,z as w,a4 as I,M as g,l as be}from"./form-create-7GAbgMwl.js";const _e=pe({__name:"ReceivablePlanForm",emits:["success"],setup(Ve,{expose:F,emit:P}){const{t:U}=Q(),T=S(),x=i([]),m=i(!1),E=i(""),c=i(!1),p=i(""),t=i({}),j=fe({price:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=i(),R=i([]),h=i([]);F({open:async(o,d,f,u)=>{if(m.value=!0,E.value=U("action."+o),p.value=o,z(),d){c.value=!0;try{const s=await H(d);t.value=ae(s),await k(s.customerId),t.value.contractId=s==null?void 0:s.contractId}finally{c.value=!1}}x.value=await Z(),R.value=await $(),p.value==="create"&&(t.value.ownerUserId=X().getUser.id),f&&(t.value.customerId=f,await k(f)),u&&(t.value.contractId=u)}});const K=P,M=async()=>{if(b&&await b.value.validate()){c.value=!0;try{const o=t.value;p.value==="create"?(await J(o),T.success(U("common.createSuccess"))):(await W(o),T.success(U("common.updateSuccess"))),m.value=!1,K("success")}finally{c.value=!1}}},z=()=>{var o;t.value={},(o=b.value)==null||o.resetFields()},k=async o=>{t.value.contractId=void 0,o&&(h.value=[],h.value=await ee(o))};return(o,d)=>{const f=le,u=re,s=de,_=te,V=se,y=oe,q=ue,A=ne,B=ie,C=me,G=Y,L=ce;return n(),v(G,{modelValue:l(m),"onUpdate:modelValue":d[10]||(d[10]=e=>be(m)?m.value=e:null),title:l(E)},{footer:r(()=>[a(C,{disabled:l(c),type:"primary",onClick:M},{default:r(()=>d[11]||(d[11]=[D("\u786E \u5B9A")])),_:1},8,["disabled"]),a(C,{onClick:d[9]||(d[9]=e=>m.value=!1)},{default:r(()=>d[12]||(d[12]=[D("\u53D6 \u6D88")])),_:1})]),default:r(()=>[ve((n(),v(B,{ref_key:"formRef",ref:b,model:l(t),rules:l(j),"label-width":"110px"},{default:r(()=>[a(y,null,{default:r(()=>[a(s,{span:12},{default:r(()=>[a(u,{label:"\u8FD8\u6B3E\u671F\u6570",prop:"period"},{default:r(()=>[a(f,{modelValue:l(t).period,"onUpdate:modelValue":d[0]||(d[0]=e=>l(t).period=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(u,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:r(()=>[a(V,{modelValue:l(t).ownerUserId,"onUpdate:modelValue":d[1]||(d[1]=e=>l(t).ownerUserId=e),disabled:l(p)!=="create",class:"w-1/1"},{default:r(()=>[(n(!0),w(g,null,I(l(x),e=>(n(),v(_,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:r(()=>[a(s,{span:12},{default:r(()=>[a(u,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:r(()=>[a(V,{modelValue:l(t).customerId,"onUpdate:modelValue":d[2]||(d[2]=e=>l(t).customerId=e),disabled:l(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:k},{default:r(()=>[(n(!0),w(g,null,I(l(R),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(u,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:r(()=>[a(V,{modelValue:l(t).contractId,"onUpdate:modelValue":d[3]||(d[3]=e=>l(t).contractId=e),disabled:l(p)!=="create"||!l(t).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C"},{default:r(()=>[(n(!0),w(g,null,I(l(h),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:r(()=>[a(s,{span:12},{default:r(()=>[a(u,{label:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:r(()=>[a(q,{modelValue:l(t).price,"onUpdate:modelValue":d[4]||(d[4]=e=>l(t).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(u,{label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:r(()=>[a(A,{modelValue:l(t).returnTime,"onUpdate:modelValue":d[5]||(d[5]=e=>l(t).returnTime=e),placeholder:"\u9009\u62E9\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,null,{default:r(()=>[a(s,{span:12},{default:r(()=>[a(u,{label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays"},{default:r(()=>[a(q,{modelValue:l(t).remindDays,"onUpdate:modelValue":d[6]||(d[6]=e=>l(t).remindDays=e),class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u63D0\u524D\u51E0\u5929\u63D0\u9192"},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(u,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:r(()=>[a(V,{modelValue:l(t).returnType,"onUpdate:modelValue":d[7]||(d[7]=e=>l(t).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:r(()=>[(n(!0),w(g,null,I(l(N)(l(O).CRM_RECEIVABLE_RETURN_TYPE),e=>(n(),v(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{span:24},{default:r(()=>[a(u,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[a(f,{modelValue:l(t).remark,"onUpdate:modelValue":d[8]||(d[8]=e=>l(t).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[L,l(c)]])]),_:1},8,["modelValue","title"])}}});export{_e as _};
