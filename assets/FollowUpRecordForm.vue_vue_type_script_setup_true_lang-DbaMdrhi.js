import{V as w,a as $,d as J,h as K,D as N,X as Z,W as ee,_ as le}from"./index-DiGvuAxb.js";import{_ as ae}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{B as g}from"./index-BbXovwRQ.js";import{_ as se}from"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-CRRE-olZ.js";import{_ as oe}from"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-DnGaMf8w.js";import{_ as te}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-DjDqRBUp.js";import{_ as ue}from"./ContactListModal.vue_vue_type_script_setup_true_lang-B6rwY0dr.js";import{aj as re,i as de,j as ne,ai as ce,x as ie,Q as pe,F as me,k as fe,f as _e,h as be}from"./form-designer-drfGvdgz.js";import{k as ve,r as c,P as ye,l as x,m,G as F,H as l,u as s,h as Ue,z as o,A as we,y as v,C as h,$ as Ve,E as y}from"./form-create-D7wT855o.js";const k={getFollowUpRecordPage:async i=>await w.get({url:"/crm/follow-up-record/page",params:i}),createFollowUpRecord:async i=>await w.post({url:"/crm/follow-up-record/create",data:i}),deleteFollowUpRecord:async i=>await w.delete({url:"/crm/follow-up-record/delete?id="+i})},Re=ve({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(i,{expose:z,emit:C}){const{t:I}=$(),S=J(),p=c(!1);c("");const _=c(!1),a=c({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),E=ye({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),U=c();z({open:async(u,e)=>{p.value=!0,B(),a.value.bizType=u,a.value.bizId=e}});const M=C,q=async()=>{await U.value.validate(),_.value=!0;try{const u={...a.value,contactIds:a.value.contacts.map(e=>e.id),businessIds:a.value.businesses.map(e=>e.id)};await k.createFollowUpRecord(u),S.success(I("common.createSuccess")),p.value=!1,M("success")}finally{_.value=!1}},V=c(),O=()=>{var u;(u=V.value)==null||u.open()},P=(u,e)=>{e.forEach(r=>{a.value.contacts.some(f=>f.id===r.id)||a.value.contacts.push(r)})},R=c(),W=()=>{var u;(u=R.value)==null||u.open()},j=(u,e)=>{e.forEach(r=>{a.value.businesses.some(f=>f.id===r.id)||a.value.businesses.push(r)})},B=()=>{var u;(u=U.value)==null||u.resetFields(),a.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}};return(u,e)=>{const r=pe,f=ie,d=ce,n=ne,D=me,L=fe,Y=Z,A=ee,T=le,b=_e,G=de,H=be,Q=ae,X=re;return m(),x(F,null,[l(Q,{modelValue:s(p),"onUpdate:modelValue":e[6]||(e[6]=t=>Ue(p)?p.value=t:null),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[l(b,{disabled:s(_),type:"primary",onClick:q},{default:o(()=>e[9]||(e[9]=[y("\u786E \u5B9A")])),_:1},8,["disabled"]),l(b,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:o(()=>e[10]||(e[10]=[y("\u53D6 \u6D88")])),_:1})]),default:o(()=>[we((m(),v(H,{ref_key:"formRef",ref:U,model:s(a),rules:s(E),"label-width":"120px"},{default:o(()=>[l(G,null,{default:o(()=>[l(n,{span:12},{default:o(()=>[l(d,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[l(f,{modelValue:s(a).type,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(m(!0),x(F,null,Ve(s(K)(s(N).CRM_FOLLOW_UP_TYPE),t=>(m(),v(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(d,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[l(D,{modelValue:s(a).nextTime,"onUpdate:modelValue":e[1]||(e[1]=t=>s(a).nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:24},{default:o(()=>[l(d,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[l(L,{modelValue:s(a).content,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(d,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[l(Y,{modelValue:s(a).picUrls,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(d,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[l(A,{modelValue:s(a).fileUrls,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),s(a).bizType==s(g).CRM_CUSTOMER?(m(),v(n,{key:0,span:24},{default:o(()=>[l(d,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[l(b,{onClick:O},{default:o(()=>[l(T,{class:"mr-5px",icon:"ep:plus"}),e[7]||(e[7]=y(" \u6DFB\u52A0\u8054\u7CFB\u4EBA "))]),_:1}),l(oe,{contacts:s(a).contacts},null,8,["contacts"])]),_:1})]),_:1})):h("",!0),s(a).bizType==s(g).CRM_CUSTOMER?(m(),v(n,{key:1,span:24},{default:o(()=>[l(d,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[l(b,{onClick:W},{default:o(()=>[l(T,{class:"mr-5px",icon:"ep:plus"}),e[8]||(e[8]=y(" \u6DFB\u52A0\u5546\u673A "))]),_:1}),l(se,{businesses:s(a).businesses},null,8,["businesses"])]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1},8,["model","rules"])),[[X,s(_)]])]),_:1},8,["modelValue"]),l(ue,{ref_key:"contactTableSelectRef",ref:V,"customer-id":s(a).bizId,onSuccess:P},null,8,["customer-id"]),l(te,{ref_key:"businessTableSelectRef",ref:R,"customer-id":s(a).bizId,onSuccess:j},null,8,["customer-id"])],64)}}});export{k as F,Re as _};
