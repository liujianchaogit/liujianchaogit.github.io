import{d as C,h as U,u as q,_ as z}from"./index-C1TKk8vI.js";import{_ as D}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CXvvgLEc.js";import{K as H}from"./index-Ctuiy-PU.js";import{K as I}from"./index-D8bH8MOw.js";import{k as L,l as N,f as E,aN as F}from"./form-designer-BpYekVAY.js";import{x as M,r as K,X as O,j as R,y as d,z as c,O as n,F as m,C as a,u as s,L as o,K as k,E as T,M as S,a4 as X,H as W}from"./form-create-7GAbgMwl.js";const A={class:"flex gap-20px w-full"},B={class:"relative mb-10px"},G={class:"absolute bottom-10px right-10px text-gray-400 text-12px"},J={class:"flex items-center mb-10px"},P={class:"flex items-center mb-15px"},Q={class:"flex justify-end"},Y={key:1,class:"font-bold mb-15px"},Z={class:"flex justify-between text-12px text-gray-500 mb-5px"},$={class:"px-8px py-4px bg-blue-50 text-blue-500 rounded-full text-12px font-bold"},ee={class:"flex justify-between items-center"},ae={class:"flex items-center text-gray-500 text-13px"},le=M({name:"KnowledgeDocumentRetrieval",__name:"index",setup(te){const u=C(),y=U(),V=q(),x=K(!1),r=K([]),l=O({id:void 0,content:"",topK:10,similarityThreshold:.5}),_=async()=>{if(l.content){x.value=!0,r.value=[];try{const p=await H.searchKnowledgeSegment({knowledgeId:l.id,content:l.content,topK:l.topK,similarityThreshold:l.similarityThreshold});r.value=p||[]}catch{}finally{x.value=!1}}else u.warning("\u8BF7\u8F93\u5165\u67E5\u8BE2\u6587\u672C")};return R(()=>{if(!y.query.id)return u.error("\u77E5\u8BC6\u5E93 ID \u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u8FDB\u884C\u53EC\u56DE\u6D4B\u8BD5"),void V.back();l.id=y.query.id,(async p=>{try{const e=await I.getKnowledge(p);e&&(l.topK=e.topK||l.topK,l.similarityThreshold=e.similarityThreshold||l.similarityThreshold)}catch{}})(l.id)}),(p,e)=>{const j=L,f=N,h=E,g=D,v=F,b=z;return d(),c("div",A,[n(g,{class:"flex-1 min-w-300px"},{default:m(()=>{var t;return[e[6]||(e[6]=a("div",{class:"mb-15px"},[a("h3",{class:"m-0 mb-5px"},"\u53EC\u56DE\u6D4B\u8BD5"),a("div",{class:"text-gray-500 text-14px"},"\u6839\u636E\u7ED9\u5B9A\u7684\u67E5\u8BE2\u6587\u672C\u6D4B\u8BD5\u53EC\u56DE\u6548\u679C\u3002")],-1)),a("div",null,[a("div",B,[n(j,{modelValue:s(l).content,"onUpdate:modelValue":e[0]||(e[0]=i=>s(l).content=i),type:"textarea",rows:8,placeholder:"\u8BF7\u8F93\u5165\u6587\u672C"},null,8,["modelValue"]),a("div",G,o((t=s(l).content)==null?void 0:t.length)+" / 200 ",1)]),a("div",J,[e[3]||(e[3]=a("span",{class:"w-60px text-gray-500"},"topK:",-1)),n(f,{modelValue:s(l).topK,"onUpdate:modelValue":e[1]||(e[1]=i=>s(l).topK=i),min:1,max:20},null,8,["modelValue"])]),a("div",P,[e[4]||(e[4]=a("span",{class:"w-60px text-gray-500"},"\u76F8\u4F3C\u5EA6:",-1)),n(f,{modelValue:s(l).similarityThreshold,"onUpdate:modelValue":e[2]||(e[2]=i=>s(l).similarityThreshold=i),min:0,max:1,precision:2,step:.01},null,8,["modelValue"])]),a("div",Q,[n(h,{type:"primary",onClick:_,loading:s(x)},{default:m(()=>e[5]||(e[5]=[k("\u6D4B\u8BD5")])),_:1},8,["loading"])])])]}),_:1}),n(g,{class:"flex-1 min-w-300px"},{default:m(()=>[s(x)?(d(),T(v,{key:0,description:"\u6B63\u5728\u68C0\u7D22\u4E2D..."})):s(r).length>0?(d(),c("div",Y,o(s(r).length)+" \u4E2A\u53EC\u56DE\u6BB5\u843D ",1)):(d(),T(v,{key:2,description:"\u6682\u65E0\u53EC\u56DE\u7ED3\u679C"})),a("div",null,[(d(!0),c(S,null,X(s(r),(t,i)=>(d(),c("div",{key:i,class:"mb-20px border border-solid border-gray-200 rounded p-15px"},[a("div",Z,[a("span",null," \u5206\u6BB5("+o(t.id)+") \xB7 "+o(t.contentLength)+" \u5B57\u7B26\u6570 \xB7 "+o(t.tokens)+" Token ",1),a("span",$," score: "+o(t.score),1)]),a("div",{class:W(["bg-gray-50 p-10px rounded mb-10px whitespace-pre-wrap overflow-hidden transition-all duration-100 text-13px",{"line-clamp-2 max-h-50px":!t.expanded,"max-h-500px":t.expanded}])},o(t.content),3),a("div",ee,[a("div",ae,[n(b,{icon:"ep:document",class:"mr-5px"}),a("span",null,o(t.documentName||"\u672A\u77E5\u6587\u6863"),1)]),n(h,{size:"small",onClick:se=>(w=>{w.expanded=!w.expanded})(t)},{default:m(()=>[k(o(t.expanded?"\u6536\u8D77":"\u5C55\u5F00")+" ",1),n(b,{icon:t.expanded?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:2},1032,["onClick"])])]))),128))])]),_:1})])}}});export{le as default};
