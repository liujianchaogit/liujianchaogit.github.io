import{a as N,d as T,F as q,E as B}from"./index-DiGvuAxb.js";import{_ as J}from"./Dialog.vue_vue_type_style_index_0_lang-WG3ZquOK.js";import{_ as O}from"./Form-DPrhcGPo.js";import{_ as Q}from"./SpuSelect.vue_vue_type_script_setup_true_lang-DkLYCAtq.js";import{_ as W}from"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-D_wn1iMC.js";import{r as F}from"./formRules-D4RhDYOS.js";import{u as X}from"./useCrudSchemas-Ds58i6kJ.js";import{P as R,k as Z,r as c,l as Y,m as h,G as $,H as l,u,h as ee,z as n,A as oe,y as x,C as ae,E as C,n as te}from"./form-create-D7wT855o.js";import{P as b}from"./index-aXvHl0SS.js";import{b as le}from"./spu-CLGmBlok.js";import{g as se}from"./index-BTEYh4my.js";import{f as ie,_ as ue,l as re,aj as ne,K as ce}from"./form-designer-drfGvdgz.js";const pe=R({spuId:[F],sort:[F]}),de=R([{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79EF\u5206\u5546\u57CE\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:me}=X(de),fe=Z({name:"PromotionSeckillActivityForm",__name:"PointActivityForm",emits:["success"],setup(ve,{expose:D,emit:L}){const{t:y}=N(),S=T(),m=c(!1),I=c(""),f=c(!1),P=c(""),d=c(),V=c(!1),U=c(),A=c(),j=[{name:"productConfig.stock",rule:a=>a>=1,message:"\u5546\u54C1\u53EF\u5151\u6362\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.point",rule:a=>a>=1,message:"\u5546\u54C1\u6240\u9700\u5151\u6362\u79EF\u5206\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.count",rule:a=>a>=1,message:"\u5546\u54C1\u53EF\u5151\u6362\u6B21\u6570\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"}],g=c([]),_=c([]),z=(a,e)=>{d.value.setValues({spuId:a}),E(a,e)},E=async(a,e,s)=>{var w;const i=[],p=await le([a]);if(p.length==0)return;g.value=[];const t=p[0],v=e===void 0?t==null?void 0:t.skus:(w=t==null?void 0:t.skus)==null?void 0:w.filter(o=>e.includes(o.id));v==null||v.forEach(o=>{let r={skuId:o.id,stock:0,price:0,point:0,count:0};if(s!==void 0){const k=s.find(M=>M.skuId===o.id);k&&(k.price=B(k.price)),r=k||r}o.productConfig=r}),t.skus=v,i.push({spuId:t.id,spuDetail:t,propertyList:se(t)}),g.value.push(t),_.value=i};D({open:async(a,e)=>{var s;if(m.value=!0,I.value=y("action."+a),P.value=a,await K(),e){f.value=!0;try{const i=await b.getPointActivity(e);V.value=!0,await E(i.spuId,(s=i.products)==null?void 0:s.map(p=>p.skuId),i.products),d.value.setValues(i)}finally{f.value=!1}}}});const G=L,H=async()=>{if(d&&await d.value.getElFormRef().validate()){f.value=!0;try{const a=ce(A.value.getSkuConfigs("productConfig"));a.forEach(s=>{s.price=q(s.price)});const e=d.value.formModel;e.products=a,P.value==="create"?(await b.createPointActivity(e),S.success(y("common.createSuccess"))):(await b.updatePointActivity(e),S.success(y("common.updateSuccess"))),m.value=!1,G("success")}finally{f.value=!1}}},K=async()=>{g.value=[],_.value=[],V.value=!1,await te(),d.value.getElFormRef().resetFields()};return(a,e)=>{const s=ie,i=re,p=ue,t=O,v=J,w=ne;return h(),Y($,null,[l(v,{modelValue:u(m),"onUpdate:modelValue":e[2]||(e[2]=o=>ee(m)?m.value=o:null),title:u(I),width:"65%"},{footer:n(()=>[l(s,{disabled:u(f),type:"primary",onClick:H},{default:n(()=>e[4]||(e[4]=[C("\u786E \u5B9A")])),_:1},8,["disabled"]),l(s,{onClick:e[1]||(e[1]=o=>m.value=!1)},{default:n(()=>e[5]||(e[5]=[C("\u53D6 \u6D88")])),_:1})]),default:n(()=>[oe((h(),x(t,{ref_key:"formRef",ref:d,isCol:!0,rules:u(pe),schema:u(me).formSchema},{spuId:n(()=>[u(V)?ae("",!0):(h(),x(s,{key:0,onClick:e[0]||(e[0]=o=>u(U).open())},{default:n(()=>e[3]||(e[3]=[C("\u9009\u62E9\u5546\u54C1")])),_:1})),l(u(W),{ref_key:"spuAndSkuListRef",ref:A,"rule-config":j,"spu-list":u(g),"spu-property-list-p":u(_)},{default:n(()=>[l(p,{align:"center",label:"\u53EF\u5151\u6362\u5E93\u5B58","min-width":"168"},{default:n(({row:o})=>[l(i,{modelValue:o.productConfig.stock,"onUpdate:modelValue":r=>o.productConfig.stock=r,max:o.stock,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),l(p,{align:"center",label:"\u53EF\u5151\u6362\u6B21\u6570","min-width":"168"},{default:n(({row:o})=>[l(i,{modelValue:o.productConfig.count,"onUpdate:modelValue":r=>o.productConfig.count=r,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{align:"center",label:"\u6240\u9700\u79EF\u5206","min-width":"168"},{default:n(({row:o})=>[l(i,{modelValue:o.productConfig.point,"onUpdate:modelValue":r=>o.productConfig.point=r,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{align:"center",label:"\u6240\u9700\u91D1\u989D(\u5143)","min-width":"168"},{default:n(({row:o})=>[l(i,{modelValue:o.productConfig.price,"onUpdate:modelValue":r=>o.productConfig.price=r,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[w,u(f)]])]),_:1},8,["modelValue","title"]),l(u(Q),{ref_key:"spuSelectRef",ref:U,isSelectSku:!0,onConfirm:z},null,512)],64)}}});export{fe as _};
